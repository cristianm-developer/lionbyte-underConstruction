"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{1578:(e,t,i)=>{i.r(t),i.d(t,{msdfVertexShader:()=>a});var s=i(52019);let r="msdfVertexShader",o=`#define BILLBOARD 1
#define BILLBOARDSCREENPROJECTED 2
attribute vec2 offsets;attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;attribute vec4 uvs;uniform mat4 transform;uniform mat4 parentWorld;uniform mat4 view;uniform mat4 projection;uniform vec3 center;uniform int mode;varying vec2 atlasUV;void main(void) {mat4 world=mat4(world0,world1,world2,world3);vec4 worldPos=transform*(world*vec4(offsets.xy-vec2(0.5,0.5),0.,1.0));if (mode>=BILLBOARD) {vec3 viewPos=(view*parentWorld*vec4(0.,0.,0.,1.0)).xyz; 
if (mode==BILLBOARDSCREENPROJECTED) {viewPos.x/=viewPos.z;viewPos.y/=viewPos.z;viewPos.z=1.0;}
gl_Position=projection*vec4(viewPos+worldPos.xyz,1.0); } else {vec3 viewPos=(view*parentWorld*worldPos).xyz; 
gl_Position=projection*vec4(viewPos,1.0); }
atlasUV=vec2(uvs.x+offsets.x*uvs.z,uvs.y+(1.0-offsets.y)*uvs.w);}`;s.l.ShadersStore[r]||(s.l.ShadersStore[r]=o);let a={name:r,shader:o}},5409:(e,t,i)=>{i.r(t),i.d(t,{DefaultParagraphOptions:()=>k,FitStrategy:()=>F,FontAsset:()=>D,HtmlMesh:()=>L,HtmlMeshRenderer:()=>_,PointerEventsCaptureBehavior:()=>A,SdfTextParagraph:()=>W,TextRenderer:()=>H,msdfPixelShader:()=>X.msdfPixelShader,msdfPixelShaderWGSL:()=>q.msdfPixelShaderWGSL,msdfVertexShader:()=>K.msdfVertexShader,msdfVertexShaderWGSL:()=>Y.msdfVertexShaderWGSL});var s,r=i(67840),o=i(40917),a=i(68341),n=i(43048),l=i(77905);let h=e=>(t,i)=>{let s=t.getMesh(),r=i.getMesh(),o=s.isHtmlMesh,a=r.isHtmlMesh;return o?a&&s.absolutePosition.z<=r.absolutePosition.z?1:-1:a?1:e(t,i)};class _{constructor(e,{parentContainerId:t=null,_containerId:i="css-container",enableOverlayRender:s=!0,defaultOpaqueRenderOrder:o=a.U.PainterSortCompare,defaultAlphaTestRenderOrder:n=a.U.PainterSortCompare,defaultTransparentRenderOrder:l=a.U.defaultTransparentSortCompare}={}){if(this._cache={cameraData:{fov:0,position:new r.Pq,style:""},htmlMeshData:new WeakMap},this._width=0,this._height=0,this._heightHalf=0,this._temp={scaleTransform:new r.Pq,rotationTransform:new r.PT,positionTransform:new r.Pq,objectMatrix:r.uq.Identity(),cameraWorldMatrix:r.uq.Identity(),cameraRotationMatrix:r.uq.Identity(),cameraWorldMatrixAsArray:Array(16)},this._lastDevicePixelRatio=window.devicePixelRatio,this._cameraMatrixUpdated=!0,this._previousCanvasDocumentPosition={top:0,left:0},this._renderObserver=null,this._onCameraMatrixChanged=e=>{this._cameraWorldMatrix=e.getWorldMatrix(),this._cameraMatrixUpdated=!0},"undefined"==typeof document)return;this._containerId=i,this._init(e,t,s,o,n,l)}dispose(){this._renderObserver&&(this._renderObserver.remove(),this._renderObserver=null),this._overlayElements?.container.remove(),this._overlayElements=null,this._inSceneElements?.container.remove(),this._inSceneElements=null}_init(e,t,i,s,r,o){let a,n;if("undefined"==typeof document)return;let l=t?document.getElementById(t):document.body;l||(l=document.body);let _=`${this._containerId}_in_scene`;if(this._inSceneElements=this._createRenderLayerElements(_),l.insertBefore(this._inSceneElements.container,l.firstChild),i){let t=`${this._containerId}_overlay`;this._overlayElements=this._createRenderLayerElements(t);let i=+(e.getEngine().getRenderingCanvas().style.zIndex??"0")+1;this._overlayElements.container.style.zIndex=`${i}`,this._overlayElements.container.style.pointerEvents="none",l.insertBefore(this._overlayElements.container,l.firstChild)}this._engine=e.getEngine();let d=this._engine.getRenderingCanvasClientRect();if(!d)throw Error("Failed to get client rect for rendering canvas");this._setSize(d.width,d.height),this._engine.onResizeObservable.add(()=>{let e=this._engine.getRenderingCanvasClientRect();e&&this._setSize(e.width,e.height)});let c=()=>{let t=e.activeCamera;t&&(a=t.onProjectionMatrixChangedObservable.add(()=>{this._onCameraMatrixChanged(t)}),n=t.onViewMatrixChangedObservable.add(()=>{this._onCameraMatrixChanged(t)}))};c(),e.onActiveCameraChanged.add(()=>{a&&e.activeCamera?.onProjectionMatrixChangedObservable.remove(a),n&&e.activeCamera?.onViewMatrixChangedObservable.remove(n),c()});let u=h(s),f=h(r),g=h(o);e.setRenderingOrder(0,u,f,g),this._renderObserver=e.onBeforeRenderObservable.add(()=>{this._render(e,e.activeCamera)})}_createRenderLayerElements(e){let t=document.getElementById(e);t&&t.remove();let i=document.createElement("div");i.id=e,i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.zIndex="-1";let s=document.createElement("div");s.style.overflow="hidden";let r=document.createElement("div");return r.style.webkitTransformStyle="preserve-3d",r.style.transformStyle="preserve-3d",r.style.pointerEvents="none",s.appendChild(r),i.appendChild(s),{container:i,domElement:s,cameraElement:r}}_getSize(){return{width:this._width,height:this._height}}_setSize(e,t){if(this._width=e,this._height=t,this._heightHalf=this._height/2,this._inSceneElements&&this._overlayElements)for(let i of[this._inSceneElements.domElement,this._overlayElements.domElement,this._inSceneElements.cameraElement,this._overlayElements.cameraElement])i&&(i.style.width=`${e}px`,i.style.height=`${t}px`)}_getCameraCssMatrix(e){let t=e.m;return`matrix3d(${this._epsilon(t[0])},${this._epsilon(-t[1])},${this._epsilon(t[2])},${this._epsilon(t[3])},${this._epsilon(t[4])},${this._epsilon(-t[5])},${this._epsilon(t[6])},${this._epsilon(t[7])},${this._epsilon(t[8])},${this._epsilon(-t[9])},${this._epsilon(t[10])},${this._epsilon(t[11])},${this._epsilon(t[12])},${this._epsilon(-t[13])},${this._epsilon(t[14])},${this._epsilon(t[15])})`}_getHtmlContentCssMatrix(e,t){let i=e.m,s=t?-1:1;return`matrix3d(${this._epsilon(i[0])},${this._epsilon(i[1])},${this._epsilon(-(i[2]*s))},${this._epsilon(i[3])},${this._epsilon(-i[4])},${this._epsilon(-i[5])},${this._epsilon(i[6]*s)},${this._epsilon(-i[7])},${this._epsilon(-(i[8]*s))},${this._epsilon(-(i[9]*s))},${this._epsilon(i[10])},${this._epsilon(i[11]*s)},${this._epsilon(i[12]*s)},${this._epsilon(i[13]*s)},${this._epsilon(i[14]*s)},${this._epsilon(i[15])})`}_getTransformationMatrix(e,t){if(this._cameraWorldMatrix||(this._cameraWorldMatrix=e.getScene().activeCamera?.getWorldMatrix()),!this._cameraWorldMatrix)return r.uq.Identity();let i=e.getWorldMatrix(),s=1,o=1;e.sourceWidth&&e.sourceHeight&&(s=e.width/(e.sourceWidth/100),o=e.height/(e.sourceHeight/100));let a=this._temp.scaleTransform,n=this._temp.rotationTransform,l=this._temp.positionTransform,h=this._temp.objectMatrix;i.decompose(a,n,l),a.x*=s,a.y*=o,r.uq.ComposeToRef(a,n,l,h);let d=t?-1:1,c=e.getAbsolutePosition();return h.setRowFromFloats(3,(-this._cameraWorldMatrix.m[12]+c.x)*100*d,(-this._cameraWorldMatrix.m[13]+c.y)*100*d,(this._cameraWorldMatrix.m[14]-c.z)*100,this._cameraWorldMatrix.m[15]*_.PROJECTION_SCALE_FACTOR*100),h.multiplyAtIndex(3,100),h.multiplyAtIndex(7,100),h.multiplyAtIndex(11,100),h}_renderHtmlMesh(e,t){if(!e.element||!e.element.firstElementChild)return;let i=this._cache.htmlMeshData.get(e);i||(i={style:""},this._cache.htmlMeshData.set(e,i));let s=e._isCanvasOverlay?this._overlayElements?.cameraElement:this._inSceneElements?.cameraElement;e.element.parentNode!==s&&s.appendChild(e.element),e.requiresUpdate&&this._updateBaseScaleFactor(e);let r=this._getTransformationMatrix(e,t),o=`translate(-50%, -50%) ${this._getHtmlContentCssMatrix(r,t)}`;o+=`${t?`matrix3d(${e.billboardMode!==l.V.BILLBOARDMODE_NONE?1:-1}, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)`:""}`,i.style!==o&&(e.element.style.webkitTransform=o,e.element.style.transform=o),e._markAsUpdated()}_render(e,t){let i=!1,s=e.useRightHandedSystem;this._updateContainerPositionIfNeeded(),this._cameraMatrixUpdated&&(this._cameraMatrixUpdated=!1,i=!0),(t.position.x!==this._cache.cameraData.position.x||t.position.y!==this._cache.cameraData.position.y||t.position.z!==this._cache.cameraData.position.z)&&(this._cache.cameraData.position.copyFrom(t.position),i=!0),window.devicePixelRatio!==this._lastDevicePixelRatio&&(this._lastDevicePixelRatio=window.devicePixelRatio,n.V.Log("In render - dpr changed: ",this._lastDevicePixelRatio),i=!0);let a=e.meshes.filter(e=>e.isHtmlMesh&&(i||e.requiresUpdate));if(!(i=i||a.length>0))return;let l=t.getProjectionMatrix().m[5]*this._heightHalf;if(this._cache.cameraData.fov!==l){let e=[this._overlayElements?.domElement,this._inSceneElements?.domElement];if(t.mode==o.i.PERSPECTIVE_CAMERA)for(let t of e)t&&(t.style.webkitPerspective=l+"px",t.style.perspective=l+"px");else for(let t of e)t&&(t.style.webkitPerspective="",t.style.perspective="");this._cache.cameraData.fov=l}null===t.parent&&t.computeWorldMatrix();let h=this._temp.cameraWorldMatrix;h.copyFrom(t.getWorldMatrix());let _=this._temp.cameraRotationMatrix;h.getRotationMatrix().transposeToRef(_);let d=this._temp.cameraWorldMatrixAsArray;h.copyToArray(d);let c=s?1:-1;d[1]=_.m[1],d[2]=_.m[2]*c,d[4]=_.m[4]*c,d[6]=_.m[6]*c,d[8]=_.m[8]*c,d[9]=_.m[9]*c,r.uq.FromArrayToRef(d,0,h);let u=this._getCameraCssMatrix(h);if(this._cache.cameraData.style!==u){for(let e of[this._inSceneElements?.cameraElement,this._overlayElements?.cameraElement])e&&(e.style.webkitTransform=u,e.style.transform=u);this._cache.cameraData.style=u}for(let e of a)this._renderHtmlMesh(e,s)}_updateBaseScaleFactor(e){let t=this._width,i=this._height,s=(e.width||1)/(e.height||1);s>t/i?t=i*s:i=t/s,e.setContentSizePx(t,i)}_updateContainerPositionIfNeeded(){let e=this._engine.getRenderingCanvasClientRect();if(!e)return void n.V.Warn("Failed to update html mesh renderer position due to failure to get canvas rect.  HtmlMesh instances may not render correctly");let t=window.scrollY,i=window.scrollX,s=e.top+t,r=e.left+i;if(this._previousCanvasDocumentPosition.top!==s||this._previousCanvasDocumentPosition.left!==r)for(let e of(this._previousCanvasDocumentPosition.top=s,this._previousCanvasDocumentPosition.left=r,[this._inSceneElements?.container,this._overlayElements?.container])){if(!e)continue;let o=e.offsetParent,a=o.getBoundingClientRect(),n=a.top+t,l=a.left+i,h=this._getAncestorMarginsAndPadding(o),_=window.getComputedStyle(document.body),d=parseInt(_.marginTop,10),c=parseInt(_.marginLeft,10);e.style.top=`${s-n-h.marginTop+h.paddingTop+d}px`,e.style.left=`${r-l-h.marginLeft+h.paddingLeft+c}px`}}_epsilon(e){return 1e-10>Math.abs(e)?0:e}_getAncestorMarginsAndPadding(e){let t=0,i=0,s=0,r=0;for(;e&&e!==document.body&&e!==document.documentElement;){let o=window.getComputedStyle(e);t+=parseInt(o.marginTop,10),i+=parseInt(o.marginLeft,10),s+=parseInt(o.paddingTop,10),r+=parseInt(o.paddingLeft,10),e=e.offsetParent}return{marginTop:t,marginLeft:i,paddingTop:s,paddingLeft:r}}}_.PROJECTION_SCALE_FACTOR=1e-5;var d=i(29218),c=i(65049),u=i(78684),f=i(81631);let g=[],m=new Map,p=[],v=null,b=e=>{P(`In pointerEventsCapture.requestRelease - Pointer events release requested for ${e}`),e&&e!==v?x(e)?m.delete(e):(P(`In pointerEventsCapture.requestRelease - Received release request ${e} but no matching capture request was received`),p.includes(e)||p.push(e)):C()},x=e=>{let t=!1;return g=g.filter(i=>i!==e||(t=!0,P(`In pointerEventsCapture.cancelRequest - Canceling pointer events capture request ${e}`),!1)),t},C=()=>{let e=S();P(`In pointerEventsCapture.transferPointerEventsOwnership - Transferrring pointer events from ${v} to ${e}`),T(),e&&y(e)},T=()=>{P(`In pointerEventsCapture.doRelease - Releasing pointer events from ${v}`),v&&(m.get(v)?.release(),m.delete(v),v=null)},y=e=>{e&&m.get(e)?.capture(),v=e,P(`In pointerEventsCapture.doCapture - Pointer events now captured by ${e}`)},S=()=>g.length>0?g.shift():null,P=e=>{("undefined"==typeof window||window["pointer-events-capture-debug"])&&f.S0.Log(`${performance.now()} - game.scene.pointerEvents - ${e}
currentOwner: ${v}
queue: ${g}
unmatched: ${p}`)},I=null,E=0,R=new WeakMap,M=e=>{"undefined"!=typeof document&&(0===E&&(document.addEventListener("pointermove",B),document.addEventListener("touchstart",B),I=I??e,n.V.Log("PointerEventsCaptureBehavior: Starting observation of pointer move events."),I.onDisposeObservable.add(w)),E++)},w=()=>{document.removeEventListener("pointermove",B),document.removeEventListener("touchstart",B),I=null,n.V.Log("PointerEventsCaptureBehavior: Stopping observation of pointer move events."),E=0},O=()=>{"undefined"!=typeof document&&I&&--E<=0&&w()},B=e=>{let t;if(!I)return;let i=I.getEngine().getRenderingCanvasClientRect();if(!i)return;let{clientX:s,clientY:r}="touches"in e?e.touches[0]:e,o=s-i.left,a=r-i.top,n=I.pick(o,a,e=>{let t=R.get(e);return e.isEnabled()&&void 0!==t&&t._captureOnPointerEnter});t=n.hit?n.pickedMesh:null;let l=parseInt(v||"");(!t||t.uniqueId!==l)&&(l&&(!t||t.uniqueId!==l)&&b(v),t&&R.get(t).capturePointerEvents())};class A{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh=e}constructor(e,t,{captureOnPointerEnter:i=!0}={}){this._captureCallback=e,this._releaseCallback=t,this.name="PointerEventsCaptureBehavior",this._attachedMesh=null,this._captureOnPointerEnter=i,"undefined"==typeof document&&n.V.Warn("Creating an instance of PointerEventsCaptureBehavior outside of a browser.  The behavior will not work.")}set captureOnPointerEnter(e){this._captureOnPointerEnter!==e&&(this._captureOnPointerEnter=e,this._attachedMesh&&(this._captureOnPointerEnter?M(this._attachedMesh.getScene()):O()))}init(){}attach(e){this.attachedMesh=e,R.set(e,this),this._captureOnPointerEnter&&M(e.getScene())}detach(){this.attachedMesh&&(R.delete(this.attachedMesh),this._captureOnPointerEnter&&O(),this.attachedMesh=null)}dispose(){this.detach()}releasePointerEvents(){this.attachedMesh&&b(this.attachedMesh.uniqueId.toString())}capturePointerEvents(){this.attachedMesh&&((e,t,i)=>{var s,r,o,a;let n;if(P(`In pointerEventsCapture.requestCapture - Pointer events capture requested for ${e}`),s=e,n=!1,p=p.filter(e=>e!==s||(n=!0,!1)),n)return P(`In pointerEventsCapture.requestCapture - Capture request matched previous release request ${e}.  Cancelling capture request`);e!==v&&(r=e,o=t,a=i,P(`In pointerEventsCapture.enqueueCaptureRequest - Enqueueing capture request for  ${r}`),g.includes(r)||(g.push(r),m.set(r,{capture:o,release:a}))),v||C()})(this.attachedMesh.uniqueId.toString(),this._captureCallback,this._releaseCallback)}}let F={CONTAIN:{wrapElement(e){let t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center";let i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize(e,t,i){let s=e.firstElementChild;e.style.width=`${t}px`,e.style.height=`${i}px`;let[r,o]=[s.offsetWidth,s.offsetHeight],a=Math.min(t/r,i/o);s.style.transform=`scale(${a})`,s.style.visibility="visible"}},COVER:{wrapElement(e){let t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.overflow="hidden";let i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize(e,t,i){let s=e.firstElementChild;e.style.width=`${t}px`,e.style.height=`${i}px`;let[r,o]=[s.offsetWidth,s.offsetHeight],a=Math.max(t/r,i/o);s.style.transform=`scale(${a})`,s.style.visibility="visible"}},STRETCH:{wrapElement(e){let t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center";let i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize(e,t,i){let s=e.firstElementChild;e.style.width=`${t}px`,e.style.height=`${i}px`;let[r,o]=[s.offsetWidth,s.offsetHeight];s.style.transform=`scale(${t/r}, ${i/o})`,s.style.visibility="visible"}},NONE:{wrapElement:e=>e,updateSize(e,t,i){e&&(e.style.width=`${t}px`,e.style.height=`${i}px`)}}};class L extends d.e{get isHtmlMesh(){return!0}get sourceWidth(){return this._sourceWidth}get sourceHeight(){return this._sourceHeight}constructor(e,t,{captureOnPointerEnter:i=!0,isCanvasOverlay:s=!1,fitStrategy:r=F.NONE}={}){if(super(t,e),this._enabled=!1,this._ready=!1,this._isCanvasOverlay=!1,this._requiresUpdate=!0,this._inverseScaleMatrix=null,this._captureOnPointerEnter=!0,this._pointerEventCaptureBehavior=null,this._sourceWidth=null,this._sourceHeight=null,this._fitStrategy=F.NONE,"undefined"==typeof document)return void n.V.Warn(`Creating an instance of an HtmlMesh with id ${t} outside of a browser.  The mesh will not be visible.`);this._fitStrategy=r,this._isCanvasOverlay=s,this._createMask(),this._element=this._createElement(),this.setEnabled(!0),this._captureOnPointerEnter=i,this._pointerEventCaptureBehavior=new A(this.capturePointerEvents.bind(this),this.releasePointerEvents.bind(this),{captureOnPointerEnter:this._captureOnPointerEnter}),this.addBehavior(this._pointerEventCaptureBehavior)}get width(){return this._width}get height(){return this._height}get element(){return this._element}get requiresUpdate(){return this._requiresUpdate}set captureOnPointerEnter(e){this._captureOnPointerEnter=e,this._pointerEventCaptureBehavior&&(this._pointerEventCaptureBehavior.captureOnPointerEnter=e)}dispose(){super.dispose(),this._element?.remove(),this._element=void 0,this._pointerEventCaptureBehavior&&(this._pointerEventCaptureBehavior.dispose(),this._pointerEventCaptureBehavior=null)}_markAsUpdated(){this._requiresUpdate=!1}setContent(e,t,i){this._setAsReady(!1),this._sourceWidth=null,this._sourceHeight=null,this._element&&(this._width=t,this._height=i,this._requiresUpdate=!0,this.scaling.setAll(1),e&&(this._element.appendChild(this._fitStrategy.wrapElement(e)),this._updateScaleIfNecessary()),this.sourceWidth&&this.sourceHeight&&this._setAsReady(!0))}setEnabled(e){this._enabled=e,(!e||this._ready)&&this._doSetEnabled(e)}setContentSizePx(e,t){this._sourceWidth=e,this._sourceHeight=t,this._element&&this._element.firstElementChild&&(this._fitStrategy.updateSize(this._element.firstElementChild,e,t),this._updateScaleIfNecessary(),this.width&&this.height&&this._setAsReady(!0))}_setAsReady(e){this._ready=e,e?this._doSetEnabled(this._enabled):this._doSetEnabled(!1)}_doSetEnabled(e){this._element&&(e&&!this._worldMatrixUpdateObserver?this._worldMatrixUpdateObserver=this.onAfterWorldMatrixUpdateObservable.add(()=>{this._requiresUpdate=!0}):e||(this._worldMatrixUpdateObserver?.remove(),this._worldMatrixUpdateObserver=null),this._element.style.display=e?"":"none",this._setElementzIndex(-1e4*this.position.z),super.setEnabled(e))}_updateScaleIfNecessary(){this.scaling.setAll(1),this._inverseScaleMatrix&&(this.bakeTransformIntoVertices(this._inverseScaleMatrix),this._inverseScaleMatrix=null);let e=this._width||1,t=this._height||1,i=r.uq.Scaling(e,t,1);this.bakeTransformIntoVertices(i),this._inverseScaleMatrix=new r.uq,i.invertToRef(this._inverseScaleMatrix)}_createMask(){(0,c.LG)({width:1,height:1}).applyToMesh(this);let e=this.getScene();this.checkCollisions=!0;let t=new u.F(`${this.id}-mat`,e);this._isCanvasOverlay||(t.backFaceCulling=!1,t.disableColorWrite=!0,t.disableLighting=!0),this.material=t,this.material.freeze()}_setElementzIndex(e){this._element&&(this._element.style.zIndex=`${e}`)}capturePointerEvents(){this._element&&(this._element.style.pointerEvents="auto",document.getElementsByTagName("body")[0].style.pointerEvents="none")}releasePointerEvents(){this._element&&(document.getElementsByTagName("body")[0].style.pointerEvents="auto",this._element.style.pointerEvents="none")}_createElement(){if("undefined"==typeof document)return;let e=document.createElement("div");return e.id=this.id,e.style.backgroundColor=this._isCanvasOverlay?"transparent":"#000",e.style.zIndex="1",e.style.position="absolute",e.style.pointerEvents="none",e.style.backfaceVisibility="hidden",e}}var N=i(75200);!function(e){e[e.SPACE=32]="SPACE",e[e.TOFU=65532]="TOFU"}(s||(s={}));class D{constructor(e,t,i){this._chars=new Map,this._kernings=new Map,this._font=JSON.parse(e),this._font.pages=[t],this._font.chars.forEach(e=>this._chars.set(e.id,e)),this._font.kernings.forEach(e=>{let t=this._kernings.get(e.first);t||(t=new Map,this._kernings.set(e.first,t)),t.set(e.second,e.amount)}),this._charsRegex=RegExp(`[${this._font.chars.map(e=>e.char.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")).join("")}]`,"g"),this._updateFallbacks(),this.scale=1/this._font.info.size,this.textures=this._font.pages.map(e=>{let t=new N.g(e,i,{noMipmap:!1,invertY:!1});return t.anisotropicFilteringLevel=16,t})}dispose(){for(let e of this.textures)e.dispose();this.textures.length=0}_updateFallbacks(){this._chars.has(s.SPACE)||this._chars.set(s.SPACE,{id:s.SPACE,x:0,y:0,width:0,height:0,xoffset:0,yoffset:0,xadvance:.5*this._font.info.size,page:-1,chnl:-1,index:-1,char:" "}),this._chars.has(s.TOFU)||this._chars.set(s.TOFU,{id:s.TOFU,x:0,y:0,width:this._font.info.size,height:this._font.info.size,xoffset:0,yoffset:0,xadvance:.5*this._font.info.size,page:-1,chnl:-1,index:-1,char:"￿"})}_getChar(e){return this._chars.get(e)||this._chars.get(s.TOFU)}_getKerning(e,t){return this._kernings.get(e)?.get(t)||0}_unsupportedChars(e){return e.replace(this._charsRegex,"")}}let k={maxWidth:1/0,lineHeight:1,letterSpacing:1,tabSize:4,whiteSpace:"pre-line",textAlign:"center",translate:{x:-.5,y:-.5}};var V=i(77633),U=i(72500),z=i(84093);class W{get lineHeight(){return this.fontAsset._font.common.lineHeight*this.options.lineHeight}constructor(e,t,i){this.text=e,this.fontAsset=t,this.options={...k,...i};let{paragraph:s,lines:r,glyphs:o,width:a,height:n}=this._computeMetrics(e);this.paragraph=s,this.lines=r,this.glyphs=o,this.width=a,this.height=n}_computeMetrics(e){let t=this._collapse(e),i=this._breakLines(t).map(e=>e.trim()),s=[];for(let e of i)s.push(...this._wrap(e,s.length));let r=Math.max(...s.map(e=>e.width)),o=this.lineHeight*s.length;("left"!==this.options.textAlign||this.options.translate)&&s.forEach(e=>{let t=(()=>{switch(this.options.textAlign){case"right":return r-e.width;case"center":return(r-e.width)/2;default:return 0}})(),i=this.options.translate?this.options.translate.x*r:0,s=this.options.translate?this.options.translate.y*o:0;for(let r of e.glyphs)r.x+=t,r.x+=i,r.y+=s});let a=s.flatMap(e=>e.glyphs);return{paragraph:i.join("\n"),lines:s,glyphs:a,width:r,height:o}}_breakLines(e){return e.split("\n")}_collapse(e){return e.replace(/\t/g," ".repeat(this.options.tabSize)).replace(/ +/g," ")}_wrap(e,t=0){let i,s=[],r=t,o=[],a=0,n=0,l=0,h=0,_=()=>{s.push({text:e.slice(l,h),glyphs:o,start:l,end:h,width:n})};for(;h<e.length;){let t=h,s=e.charCodeAt(t),d=this.fontAsset._getChar(s),c=d.width,u=(a+=i?this.fontAsset._getKerning(i.id,d.id):0)+c,f=d.xadvance+this.options.letterSpacing,g=a+f,m=g>this.options.maxWidth||u>this.options.maxWidth;m&&(_(),r++,i=void 0,a=0,n=0,h=(l=h)+1,o=[]);let p=a,v=r*this.lineHeight;o.push({char:d,line:r,position:o.length,x:p,y:v}),m?a=f:(i=d,a=g,n=u,h++)}return o.length>0&&_(),s}}var Q=i(77736),G=i(34763);class H{get parent(){return this._parent}set parent(e){this._parent=e}get transformMatrix(){return this._transformMatrix}set transformMatrix(e){this._transformMatrix=e}get characterCount(){return this._charMatrices.length/16}constructor(e,t=0,i){this._useVAO=!1,this._vertexBuffers={},this._charMatrices=[],this._charUvs=[],this._isDirty=!0,this._baseLine=0,this._scalingMatrix=new Q.F,this._fontScaleMatrix=new Q.F,this._offsetMatrix=new Q.F,this._translationMatrix=new Q.F,this._baseMatrix=new Q.F,this._scaledMatrix=new Q.F,this._localMatrix=new Q.F,this._finalMatrix=new Q.F,this._lineMatrix=new Q.F,this._parentWorldMatrix=new Q.F,this.color={r:1,g:1,b:1,a:1},this.strokeColor={r:1,g:1,b:1,a:1},this.strokeInsetWidth=0,this.strokeOutsetWidth=0,this.thicknessControl=0,this._parent=null,this._transformMatrix=new Q.F,this.isBillboard=!1,this.isBillboardScreenProjected=!1,this.ignoreDepthBuffer=!1,this._engine=e,this._shaderLanguage=t,this._font=i,this._baseLine=i._font.common.lineHeight*i.scale,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects;let s=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new V.h(e,s,!1,2),this._vertexBuffers.offsets=this._spriteBuffer.createVertexBuffer("offsets",0,2),this._resizeBuffers(128)}_resizeBuffers(e){this._worldBuffer&&(this._worldBuffer.dispose(),this._worldBuffer=null),this._uvBuffer&&(this._uvBuffer.dispose(),this._uvBuffer=null),this._worldBuffer=new V.h(this._engine,new Float32Array(16*e),!0,16),this._vertexBuffers.world0=this._worldBuffer.createVertexBuffer("world0",0,4,16,!0),this._vertexBuffers.world1=this._worldBuffer.createVertexBuffer("world1",4,4,16,!0),this._vertexBuffers.world2=this._worldBuffer.createVertexBuffer("world2",8,4,16,!0),this._vertexBuffers.world3=this._worldBuffer.createVertexBuffer("world3",12,4,16,!0),this._uvBuffer=new V.h(this._engine,new Float32Array(4*e),!0,4),this._vertexBuffers.uvs=this._uvBuffer.createVertexBuffer("uvs",0,4,4,!0)}_setShaders(e,t){this._drawWrapperBase?.dispose(),this._drawWrapperBase=new z.E(this._engine),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=!0),this._drawWrapperBase.effect=this._engine.createEffect({vertexSource:e,fragmentSource:t},["offsets","world0","world1","world2","world3","uvs"],["parentWorld","view","projection","uColor","thickness","uStrokeColor","uStrokeInsetWidth","uStrokeOutsetWidth","mode","transform"],["fontAtlas"],"",void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperBase.effect._refCount++}addParagraph(e,t,i){let s=new W(e,this._font,t),r=this._font.scale,o=this._font._font.common.scaleW,a=this._font._font.common.scaleH,n=s.glyphs.filter(e=>e.char.page>=0),l=i;if(!l){let e=s.lineHeight*r,t=s.lines.length*e/2;(0,G.Tf)(0,this._baseLine-t,0,this._lineMatrix),l=this._lineMatrix}(0,G.fg)(r,r,1,this._fontScaleMatrix),(0,G.Tf)(.5,-.5,0,this._offsetMatrix);let h=this._charUvs.length,_=this._charMatrices.length;n.forEach((e,t)=>{this._charUvs[h+4*t+0]=e.char.x/o,this._charUvs[h+4*t+1]=e.char.y/a,this._charUvs[h+4*t+2]=e.char.width/o,this._charUvs[h+4*t+3]=e.char.height/a;let i=e.x+e.char.xoffset,s=1-(e.y+e.char.yoffset);(0,G.fg)(e.char.width,e.char.height,1,this._scalingMatrix),(0,G.fd)(this._offsetMatrix,this._scalingMatrix,this._baseMatrix),(0,G.Tf)(i*r,s*r,0,this._translationMatrix),(0,G.fd)(this._baseMatrix,this._fontScaleMatrix,this._scaledMatrix),(0,G.fd)(this._scaledMatrix,this._translationMatrix,this._localMatrix),(0,G.fd)(this._localMatrix,l,this._finalMatrix),(0,G.rl)(this._finalMatrix,this._charMatrices,_+16*t)}),this._isDirty=!0,this._baseLine-=s.lineHeight*r*s.lines.length}render(e,t){let i=this._drawWrapperBase,s=i.effect;if(!s.isReady())return;let r=this._engine;r.setState(!1),r.enableEffect(i),this.ignoreDepthBuffer&&r.setDepthBuffer(!1),this._parent?(0,G.v9)(this._parent.getWorldMatrix(),this._parentWorldMatrix):(0,G.Ky)(this._parentWorldMatrix),s.setInt("mode",this.isBillboard?this.isBillboardScreenProjected?2:1:0),s.setMatrix("parentWorld",this._parentWorldMatrix),s.setMatrix("view",e),s.setMatrix("projection",t),s.setMatrix("transform",this.transformMatrix),s.setTexture("fontAtlas",this._font.textures[0]),s.setDirectColor4("uColor",this.color),s.setDirectColor4("uStrokeColor",this.strokeColor),s.setFloat("thickness",.9*this.thicknessControl),s.setFloat("uStrokeInsetWidth",this.strokeInsetWidth),s.setFloat("uStrokeOutsetWidth",this.strokeOutsetWidth);let o=this._charMatrices.length/16;this._isDirty&&(this._isDirty=!1,this._worldBuffer.getBuffer().capacity/4<16*o&&this._resizeBuffers(o),this._worldBuffer.update(this._charMatrices),this._uvBuffer.update(this._charUvs)),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=r.recordVertexArrayObject(this._vertexBuffers,null,s)),r.bindVertexArrayObject(this._vertexArrayObject,null)):r.bindBuffers(this._vertexBuffers,null,s),r.setAlphaMode(U.Y.ALPHA_COMBINE),r.drawArraysType(U.Y.MATERIAL_TriangleStripDrawMode,0,4,o),r.unbindInstanceAttributes(),r.setAlphaMode(U.Y.ALPHA_DISABLE),this.ignoreDepthBuffer&&r.setDepthBuffer(!0)}dispose(){this._worldBuffer&&(this._worldBuffer.dispose(),this._worldBuffer=null),this._uvBuffer&&(this._uvBuffer.dispose(),this._uvBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null)}static async CreateTextRendererAsync(e,t){if(!t.getCaps().instancedArrays||!t._features.supportSpriteInstancing)throw Error("Instanced arrays are required for MSDF text rendering.");let s=0,r="",o="";t.isWebGPU?(s=1,r=(await Promise.resolve().then(i.bind(i,12251))).msdfVertexShaderWGSL.shader,o=(await Promise.resolve().then(i.bind(i,87773))).msdfPixelShaderWGSL.shader):(r=(await Promise.resolve().then(i.bind(i,1578))).msdfVertexShader.shader,o=(await Promise.resolve().then(i.bind(i,12800))).msdfPixelShader.shader);let a=new H(t,s,e);return a._setShaders(r,o),a}}var K=i(1578),X=i(12800),Y=i(12251),q=i(87773)},7114:(e,t,i)=>{i.r(t),i.d(t,{BVHFileLoader:()=>C,GLTF1:()=>T.d1,GLTF2:()=>T.Ym,GLTFFileLoader:()=>T.Vs,GLTFLoaderAnimationStartMode:()=>T.Mk,GLTFLoaderCoordinateSystemMode:()=>T.hj,GLTFLoaderState:()=>T.yg,GLTFValidation:()=>T.T_,MTLFileLoader:()=>I,OBJFileLoader:()=>F,ReadBvh:()=>p,SPLATFileLoader:()=>z,STLFileLoader:()=>N,SolidParser:()=>B});var s,r=i(9333),o=i(71657),a=i(64300),n=i(27746),l=i(81631);let h="Xposition",_="Yposition",d="Zposition",c="Xrotation",u="Yrotation",f="Zrotation";class g{constructor(e){this.loopMode=r.X5.ANIMATIONLOOPMODE_CYCLE,this.list=[],this.root=m(),this.numFrames=0,this.frameRate=0,this.skeleton=e}}function m(){return{name:"",type:"",offset:new n.Pq,channels:[],children:[],frames:[],parent:null}}function p(e,t,i,s){let p=e.split("\n"),{loopMode:v}=s;t._blockEntityCollection=!!i;let b=new a.E("","",t);b._parentContainer=i,t._blockEntityCollection=!1;let x=new g(b);x.loopMode=v;let C=p.shift();if(!C||"HIERARCHY"!==C.trim().toUpperCase())throw Error("HIERARCHY expected");let T=p.shift();if(!T)throw Error("Unexpected end of file after HIERARCHY");let y=function e(t,i,s,r){let o=m();o.parent=s,r.list.push(o);let a=i.trim().split(/\s+/);if("END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=a[1],o.type=a[0].toUpperCase()),t.shift()?.trim()!="{")throw Error("Expected opening { after type & name");let l=t.shift()?.trim().split(/\s+/);if(!l)throw Error("Unexpected end of file: missing OFFSET");if("OFFSET"!=(a=l)[0].toUpperCase())throw Error("Expected OFFSET, but got: "+a[0]);if(4!=a.length)throw Error("OFFSET: Invalid number of values");let h=new n.Pq(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));if(isNaN(h.x)||isNaN(h.y)||isNaN(h.z))throw Error("OFFSET: Invalid values");if(o.offset=h,"ENDSITE"!=o.type){if(!(a=t.shift()?.trim().split(/\s+/)))throw Error("Unexpected end of file: missing CHANNELS");if("CHANNELS"!=a[0].toUpperCase())throw Error("Expected CHANNELS definition");let e=parseInt(a[1]);o.channels=a.splice(2,e),o.children=[]}for(;t.length>0;){let i=t.shift()?.trim();if("}"===i)return o;i&&o.children.push(e(t,i,o,r))}throw Error("Unexpected end of file: missing closing brace")}(p,T.trim(),null,x),S=p.shift();if(!S||"MOTION"!==S.trim().toUpperCase())throw Error("MOTION expected");let P=p.shift();if(!P)throw Error("Unexpected end of file before frame count");let I=P.trim().split(/[\s]+/);if(I.length<2)throw Error("Invalid frame count line");let E=parseInt(I[1]);if(isNaN(E))throw Error("Failed to read number of frames.");x.numFrames=E;let R=p.shift();if(!R)throw Error("Unexpected end of file before frame time");let M=R.trim().split(/[\s]+/);if(M.length<3)throw Error("Invalid frame time line");let w=parseFloat(M[2]);if(isNaN(w))throw Error("Failed to read frame time.");if(w<=0)throw Error("Failed to read frame time. Invalid value "+w);x.frameRate=1/w;for(let e=0;e<E;++e){let t=p.shift();t&&!function e(t,i,s,r){if("ENDSITE"===s.type)return;let o={frame:0,position:new n.Pq,rotation:new n.PT};o.frame=i,o.position=new n.Pq,o.rotation=new n.PT,s.frames.push(o);let a=n.uq.Identity();for(let e=0;e<s.channels.length;++e){let i=s.channels[e],g=t[r.i++];if(!g)continue;let m=parseFloat(g.trim());if(i.endsWith("position"))switch(i){case h:o.position.x=m;break;case _:o.position.y=m;break;case d:o.position.z=m}else if(i.endsWith("rotation")){let e,t=l.S0.ToRadians(m);switch(i){case c:e=n.uq.RotationX(t);break;case u:e=n.uq.RotationY(t);break;case f:e=n.uq.RotationZ(t)}a=e.multiply(a)}}for(let l of(n.PT.FromRotationMatrixToRef(a,o.rotation),s.children))e(t,i,l,r)}(t.trim().split(/[\s]+/)||[],e,y,{i:0})}return x.root=y,!function e(t,i,s){let a=function(e){let t=e.offset.x,i=e.offset.y,s=e.offset.z;return n.uq.Translation(t,i,s)}(t),l=new o.$(t.name,s.skeleton,i,a);for(let e of function(e,t){if(0===e.frames.length)return[];let i=[],s=e.channels.some(e=>e===h||e===_||e===d),o=e.channels.some(e=>e===c||e===u||e===f),a=new r.X5(`${e.name}_pos`,"position",t.frameRate,r.X5.ANIMATIONTYPE_VECTOR3,t.loopMode),n=new r.X5(`${e.name}_rot`,"rotationQuaternion",t.frameRate,r.X5.ANIMATIONTYPE_QUATERNION,t.loopMode),l=[],g=[];for(let t=0;t<e.frames.length;t++){let i=e.frames[t];s&&i.position&&l.push({frame:i.frame,value:i.position.clone()}),o&&g.push({frame:i.frame,value:i.rotation.clone()})}return l.length>0&&(a.setKeys(l),i.push(a)),g.length>0&&(n.setKeys(g),i.push(n)),i}(t,s))e.getKeys()&&e.getKeys().length>0&&l.animations.push(e);for(let i of t.children)e(i,l,s)}(x.root,null,x),x.skeleton.returnToRest(),x.skeleton}var v=i(18076),b=i(26688);let x={name:"bvh",extensions:{".bvh":{isBinary:!1}}};class C{constructor(e){this.name=x.name,this.extensions=x.extensions,this._loadingOptions={...C._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{loopMode:r.X5.ANIMATIONLOOPMODE_CYCLE}}createPlugin(e){return new C(e[x.name])}canDirectLoad(e){return this.isBvhHeader(e)}isBvhHeader(e){return"HIERARCHY"==e.split("\n")[0]}isNotBvhHeader(e){return!this.isBvhHeader(e)}importMeshAsync(e,t,i){if("string"!=typeof i)return Promise.reject("BVH loader expects string data.");if(this.isNotBvhHeader(i))return Promise.reject("BVH loader expects HIERARCHY header.");try{let e=p(i,t,null,this._loadingOptions);return Promise.resolve({meshes:[],particleSystems:[],skeletons:[e],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]})}catch(e){return Promise.reject(e)}}loadAsync(e,t){return"string"!=typeof t?Promise.reject("BVH loader expects string data."):this.isNotBvhHeader(t)?Promise.reject("BVH loader expects HIERARCHY header."):this.importMeshAsync(null,e,t).then(()=>{})}loadAssetContainerAsync(e,t){if("string"!=typeof t)return Promise.reject("BVH loader expects string data.");if(this.isNotBvhHeader(t))return Promise.reject("BVH loader expects HIERARCHY header.");let i=new b.WZ(e);try{let s=p(t,e,i,this._loadingOptions);return i.skeletons.push(s),Promise.resolve(i)}catch(e){return Promise.reject(e)}}}(0,v.qS)(new C);var T=i(55579),y=i(26856),S=i(75200),P=i(78684);class I{constructor(){this.materials=[]}parseMTL(e,t,i,s){let r;if(t instanceof ArrayBuffer)return;let o=t.split("\n"),a=/\s+/,n=null;for(let t=0;t<o.length;t++){let l=o[t].trim();if(0===l.length||"#"===l.charAt(0))continue;let h=l.indexOf(" "),_=h>=0?l.substring(0,h):l;_=_.toLowerCase();let d=h>=0?l.substring(h+1).trim():"";if("newmtl"===_)n&&this.materials.push(n),e._blockEntityCollection=!!s,(n=new P.F(d,e))._parentContainer=s,e._blockEntityCollection=!1;else if("kd"===_&&n)r=d.split(a,3).map(parseFloat),n.diffuseColor=y.v9.FromArray(r);else if("ka"===_&&n)r=d.split(a,3).map(parseFloat),n.ambientColor=y.v9.FromArray(r);else if("ks"===_&&n)r=d.split(a,3).map(parseFloat),n.specularColor=y.v9.FromArray(r);else if("ke"===_&&n)r=d.split(a,3).map(parseFloat),n.emissiveColor=y.v9.FromArray(r);else if("ns"===_&&n)n.specularPower=parseFloat(d);else if("d"===_&&n)n.alpha=parseFloat(d);else if("map_ka"===_&&n)n.ambientTexture=I._GetTexture(i,d,e);else if("map_kd"===_&&n)n.diffuseTexture=I._GetTexture(i,d,e);else if("map_ks"===_&&n)n.specularTexture=I._GetTexture(i,d,e);else if("map_ns"===_);else if("map_bump"===_&&n){let t=d.split(a),s=t.indexOf("-bm"),r=null;s>=0&&(r=t[s+1],t.splice(s,2)),n.bumpTexture=I._GetTexture(i,t.join(" "),e),n.bumpTexture&&null!==r&&(n.bumpTexture.level=parseFloat(r))}else"map_d"===_&&n&&(n.opacityTexture=I._GetTexture(i,d,e))}n&&this.materials.push(n)}static _GetTexture(e,t,i){if(!t)return null;let s=e;if("file:"===e){let e=t.lastIndexOf("\\");-1===e&&(e=t.lastIndexOf("/")),e>-1?s+=t.substring(e+1):s+=t}else s+=t;return new S.g(s,i,!1,I.INVERT_TEXTURE_Y)}}I.INVERT_TEXTURE_Y=!0;var E=i(77633),R=i(52219),M=i(29218),w=i(31506),O=i(43048);class B{constructor(e,t,i){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new y.ov(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=i}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});let i=e[t[0]].normals.indexOf(t[1]);return -1===i?-1:e[t[0]].idx[i]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});let i=e[t[0]].normals.indexOf(t[1]);return 1!=i&&t[2]===e[t[0]].uv[i]?e[t[0]].idx[i]:-1}_setData(e,t,i,s,r,o,a){let l;-1===(l=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,i,t]):this._isInArray(this._tuplePosNorm,[e,i]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(s),r=r??new n.I9(0,0),this._wrappedUvsForBabylon.push(r),this._wrappedNormalsForBabylon.push(o),void 0!==a&&this._wrappedColorsForBabylon.push(a),this._tuplePosNorm[e].normals.push(i),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(l)}_unwrapData(){try{for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch(e){throw Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(e,t){for(let i=t;i<e.length-1;i++)this._pushTriangle(e,i)}_getColor(e){return this._loadingOptions.importVertexColors?this._extColors[e]??this._colors[e]:void 0}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=parseInt(this._triangles[e])-1;this._setData(t,0,0,this._positions[t],n.I9.Zero(),n.Pq.Up(),this._getColor(t))}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=parseInt(t[0])-1,s=parseInt(t[1])-1;this._setData(i,s,0,this._positions[i],this._uvs[s]??n.I9.Zero(),n.Pq.Up(),this._getColor(i))}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=parseInt(t[0])-1,s=parseInt(t[1])-1,r=parseInt(t[2])-1;this._setData(i,s,r,this._positions[i],this._uvs[s]??n.I9.Zero(),this._normals[r]??n.Pq.Up())}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("//"),i=parseInt(t[0])-1,s=parseInt(t[1])-1;this._setData(i,1,s,this._positions[i],n.I9.Zero(),this._normals[s],this._getColor(i))}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=this._positions.length+parseInt(t[0]),s=this._uvs.length+parseInt(t[1]),r=this._normals.length+parseInt(t[2]);this._setData(i,s,r,this._positions[i],this._uvs[s],this._normals[r],this._getColor(i))}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(e){let t=e.getVerticesData(E.R.PositionKind),i=e.getVerticesData(E.R.NormalKind),s={};if(!t||!i)return;for(let e=0;e<t.length/3;e++){let i=t[3*e+0],r=i+"_"+t[3*e+1]+"_"+t[3*e+2],o=s[r];o||(o=[],s[r]=o),o.push(e)}let r=new n.Pq;for(let e in s){let t=s[e];if(t.length<2)continue;let o=t[0];for(let e=1;e<t.length;++e){let s=t[e];i[3*o+0]+=i[3*s+0],i[3*o+1]+=i[3*s+1],i[3*o+2]+=i[3*s+2]}r.copyFromFloats(i[3*o+0],i[3*o+1],i[3*o+2]),r.normalize();for(let e=0;e<t.length;++e){let s=t[e];i[3*s+0]=r.x,i[3*s+1]=r.y,i[3*s+2]=r.z}}e.setVerticesData(E.R.NormalKind,i)}static _IsLineElement(e){return e.startsWith("l")}static _IsObjectElement(e){return e.startsWith("o")}static _IsGroupElement(e){return e.startsWith("g")}static _GetZbrushMRGB(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];let i=e.match(/[a-z0-9]/g);if(!i||i.length%8!=0)return[];let s=[];for(let e=0;e<i.length/8;e++){let t=i[8*e+2]+i[8*e+3],r=i[8*e+4]+i[8*e+5],o=i[8*e+6]+i[8*e+7];s.push(new y.ov(parseInt(t,16)/255,parseInt(r,16)/255,parseInt(o,16)/255,1))}return s}parse(e,t,i,s,r){t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=1):i.useRightHandedSystem?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t+1],e[t]),this._handednessSign=1):(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=-1);let o=t.split("\n"),a=[],l=[];a.push(l);for(let e=0;e<o.length;e++){let t=o[e].trim().replace(/\s\s/g," ");if(0!==t.length&&"#"!==t.charAt(0))if((B._IsGroupElement(t)||B._IsObjectElement(t))&&(l=[],a.push(l)),B._IsLineElement(t)){let e=t.split(" ");for(let t=1;t<e.length-1;t++)l.push(`l ${e[t]} ${e[t+1]}`)}else l.push(t)}let h=a.flat();for(let e=0;e<h.length;e++){let t,i=h[e].trim().replace(/\s\s/g," ");if(0!==i.length&&"#"!==i.charAt(0))if(B.VertexPattern.test(i)){if(t=i.match(/[^ ]+/g),this._positions.push(new n.Pq(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))),this._loadingOptions.importVertexColors)if(t.length>=7){let e=parseFloat(t[4]),i=parseFloat(t[5]),s=parseFloat(t[6]);this._colors.push(new y.ov(e>1?e/255:e,i>1?i/255:i,s>1?s/255:s,7===t.length||void 0===t[7]?1:parseFloat(t[7])))}else this._colors.push(this._grayColor)}else if(null!==(t=B.NormalPattern.exec(i)))this._normals.push(new n.Pq(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));else if(null!==(t=B.UVPattern.exec(i)))this._uvs.push(new n.I9(parseFloat(t[1])*this._loadingOptions.UVScaling.x,parseFloat(t[2])*this._loadingOptions.UVScaling.y));else if(null!==(t=B.FacePattern3.exec(i)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),1);else if(null!==(t=B.FacePattern4.exec(i)))this._setDataForCurrentFaceWithPattern4(t[1].trim().split(" "),1);else if(null!==(t=B.FacePattern5.exec(i)))this._setDataForCurrentFaceWithPattern5(t[1].trim().split(" "),1);else if(null!==(t=B.FacePattern2.exec(i)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),1);else if(null!==(t=B.FacePattern1.exec(i)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),1);else if(null!==(t=B.LinePattern1.exec(i)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),0),this._hasLineData=!0;else if(null!==(t=B.LinePattern2.exec(i)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),0),this._hasLineData=!0;else if(t=B._GetZbrushMRGB(i,!this._loadingOptions.importVertexColors))for(let e of t)this._extColors.push(e);else if(null!==(t=B.LinePattern3.exec(i)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),0),this._hasLineData=!0;else if(B.GroupDescriptor.test(i)||B.ObjectDescriptor.test(i)){let e={name:i.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:B.ObjectDescriptor.test(i)};this._addPreviousObjMesh(),this._meshesFromObj.push(e),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(B.UseMtlDescriptor.test(i)){if(this._materialNameFromObj=i.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();let e={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(e),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else B.MtlLibGroupDescriptor.test(i)?r(i.substring(7).trim()):B.SmoothDescriptor.test(i)||O.V.Log("Unhandled expression at line : "+i)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){let e=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(let e of this._positions)this._unwrappedPositionsForBabylon.push(e.x,e.y,e.z);if(this._normals.length)for(let e of this._normals)this._unwrappedNormalsForBabylon.push(e.x,e.y,e.z);if(this._uvs.length)for(let e of this._uvs)this._unwrappedUVForBabylon.push(e.x,e.y);if(this._extColors.length)for(let e of this._extColors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);else if(this._colors.length)for(let e of this._colors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);!this._materialNameFromObj&&((e=new P.F(R.V.RandomId(),i)).pointsCloud=!0,this._materialNameFromObj=e.name,this._normals.length||(e.disableLighting=!0,e.emissiveColor=y.v9.White()))}this._meshesFromObj.push({name:R.V.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:e,isObject:!0,hasLines:this._hasLineData})}for(let t=0;t<this._meshesFromObj.length;t++){if(e&&this._meshesFromObj[t].name){if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==e)continue}this._handledMesh=this._meshesFromObj[t],i._blockEntityCollection=!!s;let r=new M.e(this._meshesFromObj[t].name,i);if(r._parentContainer=s,i._blockEntityCollection=!1,this._handledMesh._babylonMesh=r,!this._handledMesh.isObject){for(let e=t-1;e>=0;--e)if(this._meshesFromObj[e].isObject&&this._meshesFromObj[e]._babylonMesh){r.parent=this._meshesFromObj[e]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[t].materialName),this._handledMesh.hasLines&&(r._internalMetadata??(r._internalMetadata={}),r._internalMetadata._isLine=!0),this._handledMesh.positions?.length===0){this._babylonMeshesArray.push(r);continue}let o=new w.P;if(o.uvs=this._handledMesh.uvs,o.indices=this._handledMesh.indices,o.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){let e=[];w.P.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,e),o.normals=e}else o.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(o.colors=this._handledMesh.colors),o.applyToMesh(r),this._loadingOptions.invertY&&(r.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(r),this._babylonMeshesArray.push(r),this._handledMesh.directMaterial&&(r.material=this._handledMesh.directMaterial)}}}B.ObjectDescriptor=/^o/,B.GroupDescriptor=/^g/,B.MtlLibGroupDescriptor=/^mtllib /,B.UseMtlDescriptor=/^usemtl /,B.SmoothDescriptor=/^s /,B.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,B.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,B.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,B.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,B.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,B.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,B.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,B.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,B.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,B.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,B.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;let A={name:"obj",extensions:".obj"};class F{static get INVERT_TEXTURE_Y(){return I.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){I.INVERT_TEXTURE_Y=e}constructor(e){this.name=A.name,this.extensions=A.extensions,this._assetContainer=null,this._loadingOptions={...F._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{computeNormals:F.COMPUTE_NORMALS,optimizeNormals:F.OPTIMIZE_NORMALS,importVertexColors:F.IMPORT_VERTEX_COLORS,invertY:F.INVERT_Y,invertTextureY:F.INVERT_TEXTURE_Y,UVScaling:F.UV_SCALING,materialLoadingFailsSilently:F.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:F.OPTIMIZE_WITH_UV,skipMaterials:F.SKIP_MATERIALS,useLegacyBehavior:F.USE_LEGACY_BEHAVIOR}}_loadMTL(e,t,i,s){let r=t+e;l.S0.LoadFile(r,i,void 0,void 0,!1,(e,t)=>{s(r,t)})}createPlugin(e){return new F(e[A.name])}canDirectLoad(){return!1}importMeshAsync(e,t,i,s){return this._parseSolidAsync(e,t,i,s).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(e,t,i){return this.importMeshAsync(null,e,t,i).then(()=>{})}loadAssetContainerAsync(e,t,i){let s=new b.WZ(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,i).then(e=>(e.meshes.forEach(e=>s.meshes.push(e)),e.meshes.forEach(e=>{let t=e.material;t&&-1==s.materials.indexOf(t)&&(s.materials.push(t),t.getActiveTextures().forEach(e=>{-1==s.textures.indexOf(e)&&s.textures.push(e)}))}),this._assetContainer=null,s)).catch(e=>{throw this._assetContainer=null,e})}_parseSolidAsync(e,t,i,s){let r="",o=new I,a=[],n=[];i=i.replace(/#.*$/gm,"").trim(),new B(a,n,this._loadingOptions).parse(e,i,t,this._assetContainer,e=>{r=e});let h=[];return""===r||this._loadingOptions.skipMaterials||h.push(new Promise((e,i)=>{this._loadMTL(r,s,h=>{try{o.parseMTL(t,h,s,this._assetContainer);for(let e=0;e<o.materials.length;e++){let t,i=0,s=[];for(;(t=a.indexOf(o.materials[e].name,i))>-1;)s.push(t),i=t+1;if(-1===t&&0===s.length)o.materials[e].dispose();else for(let t=0;t<s.length;t++){let i=n[s[t]],r=o.materials[e];i.material=r,i.getTotalIndices()||(r.pointsCloud=!0)}}e()}catch(t){l.S0.Warn(`Error processing MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?e():i(t)}},(t,s)=>{l.S0.Warn(`Error downloading MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?e():i(s)})})),Promise.all(h).then(()=>{let e=e=>!!e._internalMetadata?._isLine;return n.forEach(i=>{if(e(i)){let s=i.material??new P.F(i.name+"_line",t);s.getBindedMeshes().filter(t=>!e(t)).length>0&&(s=s.clone(s.name+"_line")??s),s.wireframe=!0,i.material=s,i._internalMetadata&&(i._internalMetadata._isLine=void 0)}}),n})}}F.OPTIMIZE_WITH_UV=!0,F.INVERT_Y=!1,F.IMPORT_VERTEX_COLORS=!1,F.COMPUTE_NORMALS=!1,F.OPTIMIZE_NORMALS=!1,F.UV_SCALING=new n.I9(1,1),F.SKIP_MATERIALS=!1,F.MATERIAL_LOADING_FAILS_SILENTLY=!0,F.USE_LEGACY_BEHAVIOR=!1,(0,v.qS)(new F);let L={name:"stl",extensions:{".stl":{isBinary:!0}}};class N{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name=L.name,this.extensions=L.extensions}importMesh(e,t,i,s,r){let o;if("string"!=typeof i){if(this._isBinary(i)){let e=new M.e("stlmesh",t);return this._parseBinary(e,i),r&&r.push(e),!0}i=new TextDecoder().decode(new Uint8Array(i))}for(;o=this.solidPattern.exec(i);){let i=o[1],s=o[3];if(s&&i!=s)return l.S0.Error("Error in STL, solid name != endsolid name"),!1;if(e&&i){if(e instanceof Array){if(!e.indexOf(i))continue}else if(i!==e)continue}i=i||"stlmesh";let a=new M.e(i,t);this._parseASCII(a,o[2]),r&&r.push(a)}return!0}load(e,t,i){return this.importMesh(null,e,t,i,null)}loadAssetContainer(e,t,i){let s=new b.WZ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,i,s.meshes),e._blockEntityCollection=!1,s}_isBinary(e){let t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;let i=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==i[e])return!0;return!1}_parseBinary(e,t){let i=new DataView(t),s=i.getUint32(80,!0),r=0,o=new Float32Array(3*s*3),a=new Float32Array(3*s*3),n=new Uint32Array(3*s),l=0;for(let e=0;e<s;e++){let t=84+50*e,s=i.getFloat32(t,!0),h=i.getFloat32(t+4,!0),_=i.getFloat32(t+8,!0);for(let e=1;e<=3;e++){let n=t+12*e;o[r]=i.getFloat32(n,!0),a[r]=s,N.DO_NOT_ALTER_FILE_COORDINATES?(o[r+1]=i.getFloat32(n+4,!0),o[r+2]=i.getFloat32(n+8,!0),a[r+1]=h,a[r+2]=_):(o[r+2]=i.getFloat32(n+4,!0),o[r+1]=i.getFloat32(n+8,!0),a[r+2]=h,a[r+1]=_),r+=3}N.DO_NOT_ALTER_FILE_COORDINATES?(n[l]=l,n[l+1]=l+2,n[l+2]=l+1,l+=3):(n[l]=l++,n[l]=l++,n[l]=l++)}e.setVerticesData(E.R.PositionKind,o),e.setVerticesData(E.R.NormalKind,a),e.setIndices(n),e.computeWorldMatrix(!0)}_parseASCII(e,t){let i,s=[],r=[],o=[],a=0;for(;i=this.facetsPattern.exec(t);){let e,t=i[1],n=this.normalPattern.exec(t);if(this.normalPattern.lastIndex=0,!n)continue;let l=[Number(n[1]),Number(n[5]),Number(n[3])];for(;e=this.vertexPattern.exec(t);)N.DO_NOT_ALTER_FILE_COORDINATES?(s.push(Number(e[1]),Number(e[3]),Number(e[5])),r.push(l[0],l[2],l[1])):(s.push(Number(e[1]),Number(e[5]),Number(e[3])),r.push(l[0],l[1],l[2]));N.DO_NOT_ALTER_FILE_COORDINATES?(o.push(a,a+2,a+1),a+=3):o.push(a++,a++,a++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(E.R.PositionKind,s),e.setVerticesData(E.R.NormalKind,r),e.setIndices(o),e.computeWorldMatrix(!0)}}N.DO_NOT_ALTER_FILE_COORDINATES=!1,(0,v.qS)(new N);let D={name:"splat",extensions:{".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}}};var k=i(57483),V=i(90024),U=i(16582);!function(e){e[e.Splat=0]="Splat",e[e.PointCloud=1]="PointCloud",e[e.Mesh=2]="Mesh",e[e.Reject=3]="Reject"}(s||(s={}));class z{constructor(e=z._DefaultLoadingOptions){this.name=D.name,this._assetContainer=null,this.extensions=D.extensions,this._loadingOptions=e}createPlugin(e){return new z(e[D.name])}async importMeshAsync(e,t,i,s,r,o){return await this._parseAsync(e,t,i,s).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}static _BuildPointCloud(e,t){if(!t.byteLength)return!1;let i=new Uint8Array(t),s=new Float32Array(t),r=i.length/32;return e.addPoints(r,function(e,t){let r=s[8*t+0],o=s[8*t+1],a=s[8*t+2];e.position=new n.Pq(r,o,a);let l=i[32*t+24+0]/255,h=i[32*t+24+1]/255,_=i[32*t+24+2]/255;e.color=new y.ov(l,h,_,1)}),!0}static _BuildMesh(e,t){let i=new M.e("PLYMesh",e),s=new Uint8Array(t.data),r=new Float32Array(t.data),o=s.length/32,a=[],n=new w.P;for(let e=0;e<o;e++){let t=r[8*e+0],i=r[8*e+1],s=r[8*e+2];a.push(t,i,s)}if(t.hasVertexColors){let e=new Float32Array(4*o);for(let t=0;t<o;t++){let i=s[32*t+24+0]/255,r=s[32*t+24+1]/255,o=s[32*t+24+2]/255;e[4*t+0]=i,e[4*t+1]=r,e[4*t+2]=o,e[4*t+3]=1}n.colors=e}return n.positions=a,n.indices=t.faces,n.applyToMesh(i),i}_parseSPZAsync(e,t){let i=new Uint8Array(e),s=new Uint32Array(e.slice(0,12)),r=s[2],o=i[12],a=i[13],n=i[14],l=i[15],h=s[1];if(l||0x5053474e!=s[0]||2!=h&&3!=h)return new Promise(e=>{e({mode:3,data:_,hasVertexColors:!1})});let _=new ArrayBuffer(32*r),d=1/(1<<a),c=new Int32Array(1),u=new Uint8Array(c.buffer),f=function(e,t){return u[0]=e[t+0],u[1]=e[t+1],u[2]=e[t+2],u[3]=128&e[t+2]?255:0,c[0]*d},g=16,m=new Float32Array(_),p=new Float32Array(_),v=new Uint8ClampedArray(_),b=new Uint8ClampedArray(_),x=1,C=0;this._loadingOptions.flipY||(x=-1,C=255);for(let e=0;e<r;e++)m[8*e+0]=f(i,g+0),m[8*e+1]=x*f(i,g+3),m[8*e+2]=x*f(i,g+6),g+=9;for(let e=0;e<r;e++){for(let t=0;t<3;t++){let s=(i[g+r+3*e+t]-127.5)/38.25;v[32*e+24+t]=U.X.Clamp((.5+.282*s)*255,0,255)}v[32*e+24+3]=i[g+e]}g+=4*r;for(let e=0;e<r;e++)p[8*e+3+0]=Math.exp(i[g+0]/16-10),p[8*e+3+1]=Math.exp(i[g+1]/16-10),p[8*e+3+2]=Math.exp(i[g+2]/16-10),g+=3;if(h>=3){let e=Math.SQRT1_2;for(let t=0;t<r;t++){let s=[i[g+0],i[g+1],i[g+2],i[g+3]],r=s[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24),o=[],a=r>>>30,n=r,l=0;for(let t=3;t>=0;--t)if(t!==a){let i=511&n,s=n>>>9&1;n>>>=10,o[t]=i/511*e,1===s&&(o[t]=-o[t]),l+=o[t]*o[t]}let h=1-l;o[a]=Math.sqrt(Math.max(h,0)),o[1]*=x,o[2]*=x;let _=[3,0,1,2];for(let e=0;e<4;e++)b[32*t+28+e]=Math.round(127.5+127.5*o[_[e]]);g+=4}}else for(let e=0;e<r;e++){let t=i[g+0],s=i[g+1]*x+C,r=i[g+2]*x+C,o=t/127.5-1,a=s/127.5-1,n=r/127.5-1;b[32*e+28+1]=t,b[32*e+28+2]=s,b[32*e+28+3]=r;let l=1-(o*o+a*a+n*n);b[32*e+28+0]=127.5+127.5*Math.sqrt(l<0?0:l),g+=3}if(o){let e=3*((o+1)*(o+1)-1),s=Math.ceil(e/16),a=g,l=[],h=t.getEngine().getCaps().maxTextureSize,d=Math.ceil(r/h);for(let e=0;e<s;e++){let e=new Uint8Array(d*h*16);l.push(e)}for(let t=0;t<r;t++)for(let s=0;s<e;s++){let e=i[a++];l[Math.floor(s/16)][s%16+16*t]=e}return new Promise(e=>{e({mode:0,data:_,hasVertexColors:!1,sh:l,trainedWithAntialiasing:!!n})})}return new Promise(e=>{e({mode:0,data:_,hasVertexColors:!1,trainedWithAntialiasing:!!n})})}_parseAsync(e,t,i,s){let r=[],o=new ReadableStream({start(e){e.enqueue(new Uint8Array(i)),e.close()}}),a=new DecompressionStream("gzip"),n=o.pipeThrough(a);return new Promise(e=>{new Response(n).arrayBuffer().then(i=>{this._parseSPZAsync(i,t).then(i=>{t._blockEntityCollection=!!this._assetContainer;let s=new k.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);if(i.trainedWithAntialiasing){let e=s.material;e.kernelSize=.1,e.compensation=!0}s._parentContainer=this._assetContainer,r.push(s),s.updateData(i.data,i.sh),t._blockEntityCollection=!1,e(r)})}).catch(()=>{z._ConvertPLYToSplat(i).then(async i=>{switch(t._blockEntityCollection=!!this._assetContainer,i.mode){case 0:{let e=new k.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);e._parentContainer=this._assetContainer,r.push(e),e.updateData(i.data,i.sh),(i.compressed||!i.rawSplat)&&e.viewDirectionFactor.set(-1,-1,1)}break;case 1:{let e=new V.y("PointCloud",1,t);z._BuildPointCloud(e,i.data)?await e.buildMeshAsync().then(e=>{r.push(e)}):e.dispose()}break;case 2:if(i.faces)r.push(z._BuildMesh(t,i));else throw Error("PLY mesh doesn't contain face informations.");break;default:throw Error("Unsupported Splat mode")}t._blockEntityCollection=!1,e(r)})})})}loadAssetContainerAsync(e,t,i){let s=new b.WZ(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,i).then(e=>{for(let t of e.meshes)s.meshes.push(t);return this._assetContainer=null,s}).catch(e=>{throw this._assetContainer=null,e})}loadAsync(e,t,i){return this.importMeshAsync(null,e,t,i).then(()=>{})}static _ConvertPLYToSplat(e){var t;let i,s=new Uint8Array(e),r=new TextDecoder().decode(s.slice(0,10240)),o="end_header\n",a=r.indexOf(o);if(a<0||!r)return new Promise(t=>{t({mode:0,data:e,rawSplat:!0})});let n=parseInt(/element vertex (\d+)\n/.exec(r)[1]),l=/element face (\d+)\n/.exec(r),h=0;l&&(h=parseInt(l[1]));let _=/element chunk (\d+)\n/.exec(r),d=0;_&&(d=parseInt(_[1]));let c=0,u=0,f={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0};(t=i||(i={}))[t.Vertex=0]="Vertex",t[t.Chunk=1]="Chunk",t[t.SH=2]="SH";let g=1,m=[],p=[];for(let e of r.slice(0,a).split("\n"))if(e.startsWith("property ")){let[,t,i]=e.split(" ");1==g?(p.push({name:i,type:t,offset:u}),u+=f[t]):0==g?(m.push({name:i,type:t,offset:c}),c+=f[t]):2==g&&m.push({name:i,type:t,offset:c}),f[t]||O.V.Warn(`Unsupported property type: ${t}.`)}else if(e.startsWith("element ")){let[,t]=e.split(" ");"chunk"==t?g=1:"vertex"==t?g=0:"sh"==t&&(g=2)}let v=c,b=u;return k.t.ConvertPLYWithSHToSplatAsync(e).then(async t=>{let i=new DataView(e,a+o.length),s=b*d+v*n,r=[];if(h)for(let e=0;e<h;e++){let e=i.getUint8(s);if(3==e){s+=1;for(let t=0;t<e;t++){let e=i.getUint32(s+(2-t)*4,!0);r.push(e)}s+=12}}if(d)return await new Promise(e=>{e({mode:0,data:t.buffer,sh:t.sh,faces:r,hasVertexColors:!1,compressed:!0,rawSplat:!1})});let l=0,_=0,c=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],u=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"];for(let e=0;e<m.length;e++){let t=m[e];c.includes(t.name)&&l++,u.includes(t.name)&&_++}let f=l==c.length&&3==_,g=h?2:+!f;return await new Promise(e=>{e({mode:g,data:t.buffer,sh:t.sh,faces:r,hasVertexColors:!!_,compressed:!1,rawSplat:!1})})})}}z._DefaultLoadingOptions={keepInRam:!1,flipY:!1},(0,v.qS)(new z)},12251:(e,t,i)=>{i.r(t),i.d(t,{msdfVertexShaderWGSL:()=>a});var s=i(52019);let r="msdfVertexShader",o=`#define BILLBOARD 1
#define BILLBOARDSCREENPROJECTED 2
attribute offsets: vec2f;attribute world0: vec4f;attribute world1: vec4f;attribute world2: vec4f;attribute world3: vec4f;attribute uvs: vec4f;uniform transform: mat4x4f;uniform parentWorld: mat4x4f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform mode: u32;varying atlasUV: vec2f;@vertex
fn main(input: VertexInputs)->FragmentInputs {let world=mat4x4<f32>(input.world0,input.world1,input.world2,input.world3);let localOffset=vec4<f32>(input.offsets-vec2<f32>(0.5,0.5),0.0,1.0);let worldPos=uniforms.transform*world*localOffset;if (uniforms.mode>=BILLBOARD) { 
var viewPos=(uniforms.view*uniforms.parentWorld*vec4f(0.,0.,0.,1.0)).xyz;if (uniforms.mode==BILLBOARDSCREENPROJECTED) {viewPos=vec3f(viewPos.x/viewPos.z,viewPos.y/viewPos.z,1.0);} 
vertexOutputs.position=uniforms.projection*vec4<f32>(viewPos+worldPos.xyz,1.0);} else { 
let viewPos=(uniforms.view*uniforms.parentWorld*worldPos).xyz;vertexOutputs.position=uniforms.projection*vec4<f32>(viewPos,1.0);}
vertexOutputs.atlasUV=vec2<f32>(
input.uvs.x+input.offsets.x*input.uvs.z,
input.uvs.y+(1.0-input.offsets.y)*input.uvs.w
);}`;s.l.ShadersStoreWGSL[r]||(s.l.ShadersStoreWGSL[r]=o);let a={name:r,shader:o}},12800:(e,t,i)=>{i.r(t),i.d(t,{msdfPixelShader:()=>a});var s=i(52019);let r="msdfPixelShader",o=`#extension GL_OES_standard_derivatives : enable
precision highp float;uniform sampler2D fontAtlas;uniform vec4 uColor;uniform vec4 uStrokeColor;uniform float uStrokeInsetWidth;uniform float uStrokeOutsetWidth;uniform float thickness;varying vec2 atlasUV;float median(vec3 msdf) {return max(min(msdf.r,msdf.g),min(max(msdf.r,msdf.g),msdf.b));}
void main(void)
{vec3 s=texture2D(fontAtlas,atlasUV).rgb;float sigDist=median(s)-0.5+thickness;float alpha=clamp(sigDist/fwidth(sigDist)+0.5,0.0,1.0);float sigDistOutset=sigDist+uStrokeOutsetWidth*0.5;float sigDistInset=sigDist-uStrokeInsetWidth*0.5;float outset=clamp(sigDistOutset/fwidth(sigDistOutset)+0.5,0.0,1.0);float inset=1.0-clamp(sigDistInset/fwidth(sigDistInset)+0.5,0.0,1.0);float border=outset*inset;vec4 filledFragColor=vec4(uColor.rgb,alpha*uColor.a);vec4 strokedFragColor=vec4(uStrokeColor.rgb,border*uStrokeColor.a);gl_FragColor=mix(filledFragColor,strokedFragColor,border);}`;s.l.ShadersStore[r]||(s.l.ShadersStore[r]=o);let a={name:r,shader:o}},22855:(e,t,i)=>{i.r(t),i.d(t,{BVHExporter:()=>tu,EXT_materials_diffuse_roughness:()=>e4,EXT_mesh_gpu_instancing:()=>eC,EXT_texture_avif:()=>ti,EXT_texture_webp:()=>te,GLTF2Export:()=>eb,GLTFData:()=>_,KHR_draco_mesh_compression:()=>eS,KHR_lights_punctual:()=>ew,KHR_materials_anisotropy:()=>eB,KHR_materials_clearcoat:()=>eF,KHR_materials_diffuse_transmission:()=>ek,KHR_materials_dispersion:()=>eU,KHR_materials_emissive_strength:()=>eW,KHR_materials_ior:()=>eG,KHR_materials_iridescence:()=>eK,KHR_materials_sheen:()=>eY,KHR_materials_specular:()=>ej,KHR_materials_transmission:()=>eZ,KHR_materials_unlit:()=>e0,KHR_materials_volume:()=>e2,KHR_texture_basisu:()=>e7,KHR_texture_transform:()=>e9,OBJExport:()=>n,STLExport:()=>ts,USDZExportAsync:()=>tc,_ConvertToGLTFPBRMetallicRoughness:()=>w,_SolveMetallic:()=>M,__IGLTFExporterExtension:()=>l});var s,r=i(27746),o=i(81631),a=i(26501);class n{static OBJ(e,t,i,s){let n=[],l=1,h=1;t&&(i||(i="mat"),n.push("mtllib "+i+".mtl"));for(let i=0;i<e.length;i++){let _=e[i],d=_.name||`mesh${i}}`;n.push(`o ${d}`);let c=null;if(s){let e=_.computeWorldMatrix(!0);c=new r.uq,e.invertToRef(c),_.bakeTransformIntoVertices(e)}if(t){let e=_.material;e&&n.push("usemtl "+e.id)}let u=_.geometry;if(!u){o.S0.Warn("No geometry is present on the mesh");continue}let f=u.getVerticesData("position"),g=u.getVerticesData("normal"),m=u.getVerticesData("uv"),p=u.getIndices(),v=0,b=0;if(!f||!p){o.S0.Warn("There are no position vertices or indices on the mesh!");continue}let x=e[0].getScene().useRightHandedSystem?1:-1;for(let e=0;e<f.length;e+=3)n.push("v "+f[e]*x+" "+f[e+1]+" "+f[e+2]),v++;if(null!=g)for(let e=0;e<g.length;e+=3)n.push("vn "+g[e]*x+" "+g[e+1]+" "+g[e+2]);if(null!=m)for(let e=0;e<m.length;e+=2)n.push("vt "+m[e]+" "+m[e+1]),b++;let C=["","",""],[T,y]=(_.material||_.getScene().defaultMaterial)._getEffectiveOrientation(_)===a.i.ClockWiseSideOrientation?[2,1]:[1,2];for(let e=0;e<p.length;e+=3){let t=[String(p[e]+l),String(p[e+T]+l),String(p[e+y]+l)],i=[String(p[e]+h),String(p[e+T]+h),String(p[e+y]+h)],s=null!=m?i:C,r=null!=g?t:C;n.push("f "+t[0]+"/"+s[0]+"/"+r[0]+" "+t[1]+"/"+s[1]+"/"+r[1]+" "+t[2]+"/"+s[2]+"/"+r[2])}s&&c&&_.bakeTransformIntoVertices(c),l+=v,h+=b}return n.join("\n")}static MTL(e){let t=[],i=e.material;return t.push("newmtl mat1"),t.push("  Ns "+i.specularPower.toFixed(4)),t.push("  Ni 1.5000"),t.push("  d "+i.alpha.toFixed(4)),t.push("  Tr 0.0000"),t.push("  Tf 1.0000 1.0000 1.0000"),t.push("  illum 2"),t.push("  Ka "+i.ambientColor.r.toFixed(4)+" "+i.ambientColor.g.toFixed(4)+" "+i.ambientColor.b.toFixed(4)),t.push("  Kd "+i.diffuseColor.r.toFixed(4)+" "+i.diffuseColor.g.toFixed(4)+" "+i.diffuseColor.b.toFixed(4)),t.push("  Ks "+i.specularColor.r.toFixed(4)+" "+i.specularColor.g.toFixed(4)+" "+i.specularColor.b.toFixed(4)),t.push("  Ke "+i.emissiveColor.r.toFixed(4)+" "+i.emissiveColor.g.toFixed(4)+" "+i.emissiveColor.b.toFixed(4)),i.ambientTexture&&t.push("  map_Ka "+i.ambientTexture.name),i.diffuseTexture&&t.push("  map_Kd "+i.diffuseTexture.name),i.specularTexture&&t.push("  map_Ks "+i.specularTexture.name),i.bumpTexture&&t.push("  map_bump -imfchan z "+i.bumpTexture.name),i.opacityTexture&&t.push("  map_d "+i.opacityTexture.name),t.join("\n")}}var l=0,h=i(5797);class _{constructor(){this.files={}}get glTFFiles(){return this.files}downloadFiles(){for(let e in this.files){let t=new Blob([this.files[e]],{type:(0,h.ny)(e)});o.S0.Download(t,e)}}}var d=i(77633),c=i(77905),u=i(18640),f=i(44593),g=i(19201),m=i(32922),p=i(26856),v=i(16582),b=i(83730),x=i(75200),C=i(64544),T=i(72500),y=i(21833),S=i(9460);let P=new p.v9(.04,.04,.04),I=p.v9.White(),E=p.v9.Black();async function R(e){let t,i=e.getInternalTexture();if(!i||1!==i.source||i.invertY)return null;let s=i._buffer,r=e.mimeType;return(s?ArrayBuffer.isView(s)?t=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):s instanceof ArrayBuffer?t=s:s instanceof Blob?(t=await s.arrayBuffer(),r=s.type||r):"string"==typeof s?(t=await o.S0.LoadFileAsync(s),r=(0,h.ny)(s)||r):"undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement&&(t=await o.S0.LoadFileAsync(s.src),r=(0,h.ny)(s.src)||r):(t=await o.S0.LoadFileAsync(i.url),r=(0,h.ny)(i.url)||r),t&&r)?{data:t,mimeType:r}:null}function M(e,t,i){if(t<P.r)return 0;let s=P.r,r=e*i/(1-P.r)+t-2*P.r,o=P.r-t;return v.X.Clamp((-r+Math.sqrt(r*r-4*s*o))/(2*s),0,1)}function w(e){let t=e.diffuseColor.toLinearSpace(e.getScene().getEngine().useExactSrgbConversions).scale(.5),i=e.alpha,s=v.X.Clamp(e.specularPower,0,1024),r=(0,S.k)(s);return{baseColorFactor:[t.r,t.g,t.b,i],metallicFactor:0,roughnessFactor:r}}function O(e,t){t.needAlphaBlending()?e.alphaMode="BLEND":t.needAlphaTesting()&&(e.alphaMode="MASK",e.alphaCutoff=t.alphaCutOff)}function B(e,t,i){let s=new Uint8Array(e*t*4);for(let e=0;e<s.length;e+=4)s[e]=s[e+1]=s[e+2]=s[e+3]=255;return C.I.CreateRGBATexture(s,e,t,i)}function A(e){if(e instanceof Uint8Array){let t=e.length,i=new Float32Array(e.length);for(let s=0;s<t;++s)i[s]=e[s]/255;return i}if(e instanceof Float32Array)return e;throw Error("Unsupported pixel format!")}class F{constructor(e){this._exporter=e,this._textureMap=new Map,this._internalTextureToImage={}}getTextureInfo(e){return e?this._textureMap.get(e)??null:null}async exportStandardMaterialAsync(e,t){let i=w(e),s={name:e.name};if(null==e.backFaceCulling||e.backFaceCulling||(e.twoSidedLighting||o.S0.Warn(e.name+": Back-face culling disabled and two-sided lighting disabled is not supported in glTF."),s.doubleSided=!0),t){let t=[],r=e.diffuseTexture;r&&t.push(this.exportTextureAsync(r).then(e=>{e&&(i.baseColorTexture=e)}));let o=e.bumpTexture;o&&t.push(this.exportTextureAsync(o).then(e=>{e&&(s.normalTexture=e,1!==o.level&&(s.normalTexture.scale=o.level))}));let a=e.emissiveTexture;a&&(s.emissiveFactor=[1,1,1],t.push(this.exportTextureAsync(a).then(e=>{e&&(s.emissiveTexture=e)})));let n=e.ambientTexture;n&&t.push(this.exportTextureAsync(n).then(e=>{e&&(s.occlusionTexture={index:e.index})})),t.length>0&&(this._exporter._materialNeedsUVsSet.add(e),await Promise.all(t))}(e.alpha<1||e.opacityTexture)&&(e.alphaMode===T.Y.ALPHA_COMBINE?s.alphaMode="BLEND":o.S0.Warn(e.name+": glTF 2.0 does not support alpha mode: "+e.alphaMode.toString())),e.emissiveColor&&!e.emissiveColor.equalsWithEpsilon(E,1e-6)&&(s.emissiveFactor=e.emissiveColor.asArray()),s.pbrMetallicRoughness=i,O(s,e),await this._finishMaterialAsync(s,e);let r=this._exporter._materials;return r.push(s),r.length-1}async _finishMaterialAsync(e,t){let i=this._exporter._extensionsPostExportMaterialAdditionalTextures("exportMaterial",e,t),s=[];for(let e of i)s.push(this.exportTextureAsync(e));await Promise.all(s),await this._exporter._extensionsPostExportMaterialAsync("exportMaterial",e,t)}async _getImageDataAsync(e,t,i,s){return await y.DumpTools.DumpDataAsync(t,i,e,s,void 0,!1,!0)}_resizeTexturesToSameDimensions(e,t,i){let s,r,o=e?e.getSize():{width:0,height:0},a=t?t.getSize():{width:0,height:0};return o.width<a.width?(s=e&&e instanceof x.g?b.LO.CreateResizedCopy(e,a.width,a.height,!0):B(a.width,a.height,i),r=t):o.width>a.width?(r=t&&t instanceof x.g?b.LO.CreateResizedCopy(t,o.width,o.height,!0):B(o.width,o.height,i),s=e):(s=e,r=t),{texture1:s,texture2:r}}async _convertSpecularGlossinessTexturesToMetallicRoughnessAsync(e,t,i,s){let r=[];if(!(e||t))return await Promise.reject("diffuse and specular glossiness textures are not defined!");let o=e?e.getScene():t?t.getScene():null;if(!o)return await Promise.reject("_ConvertSpecularGlossinessTexturesToMetallicRoughness: Scene from textures is missing!");{let a,n,l=this._resizeTexturesToSameDimensions(e,t,o),h=l.texture1?.getSize(),_=h.width,d=h.height,c=await l.texture1.readPixels(),u=await l.texture2.readPixels();if(!c)return await Promise.reject("Failed to retrieve pixels from diffuse texture!");if(a=A(c),!u)return await Promise.reject("Failed to retrieve pixels from specular glossiness texture!");let f=(n=A(u)).byteLength,g=new Uint8Array(f),m=new Uint8Array(f),v=0,b=0;for(let e=0;e<d;++e)for(let t=0;t<_;++t){let s=(_*e+t)*4,r=new p.v9(a[s],a[s+1],a[s+2]).toLinearSpace(o.getEngine().useExactSrgbConversions).multiply(i.diffuseColor),h={diffuseColor:r,specularColor:new p.v9(n[s],n[s+1],n[s+2]).toLinearSpace(o.getEngine().useExactSrgbConversions).multiply(i.specularColor),glossiness:n[s+3]*i.glossiness},d=this._convertSpecularGlossinessToMetallicRoughness(h);E.r=Math.max(E.r,d.baseColor.r),E.g=Math.max(E.g,d.baseColor.g),E.b=Math.max(E.b,d.baseColor.b),v=Math.max(v,d.metallic),b=Math.max(b,d.roughness),m[s]=255*d.baseColor.r,m[s+1]=255*d.baseColor.g,m[s+2]=255*d.baseColor.b,m[s+3]=l.texture1.hasAlpha?255*a[s+3]:255,g[s]=0,g[s+1]=255*d.roughness,g[s+2]=255*d.metallic,g[s+3]=255}let x={baseColor:E,metallic:v,roughness:b},C=!1,T=!1;for(let e=0;e<d;++e)for(let t=0;t<_;++t){let i=(_*e+t)*4;m[i]/=x.baseColor.r>1e-6?x.baseColor.r:1,m[i+1]/=x.baseColor.g>1e-6?x.baseColor.g:1,m[i+2]/=x.baseColor.b>1e-6?x.baseColor.b:1;let s=p.v9.FromInts(m[i],m[i+1],m[i+2]).toGammaSpace(o.getEngine().useExactSrgbConversions);m[i]=255*s.r,m[i+1]=255*s.g,m[i+2]=255*s.b,s.equalsWithEpsilon(I,1e-6)||(T=!0),g[i+1]/=x.roughness>1e-6?x.roughness:1,g[i+2]/=x.metallic>1e-6?x.metallic:1,p.v9.FromInts(255,g[i+1],g[i+2]).equalsWithEpsilon(I,1e-6)||(C=!0)}return C&&r.push(this._getImageDataAsync(g,_,d,s).then(e=>{x.metallicRoughnessTextureData=e})),T&&r.push(this._getImageDataAsync(m,_,d,s).then(e=>{x.baseColorTextureData=e})),await Promise.all(r).then(()=>x)}}_convertSpecularGlossinessToMetallicRoughness(e){let t=this._getPerceivedBrightness(e.diffuseColor),i=this._getPerceivedBrightness(e.specularColor),s=1-this._getMaxComponent(e.specularColor),r=M(t,i,s),o=e.diffuseColor.scale(s/(1-P.r)/Math.max(1-r)),a=e.specularColor.subtract(P.scale(1-r)).scale(1/Math.max(r)),n=p.v9.Lerp(o,a,r*r);return{baseColor:n=n.clampToRef(0,1,n),metallic:r,roughness:1-e.glossiness}}_getPerceivedBrightness(e){return e?Math.sqrt(.299*e.r*e.r+.587*e.g*e.g+.114*e.b*e.b):0}_getMaxComponent(e){return e?Math.max(e.r,Math.max(e.g,e.b)):0}async _convertMetalRoughFactorsToMetallicRoughnessAsync(e,t,i){let s=[],r={baseColor:e._albedoColor,metallic:e._metallic,roughness:e._roughness};if(i){let i=e._albedoTexture;i&&s.push(this.exportTextureAsync(i).then(e=>{e&&(t.baseColorTexture=e)}));let r=e._metallicTexture;r&&s.push(this.exportTextureAsync(r).then(e=>{e&&(t.metallicRoughnessTexture=e)}))}return s.length>0&&(this._exporter._materialNeedsUVsSet.add(e),await Promise.all(s)),r}_getTextureSampler(e){let t={};if(!e||!(e instanceof x.g))return t;let i=this._getGLTFTextureWrapMode(e.wrapU);10497!==i&&(t.wrapS=i);let s=this._getGLTFTextureWrapMode(e.wrapV);switch(10497!==s&&(t.wrapT=s),e.samplingMode){case x.g.LINEAR_LINEAR:t.magFilter=9729,t.minFilter=9729;break;case x.g.LINEAR_NEAREST:t.magFilter=9729,t.minFilter=9728;break;case x.g.NEAREST_LINEAR:t.magFilter=9728,t.minFilter=9729;break;case x.g.NEAREST_LINEAR_MIPLINEAR:t.magFilter=9728,t.minFilter=9987;break;case x.g.NEAREST_NEAREST:t.magFilter=9728,t.minFilter=9728;break;case x.g.NEAREST_LINEAR_MIPNEAREST:t.magFilter=9728,t.minFilter=9985;break;case x.g.LINEAR_NEAREST_MIPNEAREST:t.magFilter=9729,t.minFilter=9984;break;case x.g.LINEAR_NEAREST_MIPLINEAR:t.magFilter=9729,t.minFilter=9986;break;case x.g.NEAREST_NEAREST_MIPLINEAR:t.magFilter=9728,t.minFilter=9986;break;case x.g.LINEAR_LINEAR_MIPLINEAR:t.magFilter=9729,t.minFilter=9987;break;case x.g.LINEAR_LINEAR_MIPNEAREST:t.magFilter=9729,t.minFilter=9985;break;case x.g.NEAREST_NEAREST_MIPNEAREST:t.magFilter=9728,t.minFilter=9984}return t}_getGLTFTextureWrapMode(e){switch(e){case x.g.WRAP_ADDRESSMODE:return 10497;case x.g.CLAMP_ADDRESSMODE:return 33071;case x.g.MIRROR_ADDRESSMODE:return 33648;default:return o.S0.Error(`Unsupported Texture Wrap Mode ${e}!`),10497}}async _convertSpecGlossFactorsToMetallicRoughnessAsync(e,t,i){let s="image/png",r={diffuseColor:e._albedoColor,specularColor:e._reflectivityColor,glossiness:e._microSurface},o=e._albedoTexture,a=e._reflectivityTexture,n=e._useMicroSurfaceFromReflectivityMapAlpha;if(a&&!n)return await Promise.reject("_ConvertPBRMaterial: Glossiness values not included in the reflectivity texture are currently not supported");if(!o&&!a||!i)return this._convertSpecularGlossinessToMetallicRoughness(r);{this._exporter._materialNeedsUVsSet.add(e);let i=this._exportTextureSampler(o||a),n=await this._convertSpecularGlossinessTexturesToMetallicRoughnessAsync(o,a,r,s),l=this._exporter._textures;if(n.baseColorTextureData){let e=this._exportImage(`baseColor${l.length}`,s,n.baseColorTextureData);t.baseColorTexture=this._exportTextureInfo(e,i,o?.coordinatesIndex)}if(n.metallicRoughnessTextureData){let e=this._exportImage(`metallicRoughness${l.length}`,s,n.metallicRoughnessTextureData);t.metallicRoughnessTexture=this._exportTextureInfo(e,i,a?.coordinatesIndex)}return n}}async exportPBRMaterialAsync(e,t){let i={},s={name:e.name},r=e.isMetallicWorkflow();if(r){let t=e._albedoColor,s=e.alpha;t&&(i.baseColorFactor=[t.r,t.g,t.b,s])}let o=r?await this._convertMetalRoughFactorsToMetallicRoughnessAsync(e,i,t):await this._convertSpecGlossFactorsToMetallicRoughnessAsync(e,i,t);await this._setMetallicRoughnessPbrMaterialAsync(o,e,s,i,t),await this._finishMaterialAsync(s,e);let a=this._exporter._materials;return a.push(s),a.length-1}async _setMetallicRoughnessPbrMaterialAsync(e,t,i,s,r){if(O(i,t),e.baseColor.equalsWithEpsilon(I,1e-6)&&v.X.WithinEpsilon(t.alpha,1,1e-6)||(s.baseColorFactor=[e.baseColor.r,e.baseColor.g,e.baseColor.b,t.alpha]),null!=e.metallic&&1!==e.metallic&&(s.metallicFactor=e.metallic),null!=e.roughness&&1!==e.roughness&&(s.roughnessFactor=e.roughness),null==t.backFaceCulling||t.backFaceCulling||(t._twoSidedLighting||o.S0.Warn(t.name+": Back-face culling disabled and two-sided lighting disabled is not supported in glTF."),i.doubleSided=!0),r){let e=[],s=t._bumpTexture;s&&e.push(this.exportTextureAsync(s).then(e=>{e&&(i.normalTexture=e,1!==s.level&&(i.normalTexture.scale=s.level))}));let r=t._ambientTexture;r&&e.push(this.exportTextureAsync(r).then(e=>{if(e){let s={index:e.index,texCoord:e.texCoord,extensions:e.extensions};i.occlusionTexture=s;let r=t._ambientTextureStrength;r&&(s.strength=r)}}));let o=t._emissiveTexture;o&&e.push(this.exportTextureAsync(o).then(e=>{e&&(i.emissiveTexture=e)})),e.length>0&&(this._exporter._materialNeedsUVsSet.add(t),await Promise.all(e))}let a=t._emissiveColor;a.equalsWithEpsilon(E,1e-6)||(i.emissiveFactor=a.asArray()),i.pbrMetallicRoughness=s}async exportTextureAsync(e){let t=this._textureMap.get(e);if(t)return t;let i=this._exportTextureSampler(e),s=await this._exportTextureImageAsync(e);return t=this._exportTextureInfo(s,i,e.coordinatesIndex),this._textureMap.set(e,t),this._exporter._extensionsPostExportTextures("exporter",t,e),t}async _exportTextureImageAsync(e){let t=e.mimeType??"none",i=this._internalTextureToImage,s=e.getInternalTexture().uniqueId;i[s]=i[s]||{};let r=i[s][t];return void 0===r&&(r=(async()=>{let i=await R(e);if(i&&("none"===t||i.mimeType===t))return this._exportImage(e.name,i.mimeType,i.data);let s="image/png";if("none"!==t)switch(t){case"image/jpeg":case"image/png":case"image/webp":s=t;break;default:o.S0.Warn(`Unsupported media type: ${t}. Exporting texture as PNG.`)}let r=e.getSize(),a=await (0,b.Oz)(e),n=await this._getImageDataAsync(a,r.width,r.height,s);return this._exportImage(e.name,s,n)})(),i[s][t]=r),await r}_exportImage(e,t,i){let s,r=this._exporter._images;if(this._exporter._shouldUseGlb){s={name:e,mimeType:t,bufferView:void 0};let r=this._exporter._bufferManager.createBufferView(new Uint8Array(i));this._exporter._bufferManager.setBufferView(s,r)}else{let a=e.replace(/\.\/|\/|\.\\|\\/g,"_"),n=function(e){switch(e){case"image/jpeg":return".jpg";case"image/png":return".png";case"image/webp":return".webp";case"image/avif":return".avif";case"image/ktx2":return".ktx2"}}(t),l=a+n;r.some(e=>e.uri===l)&&(l=`${a}_${o.S0.RandomId()}${n}`),s={name:e,uri:l},this._exporter._imageData[l]={data:i,mimeType:t}}return r.push(s),r.length-1}_exportTextureInfo(e,t,i){let s=this._exporter._textures,r=s.findIndex(i=>i.sampler==t&&i.source===e);-1===r&&(r=s.length,s.push({source:e,sampler:t}));let o={index:r};return i&&(o.texCoord=i),o}_exportTextureSampler(e){let t=this._getTextureSampler(e),i=this._exporter._samplers,s=i.findIndex(e=>e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.wrapS===t.wrapS&&e.wrapT===t.wrapT);return -1!==s?s:(i.push(t),i.length-1)}}var L=i(26442),N=i(43048),D=i(81452),k=i(72422);let V=r.uq.Compose(new r.Pq(-1,1,1),r.PT.Identity(),r.Pq.Zero());function U(e,t){if(!(e instanceof c.V))return!1;if(t){if(!e.getWorldMatrix().equalsWithEpsilon(r.uq.IdentityReadOnly,k.bH))return!1}else if(!e.getWorldMatrix().multiplyToRef(V,r.AA.Matrix[0]).equalsWithEpsilon(r.uq.IdentityReadOnly,k.bH))return!1;return!(e instanceof u.u)||!e.geometry}let z=r.Pq.Zero(),W=r.PT.Identity(),Q=r.Pq.One(),G=new r.Pq(-1,1,1);function H(e,t){let{byteOffset:i,byteStride:s,type:r,normalized:o}=e,a=e.getSize(),n=t.reduce((e,t)=>t.getTotalVertices()>e?t.getTotalVertices():e,-Number.MAX_VALUE);return{byteOffset:i,byteStride:s,componentCount:a,type:r,count:n*a,normalized:o,totalVertices:n,kind:e.getKind()}}function K(e){switch(e){case"MAT2":case"VEC4":return 4;case"MAT3":return 9;case"MAT4":return 16;case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3}}function X(e){switch(e){case d.R.PositionKind:case d.R.NormalKind:case d.R.TangentKind:case d.R.ColorKind:case d.R.MatricesIndicesKind:case d.R.MatricesIndicesExtraKind:case d.R.MatricesWeightsKind:case d.R.MatricesWeightsExtraKind:case d.R.UVKind:case d.R.UV2Kind:case d.R.UV3Kind:case d.R.UV4Kind:case d.R.UV5Kind:case d.R.UV6Kind:return!0}return!1}function Y(e){switch(e){case a.i.TriangleFillMode:return 4;case a.i.TriangleStripDrawMode:return 5;case a.i.TriangleFanDrawMode:return 6;case a.i.PointListDrawMode:case a.i.PointFillMode:return 0;case a.i.LineLoopDrawMode:return 2;case a.i.LineListDrawMode:return 1;case a.i.LineStripDrawMode:return 3}throw Error(`Unknown fill mode: ${e}`)}function q(e){let t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);t>0&&(e.x/=t,e.y/=t,e.z/=t)}function j(e){return e.x*=-1,e}function $(e){if(e.x*e.x+e.y*e.y>.5){let t=Math.abs(e.x),i=Math.abs(e.y);if(t>i){let i=Math.sign(e.x);e.x=t,e.y*=-i,e.z*=-i,e.w*=i}else{let t=Math.sign(e.y);e.x*=-t,e.y=i,e.z*=t,e.w*=-t}}else{let t=Math.abs(e.z),i=Math.abs(e.w);if(t>i){let i=Math.sign(e.z);e.x*=-i,e.y*=i,e.z=t,e.w*=-i}else{let t=Math.sign(e.w);e.x*=t,e.y*=-t,e.z*=-t,e.w=i}}return e}function Z(e){e.copyFromFloats(-e.z,e.w,e.x,-e.y)}function J(e,t){let i=r.Pq.FromArrayToRef(t.translation||[0,0,0],0,r.AA.Vector3[0]),s=r.PT.FromArrayToRef(t.rotation||[0,0,0,1],0,r.AA.Quaternion[0]),o=r.uq.ComposeToRef(Q,s,i,r.AA.Matrix[0]),a=r.Pq.FromArrayToRef(e.translation||[0,0,0],0,r.AA.Vector3[2]),n=r.PT.FromArrayToRef(e.rotation||[0,0,0,1],0,r.AA.Quaternion[1]),l=r.uq.ComposeToRef(Q,n,a,r.AA.Matrix[1]);o.multiplyToRef(l,l),l.decompose(void 0,s,i),i.equalsWithEpsilon(z,k.bH)?delete t.translation:t.translation=i.asArray(),s.equalsWithEpsilon(W,k.bH)?delete t.rotation:t.rotation=s.asArray(),t.scale&&delete t.scale}function ee(e,t){if(!(t instanceof c.V)||1!==t.getChildren().length||0!==e.getChildren().length||e.parent!==t)return!1;let i=e.getScene(),s=e instanceof D.F&&!i.useRightHandedSystem?G:Q;return!!t.scaling.equalsWithEpsilon(s,k.bH)||(N.V.Warn(`Cannot collapse node ${e.name} into parent node ${t.name} with modified scaling.`),!1)}function et(e,t){for(let[i,s]of Object.entries(e)){let r=t[i];(Array.isArray(s)&&Array.isArray(r)&&function(e,t){return e.length===t.length&&e.every((e,i)=>e===t[i])}(s,r)||s===r)&&delete e[i]}return e}let ei=new Map([[Int8Array,(e,t,i)=>e.setInt8(t,i)],[Uint8Array,(e,t,i)=>e.setUint8(t,i)],[Uint8ClampedArray,(e,t,i)=>e.setUint8(t,i)],[Int16Array,(e,t,i)=>e.setInt16(t,i,!0)],[Uint16Array,(e,t,i)=>e.setUint16(t,i,!0)],[Int32Array,(e,t,i)=>e.setInt32(t,i,!0)],[Uint32Array,(e,t,i)=>e.setUint32(t,i,!0)],[Float32Array,(e,t,i)=>e.setFloat32(t,i,!0)],[Float64Array,(e,t,i)=>e.setFloat64(t,i,!0)]]);class es{writeTypedArray(e){this._checkGrowBuffer(e.byteLength);let t=ei.get(e.constructor);for(let i=0;i<e.length;i++)t(this._dataView,this._byteOffset,e[i]),this._byteOffset+=e.BYTES_PER_ELEMENT}constructor(e){this._data=new Uint8Array(e),this._dataView=new DataView(this._data.buffer),this._byteOffset=0}get byteOffset(){return this._byteOffset}getOutputData(){return new Uint8Array(this._data.buffer,0,this._byteOffset)}writeUInt8(e){this._checkGrowBuffer(1),this._dataView.setUint8(this._byteOffset,e),this._byteOffset++}writeInt8(e){this._checkGrowBuffer(1),this._dataView.setInt8(this._byteOffset,e),this._byteOffset++}writeInt16(e){this._checkGrowBuffer(2),this._dataView.setInt16(this._byteOffset,e,!0),this._byteOffset+=2}writeUInt16(e){this._checkGrowBuffer(2),this._dataView.setUint16(this._byteOffset,e,!0),this._byteOffset+=2}writeInt32(e){this._checkGrowBuffer(4),this._dataView.setInt32(this._byteOffset,e,!0),this._byteOffset+=4}writeUInt32(e){this._checkGrowBuffer(4),this._dataView.setUint32(this._byteOffset,e,!0),this._byteOffset+=4}writeFloat32(e){this._checkGrowBuffer(4),this._dataView.setFloat32(this._byteOffset,e,!0),this._byteOffset+=4}writeFloat64(e){this._checkGrowBuffer(8),this._dataView.setFloat64(this._byteOffset,e,!0),this._byteOffset+=8}_checkGrowBuffer(e){let t=this.byteOffset+e;if(t>this._data.byteLength){let e=new Uint8Array(2*t);e.set(this._data),this._data=e,this._dataView=new DataView(this._data.buffer)}}}function er(e){return e%4==0?4:e%2==0?2:1}class eo{constructor(){this._bufferViewToData=new Map,this._bufferViewToProperties=new Map,this._accessorToBufferView=new Map}generateBinary(e){let t=0;this._bufferViewToData.forEach(e=>{t+=e.byteLength});let i=new es(t);for(let t of Array.from(this._bufferViewToData.keys()).sort((e,t)=>er(t.byteLength)-er(e.byteLength))){t.byteOffset=i.byteOffset,e.push(t);let s=e.length-1;for(let e of this.getPropertiesWithBufferView(t))e.bufferView=s;i.writeTypedArray(this._bufferViewToData.get(t)),this._bufferViewToData.delete(t)}return i.getOutputData()}createBufferView(e,t){let i={buffer:0,byteOffset:void 0,byteLength:e.byteLength,byteStride:t};return this._bufferViewToData.set(i,e),i}createAccessor(e,t,i,s,r,o,a){this._verifyBufferView(e);let n={bufferView:void 0,componentType:i,count:s,type:t,min:o?.min,max:o?.max,normalized:a,byteOffset:r};return this.setBufferView(n,e),this._accessorToBufferView.set(n,e),n}setBufferView(e,t){this._verifyBufferView(t),this.getPropertiesWithBufferView(t).push(e)}removeBufferView(e){for(let t of this.getPropertiesWithBufferView(e))void 0!==t.bufferView&&delete t.bufferView;this._bufferViewToData.delete(e),this._bufferViewToProperties.delete(e),this._accessorToBufferView.forEach((t,i)=>{t===e&&(void 0!==i.byteOffset&&delete i.byteOffset,this._accessorToBufferView.delete(i))})}getBufferView(e){let t=this._accessorToBufferView.get(e);return this._verifyBufferView(t),t}getPropertiesWithBufferView(e){return this._verifyBufferView(e),this._bufferViewToProperties.set(e,this._bufferViewToProperties.get(e)??[]),this._bufferViewToProperties.get(e)}getData(e){return this._verifyBufferView(e),this._bufferViewToData.get(e)}_verifyBufferView(e){if(void 0===e||!this._bufferViewToData.has(e))throw Error(`BufferView ${e} not found in BufferManager.`)}}var ea=i(40917),en=i(95468),el=i(70019),eh=i(78684),e_=i(9333),ed=i(60331),ec=i(29218),eu=i(64513);!function(e){e[e.INTANGENT=0]="INTANGENT",e[e.OUTTANGENT=1]="OUTTANGENT"}(s||(s={}));class ef{static _IsTransformable(e){return e&&(e instanceof c.V||e instanceof ea.i||e instanceof eu.v)}static _CreateNodeAnimation(e,t,i,s,r){if(this._IsTransformable(e)){let a=[],n=[],l=t.getKeys(),h=ef._CalculateMinMaxKeyFrames(l),_=ef._DeduceInterpolation(l,i,s),d=_.interpolationType,c=_.shouldBakeAnimation;if(c?ef._CreateBakedAnimation(e,t,i,h.min,h.max,t.framePerSecond,r,a,n,h,s):"LINEAR"===d||"STEP"===d?ef._CreateLinearOrStepAnimation(e,t,i,a,n,s):"CUBICSPLINE"===d?ef._CreateCubicSplineAnimation(e,t,i,a,n,s):ef._CreateBakedAnimation(e,t,i,h.min,h.max,t.framePerSecond,r,a,n,h,s),a.length&&n.length)return{inputs:a,outputs:n,samplerInterpolation:d,inputsMin:c?h.min:o.S0.FloatRound(h.min/t.framePerSecond),inputsMax:c?h.max:o.S0.FloatRound(h.max/t.framePerSecond)}}return null}static _DeduceAnimationInfo(e){let t=null,i="VEC3",s=!1,r=e.targetProperty.split(".");switch(r[0]){case"scaling":t="scale";break;case"position":t="translation";break;case"rotation":i="VEC4",t="rotation";break;case"rotationQuaternion":i="VEC4",s=!0,t="rotation";break;case"influence":i="SCALAR",t="weights";break;default:o.S0.Error(`Unsupported animatable property ${r[0]}`)}return t?{animationChannelTargetPath:t,dataAccessorType:i,useQuaternion:s}:(o.S0.Error("animation channel target path and data accessor type could be deduced"),null)}static _CreateNodeAnimationFromNodeAnimations(e,t,i,s,r,o,a,n,l,h,_){let d;if(ef._IsTransformable(e)&&e.animations)for(let r of e.animations){if(_&&!_(r))continue;let c=ef._DeduceAnimationInfo(r);c&&(d={name:r.name,samplers:[],channels:[]},ef._AddAnimation(`${r.name}`,r.hasRunningRuntimeAnimations?t:d,e,r,c.dataAccessorType,c.animationChannelTargetPath,s,o,a,n,c.useQuaternion,l,h),d.samplers.length&&d.channels.length&&i.push(d))}}static _CreateMorphTargetAnimationFromMorphTargetAnimations(e,t,i,s,r,o,a,n,l,h,_){let d;if(e instanceof ec.e){let r=e.morphTargetManager;if(r)for(let c=0;c<r.numTargets;++c)for(let u of r.getTarget(c).animations){if(_&&!_(u))continue;let f=new e_.X5(`${u.name}`,"influence",u.framePerSecond,u.dataType,u.loopMode,u.enableBlending),g=[],m=u.getKeys();for(let e=0;e<m.length;++e){let t=m[e];for(let e=0;e<r.numTargets;++e)e==c?g.push(t):g.push({frame:t.frame,value:0})}f.setKeys(g);let p=ef._DeduceAnimationInfo(f);p&&(d={name:f.name,samplers:[],channels:[]},ef._AddAnimation(u.name,u.hasRunningRuntimeAnimations?t:d,e,f,p.dataAccessorType,p.animationChannelTargetPath,s,o,a,n,p.useQuaternion,l,h,r.numTargets),d.samplers.length&&d.channels.length&&i.push(d))}}}static _CreateNodeAndMorphAnimationFromAnimationGroups(e,t,i,s,r,o,a,n,l){let h;if(e.animationGroups)for(let _ of e.animationGroups){let d=new Map,c=new Map,u=new Set,f=_.to-_.from;h={name:_.name,channels:[],samplers:[]};for(let t=0;t<_.targetedAnimations.length;++t){let f=_.targetedAnimations[t],g=f.target,m=f.animation;if(l&&!l(m))continue;let p=n.has(g);if(this._IsTransformable(g)||1===g.length&&this._IsTransformable(g[0])){let e=ef._DeduceAnimationInfo(f.animation);if(e){let t=this._IsTransformable(g)?g:this._IsTransformable(g[0])?g[0]:null;t&&ef._AddAnimation(`${m.name}`,h,t,m,e.dataAccessorType,e.animationChannelTargetPath,i,s,r,o,e.useQuaternion,a,p)}}else if((g instanceof ed.M||1===g.length&&g[0]instanceof ed.M)&&ef._DeduceAnimationInfo(f.animation)){let t=g instanceof ed.M?g:g[0];if(t){let i=e.morphTargetManagers.find(e=>{for(let i=0;i<e.numTargets;++i)if(e.getTarget(i)===t)return!0;return!1});if(i){let s=e.meshes.find(e=>e.morphTargetManager===i);s&&(d.has(s)||d.set(s,new Map),d.get(s)?.set(t,m),u.add(s),c.set(s,m))}}}}u.forEach(e=>{let t=e.morphTargetManager,n=null,l=[],u=c.get(e).getKeys(),g=u.length;for(let i=0;i<g;++i)for(let s=0;s<t.numTargets;++s){let r=t.getTarget(s),o=d.get(e);if(o){let t=o.get(r);t?(n||(n=new e_.X5(`${_.name}_${e.name}_MorphWeightAnimation`,"influence",t.framePerSecond,e_.X5.ANIMATIONTYPE_FLOAT,t.loopMode,t.enableBlending)),l.push(t.getKeys()[i])):l.push({frame:_.from+f/g*i,value:r.influence,inTangent:u[0].inTangent?0:void 0,outTangent:u[0].outTangent?0:void 0})}}n.setKeys(l);let m=ef._DeduceAnimationInfo(n);m&&ef._AddAnimation(`${_.name}_${e.name}_MorphWeightAnimation`,h,e,n,m.dataAccessorType,m.animationChannelTargetPath,i,s,r,o,m.useQuaternion,a,!1,t?.numTargets)}),h.channels.length&&h.samplers.length&&t.push(h)}}static _AddAnimation(e,t,i,s,o,a,n,l,h,_,d,c,u,f){let g,m,p,v,b,x,C=ef._CreateNodeAnimation(i,s,a,d,c);if(C){if(f){let e=0,t=0,i=[];for(;C.inputs.length>0;)t=C.inputs.shift(),e%f==0&&i.push(t),e++;C.inputs=i}let e=n.get(i),s=new Float32Array(C.inputs);g=l.createBufferView(s),m=l.createAccessor(g,"SCALAR",5126,C.inputs.length,void 0,{min:[C.inputsMin],max:[C.inputsMax]}),_.push(m),p=_.length-1;let h=new r.PT,d=new r.Pq,c=new r.Pq,T=i instanceof ea.i,y=K(o),S=new Float32Array(C.outputs.length*y);C.outputs.forEach(function(e,t){let i=e;switch(a){case"translation":u&&(r.Pq.FromArrayToRef(e,0,c),j(c),c.toArray(i));break;case"rotation":4===e.length?r.PT.FromArrayToRef(e,0,h):(i=[,,,,],r.Pq.FromArrayToRef(e,0,d),r.PT.FromEulerVectorToRef(d,h)),u&&($(h),T&&Z(h)),h.toArray(i)}S.set(i,t*y)}),g=l.createBufferView(S),m=l.createAccessor(g,o,5126,C.outputs.length),_.push(m),v=_.length-1,b={interpolation:C.samplerInterpolation,input:p,output:v},t.samplers.push(b),x={sampler:t.samplers.length-1,target:{node:e,path:a}},t.channels.push(x)}}static _CreateBakedAnimation(e,t,i,s,a,n,l,h,_,d,c){let u,f,g=r.PT.Identity(),m=null,p=null,v=null,b=null,x=null,C=null;d.min=o.S0.FloatRound(s/n);let T=t.getKeys();for(let s=0,r=T.length;s<r;++s){if(C=null,v=T[s],s+1<r)if(b=T[s+1],v.value.equals&&v.value.equals(b.value)||v.value===b.value)if(0!==s)continue;else C=v.frame;else C=b.frame;else{if(x=T[s-1],v.value.equals&&v.value.equals(x.value)||v.value===x.value)continue;C=a}if(C)for(let s=v.frame;s<=C;s+=l){if((f=o.S0.FloatRound(s/n))===m)continue;m=f,p=f;let r={key:0,repeatCount:0,loopMode:t.loopMode};u=t._interpolate(s,r),ef._SetInterpolatedValue(e,u,f,t,i,g,h,_,c)}}p&&(d.max=p)}static _ConvertFactorToVector3OrQuaternion(e,t,i,s,a){let n=ef._GetBasePositionRotationOrScale(t,s,a),l=i.targetProperty.split("."),h=l?l[1]:"",_=a?r.PT.FromArray(n).normalize():r.Pq.FromArray(n);switch(h){case"x":case"y":case"z":_[h]=e;break;case"w":_.w=e;break;default:o.S0.Error(`glTFAnimation: Unsupported component name "${h}"!`)}return _}static _SetInterpolatedValue(e,t,i,s,o,a,n,l,h){let _;if(n.push(i),"weights"===o)return void l.push([t]);s.dataType===e_.X5.ANIMATIONTYPE_FLOAT&&(t=this._ConvertFactorToVector3OrQuaternion(t,e,s,o,h)),"rotation"===o?(h?a=t:(_=t,r.PT.RotationYawPitchRollToRef(_.y,_.x,_.z,a)),l.push(a.asArray())):(_=t,l.push(_.asArray()))}static _CreateLinearOrStepAnimation(e,t,i,s,r,o){for(let a of t.getKeys())s.push(a.frame/t.framePerSecond),ef._AddKeyframeValue(a,t,r,i,e,o)}static _CreateCubicSplineAnimation(e,t,i,r,o,a){t.getKeys().forEach(function(n){r.push(n.frame/t.framePerSecond),ef._AddSplineTangent(s.INTANGENT,o,i,"CUBICSPLINE",n,a),ef._AddKeyframeValue(n,t,o,i,e,a),ef._AddSplineTangent(s.OUTTANGENT,o,i,"CUBICSPLINE",n,a)})}static _GetBasePositionRotationOrScale(e,t,i){return"rotation"===t?i?(e.rotationQuaternion??r.PT.Identity()).asArray():(e.rotation??r.Pq.Zero()).asArray():"translation"===t?(e.position??r.Pq.Zero()).asArray():(e.scaling??r.Pq.One()).asArray()}static _AddKeyframeValue(e,t,i,s,a,n){let l,h=t.dataType;if(h===e_.X5.ANIMATIONTYPE_VECTOR3){let t=e.value.asArray();if("rotation"===s){let e=r.Pq.FromArray(t);t=r.PT.RotationYawPitchRoll(e.y,e.x,e.z).asArray()}i.push(t)}else if(h===e_.X5.ANIMATIONTYPE_FLOAT){if("weights"===s)i.push([e.value]);else if(l=this._ConvertFactorToVector3OrQuaternion(e.value,a,t,s,n)){if("rotation"===s){let e=n?l:r.PT.RotationYawPitchRoll(l.y,l.x,l.z).normalize();i.push(e.asArray())}i.push(l.asArray())}}else h===e_.X5.ANIMATIONTYPE_QUATERNION?i.push(e.value.normalize().asArray()):o.S0.Error("glTFAnimation: Unsupported key frame values for animation!")}static _DeduceInterpolation(e,t,i){let s,r,o=!1;if("rotation"===t&&!i)return{interpolationType:"LINEAR",shouldBakeAnimation:!0};for(let t=0,i=e.length;t<i;++t)if((r=e[t]).inTangent||r.outTangent)if(s){if("CUBICSPLINE"!==s){s="LINEAR",o=!0;break}}else s="CUBICSPLINE";else if(s){if("CUBICSPLINE"===s||r.interpolation&&1===r.interpolation&&"STEP"!==s){s="LINEAR",o=!0;break}}else s=r.interpolation&&1===r.interpolation?"STEP":"LINEAR";return s||(s="LINEAR"),{interpolationType:s,shouldBakeAnimation:o}}static _AddSplineTangent(e,t,i,o,a,n){let l,h=e===s.INTANGENT?a.inTangent:a.outTangent;"CUBICSPLINE"===o&&(l="rotation"===i?h?n?h.asArray():r.PT.RotationYawPitchRoll(h.y,h.x,h.z).asArray():[0,0,0,0]:"weights"===i?h?[h]:[0]:h?h.asArray():[0,0,0],t.push(l))}static _CalculateMinMaxKeyFrames(e){let t=1/0,i=-1/0;return e.forEach(function(e){t=Math.min(t,e.frame),i=Math.max(i,e.frame)}),{min:t,max:i}}}var eg=i(9259),em=i(3970);class ep{constructor(e,t){this._indicesAccessorMap=new Map,this._vertexBufferViewMap=new Map,this._vertexAccessorMap=new Map,this._remappedBufferView=new Map,this._meshMorphTargetMap=new Map,this._vertexMapColorAlpha=new Map,this._exportedNodes=new Set,this._meshMap=new Map,this.convertedToRightHandedBuffers=new Map,this.convertToRightHanded=e,this.wasAddedByNoopNode=t}getIndicesAccessor(e,t,i,s,r){return this._indicesAccessorMap.get(e)?.get(t)?.get(i)?.get(s)?.get(r)}setIndicesAccessor(e,t,i,s,r,o){let a=this._indicesAccessorMap.get(e);a||(a=new Map,this._indicesAccessorMap.set(e,a));let n=a.get(t);n||(n=new Map,a.set(t,n));let l=n.get(i);l||(l=new Map,n.set(i,l));let h=l.get(s);h||(h=new Map,l.set(s,h)),h.set(r,o)}pushExportedNode(e){this._exportedNodes.has(e)||this._exportedNodes.add(e)}getNodesSet(){return this._exportedNodes}getVertexBufferView(e){return this._vertexBufferViewMap.get(e)}setVertexBufferView(e,t){this._vertexBufferViewMap.set(e,t)}setRemappedBufferView(e,t,i){this._remappedBufferView.set(e,new Map),this._remappedBufferView.get(e).set(t,i)}getRemappedBufferView(e,t){return this._remappedBufferView.get(e)?.get(t)}getVertexAccessor(e,t,i){return this._vertexAccessorMap.get(e)?.get(t)?.get(i)}setVertexAccessor(e,t,i,s){let r=this._vertexAccessorMap.get(e);r||(r=new Map,this._vertexAccessorMap.set(e,r));let o=r.get(t);o||(o=new Map,r.set(t,o)),o.set(i,s)}hasVertexColorAlpha(e){return this._vertexMapColorAlpha.get(e)||!1}setHasVertexColorAlpha(e,t){return this._vertexMapColorAlpha.set(e,t)}getMesh(e){return this._meshMap.get(e)}setMesh(e,t){this._meshMap.set(e,t)}bindMorphDataToMesh(e,t){let i=this._meshMorphTargetMap.get(e)||[];this._meshMorphTargetMap.set(e,i),-1===i.indexOf(t)&&i.push(t)}getMorphTargetsFromMesh(e){return this._meshMorphTargetMap.get(e)}}class ev{_ApplyExtension(e,t,i,s){if(i>=t.length)return Promise.resolve(e);let r=s(t[i],e);return r?r.then(async e=>e?await this._ApplyExtension(e,t,i+1,s):null):this._ApplyExtension(e,t,i+1,s)}_ApplyExtensions(e,t){let i=[];for(let e of ev._ExtensionNames)i.push(this._extensions[e]);return this._ApplyExtension(e,i,0,t)}_extensionsPostExportNodeAsync(e,t,i,s,r){return this._ApplyExtensions(t,(t,o)=>t.postExportNodeAsync&&t.postExportNodeAsync(e,o,i,s,r,this._bufferManager))}_extensionsPostExportMaterialAsync(e,t,i){return this._ApplyExtensions(t,(t,s)=>t.postExportMaterialAsync&&t.postExportMaterialAsync(e,s,i))}_extensionsPostExportMaterialAdditionalTextures(e,t,i){let s=[];for(let r of ev._ExtensionNames){let o=this._extensions[r];o.postExportMaterialAdditionalTextures&&s.push(...o.postExportMaterialAdditionalTextures(e,t,i))}return s}_extensionsPostExportTextures(e,t,i){for(let s of ev._ExtensionNames){let r=this._extensions[s];r.postExportTexture&&r.postExportTexture(e,t,i)}}_extensionsPostExportMeshPrimitive(e){for(let t of ev._ExtensionNames){let i=this._extensions[t];i.postExportMeshPrimitive&&i.postExportMeshPrimitive(e,this._bufferManager,this._accessors)}}async _extensionsPreGenerateBinaryAsync(){for(let e of ev._ExtensionNames){let t=this._extensions[e];t.preGenerateBinaryAsync&&await t.preGenerateBinaryAsync(this._bufferManager)}}_forEachExtensions(e){for(let t of ev._ExtensionNames){let i=this._extensions[t];i.enabled&&e(i)}}_extensionsOnExporting(){this._forEachExtensions(e=>{var t,i,s;e.wasUsed&&((t=this._glTF).extensionsUsed||(t.extensionsUsed=[]),-1===this._glTF.extensionsUsed.indexOf(e.name)&&this._glTF.extensionsUsed.push(e.name),e.required&&((i=this._glTF).extensionsRequired||(i.extensionsRequired=[]),-1===this._glTF.extensionsRequired.indexOf(e.name)&&this._glTF.extensionsRequired.push(e.name)),(s=this._glTF).extensions||(s.extensions={}),e.onExporting&&e.onExporting())})}_loadExtensions(){for(let e of ev._ExtensionNames){let t=ev._ExtensionFactories[e](this);this._extensions[e]=t}}constructor(e=m.q.LastCreatedScene,t){if(this._glTF={asset:{generator:`Babylon.js v${g.N.Version}`,version:"2.0"}},this._animations=[],this._accessors=[],this._bufferViews=[],this._cameras=[],this._images=[],this._materials=[],this._meshes=[],this._nodes=[],this._samplers=[],this._scenes=[],this._skins=[],this._textures=[],this._imageData={},this._shouldUseGlb=!1,this._materialExporter=new F(this),this._extensions={},this._bufferManager=new eo,this._shouldExportNodeMap=new Map,this._nodeMap=new Map,this._materialMap=new Map,this._camerasMap=new Map,this._nodesCameraMap=new Map,this._skinMap=new Map,this._nodesSkinMap=new Map,this._materialNeedsUVsSet=new Set,!e)throw Error("No scene available to export");this._babylonScene=e,this._options={shouldExportNode:()=>!0,shouldExportAnimation:()=>!0,metadataSelector:e=>e?.gltf?.extras,animationSampleRate:1/60,exportWithoutWaitingForScene:!1,exportUnusedUVs:!1,removeNoopRootNodes:!0,includeCoordinateSystemConversionNodes:!1,meshCompressionMethod:"None",...t},this._loadExtensions()}dispose(){for(let e in this._extensions)this._extensions[e].dispose()}get options(){return this._options}static RegisterExtension(e,t){ev.UnregisterExtension(e)&&o.S0.Warn(`Extension with the name ${e} already exists`),ev._ExtensionFactories[e]=t,ev._ExtensionNames.push(e)}static UnregisterExtension(e){if(!ev._ExtensionFactories[e])return!1;delete ev._ExtensionFactories[e];let t=ev._ExtensionNames.indexOf(e);return -1!==t&&ev._ExtensionNames.splice(t,1),!0}_generateJSON(e,t,i){let s={byteLength:e};return s.byteLength&&(this._glTF.buffers=[s]),this._nodes&&this._nodes.length&&(this._glTF.nodes=this._nodes),this._meshes&&this._meshes.length&&(this._glTF.meshes=this._meshes),this._scenes&&this._scenes.length&&(this._glTF.scenes=this._scenes,this._glTF.scene=0),this._cameras&&this._cameras.length&&(this._glTF.cameras=this._cameras),this._bufferViews&&this._bufferViews.length&&(this._glTF.bufferViews=this._bufferViews),this._accessors&&this._accessors.length&&(this._glTF.accessors=this._accessors),this._animations&&this._animations.length&&(this._glTF.animations=this._animations),this._materials&&this._materials.length&&(this._glTF.materials=this._materials),this._textures&&this._textures.length&&(this._glTF.textures=this._textures),this._samplers&&this._samplers.length&&(this._glTF.samplers=this._samplers),this._skins&&this._skins.length&&(this._glTF.skins=this._skins),this._images&&this._images.length&&(this._glTF.images=this._images),this._shouldUseGlb||(s.uri=t+".bin"),i?JSON.stringify(this._glTF,null,2):JSON.stringify(this._glTF)}async generateGLTFAsync(e){let t=await this._generateBinaryAsync();this._extensionsOnExporting();let i=this._generateJSON(t.byteLength,e,!0),s=new Blob([t],{type:"application/octet-stream"}),r=e+".gltf",o=e+".bin",a=new _;if(a.files[r]=i,a.files[o]=s,this._imageData)for(let e in this._imageData)a.files[e]=new Blob([this._imageData[e].data],{type:this._imageData[e].mimeType});return a}async _generateBinaryAsync(){return await this._exportSceneAsync(),await this._extensionsPreGenerateBinaryAsync(),this._bufferManager.generateBinary(this._bufferViews)}_getPadding(e){let t=e%4;return 0===t?t:4-t}async generateGLBAsync(e){let t;this._shouldUseGlb=!0;let i=await this._generateBinaryAsync();this._extensionsOnExporting();let s=this._generateJSON(i.byteLength),r=s.length;"undefined"!=typeof TextEncoder&&(r=(t=new TextEncoder().encode(s)).length);let o=this._getPadding(r),a=this._getPadding(i.byteLength),n=28+r+o+i.byteLength+a,l=new es(n);if(l.writeUInt32(0x46546c67),l.writeUInt32(2),l.writeUInt32(n),l.writeUInt32(r+o),l.writeUInt32(0x4e4f534a),t)l.writeTypedArray(t);else for(let e=0;e<r;++e){let t=s.charCodeAt(e);t!=s.codePointAt(e)?l.writeUInt8(95):l.writeUInt8(t)}for(let e=0;e<o;++e)l.writeUInt8(32);l.writeUInt32(i.byteLength+a),l.writeUInt32(5130562),l.writeTypedArray(i);for(let e=0;e<a;++e)l.writeUInt8(0);let h=new _;return h.files[e+".glb"]=new Blob([l.getOutputData()],{type:"application/octet-stream"}),h}_setNodeTransformation(e,t,i){if(t.getPivotPoint().equalsWithEpsilon(z,k.bH)||o.S0.Warn("Pivot points are not supported in the glTF serializer"),!t.position.equalsWithEpsilon(z,k.bH)){let s=r.AA.Vector3[0].copyFrom(t.position);i&&j(s),e.translation=s.asArray()}t.scaling.equalsWithEpsilon(Q,k.bH)||(e.scale=t.scaling.asArray());let s=t.rotationQuaternion?.clone()||r.PT.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z);s.equalsWithEpsilon(W,k.bH)||(i&&$(s),e.rotation=s.normalize().asArray())}_setCameraTransformation(e,t,i){if(!t.position.equalsWithEpsilon(z,k.bH)){let s=r.AA.Vector3[0].copyFrom(t.position);i&&j(s),e.translation=s.asArray()}let s=t.rotationQuaternion||r.PT.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z);i&&$(s),this._babylonScene.useRightHandedSystem||Z(s),s.equalsWithEpsilon(W,k.bH)||(e.rotation=s.asArray())}_listAvailableCameras(){for(let e of this._babylonScene.cameras){let t={type:e.mode===ea.i.PERSPECTIVE_CAMERA?"perspective":"orthographic"};(e.name&&(t.name=e.name),"perspective"===t.type)?t.perspective={aspectRatio:e.getEngine().getAspectRatio(e),yfov:e.fovMode===ea.i.FOVMODE_VERTICAL_FIXED?e.fov:e.fov*e.getEngine().getAspectRatio(e),znear:e.minZ,zfar:e.maxZ}:"orthographic"===t.type&&(t.orthographic={xmag:e.orthoLeft&&e.orthoRight?.5*(e.orthoRight-e.orthoLeft):.5*e.getEngine().getRenderWidth(),ymag:e.orthoBottom&&e.orthoTop?.5*(e.orthoTop-e.orthoBottom):.5*e.getEngine().getRenderHeight(),znear:e.minZ,zfar:e.maxZ}),this._camerasMap.set(e,t)}}_exportAndAssignCameras(){for(let e of Array.from(this._camerasMap.values())){let t=this._nodesCameraMap.get(e);if(void 0!==t)for(let i of(this._cameras.push(e),t))i.camera=this._cameras.length-1}}_listAvailableSkeletons(){for(let e of this._babylonScene.skeletons){if(e.bones.length<=0)continue;let t={joints:[]};this._skinMap.set(e,t)}}_exportAndAssignSkeletons(e){for(let t of this._babylonScene.skeletons){if(t.bones.length<=0)continue;let i=this._skinMap.get(t);if(void 0==i)continue;let s={},a=-1;for(let e=0;e<t.bones.length;++e){let i=t.bones[e],r=i.getIndex()??e;-1!==r&&(s[r]=i,r>a&&(a=r))}let n=[];for(let t=0;t<=a;++t){let a=s[t],l=a.getTransformNode(),h=l?this._nodeMap.get(l):void 0;if(void 0===h){o.S0.Warn("Exporting a bone without a linked transform node is currently unsupported.");continue}i.joints.push(h);let _=a.getAbsoluteInverseBindMatrix().clone();e.has(l)&&V.invertToRef(r.AA.Matrix[0]).multiplyToRef(_,_).multiplyToRef(V,_),n.push(_)}let l=this._nodesSkinMap.get(i);if(i.joints.length>0&&void 0!==l){let e=new Float32Array(16*n.length);n.forEach((t,i)=>{e.set(t.m,16*i)});let t=this._bufferManager.createBufferView(e);this._accessors.push(this._bufferManager.createAccessor(t,"MAT4",5126,n.length)),i.inverseBindMatrices=this._accessors.length-1,this._skins.push(i);let s=this._skins.length-1;for(let e of l)e.skin=s}}}async _exportSceneAsync(){let e={nodes:[]};if(this._babylonScene.metadata){let t=this._options.metadataSelector(this._babylonScene.metadata);t&&(e.extras=t)}let t=[],i=[],s=[];for(let e of this._babylonScene.rootNodes)this._options.removeNoopRootNodes&&!this._options.includeCoordinateSystemConversionNodes&&U(e,this._babylonScene.useRightHandedSystem)?s.push(...e.getChildren()):this._babylonScene.useRightHandedSystem?t.push(e):i.push(e);this._listAvailableCameras(),this._listAvailableSkeletons();let r=new ep(!0,!1);e.nodes.push(...await this._exportNodesAsync(i,r));let o=new ep(!1,!1);e.nodes.push(...await this._exportNodesAsync(t,o));let a=new ep(!1,!0);e.nodes.push(...await this._exportNodesAsync(s,a)),e.nodes.length&&this._scenes.push(e),this._exportAndAssignCameras(),this._exportAndAssignSkeletons(r.getNodesSet()),this._babylonScene.animationGroups.length&&ef._CreateNodeAndMorphAnimationFromAnimationGroups(this._babylonScene,this._animations,this._nodeMap,this._bufferManager,this._bufferViews,this._accessors,this._animationSampleRate,r.getNodesSet(),this._options.shouldExportAnimation)}_shouldExportNode(e){let t=this._shouldExportNodeMap.get(e);return void 0===t&&(t=this._options.shouldExportNode(e),this._shouldExportNodeMap.set(e,t)),t}async _exportNodesAsync(e,t){let i=[];for(let s of(this._exportBuffers(e,t),e))await this._exportNodeAsync(s,i,t);return i}_collectBuffers(e,t,i,s,r){if(this._shouldExportNode(e)&&e instanceof u.u&&e.geometry){let o=e.geometry.getVertexBuffers();if(o)for(let s in o){if(!X(s))continue;let a=o[s];r.setHasVertexColorAlpha(a,e.hasVertexAlpha);let n=a._buffer,l=t.get(n)||[];t.set(n,l),-1===l.indexOf(a)&&l.push(a);let h=i.get(a)||[];i.set(a,h),-1===h.indexOf(e)&&h.push(e)}let a=e.morphTargetManager;if(a)for(let t=0;t<a.numTargets;t++){let i=a.getTarget(t),r=s.get(i)||[];s.set(i,r),-1===r.indexOf(e)&&r.push(e)}}for(let o of e.getChildren())this._collectBuffers(o,t,i,s,r)}_exportBuffers(e,t){let i=new Map,s=new Map,a=new Map;for(let r of e)this._collectBuffers(r,i,s,a,t);for(let e of Array.from(i.keys())){let r=e.getData();if(!r)throw Error("Buffer data is not available");let o=i.get(e);if(!o)continue;let a=o[0].byteStride;if(o.some(e=>e.byteStride!==a))throw Error("Vertex buffers pointing to the same buffer must have the same byte stride");let n=(function(e){if(e instanceof Array){let t=new Float32Array(e);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}return ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)})(r).slice();for(let e of o){let t=s.get(e),{byteOffset:i,byteStride:r,componentCount:o,type:a,count:l,normalized:h,kind:_}=H(e,t);switch(_){case d.R.NormalKind:case d.R.TangentKind:(0,L.XG)(n,i,r,o,a,l,h,e=>{let t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(t>0){let i=1/t;e[0]*=i,e[1]*=i,e[2]*=i}});break;case d.R.ColorKind:{let e=t.filter(e=>e.material instanceof eh.F||null==e.material).length;if(0==e)break;if(e!=t.length){N.V.Warn("Not converting vertex color space, as buffer is shared by StandardMaterials and other material types. Results may look incorrect.");break}a==d.R.UNSIGNED_BYTE&&N.V.Warn("Converting uint8 vertex colors to linear space. Results may look incorrect.");let s=new p.v9,_=new p.ov,c=this._babylonScene.getEngine().useExactSrgbConversions;(0,L.XG)(n,i,r,o,a,l,h,e=>{3===e.length?(s.fromArray(e,0),s.toLinearSpaceToRef(s,c),s.toArray(e,0)):(_.fromArray(e,0),_.toLinearSpaceToRef(_,c),_.toArray(e,0))})}}}if(t.convertToRightHanded){for(let e of o){let t=s.get(e),{byteOffset:i,byteStride:r,componentCount:o,type:a,count:l,normalized:h,kind:_}=H(e,t);switch(_){case d.R.PositionKind:case d.R.NormalKind:case d.R.TangentKind:(0,L.XG)(n,i,r,o,a,l,h,e=>{e[0]=-e[0]})}}t.convertedToRightHandedBuffers.set(e,n)}let l=this._bufferManager.createBufferView(n,a);t.setVertexBufferView(e,l);let h=new Map;for(let e of o){let t=s.get(e),{kind:i,totalVertices:r}=H(e,t);switch(i){case d.R.MatricesIndicesKind:case d.R.MatricesIndicesExtraKind:if(e.type==d.R.FLOAT){let t=e.getFloatData(r);null!==t&&h.set(e,t)}}}for(let i of(0!==h.size&&N.V.Warn("Joint indices conversion needed: some joint indices are stored as floats in Babylon but GLTF requires UNSIGNED BYTES. We will perform the conversion but this might lead to unused data in the buffer."),Array.from(h.keys()))){let s=h.get(i);if(!s)continue;let r=s.some(e=>e>=256),o=new(r?Uint16Array:Uint8Array)(s.length);for(let e=0;e<s.length;e++)o[e]=s[e];let a=this._bufferManager.createBufferView(o,4*(r?2:1));t.setRemappedBufferView(e,i,a)}}for(let e of Array.from(a.keys())){let i=a.get(e);if(!i)continue;let s=function(e,t,i,s,a,n){let l={attributes:{},influence:e.influence,name:e.name},h=t.geometry;if(!h)return o.S0.Warn("Attempted to export morph target data from a mesh without geometry. This should not happen."),l;let _=n?-1:1,c=r.Pq.Zero(),u=0,f=0;if(e.hasPositions){let s=e.getPositions(),n=h.getVerticesData(d.R.PositionKind);if(n){let e=new Float32Array(n.length),t=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];f=n.length/3,u=0;for(let i=u;i<f;++i){let a=r.Pq.FromArray(n,3*i);r.Pq.FromArray(s,3*i).subtractToRef(a,c),c.x*=_,t[0]=Math.min(t[0],c.x),o[0]=Math.max(o[0],c.x),t[1]=Math.min(t[1],c.y),o[1]=Math.max(o[1],c.y),t[2]=Math.min(t[2],c.z),o[2]=Math.max(o[2],c.z),e[3*i]=c.x,e[3*i+1]=c.y,e[3*i+2]=c.z}let h=i.createBufferView(e,12),d=i.createAccessor(h,"VEC3",5126,s.length/3,0,{min:t,max:o});a.push(d),l.attributes.POSITION=a.length-1}else o.S0.Warn(`Morph target positions for mesh ${t.name} were not exported. Mesh does not have position vertex data`)}if(e.hasNormals){let s=e.getNormals(),n=h.getVerticesData(d.R.NormalKind);if(n){let e=new Float32Array(n.length);f=n.length/3,u=0;for(let t=u;t<f;++t){let i=r.Pq.FromArray(n,3*t).normalize();r.Pq.FromArray(s,3*t).normalize().subtractToRef(i,c),e[3*t]=c.x*_,e[3*t+1]=c.y,e[3*t+2]=c.z}let t=i.createBufferView(e,12),o=i.createAccessor(t,"VEC3",5126,s.length/3,0);a.push(o),l.attributes.NORMAL=a.length-1}else o.S0.Warn(`Morph target normals for mesh ${t.name} were not exported. Mesh does not have normals vertex data`)}if(e.hasTangents){let s=e.getTangents(),n=h.getVerticesData(d.R.TangentKind);if(n){let e=new Float32Array(3*(f=n.length/4));u=0;for(let t=u;t<f;++t){let i=r.Pq.FromArray(n,4*t);q(i);let o=r.Pq.FromArray(s,3*t);q(o),o.subtractToRef(i,c),e[3*t]=c.x*_,e[3*t+1]=c.y,e[3*t+2]=c.z}let t=i.createBufferView(e,12),o=i.createAccessor(t,"VEC3",5126,f,0);a.push(o),l.attributes.TANGENT=a.length-1}else o.S0.Warn(`Morph target tangents for mesh ${t.name} were not exported. Mesh does not have tangents vertex data`)}if(e.hasColors){let s=e.getColors(),n=h.getVerticesData(d.R.ColorKind),_=h.getVertexBuffer(d.R.ColorKind);if(n&&_){let e=_.getSize(),t=new Float32Array((f=n.length/e)*e);u=0;for(let i=u;i<f;++i)if(3===e){let o=r.Pq.FromArray(n,i*e);r.Pq.FromArray(s,i*e).subtractToRef(o,c),t[3*i]=c.x,t[3*i+1]=c.y,t[3*i+2]=c.z}else if(4===e){let o=new r.IU,a=r.IU.FromArray(n,i*e);r.IU.FromArray(s,i*e).subtractToRef(a,o),t[4*i]=o.x,t[4*i+1]=o.y,t[4*i+2]=o.z,t[4*i+3]=o.w}else o.S0.Warn(`Unsupported number of components for color attribute: ${e}`);let h=i.createBufferView(t,4*e),d=i.createAccessor(h,3===e?"VEC3":"VEC4",5126,f,0);a.push(d),l.attributes.COLOR_0=a.length-1}else o.S0.Warn(`Morph target colors for mesh ${t.name} were not exported. Mesh does not have colors vertex data`)}return l}(e,i[0],this._bufferManager,this._bufferViews,this._accessors,t.convertToRightHanded);for(let e of i)t.bindMorphDataToMesh(e,s)}}async _exportNodeAsync(e,t,i){let s=this._nodeMap.get(e);if(void 0!==s){t.includes(s)||t.push(s);return}let r=await this._createNodeAsync(e,i);if(r){s=this._nodes.length,this._nodes.push(r),this._nodeMap.set(e,s),i.pushExportedNode(e),t.push(s);let o={name:"runtime animations",channels:[],samplers:[]},a=[];!this._babylonScene.animationGroups.length&&(ef._CreateMorphTargetAnimationFromMorphTargetAnimations(e,o,a,this._nodeMap,this._nodes,this._bufferManager,this._bufferViews,this._accessors,this._animationSampleRate,i.convertToRightHanded,this._options.shouldExportAnimation),e.animations.length&&ef._CreateNodeAnimationFromNodeAnimations(e,o,a,this._nodeMap,this._nodes,this._bufferManager,this._bufferViews,this._accessors,this._animationSampleRate,i.convertToRightHanded,this._options.shouldExportAnimation)),o.channels.length&&o.samplers.length&&this._animations.push(o),a.forEach(e=>{e.channels.length&&e.samplers.length&&this._animations.push(e)})}let o=r?[]:t;for(let t of e.getChildren())await this._exportNodeAsync(t,o,i);r&&o.length&&(r.children=o)}async _createNodeAsync(e,t){if(!this._shouldExportNode(e))return null;let i={};if(e.name&&(i.name=e.name),e.metadata){let t=this._options.metadataSelector(e.metadata);t&&(i.extras=t)}if(e instanceof c.V&&(this._setNodeTransformation(i,e,t.convertToRightHanded),e instanceof u.u)){let s=e instanceof f.Z?e.sourceMesh:e;if(s.subMeshes&&s.subMeshes.length>0&&(i.mesh=await this._exportMeshAsync(s,t)),e.skeleton){let t=this._skinMap.get(e.skeleton);void 0!==t&&(void 0===this._nodesSkinMap.get(t)&&this._nodesSkinMap.set(t,[]),this._nodesSkinMap.get(t)?.push(i))}}if(e instanceof D.F){let s=this._camerasMap.get(e);if(s){void 0===this._nodesCameraMap.get(s)&&this._nodesCameraMap.set(s,[]),this._setCameraTransformation(i,e,t.convertToRightHanded);let r=e.parent;if(null!==r&&ee(e,r)){let e=this._nodeMap.get(r);if(void 0!==e){let t=this._nodes[e];return J(i,t),this._nodesCameraMap.get(s)?.push(t),null}}this._nodesCameraMap.get(s)?.push(i)}}return await this._extensionsPostExportNodeAsync("exportNodeAsync",i,e,this._nodeMap,t.convertToRightHanded)?i:(N.V.Warn(`Not exporting node ${e.name}`),null)}_exportIndices(e,t,i,s,r,o,n,l,h){let _=e;h.mode=Y(o);let d=n!==a.i.CounterClockWiseSideOrientation&&function(e){switch(e){case a.i.TriangleFillMode:case a.i.TriangleStripDrawMode:case a.i.TriangleFanDrawMode:return!0}return!1}(o);if(d){if(o===a.i.TriangleStripDrawMode||o===a.i.TriangleFanDrawMode)throw Error("Triangle strip/fan fill mode is not implemented");h.mode=Y(o);let n=t?new Uint32Array(s):new Uint16Array(s);if(e)for(let t=0;t+2<s;t+=3)n[t]=e[i+t]+r,n[t+1]=e[i+t+2]+r,n[t+2]=e[i+t+1]+r;else for(let e=0;e+2<s;e+=3)n[e]=e,n[e+1]=e+2,n[e+2]=e+1;_=n}else if(e&&0!==r){let o=t?new Uint32Array(s):new Uint16Array(s);for(let t=0;t<s;t++)o[t]=e[i+t]+r;_=o}if(_){let o=l.getIndicesAccessor(e,i,s,r,d);if(void 0===o){let a=function(e,t,i,s){if(e instanceof Uint16Array||e instanceof Uint32Array)return e;if(e instanceof Int32Array)return new Uint32Array(e.buffer,e.byteOffset,e.length);let r=e.slice(0,0+i);return s?new Uint32Array(r):new Uint16Array(r)}(_,0,s,t),n=this._bufferManager.createBufferView(a);this._accessors.push(this._bufferManager.createAccessor(n,"SCALAR",t?5125:5123,s,0)),o=this._accessors.length-1,l.setIndicesAccessor(e,i,s,r,d,o)}h.indices=o}}_exportVertexBuffer(e,t,i,s,r,o){let a=e.getKind();if(!X(a)||a.startsWith("uv")&&!this._options.exportUnusedUVs&&(!t||!this._materialNeedsUVsSet.has(t)))return;let n=r.getVertexAccessor(e,i,s);if(void 0===n){let t=r.convertedToRightHandedBuffers.get(e._buffer)||e._buffer.getData(),o=a===d.R.PositionKind?function(e,t,i,s){let{byteOffset:r,byteStride:o,type:a,normalized:n}=t,l=t.getSize(),h=Array(l).fill(1/0),_=Array(l).fill(-1/0);return(0,L.XG)(e,r+i*o,o,l,a,s*l,n,e=>{for(let t=0;t<l;t++)h[t]=Math.min(h[t],e[t]),_[t]=Math.max(_[t],e[t])}),{min:h,max:_}}(t,e,i,s):void 0,l=(a===d.R.MatricesIndicesKind||a===d.R.MatricesIndicesExtraKind)&&e.type===d.R.FLOAT,h=l?d.R.UNSIGNED_BYTE:e.type,_=l?void 0:e.normalized,c=l?r.getRemappedBufferView(e._buffer,e):r.getVertexBufferView(e._buffer),u=e.byteOffset+i*e.byteStride;this._accessors.push(this._bufferManager.createAccessor(c,function(e,t){if(e==d.R.ColorKind)return t?"VEC4":"VEC3";switch(e){case d.R.PositionKind:case d.R.NormalKind:return"VEC3";case d.R.TangentKind:case d.R.MatricesIndicesKind:case d.R.MatricesIndicesExtraKind:case d.R.MatricesWeightsKind:case d.R.MatricesWeightsExtraKind:return"VEC4";case d.R.UVKind:case d.R.UV2Kind:case d.R.UV3Kind:case d.R.UV4Kind:case d.R.UV5Kind:case d.R.UV6Kind:return"VEC2"}throw Error(`Unknown kind ${e}`)}(a,r.hasVertexColorAlpha(e)),h,s,u,o,_)),n=this._accessors.length-1,r.setVertexAccessor(e,i,s,n)}o.attributes[function(e){switch(e){case d.R.PositionKind:return"POSITION";case d.R.NormalKind:return"NORMAL";case d.R.TangentKind:return"TANGENT";case d.R.ColorKind:return"COLOR_0";case d.R.UVKind:return"TEXCOORD_0";case d.R.UV2Kind:return"TEXCOORD_1";case d.R.UV3Kind:return"TEXCOORD_2";case d.R.UV4Kind:return"TEXCOORD_3";case d.R.UV5Kind:return"TEXCOORD_4";case d.R.UV6Kind:return"TEXCOORD_5";case d.R.MatricesIndicesKind:return"JOINTS_0";case d.R.MatricesIndicesExtraKind:return"JOINTS_1";case d.R.MatricesWeightsKind:return"WEIGHTS_0";case d.R.MatricesWeightsExtraKind:return"WEIGHTS_1"}throw Error(`Unknown kind: ${e}`)}(a)]=n}async _exportMaterialAsync(e,t,i,s){let r=this._materialMap.get(e);if(void 0===r){let s=t&&Object.keys(t).some(e=>e.startsWith("uv"));if((e=e instanceof en.F?e.subMaterials[i.materialIndex]:e)instanceof el.d)r=await this._materialExporter.exportPBRMaterialAsync(e,s);else{if(!(e instanceof eh.F))return void N.V.Warn(`Unsupported material '${e.name}' with type ${e.getClassName()}`);r=await this._materialExporter.exportStandardMaterialAsync(e,s)}this._materialMap.set(e,r)}s.material=r}async _exportMeshAsync(e,t){let i=t.getMesh(e);if(void 0!==i)return i;let s={primitives:[]};i=this._meshes.length,this._meshes.push(s),t.setMesh(e,i);let r=e.isUnIndexed?null:e.getIndices(),o=e.geometry?.getVertexBuffers(),n=t.getMorphTargetsFromMesh(e),l=e instanceof eg.l,h=e instanceof em.kH,_=e.subMeshes;if(o&&_&&_.length>0)for(let i of _){let _={attributes:{}},d=i.getMaterial()||this._babylonScene.defaultMaterial;if(h){let t={name:d.name},i=p.v9.White(),s=e.material?.alpha??1,r=e.greasedLineMaterial?.color??i;(!r.equalsWithEpsilon(i,k.bH)||s<1)&&(t.pbrMetallicRoughness={baseColorFactor:[...r.asArray(),s]}),this._materials.push(t),_.material=this._materials.length-1}else if(l){let t={name:d.name};(!e.color.equalsWithEpsilon(p.v9.White(),k.bH)||e.alpha<1)&&(t.pbrMetallicRoughness={baseColorFactor:[...e.color.asArray(),e.alpha]}),this._materials.push(t),_.material=this._materials.length-1}else await this._exportMaterialAsync(d,o,i,_);let c=l||h?a.i.LineListDrawMode:e.overrideRenderingFillMode??d.fillMode,u=d._getEffectiveOrientation(e);for(let s of(t.wasAddedByNoopNode&&!e.getScene().useRightHandedSystem&&(u=u===a.i.ClockWiseSideOrientation?a.i.CounterClockWiseSideOrientation:a.i.ClockWiseSideOrientation),this._exportIndices(r,r?(0,L.Lm)(r,i.indexCount,i.indexStart,i.verticesStart):i.verticesCount>65535,r?i.indexStart:i.verticesStart,r?i.indexCount:i.verticesCount,-i.verticesStart,c,u,t,_),Object.values(o)))this._exportVertexBuffer(s,d,i.verticesStart,i.verticesCount,t,_);if(n)for(let e of(_.targets=[],n))_.targets.push(e.attributes);s.primitives.push(_),this._extensionsPostExportMeshPrimitive(_)}if(n)for(let e of(s.weights=[],s.extras||(s.extras={}),s.extras.targetNames=[],n))s.weights.push(e.influence),s.extras.targetNames.push(e.name);return i}}ev._ExtensionNames=[],ev._ExtensionFactories={};class eb{static async GLTFAsync(e,t,i){i&&i.exportWithoutWaitingForScene||await e.whenReadyAsync();let s=new ev(e,i),r=await s.generateGLTFAsync(t.replace(/\.[^/.]+$/,""));return s.dispose(),r}static async GLBAsync(e,t,i){i&&i.exportWithoutWaitingForScene||await e.whenReadyAsync();let s=new ev(e,i),r=await s.generateGLBAsync(t.replace(/\.[^/.]+$/,""));return s.dispose(),r}}i(62314);let ex="EXT_mesh_gpu_instancing";class eC{constructor(e){this.name=ex,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}async postExportNodeAsync(e,t,i,s,o,a){return await new Promise(e=>{if(t&&i instanceof ec.e&&i.hasThinInstances&&this._exporter){this._wasUsed=!0;let e=r.Pq.Zero(),s=r.PT.Identity(),n=r.Pq.One(),l=i.thinInstanceGetWorldMatrices(),h=r.AA.Vector3[2],_=r.AA.Quaternion[1],d=r.AA.Vector3[3],c=!1,u=!1,f=!1,g=new Float32Array(3*i.thinInstanceCount),m=new Float32Array(4*i.thinInstanceCount),p=new Float32Array(3*i.thinInstanceCount),v=0;for(let t of l)t.decompose(d,_,h),o&&(j(h),$(_)),g.set(h.asArray(),3*v),m.set(_.normalize().asArray(),4*v),p.set(d.asArray(),3*v),c=c||!h.equalsWithEpsilon(e),u=u||!_.equalsWithEpsilon(s),f=f||!d.equalsWithEpsilon(n),v++;let b={attributes:{}};c&&(b.attributes.TRANSLATION=this._buildAccessor(g,"VEC3",i.thinInstanceCount,a)),u&&(b.attributes.ROTATION=this._buildAccessor(m,"VEC4",i.thinInstanceCount,a)),f&&(b.attributes.SCALE=this._buildAccessor(p,"VEC3",i.thinInstanceCount,a)),t.extensions=t.extensions||{},t.extensions[ex]=b}e(t)})}_buildAccessor(e,t,i,s){let r=s.createBufferView(e),o=s.createAccessor(r,t,5126,i);return this._exporter._accessors.push(o),this._exporter._accessors.length-1}}ev.RegisterExtension(ex,e=>new eC(e));var eT=i(32881);let ey="KHR_draco_mesh_compression";class eS{get wasUsed(){return this._wasUsed}constructor(e){this.name=ey,this.required=!0,this._bufferViewsUsed=new Set,this._accessorsUsed=new Set,this._encodePromises=[],this._wasUsed=!1,this.enabled="Draco"===e.options.meshCompressionMethod&&eT.I.DefaultAvailable}dispose(){}postExportMeshPrimitive(e,t,i){if(!this.enabled)return;if(4!==e.mode&&5!==e.mode)return void N.V.Warn("Cannot compress primitive with mode "+e.mode+".");let s=[],r=[],o=null;if(void 0!==e.indices){let a=i[e.indices],n=t.getBufferView(a);o=t.getData(n).slice(),s.push(n),r.push(a)}let a=[];for(let[o,l]of Object.entries(e.attributes)){var n;let e=i[l],h=t.getBufferView(e),_=K(e.type),d=(0,L.II)(t.getData(h),_,e.componentType,e.byteOffset||0,h.byteStride||(0,L.PD)(e.componentType)*_,e.normalized||!1,e.count,!0);a.push({kind:o,dracoName:"POSITION"===(n=o)?"POSITION":"NORMAL"===n?"NORMAL":n.startsWith("COLOR")?"COLOR":n.startsWith("TEXCOORD")?"TEX_COORD":"GENERIC",size:K(e.type),data:d}),s.push(h),r.push(e)}let l={method:e.targets?"MESH_SEQUENTIAL_ENCODING":"MESH_EDGEBREAKER_ENCODING"},h=eT.I.Default._encodeAsync(a,o,l).then(i=>{if(!i)return void N.V.Error("Draco encoding failed for primitive.");let o={bufferView:-1,attributes:i.attributeIds},a=t.createBufferView(i.data);for(let e of(t.setBufferView(o,a),s))this._bufferViewsUsed.add(e);for(let e of r)this._accessorsUsed.add(e);e.extensions||(e.extensions={}),e.extensions[ey]=o}).catch(e=>{N.V.Error("Draco encoding failed for primitive: "+e)});this._encodePromises.push(h),this._wasUsed=!0}async preGenerateBinaryAsync(e){this.enabled&&(await Promise.all(this._encodePromises),this._bufferViewsUsed.forEach(t=>{e.getPropertiesWithBufferView(t).every(e=>this._accessorsUsed.has(e))&&e.removeBufferView(t)}),this._bufferViewsUsed.clear(),this._accessorsUsed.clear())}}ev.RegisterExtension(ey,e=>new eS(e));var eP=i(69613);let eI="KHR_lights_punctual",eE={name:"",color:[1,1,1],intensity:1,range:Number.MAX_VALUE},eR={innerConeAngle:0,outerConeAngle:Math.PI/4},eM=r.Pq.Backward();class ew{constructor(e){this.name=eI,this.enabled=!0,this.required=!1,this._exporter=e}dispose(){this._lights=null}get wasUsed(){return!!this._lights}onExporting(){this._exporter._glTF.extensions[eI]=this._lights}async postExportNodeAsync(e,t,i,s,o){return await new Promise(a=>{if(!(i instanceof eu.v))return void a(t);let n=i.getTypeID()==eu.v.LIGHTTYPEID_POINTLIGHT?"point":i.getTypeID()==eu.v.LIGHTTYPEID_DIRECTIONALLIGHT?"directional":i.getTypeID()==eu.v.LIGHTTYPEID_SPOTLIGHT?"spot":null;if(!n||!(i instanceof eP.p)){N.V.Warn(`${e}: Light ${i.name} is not supported in ${eI}`),a(t);return}if(i.falloffType!==eu.v.FALLOFF_GLTF&&N.V.Warn(`${e}: Light falloff for ${i.name} does not match the ${eI} specification!`),!i.position.equalsToFloats(0,0,0)){let e=r.AA.Vector3[0].copyFrom(i.position);o&&j(e),t.translation=e.asArray()}if("point"!==n){let e=i.direction.normalizeToRef(r.AA.Vector3[0]);o&&j(e);let s=r.PT.FromUnitVectorsToRef(eM,e,r.AA.Quaternion[0]);r.PT.IsIdentity(s)||(t.rotation=s.asArray())}let l={type:n,name:i.name,color:i.diffuse.asArray(),intensity:i.intensity,range:i.range};et(l,eE),"spot"===n&&(l.spot={innerConeAngle:i.innerAngle/2,outerConeAngle:i.angle/2},et(l.spot,eR)),this._lights||(this._lights={lights:[]}),this._lights.lights.push(l);let h={light:this._lights.lights.length-1},_=i.parent;if(_&&ee(i,_)){let e=s.get(_);if(e){let i=this._exporter._nodes[e];J(t,i),i.extensions||(i.extensions={}),i.extensions[eI]=h,a(null);return}}t.extensions||(t.extensions={}),t.extensions[eI]=h,a(t)})}}ev.RegisterExtension(eI,e=>new ew(e));let eO="KHR_materials_anisotropy";class eB{constructor(e){this.name=eO,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof el.d&&i.anisotropy.isEnabled&&!i.anisotropy.legacy?(i.anisotropy.texture&&s.push(i.anisotropy.texture),s):[]}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof el.d){if(!i.anisotropy.isEnabled||i.anisotropy.legacy)return void e(t);this._wasUsed=!0,t.extensions=t.extensions||{};let s=this._exporter._materialExporter.getTextureInfo(i.anisotropy.texture),r={anisotropyStrength:i.anisotropy.intensity,anisotropyRotation:i.anisotropy.angle,anisotropyTexture:s??void 0};null!==r.anisotropyTexture&&this._exporter._materialNeedsUVsSet.add(i),t.extensions[eO]=r}e(t)})}}ev.RegisterExtension(eO,e=>new eB(e));let eA="KHR_materials_clearcoat";class eF{constructor(e){this.name=eA,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof el.d&&i.clearCoat.isEnabled?(i.clearCoat.texture&&s.push(i.clearCoat.texture),!i.clearCoat.useRoughnessFromMainTexture&&i.clearCoat.textureRoughness&&s.push(i.clearCoat.textureRoughness),i.clearCoat.bumpTexture&&s.push(i.clearCoat.bumpTexture),s):[]}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof el.d){let s;if(!i.clearCoat.isEnabled)return void e(t);this._wasUsed=!0,t.extensions=t.extensions||{};let r=this._exporter._materialExporter.getTextureInfo(i.clearCoat.texture);s=i.clearCoat.useRoughnessFromMainTexture?this._exporter._materialExporter.getTextureInfo(i.clearCoat.texture):this._exporter._materialExporter.getTextureInfo(i.clearCoat.textureRoughness),i.clearCoat.isTintEnabled&&o.S0.Warn(`Clear Color tint is not supported for glTF export. Ignoring for: ${i.name}`),i.clearCoat.remapF0OnInterfaceChange&&o.S0.Warn(`Clear Color F0 remapping is not supported for glTF export. Ignoring for: ${i.name}`);let a=this._exporter._materialExporter.getTextureInfo(i.clearCoat.bumpTexture),n={clearcoatFactor:i.clearCoat.intensity,clearcoatTexture:r??void 0,clearcoatRoughnessFactor:i.clearCoat.roughness,clearcoatRoughnessTexture:s??void 0,clearcoatNormalTexture:a??void 0};(null!==n.clearcoatTexture||null!==n.clearcoatRoughnessTexture||null!==n.clearcoatRoughnessTexture)&&this._exporter._materialNeedsUVsSet.add(i),t.extensions[eA]=n}e(t)})}}ev.RegisterExtension(eA,e=>new eF(e));var eL=i(81622);let eN="KHR_materials_diffuse_transmission";function eD(e,t){let i=t.subSurface,s=null;return(i.translucencyIntensityTexture?s=i.translucencyIntensityTexture:i.thicknessTexture&&i.useMaskFromThicknessTexture&&(s=i.thicknessTexture),s&&!i.useGltfStyleTextures)?(N.V.Warn(`${e}: Translucency intensity texture is not supported when useGltfStyleTextures = false. Ignoring for: ${t.name}`,1),null):s}class ek{constructor(e){this.name=eN,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];if(i instanceof eL.Y&&this._isExtensionEnabled(i)){let t=eD(e,i);t&&s.push(t),i.subSurface.translucencyColorTexture&&s.push(i.subSurface.translucencyColorTexture)}return s}_isExtensionEnabled(e){if(e.unlit)return!1;let t=e.subSurface;return!!t.isTranslucencyEnabled&&!e.unlit&&!t.useAlbedoToTintTranslucency&&t.useGltfStyleTextures&&1===t.volumeIndexOfRefraction&&0===t.minimumThickness&&0===t.maximumThickness}postExportMaterialAsync(e,t,i){return new Promise(s=>{if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0;let s=i.subSurface,r=eD(e,i),o=0==s.translucencyIntensity?void 0:s.translucencyIntensity,a=this._exporter._materialExporter.getTextureInfo(r)??void 0,n=!s.translucencyColor||s.translucencyColor.equalsFloats(1,1,1)?void 0:s.translucencyColor.asArray(),l=this._exporter._materialExporter.getTextureInfo(s.translucencyColorTexture)??void 0;(a||l)&&this._exporter._materialNeedsUVsSet.add(i),t.extensions=t.extensions||{},t.extensions[eN]={diffuseTransmissionFactor:o,diffuseTransmissionTexture:a,diffuseTransmissionColorFactor:n,diffuseTransmissionColorTexture:l}}s(t)})}}ev.RegisterExtension(eN,e=>new ek(e));let eV="KHR_materials_dispersion";class eU{constructor(){this.name=eV,this.enabled=!0,this.required=!1,this._wasUsed=!1}dispose(){}get wasUsed(){return this._wasUsed}_isExtensionEnabled(e){if(e.unlit)return!1;let t=e.subSurface;return!!t.isRefractionEnabled||!!t.isDispersionEnabled}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0;let e=i.subSurface.dispersion;t.extensions=t.extensions||{},t.extensions[eV]={dispersion:e}}e(t)})}}ev.RegisterExtension(eV,()=>new eU);let ez="KHR_materials_emissive_strength";class eW{constructor(){this.name=ez,this.enabled=!0,this.required=!1,this._wasUsed=!1}dispose(){}get wasUsed(){return this._wasUsed}async postExportMaterialAsync(e,t,i){return await new Promise(e=>{if(!(i instanceof eL.Y))return e(t);let s=Math.max(...i.emissiveColor.asArray());if(s>1){this._wasUsed=!0,t.extensions||(t.extensions={});let e={emissiveStrength:s};t.emissiveFactor=i.emissiveColor.scale(1/e.emissiveStrength).asArray(),t.extensions[ez]=e}return e(t)})}}ev.RegisterExtension(ez,e=>new eW);let eQ="KHR_materials_ior";class eG{constructor(){this.name=eQ,this.enabled=!0,this.required=!1,this._wasUsed=!1}dispose(){}get wasUsed(){return this._wasUsed}_isExtensionEnabled(e){return!e.unlit&&void 0!=e.indexOfRefraction&&1.5!=e.indexOfRefraction}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0;let e={ior:i.indexOfRefraction};t.extensions=t.extensions||{},t.extensions[eQ]=e}e(t)})}}ev.RegisterExtension(eQ,e=>new eG);let eH="KHR_materials_iridescence";class eK{constructor(e){this.name=eH,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof el.d&&i.iridescence.isEnabled?(i.iridescence.texture&&s.push(i.iridescence.texture),i.iridescence.thicknessTexture&&i.iridescence.thicknessTexture!==i.iridescence.texture&&s.push(i.iridescence.thicknessTexture),s):[]}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof el.d){if(!i.iridescence.isEnabled)return void e(t);this._wasUsed=!0,t.extensions=t.extensions||{};let s=this._exporter._materialExporter.getTextureInfo(i.iridescence.texture),r=this._exporter._materialExporter.getTextureInfo(i.iridescence.thicknessTexture),o={iridescenceFactor:i.iridescence.intensity,iridescenceIor:i.iridescence.indexOfRefraction,iridescenceThicknessMinimum:i.iridescence.minimumThickness,iridescenceThicknessMaximum:i.iridescence.maximumThickness,iridescenceTexture:s??void 0,iridescenceThicknessTexture:r??void 0};(null!==o.iridescenceTexture||null!==o.iridescenceThicknessTexture)&&this._exporter._materialNeedsUVsSet.add(i),t.extensions[eH]=o}e(t)})}}ev.RegisterExtension(eH,e=>new eK(e));let eX="KHR_materials_sheen";class eY{constructor(e){this.name=eX,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){return i instanceof eL.Y&&i.sheen.isEnabled&&i.sheen.texture?[i.sheen.texture]:[]}async postExportMaterialAsync(e,t,i){return await new Promise(e=>{if(i instanceof eL.Y){if(!i.sheen.isEnabled)return void e(t);this._wasUsed=!0,null==t.extensions&&(t.extensions={});let s={sheenColorFactor:i.sheen.color.asArray(),sheenRoughnessFactor:i.sheen.roughness??0};(null!==s.sheenColorTexture||null!==s.sheenRoughnessTexture)&&this._exporter._materialNeedsUVsSet.add(i),i.sheen.texture&&(s.sheenColorTexture=this._exporter._materialExporter.getTextureInfo(i.sheen.texture)??void 0),i.sheen.textureRoughness&&!i.sheen.useRoughnessFromMainTexture?s.sheenRoughnessTexture=this._exporter._materialExporter.getTextureInfo(i.sheen.textureRoughness)??void 0:i.sheen.texture&&i.sheen.useRoughnessFromMainTexture&&(s.sheenRoughnessTexture=this._exporter._materialExporter.getTextureInfo(i.sheen.texture)??void 0),t.extensions[eX]=s}e(t)})}}ev.RegisterExtension(eX,e=>new eY(e));let eq="KHR_materials_specular";class ej{constructor(e){this.name=eq,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof eL.Y&&this._isExtensionEnabled(i)&&(i.metallicReflectanceTexture&&s.push(i.metallicReflectanceTexture),i.reflectanceTexture&&s.push(i.reflectanceTexture)),s}_isExtensionEnabled(e){return!e.unlit&&(void 0!=e.metallicF0Factor&&1!=e.metallicF0Factor||void 0!=e.metallicReflectanceColor&&!e.metallicReflectanceColor.equalsFloats(1,1,1)||this._hasTexturesExtension(e))}_hasTexturesExtension(e){return null!=e.metallicReflectanceTexture||null!=e.reflectanceTexture}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0,t.extensions=t.extensions||{};let e=this._exporter._materialExporter.getTextureInfo(i.metallicReflectanceTexture)??void 0,s=this._exporter._materialExporter.getTextureInfo(i.reflectanceTexture)??void 0,r=1==i.metallicF0Factor?void 0:i.metallicF0Factor,o=i.metallicReflectanceColor.equalsFloats(1,1,1)?void 0:i.metallicReflectanceColor.asArray();this._hasTexturesExtension(i)&&this._exporter._materialNeedsUVsSet.add(i),t.extensions[eq]={specularFactor:r,specularTexture:e,specularColorFactor:o,specularColorTexture:s}}e(t)})}}ev.RegisterExtension(eq,e=>new ej(e));let e$="KHR_materials_transmission";class eZ{constructor(e){this.name=e$,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof eL.Y&&this._isExtensionEnabled(i)&&i.subSurface.thicknessTexture&&s.push(i.subSurface.thicknessTexture),s}_isExtensionEnabled(e){if(e.unlit)return!1;let t=e.subSurface;return t.isRefractionEnabled&&void 0!=t.refractionIntensity&&0!=t.refractionIntensity||this._hasTexturesExtension(e)}_hasTexturesExtension(e){return null!=e.subSurface.refractionIntensityTexture}async postExportMaterialAsync(e,t,i){if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0;let s=i.subSurface,r={transmissionFactor:0===s.refractionIntensity?void 0:s.refractionIntensity};if(this._hasTexturesExtension(i)&&this._exporter._materialNeedsUVsSet.add(i),s.refractionIntensityTexture)if(s.useGltfStyleTextures){let e=await this._exporter._materialExporter.exportTextureAsync(s.refractionIntensityTexture);e&&(r.transmissionTexture=e)}else N.V.Warn(`${e}: Exporting a subsurface refraction intensity texture without \`useGltfStyleTextures\` is not supported`);t.extensions||(t.extensions={}),t.extensions[e$]=r}return t}}ev.RegisterExtension(e$,e=>new eZ(e));let eJ="KHR_materials_unlit";class e0{constructor(){this.name=eJ,this.enabled=!0,this.required=!1,this._wasUsed=!1}get wasUsed(){return this._wasUsed}dispose(){}postExportMaterialAsync(e,t,i){return new Promise(e=>{let s=!1;i instanceof eL.Y?s=i.unlit:i instanceof eh.F&&(s=i.disableLighting),s&&(this._wasUsed=!0,null==t.extensions&&(t.extensions={}),t.extensions[eJ]={}),e(t)})}}ev.RegisterExtension(eJ,()=>new e0);let e1="KHR_materials_volume";class e2{constructor(e){this.name=e1,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof eL.Y&&this._isExtensionEnabled(i)&&i.subSurface.thicknessTexture&&s.push(i.subSurface.thicknessTexture),s}_isExtensionEnabled(e){if(e.unlit)return!1;let t=e.subSurface;return(!!t.isRefractionEnabled||!!t.isTranslucencyEnabled)&&(void 0!=t.maximumThickness&&0!=t.maximumThickness||void 0!=t.tintColorAtDistance&&t.tintColorAtDistance!=1/0||void 0!=t.tintColor&&t.tintColor!=p.v9.White()||this._hasTexturesExtension(e))}_hasTexturesExtension(e){return null!=e.subSurface.thicknessTexture}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof eL.Y&&this._isExtensionEnabled(i)){this._wasUsed=!0;let e=i.subSurface,s=0==e.maximumThickness?void 0:e.maximumThickness,r=this._exporter._materialExporter.getTextureInfo(e.thicknessTexture)??void 0,o=e.tintColorAtDistance==1/0?void 0:e.tintColorAtDistance,a=e.tintColor.equalsFloats(1,1,1)?void 0:e.tintColor.asArray();this._hasTexturesExtension(i)&&this._exporter._materialNeedsUVsSet.add(i),t.extensions=t.extensions||{},t.extensions[e1]={thicknessFactor:s,thicknessTexture:r,attenuationDistance:o,attenuationColor:a}}e(t)})}}ev.RegisterExtension(e1,e=>new e2(e));let e3="EXT_materials_diffuse_roughness";class e4{constructor(e){this.name=e3,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}dispose(){}get wasUsed(){return this._wasUsed}postExportMaterialAdditionalTextures(e,t,i){let s=[];return i instanceof el.d&&i._baseDiffuseRoughness?(i._baseDiffuseRoughnessTexture&&s.push(i._baseDiffuseRoughnessTexture),s):[]}postExportMaterialAsync(e,t,i){return new Promise(e=>{if(i instanceof el.d){if(!i._baseDiffuseRoughness)return void e(t);this._wasUsed=!0,t.extensions=t.extensions||{};let s=this._exporter._materialExporter.getTextureInfo(i._baseDiffuseRoughnessTexture),r={diffuseRoughnessFactor:i._baseDiffuseRoughness,diffuseRoughnessTexture:s??void 0};null!==r.diffuseRoughnessTexture&&this._exporter._materialNeedsUVsSet.add(i),t.extensions[e3]=r}e(t)})}}ev.RegisterExtension(e3,e=>new e4(e));let e5="KHR_texture_transform";class e9{constructor(){this.name=e5,this.enabled=!0,this.required=!1,this._wasUsed=!1}dispose(){}get wasUsed(){return this._wasUsed}postExportTexture(e,t,i){if(i.getScene()||o.S0.Warn(`${e}: "scene" is not defined for Babylon texture ${i.name}!`),(0!==i.uAng||0!==i.vAng)&&(o.S0.Warn(`${e}: Texture ${i.name} with rotation in the u or v axis is not supported in glTF.`),0!==i.uRotationCenter||0!==i.vRotationCenter))return;let s={},r=!1;if((0!==i.uOffset||0!==i.vOffset)&&(s.offset=[i.uOffset,i.vOffset],r=!0),(1!==i.uScale||1!==i.vScale)&&(s.scale=[i.uScale,i.vScale],r=!0),0!==i.wAng){if(0!==i.uRotationCenter||0!==i.vRotationCenter){if(i.homogeneousRotationInUVTransform&&i.uScale!==i.vScale)return void o.S0.Warn(`${e}: Texture ${i.name} with homogenousRotationInUVTransform, non-uniform scaling, and non-zero rotation cannot be exported with ${e5}.`);o.S0.Warn(`${e}: Texture ${i.name} with non-origin rotation center will be exported using an adjusted offset with ${e5}.`),s.offset=function(e){let{uOffset:t,vOffset:i,uRotationCenter:s,vRotationCenter:r,uScale:o,vScale:a,wAng:n}=e,l=Math.cos(n),h=Math.sin(n),_=s*o,d=r*a;return[t+(_*(1-l)+d*h),i+(d*(1-l)-_*h)]}(i)}s.rotation=-i.wAng,r=!0}0!==i.coordinatesIndex&&(s.texCoord=i.coordinatesIndex,r=!0),r&&(this._wasUsed=!0,t.extensions||(t.extensions={}),t.extensions[e5]=s)}}ev.RegisterExtension(e5,()=>new e9);let e8="KHR_texture_basisu";class e7{get wasUsed(){return this._wasUsed}constructor(e){this.name=e8,this.enabled=!0,this.required=!0,this._wasUsed=!1,this._exporter=e}dispose(){}postExportTexture(e,t){let i=this._exporter._textures[t.index],s=i.source;if(void 0===s)return;let r=this._exporter._images[s];"image/ktx2"===(r.mimeType||(0,h.ny)(r.uri))&&(i.source=void 0,i.extensions||(i.extensions={}),i.extensions[e8]={source:s},this._wasUsed=!0)}}ev.RegisterExtension(e8,e=>new e7(e));let e6="EXT_texture_webp";class te{get wasUsed(){return this._wasUsed}constructor(e){this.name=e6,this.enabled=!0,this.required=!0,this._wasUsed=!1,this._exporter=e}dispose(){}postExportTexture(e,t){let i=this._exporter._textures[t.index],s=i.source;if(void 0===s)return;let r=this._exporter._images[s];"image/webp"===(r.mimeType||(0,h.ny)(r.uri))&&(i.source=void 0,i.extensions||(i.extensions={}),i.extensions[e6]={source:s},this._wasUsed=!0)}}ev.RegisterExtension(e6,e=>new te(e));let tt="EXT_texture_avif";class ti{get wasUsed(){return this._wasUsed}constructor(e){this.name=tt,this.enabled=!0,this.required=!0,this._wasUsed=!1,this._exporter=e}dispose(){}postExportTexture(e,t){let i=this._exporter._textures[t.index],s=i.source;if(void 0===s)return;let r=this._exporter._images[s];"image/avif"===(r.mimeType||(0,h.ny)(r.uri))&&(i.source=void 0,i.extensions||(i.extensions={}),i.extensions[tt]={source:s},this._wasUsed=!0)}}ev.RegisterExtension(tt,e=>new ti(e));class ts{static CreateSTL(e,t=!0,i="stlmesh",s=!1,o=!0,a=!1,n=!1,l=!1){let h=function(e,t,i,s){return t=_(e,t,i.x,s),t=_(e,t,i.y,s),_(e,t,i.z,s)},_=function(e,t,i,s){return e.setFloat32(t,i,s),t+4};n&&(a=!0);let c="",u=0,g=0;if(s){for(let t=0;t<e.length;t++){let i=e[t].getIndices();u+=i?i.length/3:0}c=new DataView(new ArrayBuffer(84+50*u)),g+=80,c.setUint32(g,u,o),g+=4}else l||(c="solid stlmesh\r\n");for(let t=0;t<e.length;t++){let i=e[t];!s&&l&&(c+="solid "+i.name+"\r\n"),!a&&i instanceof ec.e&&i.bakeCurrentTransformIntoVertices();let _=function(e){if(!n)return e.getVerticesData(d.R.PositionKind)||[];{let t,i=e;e instanceof f.Z&&(i=e.sourceMesh);let s=i.getVerticesData(d.R.PositionKind,!0,!0);if(!s)return[];let o=r.Pq.Zero();for(t=0;t<s.length;t+=3)r.Pq.TransformCoordinatesFromFloatsToRef(s[t],s[t+1],s[t+2],e.computeWorldMatrix(!0),o).toArray(s,t);return s}}(i),u=i.getIndices()||[];for(let e=0;e<u.length;e+=3){let t=function(e,t,i){let s=[3*e[i],3*e[i+1],3*e[i+2]],o=[new r.Pq(t[s[0]],t[s[0]+2],t[s[0]+1]),new r.Pq(t[s[1]],t[s[1]+2],t[s[1]+1]),new r.Pq(t[s[2]],t[s[2]+2],t[s[2]+1])],a=o[0].subtract(o[1]),n=o[2].subtract(o[1]);return{v:o,n:r.Pq.Cross(n,a).normalize()}}(u,_,e);s?(g=h(c,g,t.n,o),g=h(c,g,t.v[0],o),g=h(c,g,t.v[1],o),g=h(c,g,t.v[2],o)+2):(c+="	facet normal "+t.n.x+" "+t.n.y+" "+t.n.z+"\r\n",c+="		outer loop\r\n",c+="			vertex "+t.v[0].x+" "+t.v[0].y+" "+t.v[0].z+"\r\n",c+="			vertex "+t.v[1].x+" "+t.v[1].y+" "+t.v[1].z+"\r\n",c+="			vertex "+t.v[2].x+" "+t.v[2].y+" "+t.v[2].z+"\r\n",c+="		endloop\r\n",c+="	endfacet\r\n")}!s&&l&&(c+="endsolid "+name+"\r\n")}if(s||l||(c+="endsolid stlmesh"),t){let e=document.createElement("a"),t=new Blob([c],{type:"application/octet-stream"});e.href=window.URL.createObjectURL(t),e.download=i+".stl",e.click()}return c}}function tr(){return`#usda 1.0
    (
        customLayerData = {
            string creator = "Babylon.js USDZExportAsync"
        }
        defaultPrim = "Root"
        metersPerUnit = 1
        upAxis = "Y"
    )`}function to(e,t,i=3,s=!1){let r=[];for(let o=0;o<e.length/i;o++){let a=e[o*i]*(s?-1:1),n=e[o*i+1],l=e[o*i+2];r.push(`(${a.toPrecision(t.precision)}, ${n.toPrecision(t.precision)}, ${l.toPrecision(t.precision)})`)}return r.join(", ")}function ta(e){let t=e.m;return`( ${tn(t,0)}, ${tn(t,4)}, ${tn(t,8)}, ${tn(t,12)} )`}function tn(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function tl(e){switch(e){case T.Y.TEXTURE_CLAMP_ADDRESSMODE:return"clamp";case T.Y.TEXTURE_MIRROR_ADDRESSMODE:return"mirror";case T.Y.TEXTURE_WRAP_ADDRESSMODE:default:return"repeat"}}function th(e){return`(${e.x}, ${e.y})`}function t_(e){return`(${e.r}, ${e.g}, ${e.b})`}function td(e,t,i,s,o,a){let n=e.getInternalTexture().uniqueId+"_"+e.invertY;o[n]=e;let l=e.coordinatesIndex>0?"st"+e.coordinatesIndex:"st",h=new r.I9(e.uScale,e.vScale),_=new r.I9(e.uOffset,e.vOffset),d=e.wAng,c=Math.sin(d),u=Math.cos(d);return _.y=1-_.y-h.y,_.x+=c*h.x,_.y+=(1-u)*h.y,`
    def Shader "PrimvarReader_${i}"
    {
        uniform token info:id = "UsdPrimvarReader_float2"
        float2 inputs:fallback = (0.0, 0.0)
        token inputs:varname = "${l}"
        float2 outputs:result
    }

    def Shader "Transform2d_${i}"
    {
        uniform token info:id = "UsdTransform2d"
        token inputs:in.connect = </Root/Materials/Material_${t.uniqueId}/PrimvarReader_${i}.outputs:result>
        float inputs:rotation = ${(180/Math.PI*d).toFixed(a.precision)}
        float2 inputs:scale = ${th(h)}
        float2 inputs:translation = ${th(_)}
        float2 outputs:result
    }

    def Shader "Texture_${e.uniqueId}_${i}"
    {
        uniform token info:id = "UsdUVTexture"
        asset inputs:file = @textures/Texture_${n}.png@
        float2 inputs:st.connect = </Root/Materials/Material_${t.uniqueId}/Transform2d_${i}.outputs:result>
        ${s?`float4 inputs:scale = (${s.r}, ${s.g}, ${s.b}, 1.0)`:""}
        token inputs:sourceColorSpace = "${e.gammaSpace?"sRGB":"raw"}"
        token inputs:wrapS = "${tl(e.wrapU)}"
        token inputs:wrapT = "${tl(e.wrapV)}"
        float outputs:r
        float outputs:g
        float outputs:b
        float3 outputs:rgb
        ${t.needAlphaBlending()||t.needAlphaTesting()?"float outputs:a":""}
    }`}async function tc(e,t,i){let s={fflateUrl:"https://unpkg.com/fflate@0.8.2",includeAnchoringProperties:!0,anchoringType:"plane",planeAnchoringAlignment:"horizontal",modelFileName:"model.usda",precision:5,exportCamera:!1,cameraSensorWidth:35,...t};"undefined"==typeof fflate&&await o.S0.LoadScriptAsync(s.fflateUrl);let n={};n[s.modelFileName]=null;let l=tr();l+=function(e){let t=!0===e.includeAnchoringProperties?`
		token preliminary:anchoring:type = "${e.anchoringType}"
		token preliminary:planeAnchoring:alignment = "${e.planeAnchoringAlignment}"`:"";return`def Xform "Root"
    {
        def Scope "Scenes" (
            kind = "sceneLibrary"
        )
        {
            def Xform "Scene" (
                customData = {
                    bool preliminary_collidesWithEnvironment = 0
                    string sceneName = "Scene"
                }
                sceneName = "Scene"
            )
            {${t}
            `}(s);let h={};for(let t of e.meshes){if(0===t.getTotalVertices())continue;let e=t.geometry,r=t.material;if(r&&e&&(!i||i(t)))if(-1!==["StandardMaterial","PBRMaterial","PBRMetallicRoughnessMaterial"].indexOf(r.getClassName())){let i="geometries/Geometry_"+e.uniqueId+".usda",{matrix:_,windingOrder:c,convertToRightHanded:u}=function(e){e.computeWorldMatrix(!0);let t=e.getWorldMatrix().clone(),i=e.getScene().useRightHandedSystem,s=e.material?._getEffectiveOrientation(e)??e.sideOrientation,r=!i,n=e.parent;for(;n;){if(U(n,i)&&null===n.parent){i||(t.multiplyToRef(n.getWorldMatrix().invert(),t),s=s===a.i.ClockWiseSideOrientation?a.i.CounterClockWiseSideOrientation:a.i.ClockWiseSideOrientation),r=!1;break}n=n.parent}return 0>t.determinant()&&o.S0.Warn(`Mesh ${e.name} has a negative scale, which may look incorrect in destinations like QuickLook.`),{matrix:t,windingOrder:s===a.i.ClockWiseSideOrientation?"leftHanded":"rightHanded",convertToRightHanded:r}}(t);if(!(i in n)){let t=function(e,t,i,s){let r=function(e,t,i,s){let r=e.getVerticesData(d.R.PositionKind),o=e.getVerticesData(d.R.NormalKind);if(r&&o)return`
	def Mesh "Geometry"
	{
        uniform token orientation = "${i}"
		int[] faceVertexCounts = [${Array((e.getIndices()?.length?e.getTotalIndices():e.getTotalVertices())/3).fill(3).join(", ")}]
		int[] faceVertexIndices = [${function(e){let t=e.getIndices(),i=t?.length??e.getTotalVertices(),s=[];if(null!==t)for(let e=0;e<i;e++)s.push(t[e]);else for(let e=0;e<i;e++)s.push(e);return s.join(", ")}(e)}]
		normal3f[] normals = [${to(o,t,void 0,s)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${to(r,t,void 0,s)}]
        ${function(e,t){let i="";for(let s=0;s<4;s++){let r=s>0?s:"",o=e.getVerticesData(d.R.UVKind+(r?r+1:""));o&&(i+=`
		texCoord2f[] primvars:st${r} = [${function(e,t){let i=[];for(let s=0;s<e.length/2;s++){let r=e[2*s],o=e[2*s+1];i.push(`(${r.toPrecision(t.precision)}, ${(1-o).toPrecision(t.precision)})`)}return i.join(", ")}(o,t)}] (
			interpolation = "vertex"
		)`)}let s=e.getVerticesData(d.R.ColorKind);return s&&(i+=`
	color3f[] primvars:displayColor = [${to(s,t,s.length/e.getTotalVertices())}] (
		interpolation = "vertex"
		)`),i}(e,t)}
		uniform token subdivisionScheme = "none"
	}
`}(e,t,i,s);return`
        def "Geometry"
        {
        ${r}
        }
        `}(e,s,c,u);n[i]=function(e){let t=tr();return t+=e,fflate.strToU8(t)}(t)}r.uniqueId in h||(h[r.uniqueId]=r),l+=function(e,t){let i="Object_"+e.uniqueId,s=ta(t);return`def Xform "${i}" (
	prepend references = @./geometries/Geometry_${e.geometry.uniqueId}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${s}
	uniform token[] xformOpOrder = ["xformOp:transform"]	

    rel material:binding = </Root/Materials/Material_${e.material.uniqueId}>
}

`}(t,_)}else o.S0.Warn("USDZExportAsync does not support this material type: "+r.getClassName())}e.activeCamera&&s.exportCamera&&(l+=function(e,t){let i="Camera_"+e.uniqueId,s=ta(r.uq.RotationY(Math.PI).multiply(e.getWorldMatrix()));if(e.mode===T.Y.ORTHOGRAPHIC_CAMERA)return`def Camera "${i}"
		{
			matrix4d xformOp:transform = ${s}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${e.minZ.toPrecision(t.precision)}, ${e.maxZ.toPrecision(t.precision)})
			float horizontalAperture = ${((Math.abs(e.orthoLeft||1)+Math.abs(e.orthoRight||1))*10).toPrecision(t.precision)}
			float verticalAperture = ${((Math.abs(e.orthoTop||1)+Math.abs(e.orthoBottom||1))*10).toPrecision(t.precision)}
			token projection = "orthographic"
		}
	
	`;{let r=e.getEngine().getAspectRatio(e),o=t.cameraSensorWidth||35;return`def Camera "${i}"
		{
			matrix4d xformOp:transform = ${s}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${e.minZ.toPrecision(t.precision)}, ${e.maxZ.toPrecision(t.precision)})
			float focalLength = ${(o/(2*Math.tan(.5*e.fov))).toPrecision(t.precision)}
            token projection = "perspective"
			float horizontalAperture = ${(o*r).toPrecision(t.precision)}
			float verticalAperture = ${(o/r).toPrecision(t.precision)}            
		}
	
	`}}(e.activeCamera,s)),l+=`
            }
        }`;let _={};for(let e in l+=function(e,t,i){let s=[];for(let r in e){let o=e[r];s.push(function(e,t,i){let s=[],r=[],{diffuseMap:o,diffuse:a,alphaCutOff:n,emissiveMap:l,emissive:h,normalMap:_,roughnessMap:d,roughnessChannel:c,roughness:u,metalnessMap:f,metalnessChannel:g,metalness:m,aoMap:v,aoMapChannel:b,aoMapIntensity:x,alphaMap:C,ior:T,clearCoatEnabled:y,clearCoat:S,clearCoatMap:P,clearCoatRoughness:I,clearCoatRoughnessMap:E}=function(e){let t={diffuseMap:null,diffuse:null,alphaCutOff:0,emissiveMap:null,emissive:null,normalMap:null,roughnessMap:null,roughnessChannel:"a",roughness:0,metalnessMap:null,metalnessChannel:"r",metalness:0,aoMap:null,aoMapChannel:"rgb",aoMapIntensity:0,alphaMap:null,ior:1,clearCoatEnabled:!1,clearCoat:0,clearCoatMap:null,clearCoatRoughness:0,clearCoatRoughnessMap:null};return e instanceof eh.F?{...t,diffuseMap:e.diffuseTexture,diffuse:e.diffuseColor,alphaCutOff:e.alphaCutOff,emissiveMap:e.emissiveTexture,emissive:e.emissiveColor,roughness:1,alphaMap:e.opacityTexture}:e instanceof el.d?{...t,diffuseMap:e._albedoTexture,diffuse:e._albedoColor,alphaCutOff:e._alphaCutOff,emissiveMap:e._emissiveTexture,emissive:e._emissiveColor,normalMap:e._bumpTexture,roughnessMap:e._metallicTexture,roughnessChannel:e._useRoughnessFromMetallicTextureAlpha?"a":"g",roughness:e._roughness??1,metalnessMap:e._metallicTexture,metalnessChannel:e._useMetallnessFromMetallicTextureBlue?"b":"r",metalness:e._metallic??0,aoMap:e._ambientTexture,aoMapChannel:e._useAmbientInGrayScale?"r":"rgb",aoMapIntensity:e._ambientTextureStrength,alphaMap:e._opacityTexture,ior:e.subSurface.indexOfRefraction,clearCoatEnabled:e.clearCoat.isEnabled,clearCoat:e.clearCoat.intensity,clearCoatMap:e.clearCoat.texture,clearCoatRoughness:e.clearCoat.roughness,clearCoatRoughnessMap:e.clearCoat.useRoughnessFromMainTexture?e.clearCoat.texture:e.clearCoat.textureRoughness}:t}(e);return null!==o?(s.push(`			color3f inputs:diffuseColor.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${o.uniqueId}_diffuse.outputs:rgb>`),e.needAlphaBlending()?s.push(`			float inputs:opacity.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${o.uniqueId}_diffuse.outputs:a>`):e.needAlphaTesting()&&(s.push(`			float inputs:opacity.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${o.uniqueId}_diffuse.outputs:a>`),s.push(`			float inputs:opacityThreshold = ${n}`)),r.push(td(o,e,"diffuse",a,t,i))):s.push(`			color3f inputs:diffuseColor = ${t_(a||p.v9.White())}`),null!==l?(s.push(`			color3f inputs:emissiveColor.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${l.uniqueId}_emissive.outputs:rgb>`),r.push(td(l,e,"emissive",h,t,i))):h&&h.toLuminance()>0&&s.push(`			color3f inputs:emissiveColor = ${t_(h)}`),null!==_&&(s.push(`			normal3f inputs:normal.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${_.uniqueId}_normal.outputs:rgb>`),r.push(td(_,e,"normal",null,t,i))),null!==v&&(s.push(`			float inputs:occlusion.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${v.uniqueId}_occlusion.outputs:${b}>`),r.push(td(v,e,"occlusion",new p.v9(x,x,x),t,i))),null!==d?(s.push(`			float inputs:roughness.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${d.uniqueId}_roughness.outputs:${c}>`),r.push(td(d,e,"roughness",new p.v9(u,u,u),t,i))):s.push(`			float inputs:roughness = ${u}`),null!==f?(s.push(`			float inputs:metallic.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${f.uniqueId}_metallic.outputs:${g}>`),r.push(td(f,e,"metallic",new p.v9(m,m,m),t,i))):s.push(`			float inputs:metallic = ${m}`),null!==C?(s.push(`			float inputs:opacity.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${C.uniqueId}_opacity.outputs:r>`),s.push(`			float inputs:opacityThreshold = 0.0001`),r.push(td(C,e,"opacity",null,t,i))):s.push(`			float inputs:opacity = ${e.alpha}`),y&&(null!==P?(s.push(`			float inputs:clearcoat.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${P.uniqueId}_clearcoat.outputs:r>`),r.push(td(P,e,"clearcoat",new p.v9(S,S,S),t,i))):s.push(`			float inputs:clearcoat = ${S}`),null!==E?(s.push(`			float inputs:clearcoatRoughness.connect = </Root/Materials/Material_${e.uniqueId}/Texture_${E.uniqueId}_clearcoatRoughness.outputs:g>`),r.push(td(E,e,"clearcoatRoughness",new p.v9(I,I,I),t,i))):s.push(`			float inputs:clearcoatRoughness = ${I}`)),s.push(`			float inputs:ior = ${T}`),`
	def Material "Material_${e.uniqueId}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${s.join("\n")}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Root/Materials/Material_${e.uniqueId}/PreviewSurface.outputs:surface>

${r.join("\n")}

	}
`}(o,t,i))}return`
    def "Materials"
{
${s.join("")}
}

`}(h,_,s),l+=`
    }`,n[s.modelFileName]=fflate.strToU8(l),_){let t=_[e],i=t.getSize(),s=await (0,b.Oz)(t),r=await y.DumpTools.DumpDataAsync(i.width,i.height,s,"image/png",void 0,!1,!0);n[`textures/Texture_${e}.png`]=new Uint8Array(r).slice()}let c=0;for(let e in n){let t=n[e];if(!t)continue;let i=63&(c+=34+e.length);if(4!==i){let s=new Uint8Array(64-i);n[e]=[t,{extra:{12345:s}}]}c=t.length}return fflate.zipSync(n,{level:0})}class tu{static Export(e,t=[],i=.03333){let s=t;t&&0!==t.length||(s=e.animations.map(e=>e.name));let r=null;if(s.length>0&&(r=e.getAnimationRange(s[0])),!r&&(e.animations.length>0&&(r=e.getAnimationRange(e.animations[0].name)),!r))throw Error("No animation range found in skeleton");let o=this._BuildBoneHierarchy(e,s),a=r.to-r.from+1,n="";return n+=`HIERARCHY
`,n+=this._ExportHierarchy(o,0),n+=`MOTION
`,n+=`Frames: ${a}
`,n+=`Frame Time: ${i}
`,n+=`
`,n+=this._ExportMotionData(o,a,r.from,s)}static _BuildBoneHierarchy(e,t){let i=new Map,s=[];for(let t of e.bones){let e={bone:t,children:[],hasPositionChannels:!1,hasRotationChannels:!1,positionKeys:[],rotationKeys:[]};i.set(t,e)}for(let r of e.bones){let e=i.get(r);if(r.animations.length>0)for(let i of r.animations)t.includes(i.name)&&("position"===i.targetProperty?(e.hasPositionChannels=!0,e.positionKeys=i.getKeys()):"rotationQuaternion"===i.targetProperty&&(e.hasRotationChannels=!0,e.rotationKeys=i.getKeys()));if(r.getParent()){let t=i.get(r.getParent());t&&t.children.push(e)}else s.push(e)}return s}static _ExportHierarchy(e,t){let i="",s="    ".repeat(t);for(let r of e){let e=r.bone;if(0!==r.children.length||r.hasPositionChannels||r.hasRotationChannels){i+=`${s}JOINT ${e.name}
`,i+=`${s}{
`;let t=this._GetBoneOffset(e);i+=`${s}    OFFSET ${t.x.toFixed(6)} ${t.y.toFixed(6)} ${t.z.toFixed(6)}
`;let o=[];r.hasPositionChannels&&o.push("Xposition","Yposition","Zposition"),r.hasRotationChannels&&o.push("Zrotation","Xrotation","Yrotation"),o.length>0&&(i+=`${s}    CHANNELS ${o.length} ${o.join(" ")}
`),i+=`${s}}
`}else{i+=`${s}End Site
`,i+=`${s}{
`;let t=this._GetBoneOffset(e);i+=`${s}    OFFSET ${t.x.toFixed(6)} ${t.y.toFixed(6)} ${t.z.toFixed(6)}
`,i+=`${s}}
`}r.children.length>0&&(i+=this._ExportHierarchy(r.children,t+1))}return i}static _GetBoneOffset(e){let t=e.getParent();if(!t)return r.Pq.Zero();let i=e.getBindMatrix(),s=t.getBindMatrix(),o=i.getTranslation(),a=s.getTranslation();return o.subtract(a)}static _ExportMotionData(e,t,i,s){let r="";for(let o=0;o<t;o++){let t=[];this._CollectFrameValues(e,o+i,t,s),r+=t.map(e=>e.toFixed(6)).join(" ")+"\n"}return r}static _CollectFrameValues(e,t,i,s){for(let r of e)if(0!==r.children.length||r.hasPositionChannels||r.hasRotationChannels){if(r.hasPositionChannels){let e=this._GetPositionAtFrame(r.positionKeys,t);i.push(e.x,e.y,e.z)}if(r.hasRotationChannels){let e=this._GetRotationAtFrame(r.rotationKeys,t),s=this._QuaternionToEuler(e);i.push(s.z,s.x,s.y)}r.children.length>0&&this._CollectFrameValues(r.children,t,i,s)}}static _GetPositionAtFrame(e,t){if(0===e.length)return r.Pq.Zero();let i=e[0],s=e[e.length-1];for(let r=0;r<e.length-1;r++)if(e[r].frame<=t&&e[r+1].frame>=t){i=e[r],s=e[r+1];break}if(i.frame===s.frame)return i.value.clone();let o=(t-i.frame)/(s.frame-i.frame);return r.Pq.Lerp(i.value,s.value,o)}static _GetRotationAtFrame(e,t){if(0===e.length)return r.PT.Identity();let i=e[0],s=e[e.length-1];for(let r=0;r<e.length-1;r++)if(e[r].frame<=t&&e[r+1].frame>=t){i=e[r],s=e[r+1];break}if(i.frame===s.frame)return i.value.clone();let o=(t-i.frame)/(s.frame-i.frame);return r.PT.Slerp(i.value,s.value,o)}static _QuaternionToEuler(e){let t,i,s,a=e.toRotationMatrix(new r.uq);return Math.abs(a.m[6])<1-k.bH?(t=Math.atan2(-a.m[7],a.m[8]),i=Math.asin(a.m[6]),s=Math.atan2(-a.m[3],a.m[0])):(t=Math.atan2(a.m[5],a.m[4]),i=Math.asin(a.m[6]),s=0),new r.Pq(o.S0.ToDegrees(t),o.S0.ToDegrees(i),o.S0.ToDegrees(s))}}},46542:(e,t,i)=>{i.r(t),i.d(t,{AbstractButton3D:()=>ek,AdvancedDynamicTexture:()=>eS,AdvancedDynamicTextureInstrumentation:()=>eI,BaseGradient:()=>ef,BaseSlider:()=>$,Button:()=>A,Button3D:()=>ez,Checkbox:()=>L,CheckboxGroup:()=>ee,ColorPicker:()=>z,Container:()=>M,Container3D:()=>eW,Control:()=>P,Control3D:()=>eN,CornerHandle:()=>tB,CylinderPanel:()=>eH,DisplayGrid:()=>ed,Ellipse:()=>W,FluentBackplateMaterial:()=>ts,FluentButtonMaterial:()=>tg,FluentMaterial:()=>e3,FluentMaterialDefines:()=>e2,FocusableButton:()=>Q,FrameGraphGUITask:()=>eR,GUI3DManager:()=>iP,GizmoHandle:()=>tw,Grid:()=>V,HandMenu:()=>e9,HandleMaterial:()=>tR,HandleState:()=>r,HolographicBackplate:()=>to,HolographicButton:()=>th,HolographicSlate:()=>tD,Image:()=>B,ImageBasedSlider:()=>ec,ImageScrollBar:()=>ea,InputPassword:()=>H,InputText:()=>k,InputTextArea:()=>G,KeyPropertySet:()=>eh,Line:()=>K,LinearGradient:()=>eg,MRDLBackplateMaterial:()=>t5,MRDLSliderBarMaterial:()=>tX,MRDLSliderThumbMaterial:()=>tJ,MathTools:()=>x,Matrix2D:()=>b,Measure:()=>m,MeshButton3D:()=>tk,MultiLine:()=>q,MultiLinePoint:()=>Y,NearMenu:()=>tV,NodeRenderGraphGUIBlock:()=>eO,PlanePanel:()=>tU,RadialGradient:()=>em,RadioButton:()=>j,RadioGroup:()=>et,Rectangle:()=>w,ScatterPanel:()=>tz,ScrollBar:()=>eo,ScrollViewer:()=>en,SelectionPanel:()=>es,SelectorGroup:()=>J,SideHandle:()=>tO,SlateGizmo:()=>tA,Slider:()=>Z,Slider3D:()=>t9,SliderGroup:()=>ei,SpherePanel:()=>t8,StackPanel:()=>F,StackPanel3D:()=>t7,Style:()=>eb,TextBlock:()=>O,TextWrapper:()=>D,TextWrapping:()=>s,ToggleButton:()=>el,TouchButton3D:()=>tm,TouchHolographicButton:()=>tv,TouchHolographicButtonV3:()=>iT,TouchHolographicMenu:()=>e4,TouchMeshButton3D:()=>t6,ValueAndUnit:()=>d,Vector2WithInfo:()=>v,Vector3WithInfo:()=>eL,VirtualKeyboard:()=>e_,VolumeBasedPanel:()=>eQ,XmlLoader:()=>eA,name:()=>eu});var s,r,o=i(94269),a=i(43048),n=i(80705),l=i(27746),h=i(40337),_=i(81631);class d{constructor(e,t=d.UNITMODE_PIXEL,i=!0){this.negativeValueAllowed=i,this._value=1,this._unit=d.UNITMODE_PIXEL,this.ignoreAdaptiveScaling=!1,this.onChangedObservable=new n.cP,this._value=e,this._unit=t,this._originalUnit=t}get isPercentage(){return this._unit===d.UNITMODE_PERCENTAGE}get isPixel(){return this._unit===d.UNITMODE_PIXEL}get internalValue(){return this._value}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this.onChangedObservable.notifyObservers())}get unit(){return this._unit}set unit(e){e!==this._unit&&(this._unit=e,this.onChangedObservable.notifyObservers())}getValueInPixel(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t}updateInPlace(e,t=d.UNITMODE_PIXEL){return(this.value!==e||this.unit!==t)&&(this._value=e,this._unit=t,this.onChangedObservable.notifyObservers()),this}getValue(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==d.UNITMODE_PERCENTAGE){let t=0,i=0;if(e.idealWidth&&(t=Math.ceil(this._value*e.getSize().width/e.idealWidth)),e.idealHeight&&(i=Math.ceil(this._value*e.getSize().height/e.idealHeight)),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?t:i;if(e.idealWidth)return t;if(e.idealHeight)return i}return this._value}toString(e,t){switch(this._unit){case d.UNITMODE_PERCENTAGE:{let i=100*this.getValue(e);return(t?i.toFixed(t):i)+"%"}case d.UNITMODE_PIXEL:{let i=this.getValue(e);return(t?i.toFixed(t):i)+"px"}}return this._unit.toString()}fromString(e){let t=d._Regex.exec(e.toString());if(!t||0===t.length)return!1;let i=parseFloat(t[1]),s=this._originalUnit;if(!this.negativeValueAllowed&&i<0&&(i=0),4===t.length)switch(t[3]){case"px":s=d.UNITMODE_PIXEL;break;case"%":s=d.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||s!==this._unit)&&(this._value=i,this._unit=s,this.onChangedObservable.notifyObservers(),!0)}static get UNITMODE_PERCENTAGE(){return d._UNITMODE_PERCENTAGE}static get UNITMODE_PIXEL(){return d._UNITMODE_PIXEL}}d._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,d._UNITMODE_PERCENTAGE=0,d._UNITMODE_PIXEL=1;let c=[new l.I9(0,0),new l.I9(0,0),new l.I9(0,0),new l.I9(0,0)],u=[new l.I9(0,0),new l.I9(0,0),new l.I9(0,0),new l.I9(0,0)],f=new l.I9(0,0),g=new l.I9(0,0);class m{constructor(e,t,i,s){this.left=e,this.top=t,this.width=i,this.height=s}copyFrom(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height}copyFromFloats(e,t,i,s){this.left=e,this.top=t,this.width=i,this.height=s}static CombineToRef(e,t,i){let s=Math.min(e.left,t.left),r=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),a=Math.max(e.top+e.height,t.top+t.height);i.left=s,i.top=r,i.width=o-s,i.height=a-r}addAndTransformToRef(e,t,i,s,r,o){let a=this.left+t,n=this.top+i,l=this.width+s,h=this.height+r;c[0].copyFromFloats(a,n),c[1].copyFromFloats(a+l,n),c[2].copyFromFloats(a+l,n+h),c[3].copyFromFloats(a,n+h),f.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),g.copyFromFloats(0,0);for(let t=0;t<4;t++)e.transformCoordinates(c[t].x,c[t].y,u[t]),f.x=Math.floor(Math.min(f.x,u[t].x)),f.y=Math.floor(Math.min(f.y,u[t].y)),g.x=Math.ceil(Math.max(g.x,u[t].x)),g.y=Math.ceil(Math.max(g.y,u[t].y));o.left=f.x,o.top=f.y,o.width=g.x-f.x,o.height=g.y-f.y}transformToRef(e,t){this.addAndTransformToRef(e,0,0,0,0,t)}isEqualsTo(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height}static Empty(){return new m(0,0,0,0)}}var p=i(72422);class v extends l.I9{constructor(e,t=0){super(e.x,e.y),this.buttonIndex=t}}class b{constructor(e,t,i,s,r,o){this.m=new Float32Array(6),this.fromValues(e,t,i,s,r,o)}fromValues(e,t,i,s,r,o){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=s,this.m[4]=r,this.m[5]=o,this}determinant(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]}invertToRef(e){let t=this.m[0],i=this.m[1],s=this.m[2],r=this.m[3],o=this.m[4],a=this.m[5],n=this.determinant();if(n<p.bH*p.bH)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;let l=1/n;return e.m[0]=r*l,e.m[1]=-i*l,e.m[2]=-s*l,e.m[3]=t*l,e.m[4]=(s*a-r*o)*l,e.m[5]=(i*o-t*a)*l,this}multiplyToRef(e,t){let i=this.m[0],s=this.m[1],r=this.m[2],o=this.m[3],a=this.m[4],n=this.m[5],l=e.m[0],h=e.m[1],_=e.m[2],d=e.m[3],c=e.m[4],u=e.m[5];return t.m[0]=i*l+s*_,t.m[1]=i*h+s*d,t.m[2]=r*l+o*_,t.m[3]=r*h+o*d,t.m[4]=a*l+n*_+c,t.m[5]=a*h+n*d+u,this}transformCoordinates(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this}static Identity(){return new b(1,0,0,1,0,0)}static IdentityToRef(e){e.m[0]=1,e.m[1]=0,e.m[2]=0,e.m[3]=1,e.m[4]=0,e.m[5]=0}static TranslationToRef(e,t,i){i.fromValues(1,0,0,1,e,t)}static ScalingToRef(e,t,i){i.fromValues(e,0,0,t,0,0)}static RotationToRef(e,t){let i=Math.sin(e),s=Math.cos(e);t.fromValues(s,i,-i,s,0,0)}static ComposeToRef(e,t,i,s,r,o,a){b.TranslationToRef(e,t,b._TempPreTranslationMatrix),b.ScalingToRef(s,r,b._TempScalingMatrix),b.RotationToRef(i,b._TempRotationMatrix),b.TranslationToRef(-e,-t,b._TempPostTranslationMatrix),b._TempPreTranslationMatrix.multiplyToRef(b._TempScalingMatrix,b._TempCompose0),b._TempCompose0.multiplyToRef(b._TempRotationMatrix,b._TempCompose1),o?(b._TempCompose1.multiplyToRef(b._TempPostTranslationMatrix,b._TempCompose2),b._TempCompose2.multiplyToRef(o,a)):b._TempCompose1.multiplyToRef(b._TempPostTranslationMatrix,a)}}b._TempPreTranslationMatrix=b.Identity(),b._TempPostTranslationMatrix=b.Identity(),b._TempRotationMatrix=b.Identity(),b._TempScalingMatrix=b.Identity(),b._TempCompose0=b.Identity(),b._TempCompose1=b.Identity(),b._TempCompose2=b.Identity();class x{static Round(e,t=x.DefaultRoundingPrecision){return Math.round(e*t)/t}}x.DefaultRoundingPrecision=100;var C=i(88473),T=i(5426),y=i(68180),S=i(32922);class P{get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=e}get transformedMeasure(){return this._evaluatedMeasure}set clipChildren(e){this._clipChildren=e}get clipChildren(){return this._clipChildren}set clipContent(e){this._clipContent=e}get clipContent(){return this._clipContent}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())}get shadowBlur(){return this._shadowBlur}set shadowBlur(e){this._shadowBlur!==e&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=e,this._markAsDirty())}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get host(){return this._host}get fontOffset(){return this._fontOffset}set fontOffset(e){this._fontOffset=e}get alpha(){return this._alpha}set alpha(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())}get highlightLineWidth(){return this._highlightLineWidth}set highlightLineWidth(e){this._highlightLineWidth!==e&&(this._highlightLineWidth=e,this._markAsDirty())}get isHighlighted(){return this._isHighlighted}set isHighlighted(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())}get highlightColor(){return this._highlightColor}set highlightColor(e){this._highlightColor!==e&&(this._highlightColor=e,this._markAsDirty())}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterY(){return this._transformCenterY}set transformCenterY(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterX(){return this._transformCenterX}set transformCenterX(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())}get horizontalAlignment(){return this._horizontalAlignment}set horizontalAlignment(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())}get verticalAlignment(){return this._verticalAlignment}set verticalAlignment(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())}set fixedRatio(e){this._fixedRatio!==e&&(this._fixedRatio=e,this._markAsDirty())}get fixedRatio(){return this._fixedRatio}set fixedRatioMasterIsWidth(e){this._fixedRatioMasterIsWidth!==e&&(this._fixedRatioMasterIsWidth=e,this._markAsDirty())}get fixedRatioMasterIsWidth(){return this._fixedRatioMasterIsWidth}get width(){return this._width.toString(this._host)}set width(e){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get widthInPixels(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)}set widthInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!0,this.width=e+"px")}get height(){return this._height.toString(this._host)}set height(e){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get heightInPixels(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)}set heightInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!1,this.height=e+"px")}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())}get style(){return this._style}set style(e){this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add(()=>{this._markAsDirty(),this._resetFontCache()})),this._markAsDirty(),this._resetFontCache()}get _isFontSizeInPercentage(){return this._fontSize.isPercentage}get fontSizeInPixels(){let e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)}set fontSizeInPixels(e){isNaN(e)||(this.fontSize=e+"px")}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())}get color(){return this._color}set color(e){this._color!==e&&(this._color=e,this._markAsDirty())}get gradient(){return this._gradient}set gradient(e){this._gradient!==e&&(this._gradient=e,this._markAsDirty())}get zIndex(){return this._zIndex}set zIndex(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))}get notRenderable(){return this._doNotRender}set notRenderable(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0),this.onIsVisibleChangedObservable.notifyObservers(e))}get isDirty(){return this._isDirty}get linkedMesh(){return this._linkedMesh}get descendantsOnlyPadding(){return this._descendantsOnlyPadding}set descendantsOnlyPadding(e){this._descendantsOnlyPadding!==e&&(this._descendantsOnlyPadding=e,this._markAsDirty())}get paddingLeft(){return this._paddingLeft.toString(this._host)}set paddingLeft(e){this._paddingLeft.fromString(e)&&this._markAsDirty()}get paddingLeftInPixels(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingLeftInPixels(e){isNaN(e)||(this.paddingLeft=e+"px")}get _paddingLeftInPixels(){return this._descendantsOnlyPadding?0:this.paddingLeftInPixels}get paddingRight(){return this._paddingRight.toString(this._host)}set paddingRight(e){this._paddingRight.fromString(e)&&this._markAsDirty()}get paddingRightInPixels(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingRightInPixels(e){isNaN(e)||(this.paddingRight=e+"px")}get _paddingRightInPixels(){return this._descendantsOnlyPadding?0:this.paddingRightInPixels}get paddingTop(){return this._paddingTop.toString(this._host)}set paddingTop(e){this._paddingTop.fromString(e)&&this._markAsDirty()}get paddingTopInPixels(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingTopInPixels(e){isNaN(e)||(this.paddingTop=e+"px")}get _paddingTopInPixels(){return this._descendantsOnlyPadding?0:this.paddingTopInPixels}get paddingBottom(){return this._paddingBottom.toString(this._host)}set paddingBottom(e){this._paddingBottom.fromString(e)&&this._markAsDirty()}get paddingBottomInPixels(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingBottomInPixels(e){isNaN(e)||(this.paddingBottom=e+"px")}get _paddingBottomInPixels(){return this._descendantsOnlyPadding?0:this.paddingBottomInPixels}get left(){return this._left.toString(this._host)}set left(e){this._left.fromString(e)&&this._markAsDirty()}get leftInPixels(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)}set leftInPixels(e){isNaN(e)||(this.left=e+"px")}get top(){return this._top.toString(this._host)}set top(e){this._top.fromString(e)&&this._markAsDirty()}get topInPixels(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)}set topInPixels(e){isNaN(e)||(this.top=e+"px")}get linkOffsetX(){return this._linkOffsetX.toString(this._host)}set linkOffsetX(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()}get linkOffsetXInPixels(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)}set linkOffsetXInPixels(e){isNaN(e)||(this.linkOffsetX=e+"px")}get linkOffsetY(){return this._linkOffsetY.toString(this._host)}set linkOffsetY(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()}get linkOffsetYInPixels(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)}set linkOffsetYInPixels(e){isNaN(e)||(this.linkOffsetY=e+"px")}get centerX(){return this._currentMeasure.left+this._currentMeasure.width/2}get centerY(){return this._currentMeasure.top+this._currentMeasure.height/2}get isEnabled(){return this._isEnabled}set isEnabled(e){if(this._isEnabled===e)return;this._isEnabled=e,this._markAsDirty();let t=e=>{if(e.host){for(let t in e.host._lastControlOver)e===this.host._lastControlOver[t]&&(e._onPointerOut(e,null,!0),delete e.host._lastControlOver[t]);if(void 0!==e.children)for(let i of e.children)t(i)}};t(this),this.onEnabledStateChangedObservable.notifyObservers(e)}get disabledColor(){return this._disabledColor}set disabledColor(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())}get disabledColorItem(){return this._disabledColorItem}set disabledColorItem(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())}get focusedColor(){return this._focusedColor}set focusedColor(e){this._focusedColor=e}onBlur(){this._isFocused&&(this._isFocused=!1,this.focusedColor&&null!=this._unfocusedColor&&(this.color=this._unfocusedColor),this.onBlurObservable.notifyObservers(this))}onFocus(){this._isFocused=!0,this.focusedColor&&(this._unfocusedColor=this.color,this.color=this.focusedColor),this.onFocusObservable.notifyObservers(this)}keepsFocusWith(){return null}focus(){this._host.moveFocusToControl(this)}blur(){this._host.focusedControl=null}processKeyboard(e){"Enter"===e.key&&this.onEnterPressedObservable.notifyObservers(this),this.onKeyboardEventProcessedObservable.notifyObservers(e,-1,this)}constructor(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=m.Empty(),this._tempPaddingMeasure=m.Empty(),this._fontFamily="",this._fontStyle="",this._fontWeight="",this._fontSize=new d(18,d.UNITMODE_PIXEL,!1),this._width=new d(1,d.UNITMODE_PERCENTAGE,!1),this._height=new d(1,d.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=m.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=m.Empty(),this._cachedParentMeasure=m.Empty(),this._descendantsOnlyPadding=!1,this._paddingLeft=new d(0),this._paddingRight=new d(0),this._paddingTop=new d(0),this._paddingBottom=new d(0),this._left=new d(0),this._top=new d(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=b.Identity(),this._invertTransformMatrix=b.Identity(),this._transformedPosition=l.I9.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightColor="#4affff",this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=l.I9.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._evaluatedMeasure=new m(0,0,0,0),this._evaluatedParentMeasure=new m(0,0,0,0),this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._isReadOnly=!1,this._gradient=null,this._rebuildLayout=!1,this.onEnabledStateChangedObservable=new n.cP,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this._clipChildren=!0,this._clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new d(0),this._linkOffsetY=new d(0),this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new n.cP,this.onWheelObservable=new n.cP,this.onPointerMoveObservable=new n.cP,this.onPointerOutObservable=new n.cP,this.onPointerDownObservable=new n.cP,this.onPointerUpObservable=new n.cP,this.onPointerClickObservable=new n.cP,this.onEnterPressedObservable=new n.cP,this.onPointerEnterObservable=new n.cP,this.onDirtyObservable=new n.cP,this.onBeforeDrawObservable=new n.cP,this.onAfterDrawObservable=new n.cP,this.onDisposeObservable=new n.cP,this.onIsVisibleChangedObservable=new n.cP,this.isSerializable=!0,this._fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this.animations=null,this._focusedColor=null,this.tabIndex=-1,this._isFocused=!1,this._unfocusedColor=null,this.onFocusObservable=new n.cP,this.onBlurObservable=new n.cP,this.onKeyboardEventProcessedObservable=new n.cP,this._tmpMeasureA=new m(0,0,0,0)}_getTypeName(){return"Control"}getAscendantOfClass(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null}markAsDirty(e=!1){this._markAsDirty(e)}markAllAsDirty(){this._markAllAsDirty()}_resetFontCache(){this._fontSet=!0,this._markAsDirty()}isAscendant(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))}getLocalCoordinates(e){let t=l.I9.Zero();return this.getLocalCoordinatesToRef(e,t),t}getLocalCoordinatesToRef(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this}getParentLocalCoordinates(e){let t=l.I9.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t}moveToVector3(e,t){if(!this._host||this.parent!==this._host._rootContainer)return void _.S0.Error("Cannot move a control to a vector3 if the control is not at root level");this.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP;let i=this._host._getGlobalViewport(),s=l.Pq.Project(e,l.uq.IdentityReadOnly,t.getTransformMatrix(),i);if(this._moveToProjectedPosition(s),s.z<0||s.z>1){this.notRenderable=!0;return}this.notRenderable=!1}getDescendantsToRef(e,t=!1,i){}getDescendants(e,t){let i=[];return this.getDescendantsToRef(i,e,t),i}linkWithMesh(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer){e&&_.S0.Error("Cannot link a control to a mesh if the control is not at root level");return}let t=this._host._linkedControls.indexOf(this);if(-1!==t){this._linkedMesh=e,e||this._host._linkedControls.splice(t,1);return}e&&(this.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this))}setPadding(e,t,i,s){let r=t??e;this.paddingTop=e,this.paddingRight=r,this.paddingBottom=i??e,this.paddingLeft=s??r}setPaddingInPixels(e,t,i,s){let r=t??e;this.paddingTopInPixels=e,this.paddingRightInPixels=r,this.paddingBottomInPixels=i??e,this.paddingLeftInPixels=s??r}_moveToProjectedPosition(e){let t=this._left.getValue(this._host),i=this._top.getValue(this._host),s=this.parent?._currentMeasure;s&&this._processMeasures(s,this._host.getContext());let r=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,o=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(.5>Math.abs(r-t)&&(r=t),.5>Math.abs(o-i)&&(o=i)),(t!==r||i!==o)&&(this.left=r+"px",this.top=o+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty())}_offsetLeft(e){this._isDirty=!0,this._currentMeasure.left+=e}_offsetTop(e){this._isDirty=!0,this._currentMeasure.top+=e}_markMatrixAsDirty(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()}_flagDescendantsAsMatrixDirty(){}_intersectsRect(e,t){return this._transform(t),!(this._evaluatedMeasure.left>=e.left+e.width)&&!(this._evaluatedMeasure.top>=e.top+e.height)&&!(this._evaluatedMeasure.left+this._evaluatedMeasure.width<=e.left)&&!(this._evaluatedMeasure.top+this._evaluatedMeasure.height<=e.top)}_computeAdditionalOffsetX(){return 0}_computeAdditionalOffsetY(){return 0}invalidateRect(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),m.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);let e=this.shadowOffsetX,t=this.shadowOffsetY,i=Math.max(this._previousShadowBlur,this.shadowBlur),s=Math.min(Math.min(e,0)-2*i,0),r=Math.max(Math.max(e,0)+2*i,0),o=Math.min(Math.min(t,0)-2*i,0),a=Math.max(Math.max(t,0)+2*i,0),n=this._computeAdditionalOffsetX(),l=this._computeAdditionalOffsetY();this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+s-n),Math.floor(this._tmpMeasureA.top+o-l),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+a+l))}}_markAsDirty(e=!1){(this._isVisible||e)&&(this._isDirty=!0,this._markMatrixAsDirty(),this._host&&this._host.markAsDirty())}_markAllAsDirty(){this._markAsDirty(),this._font&&this._prepareFont()}_link(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())}_transform(e){if(!this._isMatrixDirty&&1===this._scaleX&&1===this._scaleY&&0===this._rotation)return;let t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==i)&&(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),b.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure))}_renderHighlight(e){this.isHighlighted&&(e.save(),e.strokeStyle=this._highlightColor,e.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(e),e.restore())}_renderHighlightSpecific(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)}_getColor(e){return this.gradient?this.gradient.getCanvasGradient(e):this.color}_applyStates(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._host&&this._host.useSmallestIdeal&&!this._font&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),(this._color||this.gradient)&&(e.fillStyle=this._getColor(e)),P.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)}_layout(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this._paddingLeftInPixels,0|-this._paddingTopInPixels,0|this._paddingRightInPixels,0|this._paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save();let i=0;do this._rebuildLayout=!1,this._processMeasures(e,t),i++;while(this._rebuildLayout&&i<4);i>=4&&a.V.Error(`Layout cycle detected in GUI (Control name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0}_processMeasures(e,t){this._applyStates(t),this._tempPaddingMeasure.copyFrom(e),this.parent&&this.parent.descendantsOnlyPadding&&(this._tempPaddingMeasure.left+=this.parent.paddingLeftInPixels,this._tempPaddingMeasure.top+=this.parent.paddingTopInPixels,this._tempPaddingMeasure.width-=this.parent.paddingLeftInPixels+this.parent.paddingRightInPixels,this._tempPaddingMeasure.height-=this.parent.paddingTopInPixels+this.parent.paddingBottomInPixels),this._currentMeasure.copyFrom(this._tempPaddingMeasure),this._preMeasure(this._tempPaddingMeasure,t),this._measure(),this._postMeasure(this._tempPaddingMeasure,t),this._computeAlignment(this._tempPaddingMeasure,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(this._tempPaddingMeasure,t),this._cachedParentMeasure.copyFrom(this._tempPaddingMeasure),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)}_evaluateClippingState(e){if(this._transform(),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.parent&&this.parent.clipChildren&&(e.transformToRef(this.parent._transformMatrix,this._evaluatedParentMeasure),this._evaluatedMeasure.left>this._evaluatedParentMeasure.left+this._evaluatedParentMeasure.width||this._evaluatedMeasure.left+this._evaluatedMeasure.width<this._evaluatedParentMeasure.left||this._evaluatedMeasure.top>this._evaluatedParentMeasure.top+this._evaluatedParentMeasure.height||this._evaluatedMeasure.top+this._evaluatedMeasure.height<this._evaluatedParentMeasure.top)){this._isClipped=!0;return}this._isClipped=!1}_measure(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this._fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this._fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this._fixedRatio)}_computeAlignment(e,t){let i=this._currentMeasure.width,s=this._currentMeasure.height,r=e.width,o=e.height,a=0,n=0;switch(this.horizontalAlignment){case P.HORIZONTAL_ALIGNMENT_LEFT:a=0;break;case P.HORIZONTAL_ALIGNMENT_RIGHT:a=r-i;break;case P.HORIZONTAL_ALIGNMENT_CENTER:a=(r-i)/2}switch(this.verticalAlignment){case P.VERTICAL_ALIGNMENT_TOP:n=0;break;case P.VERTICAL_ALIGNMENT_BOTTOM:n=o-s;break;case P.VERTICAL_ALIGNMENT_CENTER:n=(o-s)/2}this.descendantsOnlyPadding||(this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=r*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=r*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=r*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=o*this._paddingTop.getValue(this._host),this._currentMeasure.height-=o*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=o*this._paddingBottom.getValue(this._host)),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=r*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=o*this._top.getValue(this._host),this._currentMeasure.left+=a,this._currentMeasure.top+=n}_preMeasure(e,t){}_postMeasure(e,t){}_additionalProcessing(e,t){}_clipForChildren(e){}_clip(e,t){if(e.beginPath(),P._ClipMeasure.copyFrom(this._currentMeasure),t){t.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);let e=new m(0,0,0,0);e.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),e.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),e.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-e.left,e.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-e.top,P._ClipMeasure.copyFrom(e)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){let t=this.shadowOffsetX,i=this.shadowOffsetY,s=this.shadowBlur,r=Math.min(Math.min(t,0)-2*s,0),o=Math.max(Math.max(t,0)+2*s,0),a=Math.min(Math.min(i,0)-2*s,0),n=Math.max(Math.max(i,0)+2*s,0);e.rect(P._ClipMeasure.left+r,P._ClipMeasure.top+a,P._ClipMeasure.width+o-r,P._ClipMeasure.height+n-a)}else e.rect(P._ClipMeasure.left,P._ClipMeasure.top,P._ClipMeasure.width,P._ClipMeasure.height);e.clip()}_render(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)}_draw(e,t){}contains(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left)&&!(e>this._currentMeasure.left+this._currentMeasure.width)&&!(t<this._currentMeasure.top)&&!(t>this._currentMeasure.top+this._currentMeasure.height)&&(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0)}_processPicking(e,t,i,s,r,o,a,n){return!!this._isEnabled&&!!this.isHitTestVisible&&!!this.isVisible&&!this._doNotRender&&!!this.contains(e,t)&&(this._processObservables(s,e,t,i,r,o,a,n),!0)}_onPointerMove(e,t,i,s){this.onPointerMoveObservable.notifyObservers(t,-1,e,this,s)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerMove(e,t,i,s)}_onPointerEnter(e,t){return!!this._isEnabled&&!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this,t)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerEnter(e,t),!0)}_onPointerOut(e,t,i=!1){if(!i&&!this._isEnabled)return;this._enterCount=0;let s=!0;e.isAscendant(this)||(s=this.onPointerOutObservable.notifyObservers(this,-1,e,this,t)),s&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return this._onPointerEnter(this,r),-1!==this.tabIndex&&(this.host.focusedControl=this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new v(t,s),-1,e,this,r)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerDown(e,t,i,s,r),r&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.add(r.event.pointerId),!0)}_onPointerUp(e,t,i,s,r,o){if(!this._isEnabled)return;this._downCount=0,delete this._downPointerIds[i];let a=r;r&&(this._enterCount>0||-1===this._enterCount)&&!this._host.usePointerTapForClickEvent&&(a=this.onPointerClickObservable.notifyObservers(new v(t,s),-1,e,this,o)),this.onPointerUpObservable.notifyObservers(new v(t,s),-1,e,this,o)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerUp(e,t,i,s,a,o),o&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.delete(o.event.pointerId),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!1)}_onPointerPick(e,t,i,s,r,o){if(!this._host.usePointerTapForClickEvent)return!1;let a=r;return r&&(this._enterCount>0||-1===this._enterCount)&&(a=this.onPointerClickObservable.notifyObservers(new v(t,s),-1,e,this,o)),this.onPointerUpObservable.notifyObservers(new v(t,s),-1,e,this,o)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerPick(e,t,i,s,a,o),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0}_forcePointerUp(e=null){if(null!==e)this._onPointerUp(this,l.I9.Zero(),e,0,!0);else for(let e in this._downPointerIds)this._onPointerUp(this,l.I9.Zero(),+e,0,!0)}_onWheelScroll(e,t){this._isEnabled&&this.onWheelObservable.notifyObservers(new l.I9(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)}_onCanvasBlur(){}_processObservables(e,t,i,s,r,o,a,n){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e===h.Zp.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r,s);let e=this._host._lastControlOver[r];return e&&e!==this&&e._onPointerOut(this,s),e!==this&&this._onPointerEnter(this,s),this._host._lastControlOver[r]=this,!0}if(e===h.Zp.POINTERDOWN)return this._onPointerDown(this,this._dummyVector2,r,o,s),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0;if(e===h.Zp.POINTERUP)return this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,o,!0,s),this._host.usePointerTapForClickEvent||delete this._host._lastControlDown[r],!0;if(e===h.Zp.POINTERWHEEL){if(this._host._lastControlOver[r])return this._host._lastControlOver[r]._onWheelScroll(a,n),!0}else if(e===h.Zp.POINTERTAP)return this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerPick(this,this._dummyVector2,r,o,!0,s),delete this._host._lastControlDown[r],!0;return!1}_getStyleProperty(e,t){let i=(this._style&&this._style[e])??this[e];return!i&&this.parent?this.parent._getStyleProperty(e,t):this.parent?i:t}_prepareFont(){if(this._font||this._fontSet)for(let e of(this._font=this._getStyleProperty("fontStyle","")+" "+this._getStyleProperty("fontWeight","")+" "+this.fontSizeInPixels+"px "+this._getStyleProperty("fontFamily","Arial"),this._fontOffset=P._GetFontOffset(this._font,this._host?.getScene()?.getEngine()),this.getDescendants()))e._markAllAsDirty()}isDimensionFullyDefined(e){return this.getDimension(e).isPixel}getDimension(e){return"width"===e?this._width:this._height}clone(e){let t={};this.serialize(t,!0);let i=new(_.S0.Instantiate("BABYLON.GUI."+t.className));return i.parse(t,e),i}parse(e,t,i){return this._urlRewriter=i,y.p.Parse(()=>this,e,null),this.name=e.name,this._parseFromContent(e,t??this._host),this}serialize(e,t=!1,i=!0){if(!this.isSerializable&&!t)return;let s=0,r=0;this.host&&(r=this.host.idealHeight,s=this.host.idealWidth,this.host.idealWidth=0,this.host.idealHeight=0),y.p.Serialize(this,e),e.name=this.name,e.className=this.getClassName(),i&&this._prepareFont(),this._fontFamily&&(e.fontFamily=this._fontFamily),this.fontSize&&(e.fontSize=this.fontSize),this.fontWeight&&(e.fontWeight=this.fontWeight),this.fontStyle&&(e.fontStyle=this.fontStyle),this._gradient&&(e.gradient={},this._gradient.serialize(e.gradient)),y.p.AppendSerializedAnimations(this,e),this.host&&(this.host.idealWidth=s,this.host.idealHeight=r)}_parseFromContent(e,t,i){if(e.fontFamily&&(this.fontFamily=e.fontFamily),e.fontSize&&(this.fontSize=e.fontSize),e.fontWeight&&(this.fontWeight=e.fontWeight),e.fontStyle&&(this.fontStyle=e.fontStyle),e.gradient){let t=_.S0.Instantiate("BABYLON.GUI."+e.gradient.className);this._gradient=new t,this._gradient?.parse(e.gradient)}if(e.animations){this.animations=[];for(let t=0;t<e.animations.length;t++){let i=e.animations[t],s=(0,C.n9)("BABYLON.Animation");s&&this.animations.push(s.Parse(i))}e.autoAnimate&&this._host&&this._host.getScene()&&this._host.getScene().beginAnimation(this,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}this.fixedRatioMasterIsWidth=e.fixedRatioMasterIsWidth??this.fixedRatioMasterIsWidth}dispose(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onKeyboardEventProcessedObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}static get HORIZONTAL_ALIGNMENT_LEFT(){return P._HORIZONTAL_ALIGNMENT_LEFT}static get HORIZONTAL_ALIGNMENT_RIGHT(){return P._HORIZONTAL_ALIGNMENT_RIGHT}static get HORIZONTAL_ALIGNMENT_CENTER(){return P._HORIZONTAL_ALIGNMENT_CENTER}static get VERTICAL_ALIGNMENT_TOP(){return P._VERTICAL_ALIGNMENT_TOP}static get VERTICAL_ALIGNMENT_BOTTOM(){return P._VERTICAL_ALIGNMENT_BOTTOM}static get VERTICAL_ALIGNMENT_CENTER(){return P._VERTICAL_ALIGNMENT_CENTER}static _GetFontOffset(e,t){if(P._FontHeightSizes[e])return P._FontHeightSizes[e];let i=t||S.q.LastCreatedEngine;if(!i)throw Error("Invalid engine. Unable to create a canvas.");let s=i.getFontOffset(e);return P._FontHeightSizes[e]=s,s}static Parse(e,t,i){let s=_.S0.Instantiate("BABYLON.GUI."+e.className),r=y.p.Parse(()=>{let e=new s;return e._urlRewriter=i,e},e,null);return r.name=e.name,r._parseFromContent(e,t,i),r}static drawEllipse(e,t,i,s,r,o){o.translate(e,t),o.scale(i,s),o.beginPath(),o.arc(0,0,1,0,2*Math.PI*r,r<0),r>=1&&o.closePath(),o.scale(1/i,1/s),o.translate(-e,-t)}isReady(){return!0}}P.AllowAlphaInheritance=!1,P._ClipMeasure=new m(0,0,0,0),P._HORIZONTAL_ALIGNMENT_LEFT=0,P._HORIZONTAL_ALIGNMENT_RIGHT=1,P._HORIZONTAL_ALIGNMENT_CENTER=2,P._VERTICAL_ALIGNMENT_TOP=0,P._VERTICAL_ALIGNMENT_BOTTOM=1,P._VERTICAL_ALIGNMENT_CENTER=2,P._FontHeightSizes={},P.AddHeader=()=>{},(0,o.Cg)([(0,T.lK)()],P.prototype,"metadata",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"isHitTestVisible",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"isPointerBlocker",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"isFocusInvisible",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"clipChildren",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"clipContent",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"useBitmapCache",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"shadowOffsetX",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"shadowOffsetY",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"shadowBlur",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"shadowColor",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"hoverCursor",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"fontOffset",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"alpha",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"isSerializable",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"scaleX",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"scaleY",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"rotation",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"transformCenterY",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"transformCenterX",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"horizontalAlignment",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"verticalAlignment",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"fixedRatio",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"fixedRatioMasterIsWidth",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"width",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"height",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"style",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"color",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"gradient",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"zIndex",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"notRenderable",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"isVisible",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"descendantsOnlyPadding",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"paddingLeft",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"paddingRight",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"paddingTop",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"paddingBottom",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"left",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"top",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"linkOffsetX",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"linkOffsetY",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"isEnabled",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"disabledColor",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"disabledColorItem",null),(0,o.Cg)([(0,T.lK)()],P.prototype,"overlapGroup",void 0),(0,o.Cg)([(0,T.lK)()],P.prototype,"overlapDeltaMultiplier",void 0),(0,C.Y5)("BABYLON.GUI.Control",P);var I=i(4661),E=i(75200),R=i(72500);class M extends P{get renderToIntermediateTexture(){return this._renderToIntermediateTexture}set renderToIntermediateTexture(e){this._renderToIntermediateTexture!==e&&(this._renderToIntermediateTexture=e,this._markAsDirty())}get adaptHeightToChildren(){return this._adaptHeightToChildren}set adaptHeightToChildren(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())}get adaptWidthToChildren(){return this._adaptWidthToChildren}set adaptWidthToChildren(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get children(){return this._children}get isReadOnly(){return this._isReadOnly}set isReadOnly(e){for(let t of(this._isReadOnly=e,this._children))t.isReadOnly=e}constructor(e){super(e),this.name=e,this._children=[],this._measureForChildren=m.Empty(),this._background="",this._backgroundGradient=null,this._adaptWidthToChildren=!1,this._adaptHeightToChildren=!1,this._renderToIntermediateTexture=!1,this._intermediateTexture=null,this.delegatePickingToChildren=!1,this.logLayoutCycleErrors=!1,this.maxLayoutCycle=3,this.onControlAddedObservable=new n.cP,this.onControlRemovedObservable=new n.cP,this._inverseTransformMatrix=b.Identity(),this._inverseMeasure=new m(0,0,0,0)}_getTypeName(){return"Container"}_flagDescendantsAsMatrixDirty(){for(let e of this.children)e._isClipped=!1,e._markMatrixAsDirty()}getChildByName(e){for(let t of this.children)if(t.name===e)return t;return null}getChildByType(e,t){for(let e of this.children)if(e.typeName===t)return e;return null}containsControl(e){return -1!==this.children.indexOf(e)}addControl(e){return e&&-1===this._children.indexOf(e)&&(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty(),this.onControlAddedObservable.notifyObservers(e)),this}clearControls(){for(let e of this.children.slice())this.removeControl(e);return this}removeControl(e){let t=this._children.indexOf(e);return -1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this.onControlRemovedObservable.notifyObservers(e),this}_reOrderControl(e){let t=e.linkedMesh;this.removeControl(e);let i=!1;for(let t=0;t<this._children.length;t++)if(this._children[t].zIndex>e.zIndex){this._children.splice(t,0,e),i=!0;break}i||this._children.push(e),e.parent=this,t&&e.linkWithMesh(t),this._markAsDirty()}_offsetLeft(e){for(let t of(super._offsetLeft(e),this._children))t._offsetLeft(e)}_offsetTop(e){for(let t of(super._offsetTop(e),this._children))t._offsetTop(e)}_markAllAsDirty(){super._markAllAsDirty();for(let e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_localDraw(e){(this._background||this._backgroundGradient)&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._getBackgroundColor(e),e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())}_link(e){for(let t of(super._link(e),this._children))t._link(e)}_beforeLayout(){}_processMeasures(e,t){(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e))&&(super._processMeasures(e,t),this._evaluateClippingState(e),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new I.R("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,E.g.NEAREST_SAMPLINGMODE,R.Y.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))}_layout(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);let i=0;t.save(),this._applyStates(t),this._beforeLayout();do{let s=-1,r=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(let e of this._children)e._tempParentMeasure.copyFrom(this._measureForChildren),e._layout(this._measureForChildren,t)&&e.isVisible&&!e.notRenderable&&(this.adaptWidthToChildren&&e._width.isPixel&&(s=Math.max(s,e._currentMeasure.width+e._paddingLeftInPixels+e._paddingRightInPixels)),this.adaptHeightToChildren&&e._height.isPixel&&(r=Math.max(r,e._currentMeasure.height+e._paddingTopInPixels+e._paddingBottomInPixels)));if(this.adaptWidthToChildren&&s>=0){let e=(s+=this.paddingLeftInPixels+this.paddingRightInPixels)+"px";this.width!==e&&(this.parent?._markAsDirty(),this.width=e,this._width.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}if(this.adaptHeightToChildren&&r>=0){let e=(r+=this.paddingTopInPixels+this.paddingBottomInPixels)+"px";this.height!==e&&(this.parent?._markAsDirty(),this.height=e,this._height.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&a.V.Error(`Layout cycle detected in GUI (Container name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0}_postMeasure(){}_draw(e,t){let i=this._renderToIntermediateTexture&&this._intermediateTexture,s=i?this._intermediateTexture.getContext():e;for(let r of(i&&(s.save(),s.translate(-this._currentMeasure.left,-this._currentMeasure.top),t?(this._transformMatrix.invertToRef(this._inverseTransformMatrix),t.transformToRef(this._inverseTransformMatrix,this._inverseMeasure),s.clearRect(this._inverseMeasure.left,this._inverseMeasure.top,this._inverseMeasure.width,this._inverseMeasure.height)):s.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(s),e.save(),this.clipChildren&&this._clipForChildren(s),this._children))(!t||r._intersectsRect(t))&&r._render(s,t);i&&(s.restore(),e.save(),e.globalAlpha=this.alpha,e.drawImage(s.canvas,this._currentMeasure.left,this._currentMeasure.top),e.restore()),e.restore()}getDescendantsToRef(e,t=!1,i){if(this.children)for(let s=0;s<this.children.length;s++){let r=this.children[s];(!i||i(r))&&e.push(r),t||r.getDescendantsToRef(e,!1,i)}}_processPicking(e,t,i,s,r,o,a,n){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;let l=super.contains(e,t);if(!l&&this.clipChildren)return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){let r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}for(let l=this._children.length-1;l>=0;l--){let h=this._children[l];if(h._processPicking(e,t,i,s,r,o,a,n))return h.hoverCursor&&this._host._changeCursor(h.hoverCursor),!0}return!!l&&!!this.isHitTestVisible&&this._processObservables(s,e,t,i,r,o,a,n)}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(this._currentMeasure)}_getAdaptDimTo(e){return"width"===e?this.adaptWidthToChildren:this.adaptHeightToChildren}isDimensionFullyDefined(e){if(this._getAdaptDimTo(e)){for(let t of this.children)if(!t.isDimensionFullyDefined(e))return!1;return!0}return super.isDimensionFullyDefined(e)}serialize(e,t=!1,i=!0){if((super.serialize(e,t,i),this.isSerializable||t)&&(this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient)),this.children.length)){for(let s of(e.children=[],this.children))if(s.isSerializable||t){let r={};s.serialize(r,t,i),e.children.push(r)}}}dispose(){super.dispose();for(let e=this.children.length-1;e>=0;e--)this.children[e].dispose();this._intermediateTexture?.dispose()}_parseFromContent(e,t,i){if(super._parseFromContent(e,t,i),this._link(t),e.backgroundGradient){let t=_.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this._backgroundGradient=new t,this._backgroundGradient?.parse(e.backgroundGradient)}if(e.children)for(let s of e.children)this.addControl(P.Parse(s,t,i))}isReady(){for(let e of this.children)if(!e.isReady())return!1;return!0}}(0,o.Cg)([(0,T.lK)()],M.prototype,"delegatePickingToChildren",void 0),(0,o.Cg)([(0,T.lK)()],M.prototype,"renderToIntermediateTexture",null),(0,o.Cg)([(0,T.lK)()],M.prototype,"maxLayoutCycle",void 0),(0,o.Cg)([(0,T.lK)()],M.prototype,"adaptHeightToChildren",null),(0,o.Cg)([(0,T.lK)()],M.prototype,"adaptWidthToChildren",null),(0,o.Cg)([(0,T.lK)()],M.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],M.prototype,"backgroundGradient",null),(0,C.Y5)("BABYLON.GUI.Container",M);class w extends M{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get cornerRadius(){return this._cornerRadius[0]}set cornerRadius(e){e<0&&(e=0),(this._cornerRadius[0]!==e||this._cornerRadius[1]!==e||this._cornerRadius[2]!==e||this._cornerRadius[3]!==e)&&(this._cornerRadius[0]=this._cornerRadius[1]=this._cornerRadius[2]=this._cornerRadius[3]=e,this._markAsDirty())}get cornerRadiusX(){return this._cornerRadius[0]}set cornerRadiusX(e){this._cornerRadius[0]!==e&&(this._cornerRadius[0]=e)}get cornerRadiusY(){return this._cornerRadius[1]}set cornerRadiusY(e){this._cornerRadius[1]!==e&&(this._cornerRadius[1]=e)}get cornerRadiusZ(){return this._cornerRadius[2]}set cornerRadiusZ(e){this._cornerRadius[2]!==e&&(this._cornerRadius[2]=e)}get cornerRadiusW(){return this._cornerRadius[3]}set cornerRadiusW(e){this._cornerRadius[3]!==e&&(this._cornerRadius[3]=e)}constructor(e){super(e),this.name=e,this._thickness=1,this._cornerRadius=[0,0,0,0],this._cachedRadius=[0,0,0,0]}_getTypeName(){return"Rectangle"}_computeAdditionalOffsetX(){let e=0;return(0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3])&&(e+=1),this.thickness&&(e+=this.thickness/2),e}_computeAdditionalOffsetY(){let e=0;return(0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3])&&(e+=1),this.thickness&&(e+=this.thickness/2),e}_getRectangleFill(e){return this._getBackgroundColor(e)}_localDraw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),(this._background||this._backgroundGradient)&&(e.fillStyle=this._getRectangleFill(e),0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),(this.color||this.gradient)&&(e.strokeStyle=this.gradient?this.gradient.getCanvasGradient(e):this.color),e.lineWidth=this._thickness,0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_drawRoundedRect(e,t=0){let i=this._currentMeasure.left+t,s=this._currentMeasure.top+t,r=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t;for(let e=0;e<this._cornerRadius.length;e++)this._cachedRadius[e]=Math.abs(Math.min(o/2,Math.min(r/2,this._cornerRadius[e])));e.beginPath(),e.moveTo(i+this._cachedRadius[0],s),e.lineTo(i+r-this._cachedRadius[1],s),e.arc(i+r-this._cachedRadius[1],s+this._cachedRadius[1],this._cachedRadius[1],3*Math.PI/2,2*Math.PI),e.lineTo(i+r,s+o-this._cachedRadius[2]),e.arc(i+r-this._cachedRadius[2],s+o-this._cachedRadius[2],this._cachedRadius[2],0,Math.PI/2),e.lineTo(i+this._cachedRadius[3],s+o),e.arc(i+this._cachedRadius[3],s+o-this._cachedRadius[3],this._cachedRadius[3],Math.PI/2,Math.PI),e.lineTo(i,s+this._cachedRadius[0]),e.arc(i+this._cachedRadius[0],s+this._cachedRadius[0],this._cachedRadius[0],Math.PI,3*Math.PI/2),e.closePath()}_clipForChildren(e){(0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3])&&(this._drawRoundedRect(e,this._thickness),e.clip())}}(0,o.Cg)([(0,T.lK)()],w.prototype,"thickness",null),(0,o.Cg)([(0,T.lK)()],w.prototype,"cornerRadius",null),(0,o.Cg)([(0,T.lK)()],w.prototype,"cornerRadiusX",null),(0,o.Cg)([(0,T.lK)()],w.prototype,"cornerRadiusY",null),(0,o.Cg)([(0,T.lK)()],w.prototype,"cornerRadiusZ",null),(0,o.Cg)([(0,T.lK)()],w.prototype,"cornerRadiusW",null),(0,C.Y5)("BABYLON.GUI.Rectangle",w),function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis",e[e.WordWrapEllipsis=3]="WordWrapEllipsis",e[e.HTML=4]="HTML"}(s||(s={}));class O extends P{get lines(){return this._lines}get resizeToFit(){return this._resizeToFit}set resizeToFit(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())}get textWrapping(){return this._textWrapping}set textWrapping(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())}get text(){return this._text}set text(e){this._text!==e&&(this._text=e+"",this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))}get textHorizontalAlignment(){return this._textHorizontalAlignment}set textHorizontalAlignment(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())}get textVerticalAlignment(){return this._textVerticalAlignment}set textVerticalAlignment(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())}set lineSpacing(e){this._lineSpacing.fromString(e)&&this._markAsDirty()}get lineSpacing(){return this._lineSpacing.toString(this._host)}get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())}get underline(){return this._underline}set underline(e){this._underline!==e&&(this._underline=e,this._markAsDirty())}get lineThrough(){return this._lineThrough}set lineThrough(e){this._lineThrough!==e&&(this._lineThrough=e,this._markAsDirty())}get applyOutlineToUnderline(){return this._applyOutlineToUnderline}set applyOutlineToUnderline(e){this._applyOutlineToUnderline!==e&&(this._applyOutlineToUnderline=e,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())}get wordDivider(){return this._wordDivider}set wordDivider(e){this._wordDivider!==e&&(this._wordDivider=e,this._markAsDirty())}get forceResizeWidth(){return this._forceResizeWidth}set forceResizeWidth(e){this._forceResizeWidth!==e&&(this._forceResizeWidth=e,this._markAsDirty())}constructor(e,t=""){super(e),this.name=e,this._text="",this._textWrapping=0,this._textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,this._textVerticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,this._resizeToFit=!1,this._lineSpacing=new d(0),this._outlineWidth=0,this._outlineColor="white",this._underline=!1,this._lineThrough=!1,this._wordDivider=" ",this._forceResizeWidth=!1,this._applyOutlineToUnderline=!1,this.onTextChangedObservable=new n.cP,this.onLinesReadyObservable=new n.cP,this.reuseHTMLForWordWrapping=!1,this._linesTemp=[],this._htmlElement=null,this.text=t}_getTypeName(){return"TextBlock"}_processMeasures(e,t){(!this._fontOffset||this.isDirty)&&(this._fontOffset=P._GetFontOffset(t.font,this._host.getScene()?.getEngine())),super._processMeasures(e,t),this._lines=this._breakLines(this._currentMeasure.width,this._currentMeasure.height,t),this.onLinesReadyObservable.notifyObservers(this);let i=0;for(let e=0;e<this._lines.length;e++){let t=this._lines[e];t.width>i&&(i=t.width)}if(this._resizeToFit){if(0===this._textWrapping||this._forceResizeWidth){let e=Math.ceil(this._paddingLeftInPixels)+Math.ceil(this._paddingRightInPixels)+Math.ceil(i);e!==this._width.getValueInPixel(this._host,this._tempParentMeasure.width)&&(this._width.updateInPlace(e,d.UNITMODE_PIXEL),this._rebuildLayout=!0)}let e=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){let t=0;t=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),e+=(this._lines.length-1)*t}e!==this._height.internalValue&&(this._height.updateInPlace(e,d.UNITMODE_PIXEL),this._rebuildLayout=!0)}}_drawText(e,t,i,s){let r=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case P.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case P.HORIZONTAL_ALIGNMENT_RIGHT:o=r-t;break;case P.HORIZONTAL_ALIGNMENT_CENTER:o=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(e,this._currentMeasure.left+o,i),s.fillText(e,this._currentMeasure.left+o,i),this._underline&&this._drawLine(this._currentMeasure.left+o,i+3,this._currentMeasure.left+o+t,i+3,s),this._lineThrough&&this._drawLine(this._currentMeasure.left+o,i-this.fontSizeInPixels/3,this._currentMeasure.left+o+t,i-this.fontSizeInPixels/3,s)}_drawLine(e,t,i,s,r){if(r.beginPath(),r.lineWidth=Math.round(.05*this.fontSizeInPixels),r.moveTo(e,t),r.lineTo(i,s),this.outlineWidth&&this.applyOutlineToUnderline)r.stroke(),r.fill();else{let e=r.strokeStyle;r.strokeStyle=r.fillStyle,r.stroke(),r.strokeStyle=e}r.closePath()}_draw(e){e.save(),this._applyStates(e),this._renderLines(e),e.restore()}_applyStates(e){super._applyStates(e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor,e.lineJoin="miter",e.miterLimit=2)}_breakLines(e,t,i){this._linesTemp.length=0;let s=4===this._textWrapping?this._parseHTMLText(e,t,i):this.text.split("\n");switch(this._textWrapping){case 1:for(let t of s)this._linesTemp.push(...this._parseLineWordWrap(t,e,i));break;case 2:for(let t of s)this._linesTemp.push(this._parseLineEllipsis(t,e,i));break;case 3:for(let r of s)this._linesTemp.push(...this._parseLineWordWrapEllipsis(r,e,t,i));break;default:for(let e of s)this._linesTemp.push(this._parseLine(e,i))}return this._linesTemp}_parseHTMLText(e,t,i){let s=[];this._htmlElement||(this._htmlElement=document.createElement("div"),document.body.appendChild(this._htmlElement));let r=this._htmlElement;r.textContent=this.text,r.style.font=i.font,r.style.position="absolute",r.style.visibility="hidden",r.style.top="-1000px",r.style.left="-1000px",this.adjustWordWrappingHTMLElement?.(r),r.style.width=e+"px",r.style.height=t+"px";let o=r.textContent;if(!o)return s;let a=r.childNodes[0],n=document.createRange(),l=0;for(let e of o){n.setStart(a,0),n.setEnd(a,l+1);let t=n.getClientRects().length-1;s[t]=(s[t]||"")+e,l++}return this.reuseHTMLForWordWrapping||(r.remove(),this._htmlElement=null),s}_parseLine(e="",t){return{text:e,width:this._getTextMetricsWidth(t.measureText(e))}}_getCharsToRemove(e,t,i){return Math.max(Math.floor((e>t?e-t:0)/(e/i)),1)}_parseLineEllipsis(e="",t,i){let s=this._getTextMetricsWidth(i.measureText(e)),r=this._getCharsToRemove(s,t,e.length),o=Array.from&&Array.from(e);if(o)for(;o.length&&s>t;)o.splice(o.length-r,r),e=`${o.join("")}…`,s=this._getTextMetricsWidth(i.measureText(e)),r=this._getCharsToRemove(s,t,e.length);else{for(;e.length>2&&s>t;)e=e.slice(0,-r),s=this._getTextMetricsWidth(i.measureText(e+"…")),r=this._getCharsToRemove(s,t,e.length);e+="…"}return{text:e,width:s}}_getTextMetricsWidth(e){return void 0!==e.actualBoundingBoxLeft?Math.abs(e.actualBoundingBoxLeft)+Math.abs(e.actualBoundingBoxRight):e.width}_parseLineWordWrap(e="",t,i){let s=[],r=this.wordSplittingFunction?this.wordSplittingFunction(e):e.split(this._wordDivider),o=this._getTextMetricsWidth(i.measureText(e));for(let a=0;a<r.length;a++){let n=a>0?e+this._wordDivider+r[a]:r[0],l=this._getTextMetricsWidth(i.measureText(n));l>t&&a>0?(s.push({text:e,width:o}),e=r[a],o=this._getTextMetricsWidth(i.measureText(e))):(o=l,e=n)}return s.push({text:e,width:o}),s}_parseLineWordWrapEllipsis(e="",t,i,s){let r=this._parseLineWordWrap(e,t,s);for(let e=1;e<=r.length;e++)if(this._computeHeightForLinesOf(e)>i&&e>1){let i=r[e-2],o=r[e-1];r[e-2]=this._parseLineEllipsis(i.text+this._wordDivider+o.text,t,s);let a=r.length-e+1;for(let e=0;e<a;e++)r.pop();break}return r}_renderLines(e){if(!this._fontOffset||!this._lines)return;let t=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case P.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case P.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case P.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(let t=0;t<this._lines.length;t++){let s=this._lines[t];0!==t&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(s.text,s.width,i,e),i+=this._fontOffset.height}}_computeHeightForLinesOf(e){let t=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*e;e>0&&0!==this._lineSpacing.internalValue&&(t+=(e-1)*(this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)));return t}isDimensionFullyDefined(e){return!!this.resizeToFit||super.isDimensionFullyDefined(e)}computeExpectedHeight(){if(this.text&&this.widthInPixels){let e=S.q.LastCreatedEngine?.createCanvas(0,0).getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=P._GetFontOffset(e.font,this._host.getScene()?.getEngine()));let t=this._lines?this._lines:this._breakLines(this.widthInPixels-this._paddingLeftInPixels-this._paddingRightInPixels,this.heightInPixels-this._paddingTopInPixels-this._paddingBottomInPixels,e);return this._computeHeightForLinesOf(t.length)}}return 0}dispose(){super.dispose(),this.onTextChangedObservable.clear(),this._htmlElement?.remove(),this._htmlElement=null}}(0,o.Cg)([(0,T.lK)()],O.prototype,"resizeToFit",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"textWrapping",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"text",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"textHorizontalAlignment",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"textVerticalAlignment",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"lineSpacing",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"outlineWidth",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"underline",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"lineThrough",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"applyOutlineToUnderline",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"outlineColor",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"wordDivider",null),(0,o.Cg)([(0,T.lK)()],O.prototype,"forceResizeWidth",null),(0,C.Y5)("BABYLON.GUI.TextBlock",O);class B extends P{get isLoaded(){return this._loaded}isReady(){return this.isLoaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)}get sliceLeft(){return this._sliceLeft}set sliceLeft(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())}get sliceRight(){return this._sliceRight}set sliceRight(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())}get sliceTop(){return this._sliceTop}set sliceTop(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())}get sliceBottom(){return this._sliceBottom}set sliceBottom(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())}get sourceLeft(){return this._sourceLeft}set sourceLeft(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get populateNinePatchSlicesFromImage(){return this._populateNinePatchSlicesFromImage}set populateNinePatchSlicesFromImage(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())}get isSVG(){return this._isSVG}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())}get stretch(){return this._stretch}set stretch(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())}_rotate90(e,t=!1){let i=this._domImage.width,s=this._domImage.height,r=this._host?.getScene()?.getEngine()||S.q.LastCreatedEngine;if(!r)throw Error("Invalid engine. Unable to create a canvas.");let o=r.createCanvas(s,i),a=o.getContext("2d");a.translate(o.width/2,o.height/2),a.rotate(e*Math.PI/2),a.drawImage(this._domImage,0,0,i,s,-i/2,-s/2,i,s);let n=o.toDataURL("image/jpg"),l=new B(this.name+"rotated",n);return t&&(l._stretch=this._stretch,l._autoScale=this._autoScale,l._cellId=this._cellId,l._cellWidth=e%1?this._cellHeight:this._cellWidth,l._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,l,e),this._imageDataCache.data=null,l}_handleRotationForSVGImage(e,t,i){e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce(()=>{this._rotate90SourceProperties(e,t,i),this._markAsDirty()}))}_rotate90SourceProperties(e,t,i){let s=e.sourceLeft,r=e.sourceTop,o=e.domImage.width,a=e.domImage.height,n=s,l=r,h=e.sourceWidth,_=e.sourceHeight;if(0!=i){let e=i<0?-1:1;i%=4;for(let t=0;t<Math.abs(i);++t)n=-(r-a/2)*e+a/2,l=(s-o/2)*e+o/2,[h,_]=[_,h],i<0?l-=_:n-=h,s=n,r=l,[o,a]=[a,o]}t.sourceLeft=n,t.sourceTop=l,t.sourceWidth=h,t.sourceHeight=_}_extractNinePatchSliceDataFromImage(){let e=this._domImage.width,t=this._domImage.height;if(!this._workingCanvas){let i=this._host?.getScene()?.getEngine()||S.q.LastCreatedEngine;if(!i)throw Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}let i=this._workingCanvas.getContext("2d");i.drawImage(this._domImage,0,0,e,t);let s=i.getImageData(0,0,e,t);this._sliceLeft=-1,this._sliceRight=-1;for(let t=0;t<e;t++){let e=s.data[4*t+3];if(e>127&&-1===this._sliceLeft){this._sliceLeft=t;continue}if(e<127&&this._sliceLeft>-1){this._sliceRight=t;break}}this._sliceTop=-1,this._sliceBottom=-1;for(let i=0;i<t;i++){let t=s.data[i*e*4+3];if(t>127&&-1===this._sliceTop){this._sliceTop=i;continue}if(t<127&&this._sliceTop>-1){this._sliceBottom=i;break}}}set domImage(e){this._domImage=e,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=()=>{this._onImageLoaded()}}get domImage(){return this._domImage}_onImageLoaded(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get source(){return this._source}static ResetImageCache(){B.SourceImgCache.clear()}_removeCacheUsage(e){let t=e&&B.SourceImgCache.get(e);if(t){t.timesUsed-=1;let i=t.img;i.parentNode&&i.parentNode.removeChild(i),0===t.timesUsed&&B.SourceImgCache.delete(e)}}set source(e){if(this._urlRewriter&&e&&(e=this._urlRewriter(e)),this._source===e)return;this._removeCacheUsage(this._source),this._loaded=!1,this._source=e,this._imageDataCache.data=null,e&&(e=this._svgCheck(e));let t=this._host?.getScene()?.getEngine()||S.q.LastCreatedEngine;if(!t)return;if(e&&B.SourceImgCache.has(e)){let t=B.SourceImgCache.get(e);this._domImage=t.img,t.timesUsed+=1,t.loaded?this._onImageLoaded():t.waitingForLoadCallback.push(this._onImageLoaded.bind(this));return}this._domImage=t.createCanvasImage();let i=this._domImage,s=!1;i.style&&this._source?.endsWith(".svg")&&(i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",t.getRenderingCanvas()?.parentNode?.appendChild(i),s=!0),e&&B.SourceImgCache.set(e,{img:this._domImage,timesUsed:1,loaded:!1,waitingForLoadCallback:[this._onImageLoaded.bind(this)]}),this._domImage.onload=()=>{if(e){let t=B.SourceImgCache.get(e);if(t){for(let e of(t.loaded=!0,t.waitingForLoadCallback))e();t.waitingForLoadCallback.length=0,s&&i.remove();return}}this._onImageLoaded(),s&&i.remove()},e&&(_.S0.SetCorsBehavior(e,this._domImage),_.S0.SetReferrerPolicyBehavior(this.referrerPolicy,this._domImage),this._domImage.src=e)}_sanitizeSVG(e){if(-1===e.indexOf("<svg"))return e;let t=new DOMParser().parseFromString(e,"image/svg+xml"),i=[/^on/i,/^xlink:href$/,/^href$/];return["script","iframe","foreignObject","object","embed","link","style"].forEach(e=>{let i=t.getElementsByTagName(e);for(let e=i.length-1;e>=0;e--)i[e].remove()}),!function e(t){if(t.attributes)for(let e=t.attributes.length-1;e>=0;e--){let s=t.attributes[e],r=s.name,o=s.value;i.some(e=>e.test(r))&&t.removeAttribute(r),"string"==typeof o&&o.trim().toLowerCase().startsWith("javascript:")&&t.removeAttribute(r)}for(let i=0;i<t.children.length;i++)e(t.children[i])}(t.documentElement),new XMLSerializer().serializeToString(t)}_svgCheck(e){if("undefined"==typeof window||"undefined"==typeof document||!window.SVGSVGElement||!window.SVGSVGElement||-1===e.search(/(\.svg|\.svg?[?|#].*)$/gi)||e.indexOf("#")!==e.lastIndexOf("#"))return e;{this._isSVG=!0;let t=(e=this._sanitizeSVG(e)).split("#")[0],i=e.split("#")[1],s=document.body.querySelector('object[data="'+t+'"]');if(s){let t=s.contentDocument;if(t&&t.documentElement){let r=t.documentElement.getAttribute("viewBox"),o=Number(t.documentElement.getAttribute("width")),a=Number(t.documentElement.getAttribute("height"));if(t.getElementById(i)&&r&&o&&a)return this._getSVGAttribs(s,i),e}s.addEventListener("load",()=>{this._getSVGAttribs(s,i)})}else{let e=document.createElement("object");e.data=t,e.type="image/svg+xml",e.width="0%",e.height="0%",document.body.appendChild(e),e.onload=()=>{let e=document.body.querySelector('object[data="'+t+'"]');e&&this._getSVGAttribs(e,i)}}return t}}_getSVGAttribs(e,t){let i=e.contentDocument;if(i&&i.documentElement){let e=i.documentElement.getAttribute("viewBox"),s=Number(i.documentElement.getAttribute("width")),r=Number(i.documentElement.getAttribute("height")),o=i.getElementById(t);if(e&&s&&r&&o){let t=Number(e.split(" ")[2]),i=Number(e.split(" ")[3]),a=o.getBBox(),n=1,l=1,h=0,_=0,d=o.transform.baseVal.consolidate().matrix;o.transform&&o.transform.baseVal.consolidate()&&(n=d.a,l=d.d,h=d.e,_=d.f),this.sourceLeft=(n*a.x+h)*s/t,this.sourceTop=(l*a.y+_)*r/i,this.sourceWidth=a.width*n*(s/t),this.sourceHeight=a.height*l*(r/i),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())}get cellId(){return this._cellId}set cellId(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())}constructor(e,t=null){super(e),this.name=e,this._workingCanvas=null,this._loaded=!1,this._stretch=B.STRETCH_FILL,this._source=null,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._isSVG=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._populateNinePatchSlicesFromImage=!1,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new n.cP,this.onSVGAttributesComputedObservable=new n.cP,this.source=t}contains(e,t){if(!super.contains(e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;let i=0|this._currentMeasure.width,s=0|this._currentMeasure.height,r=i+"_"+s,o=this._imageDataCache.data;if(!o||this._imageDataCache.key!==r){let e=this._workingCanvas.getContext("2d");this._imageDataCache.data=o=e.getImageData(0,0,i,s).data,this._imageDataCache.key=r}return e=e-this._currentMeasure.left|0,t=t-this._currentMeasure.top|0,o[(e+t*i)*4+3]>0}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")}_processMeasures(e,t){if(this._loaded)switch(this._stretch){case B.STRETCH_NONE:case B.STRETCH_FILL:case B.STRETCH_UNIFORM:case B.STRETCH_NINE_PATCH:break;case B.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}super._processMeasures(e,t)}_prepareWorkingCanvasForOpaqueDetection(){if(!this._detectPointerOnOpaqueOnly)return;let e=this._currentMeasure.width,t=this._currentMeasure.height;if(!this._workingCanvas){let i=this._host?.getScene()?.getEngine()||S.q.LastCreatedEngine;if(!i)throw Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}this._workingCanvas.getContext("2d").clearRect(0,0,e,t)}_drawImage(e,t,i,s,r,o,a,n,l){if(e.drawImage(this._domImage,t,i,s,r,o,a,n,l),!this._detectPointerOnOpaqueOnly)return;let h=e.getTransform(),_=this._workingCanvas.getContext("2d");_.save();let d=o-this._currentMeasure.left,c=a-this._currentMeasure.top;_.setTransform(h.a,h.b,h.c,h.d,(d+n)/2,(c+l)/2),_.translate(-(d+n)/2,-(c+l)/2),_.drawImage(this._domImage,t,i,s,r,d,c,n,l),_.restore()}_draw(e){let t,i,s,r;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)t=this._sourceLeft,i=this._sourceTop,s=this._sourceWidth?this._sourceWidth:this._imageWidth,r=this._sourceHeight?this._sourceHeight:this._imageHeight;else{let e=this._domImage.naturalWidth/this.cellWidth,o=this.cellId/e|0,a=this.cellId%e;t=this.cellWidth*a,i=this.cellHeight*o,s=this.cellWidth,r=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case B.STRETCH_NONE:case B.STRETCH_FILL:this._drawImage(e,t,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case B.STRETCH_UNIFORM:{let o=Math.min(this._currentMeasure.width/s,this._currentMeasure.height/r),a=(this._currentMeasure.width-s*o)/2,n=(this._currentMeasure.height-r*o)/2;this._drawImage(e,t,i,s,r,this._currentMeasure.left+a,this._currentMeasure.top+n,s*o,r*o);break}case B.STRETCH_EXTEND:this._drawImage(e,t,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case B.STRETCH_NINE_PATCH:this._renderNinePatch(e,t,i,s,r)}e.restore()}_renderNinePatch(e,t,i,s,r){let o=this.host.idealRatio,a=this._sliceLeft,n=this._sliceTop,l=r-this._sliceBottom,h=s-this._sliceRight,_=this._sliceRight-this._sliceLeft,d=this._sliceBottom-this._sliceTop,c=Math.round(a*o),u=Math.round(n*o),f=Math.round(l*o),g=Math.round(h*o),m=Math.round(this._currentMeasure.width)-g-c+2,p=Math.round(this._currentMeasure.height)-f-u+2,v=Math.round(this._currentMeasure.left)+c-1,b=Math.round(this._currentMeasure.top)+u-1,x=Math.round(this._currentMeasure.left+this._currentMeasure.width)-g,C=Math.round(this._currentMeasure.top+this._currentMeasure.height)-f;this._drawImage(e,t,i,a,n,this._currentMeasure.left,this._currentMeasure.top,c,u),this._drawImage(e,t+this._sliceLeft,i,_,n,v+1,this._currentMeasure.top,m-2,u),this._drawImage(e,t+this._sliceRight,i,h,n,x,this._currentMeasure.top,g,u),this._drawImage(e,t,i+this._sliceTop,a,d,this._currentMeasure.left,b+1,c,p-2),this._drawImage(e,t+this._sliceLeft,i+this._sliceTop,_,d,v+1,b+1,m-2,p-2),this._drawImage(e,t+this._sliceRight,i+this._sliceTop,h,d,x,b+1,g,p-2),this._drawImage(e,t,i+this._sliceBottom,a,l,this._currentMeasure.left,C,c,f),this._drawImage(e,t+this.sliceLeft,i+this._sliceBottom,_,l,v+1,C,m-2,f),this._drawImage(e,t+this._sliceRight,i+this._sliceBottom,h,l,x,C,g,f)}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this._removeCacheUsage(this._source)}}B.SourceImgCache=new Map,B.STRETCH_NONE=0,B.STRETCH_FILL=1,B.STRETCH_UNIFORM=2,B.STRETCH_EXTEND=3,B.STRETCH_NINE_PATCH=4,(0,o.Cg)([(0,T.lK)()],B.prototype,"detectPointerOnOpaqueOnly",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sliceLeft",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sliceRight",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sliceTop",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sliceBottom",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sourceLeft",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sourceTop",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sourceWidth",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"sourceHeight",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"populateNinePatchSlicesFromImage",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"autoScale",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"stretch",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"source",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"cellWidth",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"cellHeight",null),(0,o.Cg)([(0,T.lK)()],B.prototype,"cellId",null),(0,C.Y5)("BABYLON.GUI.Image",B);class A extends w{get image(){return this._image}get textBlock(){return this._textBlock}constructor(e){super(e),this.name=e,this.thickness=1,this.isPointerBlocker=!0;let t=null;this.pointerEnterAnimation=()=>{t=this.alpha,this.alpha-=.1},this.pointerOutAnimation=()=>{null!==t&&(this.alpha=t)},this.pointerDownAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"Button"}_processPicking(e,t,i,s,r,o,a,n){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable||!super.contains(e,t))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){let r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}return this._processObservables(s,e,t,i,r,o,a,n),!0}_onPointerEnter(e,t){return!!super._onPointerEnter(e,t)&&(!this.isReadOnly&&this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)}_onPointerOut(e,t,i=!1){!this.isReadOnly&&this.pointerOutAnimation&&this.pointerOutAnimation(),super._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!this.isReadOnly&&this.pointerDownAnimation&&this.pointerDownAnimation(),!0)}_getRectangleFill(e){return this.isEnabled?this._getBackgroundColor(e):this._disabledColor}_onPointerUp(e,t,i,s,r,o){!this.isReadOnly&&this.pointerUpAnimation&&this.pointerUpAnimation(),super._onPointerUp(e,t,i,s,r,o)}serialize(e,t,i){super.serialize(e,t,i),(this.isSerializable||t)&&(this._textBlock&&(e.textBlockName=this._textBlock.name),this._image&&(e.imageName=this._image.name))}_parseFromContent(e,t){super._parseFromContent(e,t),e.textBlockName&&(this._textBlock=this.getChildByName(e.textBlockName)),e.imageName&&(this._image=this.getChildByName(e.imageName))}static CreateImageButton(e,t,i){let s=new this(e),r=new O(e+"_button",t);r.textWrapping=!0,r.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,r.paddingLeft="20%",s.addControl(r);let o=new B(e+"_icon",i);return o.width="20%",o.stretch=B.STRETCH_UNIFORM,o.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,s.addControl(o),s._image=o,s._textBlock=r,s}static CreateImageOnlyButton(e,t){let i=new this(e),s=new B(e+"_icon",t);return s.stretch=B.STRETCH_FILL,s.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(s),i._image=s,i}static CreateSimpleButton(e,t){let i=new this(e),s=new O(e+"_button",t);return s.textWrapping=!0,s.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(s),i._textBlock=s,i}static CreateImageWithCenterTextButton(e,t,i){let s=new this(e),r=new B(e+"_icon",i);r.stretch=B.STRETCH_FILL,s.addControl(r);let o=new O(e+"_button",t);return o.textWrapping=!0,o.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,s.addControl(o),s._image=r,s._textBlock=o,s}}(0,C.Y5)("BABYLON.GUI.Button",A);class F extends M{get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())}get spacing(){return this._spacing}set spacing(e){this._spacing!==e&&(this._spacing=e,this._markAsDirty())}set width(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get width(){return this._width.toString(this._host)}set height(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get height(){return this._height.toString(this._host)}constructor(e){super(e),this.name=e,this._isVertical=!0,this._manualWidth=!1,this._manualHeight=!1,this._doNotTrackManualChanges=!1,this._spacing=0,this.ignoreLayoutWarnings=!1}_getTypeName(){return"StackPanel"}_preMeasure(e,t){for(let e of this._children)this._isVertical?e.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP:e.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT;super._preMeasure(e,t)}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,(!this.isVertical||this._manualWidth)&&(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)}_postMeasure(){let e=0,t=0,i=this._children.length;for(let s=0;s<i;s++){let r=this._children[s];if(r.isVisible&&!r.notRenderable)if(this._isVertical){let e=t+"px";r.top!==e&&(r.top=e,this._rebuildLayout=!0,r._top.ignoreAdaptiveScaling=!0),this.ignoreLayoutWarnings||r.isDimensionFullyDefined("height")?t+=r._currentMeasure.height+r._paddingTopInPixels+r._paddingBottomInPixels+(s<i-1?this._spacing:0):a.V.Warn(`Control (Name:${r.name}, UniqueId:${r.uniqueId}) is using height in percentage mode inside a vertical StackPanel`,1)}else{let t=e+"px";r.left!==t&&(r.left=t,this._rebuildLayout=!0,r._left.ignoreAdaptiveScaling=!0),this.ignoreLayoutWarnings||r.isDimensionFullyDefined("width")?e+=r._currentMeasure.width+r._paddingLeftInPixels+r._paddingRightInPixels+(s<i-1?this._spacing:0):a.V.Warn(`Control (Name:${r.name}, UniqueId:${r.uniqueId}) is using width in percentage mode inside a horizontal StackPanel`,1)}}e+=this._paddingLeftInPixels+this._paddingRightInPixels,t+=this._paddingTopInPixels+this._paddingBottomInPixels,this._doNotTrackManualChanges=!0;let s=!1,r=!1;if((!this._manualHeight||this.adaptHeightToChildren)&&this._isVertical){let e=this.height;this.height=t+"px",r=e!==this.height||!this._height.ignoreAdaptiveScaling}if((!this._manualWidth||this.adaptWidthToChildren)&&!this._isVertical){let t=this.width;this.width=e+"px",s=t!==this.width||!this._width.ignoreAdaptiveScaling}r&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||r)&&(this._rebuildLayout=!0),super._postMeasure()}_getManualDim(e){return"width"===e?this._manualWidth:this._manualHeight}isDimensionFullyDefined(e){if("height"===e?this.isVertical:!this.isVertical&&!this._getManualDim(e)){for(let t of this._children)if(!t.isDimensionFullyDefined(e))return!1;return!0}return this.getDimension(e).isPixel||this._getAdaptDimTo(e)}serialize(e,t,i){super.serialize(e,t,i),(this.isSerializable||t)&&(e.manualWidth=this._manualWidth,e.manualHeight=this._manualHeight)}_parseFromContent(e,t){this._manualWidth=e.manualWidth,this._manualHeight=e.manualHeight,super._parseFromContent(e,t)}}(0,o.Cg)([(0,T.lK)()],F.prototype,"ignoreLayoutWarnings",void 0),(0,o.Cg)([(0,T.lK)()],F.prototype,"isVertical",null),(0,o.Cg)([(0,T.lK)()],F.prototype,"spacing",null),(0,o.Cg)([(0,T.lK)()],F.prototype,"width",null),(0,o.Cg)([(0,T.lK)()],F.prototype,"height",null),(0,C.Y5)("BABYLON.GUI.StackPanel",F);class L extends P{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))}constructor(e){super(e),this.name=e,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.onIsCheckedChangedObservable=new n.cP,this.isPointerBlocker=!0}_getTypeName(){return"Checkbox"}_draw(e){e.save(),this._applyStates(e);let t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,i),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color?this.color:"#ffffff":this._disabledColorItem;let s=t*this._checkSizeRatio,r=i*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(t-s)/2,this._currentMeasure.top+this._thickness/2+(i-r)/2,s,r)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,i),e.restore()}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(this.isReadOnly||(this.isChecked=!this.isChecked),!0)}static AddCheckBoxWithHeader(e,t){let i=new F;i.isVertical=!1,i.height="30px";let s=new L;s.width="20px",s.height="20px",s.isChecked=!0,s.color="green",s.onIsCheckedChangedObservable.add(t),i.addControl(s);let r=new O;return r.text=e,r.width="180px",r.paddingLeft="5px",r.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,r.color="white",i.addControl(r),i}}(0,o.Cg)([(0,T.lK)()],L.prototype,"thickness",null),(0,o.Cg)([(0,T.lK)()],L.prototype,"checkSizeRatio",null),(0,o.Cg)([(0,T.lK)()],L.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],L.prototype,"isChecked",null),(0,C.Y5)("BABYLON.GUI.Checkbox",L);var N=i(46162);class D{get text(){return this._characters?this._characters.join(""):this._text}set text(e){this._text=e,this._characters=Array.from&&Array.from(e)}get length(){return this._characters?this._characters.length:this._text.length}removePart(e,t,i){if(this._text=this._text.slice(0,e)+(i||"")+this._text.slice(t),this._characters){let s=i?Array.from(i):[];this._characters.splice(e,t-e,...s)}}charAt(e){return this._characters?this._characters[e]:this._text.charAt(e)}substr(e,t){if(this._characters){e=isNaN(e)?0:e>=0?Math.min(e,this._characters.length):this._characters.length+Math.max(e,-this._characters.length),void 0===t?t=this._characters.length-e:isNaN(t)?t=0:t<0&&(t=0);let i=[];for(;--t>=0;)i[t]=this._characters[e+t];return i.join("")}return this._text.substring(e,t?t+e:void 0)}substring(e,t){if(this._characters){isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0),void 0===t?t=this._characters.length:isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0);let i=[],s=0;for(;e<t;)i[s++]=this._characters[e++];return i.join("")}return this._text.substring(e,t)}isWord(e){let t=/\w/g;return this._characters?-1!==this._characters[e].search(t):-1!==this._text.search(t)}}class k extends P{get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())}get maxWidth(){return this._maxWidth.toString(this._host)}get maxWidthInPixels(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set maxWidth(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()}get highligherOpacity(){return this._highligherOpacity}set highligherOpacity(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())}get onFocusSelectAll(){return this._onFocusSelectAll}set onFocusSelectAll(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())}get textHighlightColor(){return this._textHighlightColor}set textHighlightColor(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())}get margin(){return this._margin.toString(this._host)}get marginInPixels(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)}set margin(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()}get autoStretchWidth(){return this._autoStretchWidth}set autoStretchWidth(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())}get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get focusedBackground(){return this._focusedBackground}set focusedBackground(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())}set focusedColor(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get placeholderColor(){return this._placeholderColor}set placeholderColor(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())}get placeholderText(){return this._placeholderText}set placeholderText(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())}get deadKey(){return this._deadKey}set deadKey(e){this._deadKey=e}get highlightedText(){return this._highlightedText}set highlightedText(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())}get addKey(){return this._addKey}set addKey(e){this._addKey=e}get currentKey(){return this._currentKey}set currentKey(e){this._currentKey=e}get text(){return this._textWrapper.text}set text(e){let t=e.toString();this._textWrapper||(this._textWrapper=new D),this._textWrapper.text!==t&&(this._textWrapper.text=t,this._textHasChanged())}_textHasChanged(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)}_applyStates(e){super._applyStates(e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)}get width(){return this._width.toString(this._host)}set width(e){(this._width.toString(this._host)!==e||this._autoStretchWidth)&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)}constructor(e,t=""){super(e),this.name=e,this._placeholderText="",this._background="#222222",this._focusedBackground="#000000",this._placeholderColor="gray",this._thickness=1,this._margin=new d(10,d.UNITMODE_PIXEL),this._autoStretchWidth=!0,this._maxWidth=new d(1,d.UNITMODE_PERCENTAGE,!1),this._blinkIsEven=!1,this._cursorOffset=0,this._deadKey=!1,this._addKey=!0,this._currentKey="",this._isTextHighlightOn=!1,this._textHighlightColor="#d5e0ff",this._highligherOpacity=.4,this._highlightedText="",this._startHighlightIndex=0,this._endHighlightIndex=0,this._cursorIndex=-1,this._outlineWidth=0,this._outlineColor="white",this._onFocusSelectAll=!1,this._isPointerDown=!1,this.promptMessage="Please enter text:",this.disableMobilePrompt=!1,this.onTextChangedObservable=new n.cP,this.onBeforeKeyAddObservable=new n.cP,this.onTextHighlightObservable=new n.cP,this.onTextCopyObservable=new n.cP,this.onTextCutObservable=new n.cP,this.onTextPasteObservable=new n.cP,this.text=t,this.isPointerBlocker=!0,this._focusedColor="white"}onBlur(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);let e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)}onFocus(){if(!this._isEnabled)return;if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),"touch"===this._focusedBy&&!this.disableMobilePrompt){let e=prompt(this.promptMessage);null!==e&&(this.text=e),this._host.focusedControl=null;return}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(e=>{switch(e.type){case N.G.COPY:this._onCopyText(e.event),this.onTextCopyObservable.notifyObservers(this);break;case N.G.CUT:this._onCutText(e.event),this.onTextCutObservable.notifyObservers(this);break;case N.G.PASTE:this._onPasteText(e.event),this.onTextPasteObservable.notifyObservers(this);break;default:return}});let e=this._host.getScene();e&&(this._onPointerDblTapObserver=e.onPointerObservable.add(e=>{this._isFocused&&e.type===h.Zp.POINTERDOUBLETAP&&this._processDblClick(e)})),this._onFocusSelectAll&&this.selectAllText()}_getTypeName(){return"InputText"}keepsFocusWith(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null}processKey(e,t,i){if(!this.isReadOnly&&(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e)){if(i&&(i.ctrlKey||i.metaKey)&&65===e){this.selectAllText(),i.preventDefault();return}switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this.isTextHighlightOn){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,i&&i.preventDefault();return}if(0===this._cursorOffset)this.text=this._textWrapper.substring(0,this._textWrapper.length-1);else{let e=this._textWrapper.length-this._cursorOffset;e>0&&(this._textWrapper.removePart(e-1,e),this._textHasChanged())}}i&&i.preventDefault();return;case 46:if(this.isTextHighlightOn){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,i&&i.preventDefault();return}if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){let e=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(e,e+1),this._textHasChanged(),this._cursorOffset--}i&&i.preventDefault();return;case 13:this._host.focusedControl=null,this.isTextHighlightOn=!1;return;case 35:this._cursorOffset=0,this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._markAsDirty();return;case 36:this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._markAsDirty();return;case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn)if(this._textWrapper.length===this._cursorOffset)return;else this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1;this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this.isTextHighlightOn=!0,this._markAsDirty();return}this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,this._markAsDirty();return;case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn)if(0===this._cursorOffset)return;else this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1;this._endHighlightIndex=this._textWrapper.length,this.isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,this._markAsDirty();return}this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,this._markAsDirty();return}if(32===e&&(t=i?.key??" "),this._deadKey="Dead"===t,t&&(-1===e||32===e||34===e||39===e||e>47&&e<64||e>64&&e<91||e>159&&e<193||e>218&&e<223||e>95&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey&&!this._deadKey))if(this.isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,t),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this.isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=this._deadKey&&i?.key?i.key:t;else{let e=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(e,e,t),this._textHasChanged()}}}_updateValueFromCursorIndex(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else if(this._cursorIndex>this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex;else{this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn=!0,this._markAsDirty()}_processDblClick(e){let t,i;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;do i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,t=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0;while(t||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()}selectAllText(){this._blinkIsEven=!0,this.isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()}processKeyboard(e){this.processKey(e.keyCode,e.key,e),super.processKeyboard(e)}_onCopyText(e){this.isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(e){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._highlightedText=""}}_onPasteText(e){let t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;let i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,t),this._textHasChanged()}_draw(e){e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),(!this._fontOffset||this._wasDirty)&&(this._fontOffset=P._GetFontOffset(e.font,this._host.getScene()?.getEngine()));let t=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);let i=this._beforeRenderText(this._textWrapper);!this._isFocused&&!this._textWrapper.text&&this._placeholderText&&((i=new D).text=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(i.text).width;let s=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+s)+"px",this._autoStretchWidth=!0);let r=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,o=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-s;if(e.save(),e.beginPath(),e.rect(t,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,o+2,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>o){let e=t-this._textWidth+o;this._scrollLeft||(this._scrollLeft=e)}else this._scrollLeft=t;if(this.outlineWidth&&e.strokeText(i.text,this._scrollLeft,this._currentMeasure.top+r),e.fillText(i.text,this._scrollLeft,this._currentMeasure.top+r),this._isFocused){if(this._clickedCoordinate){let t=this._scrollLeft+this._textWidth-this._clickedCoordinate,s=0;this._cursorOffset=0;let r=0;do this._cursorOffset&&(r=Math.abs(t-s)),this._cursorOffset++,s=e.measureText(i.substr(i.length-this._cursorOffset,this._cursorOffset)).width;while(s<t&&i.length>=this._cursorOffset);Math.abs(t-s)>r&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){let s=i.substr(i.length-this._cursorOffset),r=e.measureText(s).width,a=this._scrollLeft+this._textWidth-r;a<t?(this._scrollLeft+=t-a,a=t,this._markAsDirty()):a>t+o&&(this._scrollLeft+=t+o-a,a=t+o,this._markAsDirty()),this.isTextHighlightOn||e.fillRect(a,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()},500),this.isTextHighlightOn){clearTimeout(this._blinkTimeout);let s=e.measureText(i.substring(this._startHighlightIndex)).width,r=this._scrollLeft+this._textWidth-s;this._highlightedText=i.substring(this._startHighlightIndex,this._endHighlightIndex);let o=e.measureText(i.substring(this._startHighlightIndex,this._endHighlightIndex)).width;r<t&&((o-=t-r)||(o=e.measureText(i.charAt(i.length-this._cursorOffset)).width),r=t),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,o,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!!this.isReadOnly||((this._clickedCoordinate=t.x,this.isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[i]=this,this._focusedBy=r.event.pointerType,this._host.focusedControl===this)?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):!!this._isEnabled&&(this._host.focusedControl=this,!0)))}_onPointerMove(e,t,i,s){this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinate=t.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),super._onPointerMove(e,t,i,s)}_onPointerUp(e,t,i,s,r){this._isPointerDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r)}_beforeRenderText(e){return e}set isTextHighlightOn(e){this._isTextHighlightOn!==e&&(e&&this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=e)}get isTextHighlightOn(){return this._isTextHighlightOn}dispose(){super.dispose(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()}}(0,o.Cg)([(0,T.lK)()],k.prototype,"promptMessage",void 0),(0,o.Cg)([(0,T.lK)()],k.prototype,"disableMobilePrompt",void 0),(0,o.Cg)([(0,T.lK)()],k.prototype,"maxWidth",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"highligherOpacity",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"onFocusSelectAll",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"textHighlightColor",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"margin",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"autoStretchWidth",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"thickness",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"focusedBackground",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"placeholderColor",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"placeholderText",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"deadKey",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"text",null),(0,o.Cg)([(0,T.lK)()],k.prototype,"width",null),(0,C.Y5)("BABYLON.GUI.InputText",k);class V extends M{set clipContent(e){for(let t in this._clipContent=e,this._cells)this._cells[t].clipContent=e}get clipContent(){return this._clipContent}set clipChildren(e){for(let t in this._clipChildren=e,this._cells)this._cells[t].clipChildren=e}get clipChildren(){return this._clipChildren}get columnCount(){return this._columnDefinitions.length}get rowCount(){return this._rowDefinitions.length}get children(){return this._childControls}get cells(){return this._cells}getRowDefinition(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]}getColumnDefinition(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]}addRowDefinition(e,t=!1){return this._rowDefinitions.push(new d(e,t?d.UNITMODE_PIXEL:d.UNITMODE_PERCENTAGE)),this._rowDefinitionObservers.push(this._rowDefinitions[this.rowCount-1].onChangedObservable.add(()=>this._markAsDirty())),this._markAsDirty(),this}addColumnDefinition(e,t=!1){return this._columnDefinitions.push(new d(e,t?d.UNITMODE_PIXEL:d.UNITMODE_PERCENTAGE)),this._columnDefinitionObservers.push(this._columnDefinitions[this.columnCount-1].onChangedObservable.add(()=>this._markAsDirty())),this._markAsDirty(),this}setRowDefinition(e,t,i=!1){if(e<0||e>=this._rowDefinitions.length)return this;let s=this._rowDefinitions[e];return s&&s.isPixel===i&&s.value===t||(this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]),this._rowDefinitions[e]=new d(t,i?d.UNITMODE_PIXEL:d.UNITMODE_PERCENTAGE),this._rowDefinitionObservers[e]=this._rowDefinitions[e].onChangedObservable.add(()=>this._markAsDirty()),this._markAsDirty()),this}setColumnDefinition(e,t,i=!1){if(e<0||e>=this._columnDefinitions.length)return this;let s=this._columnDefinitions[e];return s&&s.isPixel===i&&s.value===t||(this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]),this._columnDefinitions[e]=new d(t,i?d.UNITMODE_PIXEL:d.UNITMODE_PERCENTAGE),this._columnDefinitionObservers[e]=this._columnDefinitions[e].onChangedObservable.add(()=>this._markAsDirty()),this._markAsDirty()),this}getChildrenAt(e,t){let i=this._cells[`${e}:${t}`];return i?i.children:null}getChildCellInfo(e){return e._tag}_removeCell(e,t){if(e){for(let t of(super.removeControl(e),e.children)){let e=this._childControls.indexOf(t);-1!==e&&this._childControls.splice(e,1)}delete this._cells[t]}}_offsetCell(e,t){if(this._cells[t]){for(let i of(this._cells[e]=this._cells[t],this._cells[e].children))i._tag=e;delete this._cells[t]}}removeColumnDefinition(e){if(e<0||e>=this._columnDefinitions.length)return this;for(let t=0;t<this._rowDefinitions.length;t++){let i=`${t}:${e}`,s=this._cells[i];this._removeCell(s,i)}for(let t=0;t<this._rowDefinitions.length;t++)for(let i=e+1;i<this._columnDefinitions.length;i++){let e=`${t}:${i-1}`,s=`${t}:${i}`;this._offsetCell(e,s)}return this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]),this._columnDefinitions.splice(e,1),this._columnDefinitionObservers.splice(e,1),this._markAsDirty(),this}removeRowDefinition(e){if(e<0||e>=this._rowDefinitions.length)return this;for(let t=0;t<this._columnDefinitions.length;t++){let i=`${e}:${t}`,s=this._cells[i];this._removeCell(s,i)}for(let t=0;t<this._columnDefinitions.length;t++)for(let i=e+1;i<this._rowDefinitions.length;i++){let e=`${i-1}:${t}`,s=`${i}:${t}`;this._offsetCell(e,s)}return this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]),this._rowDefinitions.splice(e,1),this._rowDefinitionObservers.splice(e,1),this._markAsDirty(),this}addControl(e,t=0,i=0){if(0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return _.S0.Warn(`Control (Name:${e.name}, UniqueId:${e.uniqueId}) is already associated with this grid. You must remove it before reattaching it`),this;let s=Math.min(t,this._rowDefinitions.length-1),r=Math.min(i,this._columnDefinitions.length-1),o=`${s}:${r}`,a=this._cells[o];return a||(a=new M(o),this._cells[o]=a,a.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,a.clipContent=this.clipContent,a.clipChildren=this.clipChildren,super.addControl(a)),a.addControl(e),this._childControls.push(e),e._tag=o,e.parent=this,this._markAsDirty(),this}removeControl(e){let t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);let i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this}constructor(e){super(e),this.name=e,this._rowDefinitions=[],this._rowDefinitionObservers=[],this._columnDefinitions=[],this._columnDefinitionObservers=[],this._cells={},this._childControls=[]}_getTypeName(){return"Grid"}_getGridDefinitions(e){let t=[],i=[],s=[],r=[],o=this._currentMeasure.width,a=0,n=this._currentMeasure.height,l=0,h=0;for(let e of this._rowDefinitions){if(e.isPixel){let t=e.getValue(this._host);n-=t,i[h]=t}else l+=e.value;h++}let _=0;for(let e of(h=0,this._rowDefinitions)){if(r.push(_),e.isPixel)_+=e.getValue(this._host);else{let t=Math.round(e.value/l*n);_+=t,i[h]=t}h++}for(let e of(h=0,this._columnDefinitions)){if(e.isPixel){let i=e.getValue(this._host);o-=i,t[h]=i}else a+=e.value;h++}let d=0;for(let e of(h=0,this._columnDefinitions)){if(s.push(d),e.isPixel)d+=e.getValue(this._host);else{let i=Math.round(e.value/a*o);d+=i,t[h]=i}h++}e(s,r,t,i)}_additionalProcessing(e,t){this._getGridDefinitions((e,t,i,s)=>{for(let r in this._cells){if(!Object.prototype.hasOwnProperty.call(this._cells,r))continue;let o=r.split(":"),a=parseInt(o[0]),n=parseInt(o[1]),l=this._cells[r];l.leftInPixels=e[n],l.topInPixels=t[a],l.widthInPixels=i[n],l.heightInPixels=s[a],l._left.ignoreAdaptiveScaling=!0,l._top.ignoreAdaptiveScaling=!0,l._width.ignoreAdaptiveScaling=!0,l._height.ignoreAdaptiveScaling=!0}}),super._additionalProcessing(e,t)}_flagDescendantsAsMatrixDirty(){for(let e in this._cells)Object.prototype.hasOwnProperty.call(this._cells,e)&&this._cells[e]._markMatrixAsDirty()}_renderHighlightSpecific(e){super._renderHighlightSpecific(e),this._getGridDefinitions((t,i,s,r)=>{for(let i=0;i<t.length;i++){let r=this._currentMeasure.left+t[i]+s[i];e.beginPath(),e.moveTo(r,this._currentMeasure.top),e.lineTo(r,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=0;t<i.length;t++){let s=this._currentMeasure.top+i[t]+r[t];e.beginPath(),e.moveTo(this._currentMeasure.left,s),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,s),e.stroke()}}),e.restore()}dispose(){for(let e of(super.dispose(),this._childControls))e.dispose();for(let e=0;e<this._rowDefinitions.length;e++)this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]);for(let e=0;e<this._columnDefinitions.length;e++)this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]);this._rowDefinitionObservers.length=0,this._rowDefinitions.length=0,this._columnDefinitionObservers.length=0,this._columnDefinitions.length=0,this._cells={},this._childControls.length=0}serialize(e,t,i){if(super.serialize(e,t,i),this.isSerializable||t){e.columnCount=this.columnCount,e.rowCount=this.rowCount,e.columns=[],e.rows=[],e.tags=[];for(let t=0;t<this.columnCount;++t){let i=this.getColumnDefinition(t),s={value:i?.getValue(this.host),unit:i?.unit};e.columns.push(s)}for(let t=0;t<this.rowCount;++t){let i=this.getRowDefinition(t),s={value:i?.getValue(this.host),unit:i?.unit};e.rows.push(s)}for(let t of this.children)e.tags.push(t._tag)}}_parseFromContent(e,t){super._parseFromContent(e,t);let i=[];for(let e of this.children)i.push(e);this.removeRowDefinition(0),this.removeColumnDefinition(0);for(let t=0;t<e.columnCount;++t){let i=e.columns[t].value,s=e.columns[t].unit;this.addColumnDefinition(i,1===s)}for(let t=0;t<e.rowCount;++t){let i=e.rows[t].value,s=e.rows[t].unit;this.addRowDefinition(i,1===s)}for(let t=0;t<i.length;++t){let s=e.tags[t],r=parseInt(s.substring(0,s.search(":")));isNaN(r)&&(r=0);let o=parseInt(s.substring(s.search(":")+1));isNaN(o)&&(o=0),this.addControl(i[t],r,o)}}}(0,o.Cg)([(0,T.lK)()],V.prototype,"clipContent",null),(0,C.Y5)("BABYLON.GUI.Grid",V);var U=i(26856);class z extends P{get value(){return this._value}set value(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=z._Epsilon&&(this._value.r=0),this._value.g<=z._Epsilon&&(this._value.g=0),this._value.b<=z._Epsilon&&(this._value.b=0),this._value.r>=1-z._Epsilon&&(this._value.r=1),this._value.g>=1-z._Epsilon&&(this._value.g=1),this._value.b>=1-z._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))}get width(){return this._width.toString(this._host)}set width(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(0===this._width.getValue(this._host)&&(e="1px",this._width.fromString(e)),this._height.fromString(e),this._markAsDirty())}get height(){return this._height.toString(this._host)}set height(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(0===this._height.getValue(this._host)&&(e="1px",this._height.fromString(e)),this._width.fromString(e),this._markAsDirty())}get size(){return this.width}set size(e){this.width=e}constructor(e){super(e),this.name=e,this._value=U.v9.Red(),this._tmpColor=new U.v9,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._squareLeft=0,this._squareTop=0,this._squareSize=0,this._h=360,this._s=1,this._v=1,this._lastPointerDownId=-1,this.onValueChangedObservable=new n.cP,this._pointerIsDown=!1,this.value=new U.v9(.88,.1,.1),this.size="200px",this.isPointerBlocker=!0}_getTypeName(){return"ColorPicker"}_preMeasure(e){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height}_updateSquareProps(){let e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=(e-.2*e)*2/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t}_drawGradientSquare(e,t,i,s,r,o){let a=o.createLinearGradient(t,i,s+t,i);a.addColorStop(0,"#fff"),a.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=a,o.fillRect(t,i,s,r);let n=o.createLinearGradient(t,i,t,r+i);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"#000"),o.fillStyle=n,o.fillRect(t,i,s,r)}_drawCircle(e,t,i,s){s.beginPath(),s.arc(e,t,i+1,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#333333",s.stroke(),s.beginPath(),s.arc(e,t,i,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#ffffff",s.stroke()}_createColorWheelCanvas(e,t){let i=S.q.LastCreatedEngine;if(!i)throw Error("Invalid engine. Unable to create a canvas.");let s=i.createCanvas(2*e,2*e),r=s.getContext("2d"),o=r.getImageData(0,0,2*e,2*e),a=o.data,n=this._tmpColor,l=e*e,h=e-t,_=h*h;for(let t=-e;t<e;t++)for(let i=-e;i<e;i++){let s=t*t+i*i;if(s>l||s<_)continue;let r=Math.sqrt(s),o=Math.atan2(i,t);U.v9.HSVtoRGBToRef(180*o/Math.PI+180,r/e,1,n);let d=(t+e+(i+e)*2*e)*4;a[d]=255*n.r,a[d+1]=255*n.g,a[d+2]=255*n.b;let c=(r-h)/(e-h),u=.2;u=e<50?.2:e>150?.04:-.16*(e-50)/100+.2,(c=(r-h)/(e-h))<u?a[d+3]=c/u*255:c>1-u?a[d+3]=255*(1-(c-(1-u))/u):a[d+3]=255}return r.putImageData(o,0,0),s}_draw(e){e.save(),this._applyStates(e);let t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,s=this._currentMeasure.left,r=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);let o=this._squareLeft+this._squareSize*this._s,a=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,a,.04*t,e);let n=t-.5*i;o=s+t+Math.cos((this._h-180)*Math.PI/180)*n,a=r+t+Math.sin((this._h-180)*Math.PI/180)*n,this._drawCircle(o,a,.35*i,e),e.restore()}_updateValueFromPointer(e,t){if(this._pointerStartedOnWheel){let i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i+this._currentMeasure.left,r=i+this._currentMeasure.top;this._h=180*Math.atan2(t-r,e-s)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(t-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,z._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,z._Epsilon));U.v9.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor}_isPointOnSquare(e,t){this._updateSquareProps();let i=this._squareLeft,s=this._squareTop,r=this._squareSize;return!!(e>=i)&&!!(e<=i+r)&&!!(t>=s)&&!!(t<=s+r)}_isPointOnWheel(e,t){let i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i+this._currentMeasure.left,r=i+this._currentMeasure.top,o=i-.2*i,a=e-s,n=t-r,l=a*a+n*n;return!!(l<=i*i)&&!!(l>=o*o)}_onPointerDown(e,t,i,s,r){if(!super._onPointerDown(e,t,i,s,r))return!1;if(this.isReadOnly)return!0;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);let o=this._transformedPosition.x,a=this._transformedPosition.y;return this._isPointOnSquare(o,a)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(o,a)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(o,a),this._host._capturingControl[i]=this,this._lastPointerDownId=i,!0}_onPointerMove(e,t,i,s){if(i==this._lastPointerDownId){if(!this.isReadOnly){this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);let e=this._transformedPosition.x,i=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(e,i)}super._onPointerMove(e,t,i,s)}}_onPointerUp(e,t,i,s,r,o){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r,o)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}static async ShowPickerDialogAsync(e,t){return await new Promise(i=>{let s,r,o,a,n,l,h,_;t.pickerWidth=t.pickerWidth||"640px",t.pickerHeight=t.pickerHeight||"400px",t.headerHeight=t.headerHeight||"35px",t.lastColor=t.lastColor||"#000000",t.swatchLimit=t.swatchLimit||20,t.numSwatchesPerLine=t.numSwatchesPerLine||10;let d=t.swatchLimit/t.numSwatchesPerLine,c=Math.floor(.25*(parseFloat(t.pickerWidth)/t.numSwatchesPerLine)),u=c*(t.numSwatchesPerLine+1),f=Math.floor((parseFloat(t.pickerWidth)-u)/t.numSwatchesPerLine),g=f*d+c*(d+1),m=(parseInt(t.pickerHeight)+g+Math.floor(.25*f)).toString()+"px",p="#c0c0c0",v="#535353",b="#414141",x="515151",C=U.v9.FromHexString("#dddddd"),T=C.r+C.g+C.b,y=["R","G","B"],S="#454545",I="#f0f0f0",E=!1,R=new V;if(R.name="Dialog Container",R.width=t.pickerWidth,t.savedColors){R.height=m;let e=parseInt(t.pickerHeight)/parseInt(m);R.addRowDefinition(e,!1),R.addRowDefinition(1-e,!1)}else R.height=t.pickerHeight,R.addRowDefinition(1,!1);if(e.addControl(R),t.savedColors){(a=new V).name="Swatch Drawer",a.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,a.background=v,a.width=t.pickerWidth;let e=t.savedColors.length/t.numSwatchesPerLine;a.height=(f*e+(0==e?0:e+1)*c).toString()+"px",a.top=Math.floor(.25*f).toString()+"px";for(let e=0;e<2*Math.ceil(t.savedColors.length/t.numSwatchesPerLine)+1;e++)e%2!=0?a.addRowDefinition(f,!0):a.addRowDefinition(c,!0);for(let e=0;e<2*t.numSwatchesPerLine+1;e++)e%2!=0?a.addColumnDefinition(f,!0):a.addColumnDefinition(c,!0);R.addControl(a,1,0)}let M=new V;M.name="Picker Panel",M.height=t.pickerHeight;let B=parseInt(t.headerHeight)/parseInt(t.pickerHeight),F=[B,1-B];M.addRowDefinition(F[0],!1),M.addRowDefinition(F[1],!1),R.addControl(M,0,0);let L=new w;L.name="Dialogue Header Bar",L.background="#cccccc",L.thickness=0,M.addControl(L,0,0);let N=A.CreateSimpleButton("closeButton","a");N.fontFamily="coreglyphs";let D=U.v9.FromHexString(L.background),W=new U.v9(1-D.r,1-D.g,1-D.b);N.color=W.toHexString(),N.fontSize=Math.floor(.6*parseInt(t.headerHeight)),N.textBlock.textVerticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,N.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_RIGHT,N.height=N.width=t.headerHeight,N.background=L.background,N.thickness=0,N.pointerDownAnimation=()=>{},N.pointerUpAnimation=()=>{N.background=L.background},N.pointerEnterAnimation=()=>{N.color=L.background,N.background="red"},N.pointerOutAnimation=()=>{N.color=W.toHexString(),N.background=L.background},N.onPointerClickObservable.add(()=>{eR(ee.background)}),M.addControl(N,0,0);let Q=new V;Q.name="Dialogue Body",Q.background=v;Q.addRowDefinition(1,!1),Q.addColumnDefinition(.4375,!1),Q.addColumnDefinition(.5625,!1),M.addControl(Q,1,0);let G=new V;G.name="Picker Grid",G.addRowDefinition(.85,!1),G.addRowDefinition(.15,!1),Q.addControl(G,0,0);let H=new z;H.name="GUI Color Picker",t.pickerHeight<t.pickerWidth?H.width=.89:H.height=.89,H.value=U.v9.FromHexString(t.lastColor),H.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,H.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,H.onPointerDownObservable.add(()=>{h=H.name,l="",eS(!1)}),H.onValueChangedObservable.add(function(e){h==H.name&&eC(e,H.name)}),G.addControl(H,0,0);let K=new V;K.name="Dialogue Right Half",K.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT;K.addRowDefinition(.514,!1),K.addRowDefinition(.486,!1),Q.addControl(K,1,1);let X=new V;X.name="Swatches and Buttons";X.addRowDefinition(1,!1),X.addColumnDefinition(.417,!1),X.addColumnDefinition(.583,!1),K.addControl(X,0,0);let Y=new V;Y.name="New and Current Swatches";Y.addRowDefinition(.04,!1),Y.addRowDefinition(.16,!1),Y.addRowDefinition(.64,!1),Y.addRowDefinition(.16,!1),X.addControl(Y,0,0);let q=new V;q.name="Active Swatches",q.width=.67,q.addRowDefinition(.5,!1),q.addRowDefinition(.5,!1),Y.addControl(q,2,0);let j=Math.floor(.5625*parseInt(t.pickerWidth)*.04587),$=Math.floor(parseInt(t.pickerHeight)*F[1]*.041120000000000004);_=t.pickerWidth>t.pickerHeight?$:j;let Z=new O;Z.text="new",Z.name="New Color Label",Z.color=p,Z.fontSize=_,Y.addControl(Z,1,0);let J=new w;J.name="New Color Swatch",J.background=t.lastColor,J.thickness=0,q.addControl(J,0,0);let ee=A.CreateSimpleButton("currentSwatch","");ee.background=t.lastColor,ee.thickness=0,ee.onPointerClickObservable.add(()=>{eC(U.v9.FromHexString(ee.background),ee.name),eS(!1)}),ee.pointerDownAnimation=()=>{},ee.pointerUpAnimation=()=>{},ee.pointerEnterAnimation=()=>{},ee.pointerOutAnimation=()=>{},q.addControl(ee,1,0);let et=new w;et.name="Swatch Outline",et.width=.67,et.thickness=2,et.color="#404040",et.isHitTestVisible=!1,Y.addControl(et,2,0);let ei=new O;ei.name="Current Color Label",ei.text="current",ei.color=p,ei.fontSize=_,Y.addControl(ei,3,0);let es=new V;es.name="Button Grid",es.height=.8;let er=1/3;es.addRowDefinition(er,!1),es.addRowDefinition(er,!1),es.addRowDefinition(er,!1),X.addControl(es,0,1);let eo=Math.floor(.5625*parseInt(t.pickerWidth)*.39061).toString()+"px",ea=Math.floor(parseInt(t.pickerHeight)*F[1]*.514*(parseFloat(es.height.toString())/100)*er*.7).toString()+"px";s=parseFloat(eo)>parseFloat(ea)?Math.floor(.45*parseFloat(ea)):Math.floor(.11*parseFloat(eo));let en=A.CreateSimpleButton("butOK","OK");en.width=eo,en.height=ea,en.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,en.thickness=2,en.color=p,en.fontSize=s,en.background=v,en.onPointerEnterObservable.add(()=>{en.background=b}),en.onPointerOutObservable.add(()=>{en.background=v}),en.pointerDownAnimation=()=>{en.background=x},en.pointerUpAnimation=()=>{en.background=b},en.onPointerClickObservable.add(()=>{eS(!1),eR(J.background)}),es.addControl(en,0,0);let el=A.CreateSimpleButton("butCancel","Cancel");el.width=eo,el.height=ea,el.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,el.thickness=2,el.color=p,el.fontSize=s,el.background=v,el.onPointerEnterObservable.add(()=>{el.background=b}),el.onPointerOutObservable.add(()=>{el.background=v}),el.pointerDownAnimation=()=>{el.background=x},el.pointerUpAnimation=()=>{el.background=b},el.onPointerClickObservable.add(()=>{eS(!1),eR(ee.background)}),es.addControl(el,1,0),t.savedColors&&((n=A.CreateSimpleButton("butSave","Save")).width=eo,n.height=ea,n.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,n.thickness=2,n.fontSize=s,t.savedColors.length<t.swatchLimit?(n.color=p,n.background=v):eE(n,!0),n.onPointerEnterObservable.add(()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(n.background=b)}),n.onPointerOutObservable.add(()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(n.background=v)}),n.pointerDownAnimation=()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(n.background=x)},n.pointerUpAnimation=()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(n.background=b)},n.onPointerClickObservable.add(()=>{t.savedColors&&(0==t.savedColors.length&&eI(!0),t.savedColors.length<t.swatchLimit&&eP(J.background,n),eS(!1))}),t.savedColors.length>0&&eI(!0),es.addControl(n,2,0));let eh=new V;eh.name="Dialog Lower Right",eh.addRowDefinition(.02,!1),eh.addRowDefinition(.63,!1),eh.addRowDefinition(.21,!1),eh.addRowDefinition(.14,!1),K.addControl(eh,1,0);let e_=U.v9.FromHexString(t.lastColor),ed=new V;ed.name="RGB Values",ed.width=.82,ed.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,ed.addRowDefinition(1/3,!1),ed.addRowDefinition(1/3,!1),ed.addRowDefinition(1/3,!1),ed.addColumnDefinition(.1,!1),ed.addColumnDefinition(.2,!1),ed.addColumnDefinition(.7,!1),eh.addControl(ed,1,0);for(let e=0;e<y.length;e++){let t=new O;t.text=y[e],t.color=p,t.fontSize=s,ed.addControl(t,e,0)}let ec=new k;ec.width=.83,ec.height=.72,ec.name="rIntField",ec.fontSize=s,ec.text=(255*e_.r).toString(),ec.color=I,ec.background=S,ec.onFocusObservable.add(()=>{h=ec.name,l=ec.text,eS(!1)}),ec.onBlurObservable.add(()=>{""==ec.text&&(ec.text="0"),eT(ec,"r"),h==ec.name&&(h="")}),ec.onTextChangedObservable.add(()=>{h==ec.name&&eT(ec,"r")}),ed.addControl(ec,0,1);let eu=new k;eu.width=.83,eu.height=.72,eu.name="gIntField",eu.fontSize=s,eu.text=(255*e_.g).toString(),eu.color=I,eu.background=S,eu.onFocusObservable.add(()=>{h=eu.name,l=eu.text,eS(!1)}),eu.onBlurObservable.add(()=>{""==eu.text&&(eu.text="0"),eT(eu,"g"),h==eu.name&&(h="")}),eu.onTextChangedObservable.add(()=>{h==eu.name&&eT(eu,"g")}),ed.addControl(eu,1,1);let ef=new k;ef.width=.83,ef.height=.72,ef.name="bIntField",ef.fontSize=s,ef.text=(255*e_.b).toString(),ef.color=I,ef.background=S,ef.onFocusObservable.add(()=>{h=ef.name,l=ef.text,eS(!1)}),ef.onBlurObservable.add(()=>{""==ef.text&&(ef.text="0"),eT(ef,"b"),h==ef.name&&(h="")}),ef.onTextChangedObservable.add(()=>{h==ef.name&&eT(ef,"b")}),ed.addControl(ef,2,1);let eg=new k;eg.width=.95,eg.height=.72,eg.name="rDecField",eg.fontSize=s,eg.text=e_.r.toString(),eg.color=I,eg.background=S,eg.onFocusObservable.add(()=>{h=eg.name,l=eg.text,eS(!1)}),eg.onBlurObservable.add(()=>{(0==parseFloat(eg.text)||""==eg.text)&&(eg.text="0",ey(eg,"r")),h==eg.name&&(h="")}),eg.onTextChangedObservable.add(()=>{h==eg.name&&ey(eg,"r")}),ed.addControl(eg,0,2);let em=new k;em.width=.95,em.height=.72,em.name="gDecField",em.fontSize=s,em.text=e_.g.toString(),em.color=I,em.background=S,em.onFocusObservable.add(()=>{h=em.name,l=em.text,eS(!1)}),em.onBlurObservable.add(()=>{(0==parseFloat(em.text)||""==em.text)&&(em.text="0",ey(em,"g")),h==em.name&&(h="")}),em.onTextChangedObservable.add(()=>{h==em.name&&ey(em,"g")}),ed.addControl(em,1,2);let ep=new k;ep.width=.95,ep.height=.72,ep.name="bDecField",ep.fontSize=s,ep.text=e_.b.toString(),ep.color=I,ep.background=S,ep.onFocusObservable.add(()=>{h=ep.name,l=ep.text,eS(!1)}),ep.onBlurObservable.add(()=>{(0==parseFloat(ep.text)||""==ep.text)&&(ep.text="0",ey(ep,"b")),h==ep.name&&(h="")}),ep.onTextChangedObservable.add(()=>{h==ep.name&&ey(ep,"b")}),ed.addControl(ep,2,2);let ev=new V;ev.name="Hex Value",ev.width=.82,ev.addRowDefinition(1,!1),ev.addColumnDefinition(.1,!1),ev.addColumnDefinition(.9,!1),eh.addControl(ev,2,0);let eb=new O;eb.text="#",eb.color=p,eb.fontSize=s,ev.addControl(eb,0,0);let ex=new k;function eC(e,t){h=t;let i=e.toHexString();J.background=i,ec.name!=h&&(ec.text=Math.floor(255*e.r).toString()),eu.name!=h&&(eu.text=Math.floor(255*e.g).toString()),ef.name!=h&&(ef.text=Math.floor(255*e.b).toString()),eg.name!=h&&(eg.text=e.r.toString()),em.name!=h&&(em.text=e.g.toString()),ep.name!=h&&(ep.text=e.b.toString()),ex.name!=h&&(ex.text=i.split("#")[1]),H.name!=h&&(H.value=e)}function eT(e,t){let i=e.text;if(/[^0-9]/g.test(i)){e.text=l;return}if(""!=i&&(0>Math.floor(parseInt(i))?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),h==e.name&&(l=i),""!=i){e.text=i=parseInt(i).toString();let s=U.v9.FromHexString(J.background);h==e.name&&("r"==t?eC(new U.v9(parseInt(i)/255,s.g,s.b),e.name):"g"==t?eC(new U.v9(s.r,parseInt(i)/255,s.b),e.name):eC(new U.v9(s.r,s.g,parseInt(i)/255),e.name))}}function ey(e,t){let i=e.text;if(/[^0-9.]/g.test(i)){e.text=l;return}""!=i&&"."!=i&&0!=parseFloat(i)&&(0>parseFloat(i)?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),h==e.name&&(l=i),""!=i&&"."!=i&&0!=parseFloat(i)?e.text=i=parseFloat(i).toString():i="0.0";let s=U.v9.FromHexString(J.background);h==e.name&&("r"==t?eC(new U.v9(parseFloat(i),s.g,s.b),e.name):"g"==t?eC(new U.v9(s.r,parseFloat(i),s.b),e.name):eC(new U.v9(s.r,s.g,parseFloat(i)),e.name))}function eS(e){if(void 0!==e&&(E=e),E){for(let e=0;e<a.children.length;e++)a.children[e].textBlock.text="b";void 0!==r&&(r.textBlock.text="Done")}else{for(let e=0;e<a.children.length;e++)a.children[e].textBlock.text="";void 0!==r&&(r.textBlock.text="Edit")}}function eP(e,i){if(t.savedColors){let s;""!=e&&t.savedColors.push(e),o=0,a.clearControls();let r=Math.ceil(t.savedColors.length/t.numSwatchesPerLine);if(s=0==r?0:r+1,a.rowCount!=r+s){let e=a.rowCount;for(let t=0;t<e;t++)a.removeRowDefinition(0);for(let e=0;e<r+s;e++)e%2?a.addRowDefinition(f,!0):a.addRowDefinition(c,!0)}a.height=(f*r+s*c).toString()+"px";for(let e=1,i=1;e<r+s;e+=2,i++){let s=Math.min(Math.max(t.savedColors.length>i*t.numSwatchesPerLine?t.numSwatchesPerLine:t.savedColors.length-(i-1)*t.numSwatchesPerLine,0),t.numSwatchesPerLine);for(let i=0,r=1;i<s;i++){if(i>t.numSwatchesPerLine)continue;let s=function(){if(!t.savedColors||!t.savedColors[o])return null;{let e;e=E?"b":"";let i=A.CreateSimpleButton("Swatch_"+o,e);i.fontFamily="coreglyphs";let s=U.v9.FromHexString(t.savedColors[o]);s.r+s.g+s.b>T?i.color="#aaaaaa":i.color="#ffffff",i.fontSize=Math.floor(.7*f),i.textBlock.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,i.height=i.width=f.toString()+"px",i.background=t.savedColors[o],i.thickness=2;let r=o;return i.pointerDownAnimation=()=>{i.thickness=4},i.pointerUpAnimation=()=>{i.thickness=3},i.pointerEnterAnimation=()=>{i.thickness=3},i.pointerOutAnimation=()=>{i.thickness=2},i.onPointerClickObservable.add(()=>{if(E)t.savedColors&&t.savedColors.splice(r,1),t.savedColors&&0==t.savedColors.length&&(eI(!1),E=!1),eP("",n);else t.savedColors&&eC(U.v9.FromHexString(t.savedColors[r]),i.name)}),i}}();null!=s&&(a.addControl(s,e,r),r+=2,o++)}}t.savedColors.length>=t.swatchLimit?eE(i,!0):eE(i,!1)}}function eI(e){e?((r=A.CreateSimpleButton("butEdit","Edit")).width=eo,r.height=ea,r.left=Math.floor(.1*parseInt(eo)).toString()+"px",r.top=(-1*parseFloat(r.left)).toString()+"px",r.verticalAlignment=P.VERTICAL_ALIGNMENT_BOTTOM,r.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,r.thickness=2,r.color=p,r.fontSize=s,r.background=v,r.onPointerEnterObservable.add(()=>{r.background=b}),r.onPointerOutObservable.add(()=>{r.background=v}),r.pointerDownAnimation=()=>{r.background=x},r.pointerUpAnimation=()=>{r.background=b},r.onPointerClickObservable.add(()=>{E=!E,eS()}),G.addControl(r,1,0)):G.removeControl(r)}function eE(e,t){t?(e.color="#555555",e.background="#454545"):(e.color=p,e.background=v)}function eR(s){t.savedColors&&t.savedColors.length>0?i({savedColors:t.savedColors,pickedColor:s}):i({pickedColor:s}),e.removeControl(R)}ex.width=.96,ex.height=.72,ex.name="hexField",ex.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,ex.fontSize=s,ex.text=t.lastColor.split("#")[1],ex.color=I,ex.background=S,ex.onFocusObservable.add(()=>{h=ex.name,l=ex.text,eS(!1)}),ex.onBlurObservable.add(()=>{if(3==ex.text.length){let e=ex.text.split("");ex.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==ex.text&&(ex.text="000000",eC(U.v9.FromHexString(ex.text),"b")),h==ex.name&&(h="")}),ex.onTextChangedObservable.add(()=>{let e=ex.text,t=/[^0-9A-F]/i.test(e);if((ex.text.length>6||t)&&h==ex.name)ex.text=l;else{if(ex.text.length<6){let t=6-ex.text.length;for(let i=0;i<t;i++)e="0"+e}if(3==ex.text.length){let t=ex.text.split("");e=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}e="#"+e,h==ex.name&&(l=ex.text,eC(U.v9.FromHexString(e),ex.name))}}),ev.addControl(ex,0,1),t.savedColors&&t.savedColors.length>0&&eP("",n)})}}z._Epsilon=1e-6,(0,o.Cg)([(0,T.lK)()],z.prototype,"value",null),(0,o.Cg)([(0,T.lK)()],z.prototype,"width",null),(0,o.Cg)([(0,T.lK)()],z.prototype,"height",null),(0,o.Cg)([(0,T.lK)()],z.prototype,"size",null),(0,C.Y5)("BABYLON.GUI.ColorPicker",z);class W extends M{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get arc(){return this._arc}set arc(e){this._arc!==e&&(this._arc=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thickness=1,this._arc=1}_getTypeName(){return"Ellipse"}_localDraw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),P.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,this._arc,e),(this._backgroundGradient||this._background)&&(e.fillStyle=this._getBackgroundColor(e),e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_clipForChildren(e){P.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,this._arc,e),e.clip()}_renderHighlightSpecific(e){P.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._highlightLineWidth/2,this._currentMeasure.height/2-this._highlightLineWidth/2,this._arc,e),e.stroke()}}(0,o.Cg)([(0,T.lK)()],W.prototype,"thickness",null),(0,o.Cg)([(0,T.lK)()],W.prototype,"arc",null),(0,C.Y5)("BABYLON.GUI.Ellipse",W);class Q extends A{constructor(e){super(e),this.name=e,this._unfocusedColor=this.color}_onPointerDown(e,t,i,s,r){return this.isReadOnly||this.focus(),super._onPointerDown(e,t,i,s,r)}}(0,C.Y5)("BABYLON.GUI.FocusableButton",Q);class G extends k{get autoStretchHeight(){return this._autoStretchHeight}set autoStretchHeight(e){this._autoStretchHeight!==e&&(this._autoStretchHeight=e,this._markAsDirty())}set height(e){this.fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&(this._height.fromString(e)&&this._markAsDirty(),this._autoStretchHeight=!1)}get maxHeight(){return this._maxHeight.toString(this._host)}get maxHeightInPixels(){return this._maxHeight.getValueInPixel(this._host,this._cachedParentMeasure.height)}set maxHeight(e){this._maxHeight.toString(this._host)!==e&&this._maxHeight.fromString(e)&&this._markAsDirty()}constructor(e,t=""){super(e),this.name=e,this._textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._textVerticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._prevText=this.text,this._lineSpacing=new d(0),this._maxHeight=new d(1,d.UNITMODE_PERCENTAGE,!1),this.onLinesReadyObservable=new n.cP,this.text=t,this.isPointerBlocker=!0,this.onLinesReadyObservable.add(()=>this._updateCursorPosition()),this._highlightCursorInfo={initialStartIndex:-1,initialRelativeStartIndex:-1,initialLineIndex:-1},this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeEndIndex:0,relativeStartIndex:0,currentLineIndex:0}}_getTypeName(){return"InputTextArea"}processKeyboard(e){this.isReadOnly||(this.alternativeProcessKey(e.code,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e))}alternativeProcessKey(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||"c"!==t&&"v"!==t&&"x"!==t){switch(e){case"Period":i&&i.shiftKey&&i.preventDefault();break;case"Backspace":!this._isTextHighlightOn&&this._cursorInfo.globalStartIndex>0&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"Delete":!this._isTextHighlightOn&&this._cursorInfo.globalEndIndex<this.text.length&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex+1),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"NumpadEnter":case"Enter":this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,"\n"),this._cursorInfo.globalStartIndex++,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();return;case"End":this._cursorInfo.globalStartIndex=this.text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._markAsDirty();return;case"Home":this._cursorInfo.globalStartIndex=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._markAsDirty();return;case"ArrowLeft":if(this._markAsDirty(),i&&i.shiftKey){(i.ctrlKey||i.metaKey)&&(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex),this._isTextHighlightOn?this._cursorInfo.globalEndIndex>this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalEndIndex--:this._cursorInfo.globalStartIndex--:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--,this._isTextHighlightOn=!0),this._blinkIsEven=!0,i.preventDefault();return}this._isTextHighlightOn?this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex:i&&(i.ctrlKey||i.metaKey)?(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,i.preventDefault()):this._cursorInfo.globalStartIndex>0&&this._cursorInfo.globalStartIndex--,this._blinkIsEven=!1,this._isTextHighlightOn=!1;return;case"ArrowRight":if(this._markAsDirty(),i&&i.shiftKey){if(i.ctrlKey||i.metaKey){let e=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex-1;this._cursorInfo.globalEndIndex+=e,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex}this._isTextHighlightOn?this._cursorInfo.globalStartIndex<this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalStartIndex++:this._cursorInfo.globalEndIndex++:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex++,this._isTextHighlightOn=!0),this._blinkIsEven=!0,i.preventDefault();return}if(this._isTextHighlightOn)this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex;else if(i&&(i.ctrlKey||i.metaKey)){let e=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex;this._cursorInfo.globalStartIndex+=e}else this._cursorInfo.globalStartIndex<this.text.length&&this._cursorInfo.globalStartIndex++;this._blinkIsEven=!1,this._isTextHighlightOn=!1;return;case"ArrowUp":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),0===this._cursorInfo.currentLineIndex)this._cursorInfo.globalStartIndex=0;else{let e=this._lines[this._cursorInfo.currentLineIndex],t=this._lines[this._cursorInfo.currentLineIndex-1],i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);let r=e.text.substring(0,s),o=this._contextForBreakLines.measureText(r).width,a=0,n=0;i-=s,i-=t.text.length+t.lineEnding.length;let l=0;for(;a<o&&l<t.text.length;)i++,l++,n=Math.abs(o-a),a=this._contextForBreakLines.measureText(t.text.substring(0,l)).width;Math.abs(o-a)>n&&l>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<=this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):this._cursorInfo.globalEndIndex=i:this._cursorInfo.globalStartIndex=i}this._markAsDirty();return;case"ArrowDown":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),this._cursorInfo.currentLineIndex===this._lines.length-1)this._cursorInfo.globalStartIndex=this.text.length;else{let e=this._lines[this._cursorInfo.currentLineIndex],t=this._lines[this._cursorInfo.currentLineIndex+1],i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);let r=e.text.substring(0,s),o=this._contextForBreakLines.measureText(r).width,a=0,n=0;i+=e.text.length-s+e.lineEnding.length;let l=0;for(;a<o&&l<t.text.length;)i++,l++,n=Math.abs(o-a),a=this._contextForBreakLines.measureText(t.text.substring(0,l)).width;Math.abs(o-a)>n&&l>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalStartIndex>this._cursorInfo.globalEndIndex&&(this._cursorInfo.globalEndIndex+=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex-=this._cursorInfo.globalStartIndex)):(this._cursorInfo.globalEndIndex=i,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex):this._cursorInfo.globalStartIndex=i}this._markAsDirty();return}if("a"===t&&i&&(i.ctrlKey||i.metaKey)){this.selectAllText(),i.preventDefault();return}t?.length===1&&(i?.preventDefault(),this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey&&(this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,t),this._cursorInfo.globalStartIndex+=t.length,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._textHasChanged()))}}_parseLineWordWrap(e="",t,i){let s=[],r=e.split(" "),o=0;for(let a=0;a<r.length;a++){let n=a>0?e+" "+r[a]:r[0],l=i.measureText(n).width;if(l>t){a>0&&(o=i.measureText(e).width,s.push({text:e,width:o,lineEnding:" "}));let n="";(e=r[a]).split("").map(e=>{i.measureText(n+e).width>t&&(s.push({text:n,width:i.measureText(n).width,lineEnding:""}),n=""),n+=e}),e=n,o=i.measureText(e).width}else o=l,e=n}return s.push({text:e,width:o,lineEnding:" "}),s}_breakLines(e,t){let i=[],s=(this.text||this.placeholderText).split("\n");if(this.clipContent)for(let r of s)i.push(...this._parseLineWordWrap(r,e,t));else for(let e of s)i.push(this._parseLine(e,t));return i[i.length-1].lineEnding="\n",i}_parseLine(e="",t){return{text:e,width:t.measureText(e).width,lineEnding:" "}}_preMeasure(e,t){(!this._fontOffset||this._wasDirty)&&(this._fontOffset=P._GetFontOffset(t.font,this._host.getScene()?.getEngine()));let i=this._beforeRenderText(this._textWrapper).text;!this.text&&this._placeholderText&&(i=this._placeholderText),this._textWidth=t.measureText(i).width;let s=2*this._margin.getValueInPixel(this._host,e.width);if(this._autoStretchWidth){let r=i.split("\n").reduce((e,i)=>t.measureText(i).width>t.measureText(e).width?i:e,""),o=t.measureText(r).width;this.width=Math.min(this._maxWidth.getValueInPixel(this._host,e.width),o+s)+"px",this.autoStretchWidth=!0}if(this._availableWidth=this._width.getValueInPixel(this._host,e.width)-s,this._lines=this._breakLines(this._availableWidth,t),this._contextForBreakLines=t,this._autoStretchHeight){let t=this._lines.length*this._fontOffset.height+2*this._margin.getValueInPixel(this._host,e.height);this.height=Math.min(this._maxHeight.getValueInPixel(this._host,e.height),t)+"px",this._autoStretchHeight=!0}if(this._availableHeight=this._height.getValueInPixel(this._host,e.height)-s,this._isFocused){this._cursorInfo.currentLineIndex=0;let e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,t=0;for(;t+e<=this._cursorInfo.globalStartIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length)}}_textHasChanged(){!this._prevText&&this._textWrapper.text&&this.placeholderText&&(this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=1,this._cursorInfo.globalEndIndex=1,this._cursorInfo.relativeStartIndex=1,this._cursorInfo.relativeEndIndex=1),super._textHasChanged()}_computeScroll(){if(this._clipTextLeft=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width),this._clipTextTop=this._currentMeasure.top+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.height),this._isFocused&&this._lines[this._cursorInfo.currentLineIndex].width>this._availableWidth){let e=this._clipTextLeft-this._lines[this._cursorInfo.currentLineIndex].width+this._availableWidth;this._scrollLeft||(this._scrollLeft=e)}else this._scrollLeft=this._clipTextLeft;if(this._isFocused){let e=(this._cursorInfo.currentLineIndex+1)*this._fontOffset.height,t=this._clipTextTop-e;this._scrollTop||(this._scrollTop=t)}else this._scrollTop=this._clipTextTop}_additionalProcessing(){this.highlightedText="",this.onLinesReadyObservable.notifyObservers(this)}_drawText(e,t,i,s){let r=this._currentMeasure.width,o=this._scrollLeft;switch(this._textHorizontalAlignment){case P.HORIZONTAL_ALIGNMENT_LEFT:o+=0;break;case P.HORIZONTAL_ALIGNMENT_RIGHT:o+=r-t;break;case P.HORIZONTAL_ALIGNMENT_CENTER:o+=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(e,this._currentMeasure.left+o,i),s.fillText(e,o,i)}_onCopyText(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(e){if(this._highlightedText){try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._textHasChanged()}}_onPasteText(e){let t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData,this._isTextHighlightOn=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,t);let i=t.length-(this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex);this._cursorInfo.globalStartIndex+=i,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._clickedCoordinateX=null,this._clickedCoordinateY=null,super._textHasChanged()}_draw(e){this._computeScroll(),this._scrollLeft=this._scrollLeft??0,this._scrollTop=this._scrollTop??0,e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.fillStyle=this.color);let t=this._currentMeasure.height,i=this._currentMeasure.width,s=0;switch(this._textVerticalAlignment){case P.VERTICAL_ALIGNMENT_TOP:s=this._fontOffset.ascent;break;case P.VERTICAL_ALIGNMENT_BOTTOM:s=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case P.VERTICAL_ALIGNMENT_CENTER:s=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}e.save(),e.beginPath(),e.fillStyle=this.fontStyle,!this._textWrapper.text&&this.placeholderText&&(e.fillStyle=this._placeholderColor),e.rect(this._clipTextLeft,this._clipTextTop,this._availableWidth+2,this._availableHeight+2),e.clip(),s+=this._scrollTop;for(let t=0;t<this._lines.length;t++){let i=this._lines[t];0!==t&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?s+=this._lineSpacing.getValue(this._host):s+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(i.text,i.width,s,e),s+=this._fontOffset.height}if(e.restore(),this._isFocused){if(!this._blinkIsEven||this._isTextHighlightOn){let t=this._scrollLeft+e.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,this._cursorInfo.relativeStartIndex)).width;t<this._clipTextLeft?(this._scrollLeft+=this._clipTextLeft-t,t=this._clipTextLeft,this._markAsDirty()):t>this._clipTextLeft+this._availableWidth&&(this._scrollLeft+=this._clipTextLeft+this._availableWidth-t,t=this._clipTextLeft+this._availableWidth,this._markAsDirty());let i=this._scrollTop+this._cursorInfo.currentLineIndex*this._fontOffset.height;i<this._clipTextTop?(this._scrollTop+=this._clipTextTop-i,i=this._clipTextTop,this._markAsDirty()):i+this._fontOffset.height>this._clipTextTop+this._availableHeight&&this._availableHeight>this._fontOffset.height&&(this._scrollTop+=this._clipTextTop+this._availableHeight-i-this._fontOffset.height,i=this._clipTextTop+this._availableHeight-this._fontOffset.height,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(t,i,2,this._fontOffset.height)}if(this._resetBlinking(),this._isTextHighlightOn){clearTimeout(this._blinkTimeout),this._highlightedText=this.text.substring(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor;let t=Math.min(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex),s=Math.max(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex),r=this._scrollTop+t*this._fontOffset.height;for(let o=t;o<=s;o++){let a=this._lines[o],n=this._scrollLeft;switch(this._textHorizontalAlignment){case P.HORIZONTAL_ALIGNMENT_LEFT:n+=0;break;case P.HORIZONTAL_ALIGNMENT_RIGHT:n+=i-a.width;break;case P.HORIZONTAL_ALIGNMENT_CENTER:n+=(i-a.width)/2}let l=o===t?this._cursorInfo.relativeStartIndex:0,h=o===s?this._cursorInfo.relativeEndIndex:a.text.length,_=e.measureText(a.text.substring(0,l)).width,d=a.text.substring(l,h),c=e.measureText(d).width;e.fillRect(n+_,r,c,this._fontOffset.height),r+=this._fontOffset.height}this._cursorInfo.globalEndIndex===this._cursorInfo.globalStartIndex&&this._resetBlinking()}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness))}_resetBlinking(){clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()},500)}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!!this.isReadOnly||((this._clickedCoordinateX=t.x,this._clickedCoordinateY=t.y,this._isTextHighlightOn=!1,this._highlightedText="",this._isPointerDown=!0,this._host._capturingControl[i]=this,this._host.focusedControl===this)?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):!!this._isEnabled&&(this._host.focusedControl=this,!0)))}_onPointerMove(e,t,i,s){(0!==s.event.movementX||0!==s.event.movementY)&&(this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinateX=t.x,this._clickedCoordinateY=t.y,this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._isTextHighlightOn=!0),this._markAsDirty()),super._onPointerMove(e,t,i,s))}_updateCursorPosition(){if(this._isFocused)if(!this._textWrapper.text&&this.placeholderText)this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=0,this._cursorInfo.globalEndIndex=0,this._cursorInfo.relativeStartIndex=0,this._cursorInfo.relativeEndIndex=0;else if(this._clickedCoordinateX&&this._clickedCoordinateY){this._isTextHighlightOn||(this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeStartIndex:0,relativeEndIndex:0,currentLineIndex:0});let e=0,t=0,i=Math.floor((this._clickedCoordinateY-this._scrollTop)/this._fontOffset.height);this._cursorInfo.currentLineIndex=Math.min(Math.max(i,0),this._lines.length-1);let s=0,r=this._clickedCoordinateX-(this._scrollLeft??0),o=0;for(let t=0;t<this._cursorInfo.currentLineIndex;t++){let i=this._lines[t];e+=i.text.length+i.lineEnding.length}for(;s<r&&this._lines[this._cursorInfo.currentLineIndex].text.length>t;)t++,o=Math.abs(r-s),s=this._contextForBreakLines.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,t)).width;Math.abs(r-s)>o&&t>0&&t--,e+=t,this._isTextHighlightOn?e<this._highlightCursorInfo.initialStartIndex?(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=t,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):(this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeStartIndex=this._highlightCursorInfo.initialRelativeStartIndex,this._cursorInfo.globalEndIndex=e,this._cursorInfo.relativeEndIndex=t):(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=t,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex),this._blinkIsEven=this._isTextHighlightOn,this._clickedCoordinateX=null,this._clickedCoordinateY=null}else{this._cursorInfo.relativeStartIndex=0,this._cursorInfo.currentLineIndex=0;let e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,t=0;for(;t+e<=this._cursorInfo.globalStartIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);if(this._cursorInfo.relativeStartIndex=this._cursorInfo.globalStartIndex-t,this._isTextHighlightOn){if(-1!==this._highlightCursorInfo.initialStartIndex&&this._cursorInfo.globalStartIndex>=this._highlightCursorInfo.initialStartIndex){for(;t+e<=this._cursorInfo.globalEndIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);this._cursorInfo.relativeEndIndex=this._cursorInfo.globalEndIndex-t}}else this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex}}_updateValueFromCursorIndex(e){}_processDblClick(e){let t,i;do t=this._cursorInfo.globalStartIndex>0&&this._textWrapper.isWord(this._cursorInfo.globalStartIndex-1)?--this._cursorInfo.globalStartIndex:0,i=this._cursorInfo.globalEndIndex<this._textWrapper.length&&this._textWrapper.isWord(this._cursorInfo.globalEndIndex)?++this._cursorInfo.globalEndIndex:0;while(t||i);this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._markAsDirty()}selectAllText(){this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._highlightCursorInfo={initialStartIndex:0,initialRelativeStartIndex:0,initialLineIndex:0},this._cursorInfo={globalStartIndex:0,globalEndIndex:this._textWrapper.length,relativeEndIndex:this._lines[this._lines.length-1].text.length,relativeStartIndex:0,currentLineIndex:this._lines.length-1},this._markAsDirty()}dispose(){super.dispose(),this.onLinesReadyObservable.clear()}}(0,o.Cg)([(0,T.lK)()],G.prototype,"autoStretchHeight",null),(0,o.Cg)([(0,T.lK)()],G.prototype,"maxHeight",null),(0,C.Y5)("BABYLON.GUI.InputTextArea",G);class H extends k{_getTypeName(){return"InputPassword"}_beforeRenderText(e){let t=new D,i="";for(let t=0;t<e.length;t++)i+="•";return t.text=i,t}}(0,C.Y5)("BABYLON.GUI.InputPassword",H);class K extends P{get dash(){return this._dash}set dash(e){this._dash!==e&&(this._dash=e,this._markAsDirty())}get connectedControl(){return this._connectedControl}set connectedControl(e){this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add(()=>this._markAsDirty())),this._connectedControl=e,this._markAsDirty())}get x1(){return this._x1.toString(this._host)}set x1(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()}get y1(){return this._y1.toString(this._host)}set y1(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()}get x2(){return this._x2.toString(this._host)}set x2(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()}get y2(){return this._y2.toString(this._host)}set y2(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())}set horizontalAlignment(e){}set verticalAlignment(e){}get _effectiveX2(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)}get _effectiveY2(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)}constructor(e){super(e),this.name=e,this._lineWidth=1,this._x1=new d(0),this._y1=new d(0),this._x2=new d(0),this._y2=new d(0),this._dash=[],this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=P.VERTICAL_ALIGNMENT_TOP}_getTypeName(){return"Line"}_draw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this._getColor(e),e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()}_measure(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth}_computeAlignment(e){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2}moveToVector3(e,t,i=!1){if(!this._host||this.parent!==this._host._rootContainer)return void _.S0.Error("Cannot move a control to a vector3 if the control is not at root level");let s=this._host._getGlobalViewport(),r=l.Pq.Project(e,l.uq.IdentityReadOnly,t.getTransformMatrix(),s);if(this._moveToProjectedPosition(r,i),r.z<0||r.z>1){this.notRenderable=!0;return}this.notRenderable=!1}_moveToProjectedPosition(e,t=!1){let i=e.x+this._linkOffsetX.getValue(this._host)+"px",s=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=s,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=s,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)}}(0,o.Cg)([(0,T.lK)()],K.prototype,"dash",null),(0,o.Cg)([(0,T.lK)()],K.prototype,"x1",null),(0,o.Cg)([(0,T.lK)()],K.prototype,"y1",null),(0,o.Cg)([(0,T.lK)()],K.prototype,"x2",null),(0,o.Cg)([(0,T.lK)()],K.prototype,"y2",null),(0,o.Cg)([(0,T.lK)()],K.prototype,"lineWidth",null),(0,C.Y5)("BABYLON.GUI.Line",K);var X=i(18640);class Y{constructor(e){this._multiLine=e,this._x=new d(0),this._y=new d(0),this._point=new l.Pq(0,0,0)}get x(){return this._x.toString(this._multiLine._host)}set x(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()}get y(){return this._y.toString(this._multiLine._host)}set y(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()}get control(){return this._control}set control(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}resetLinks(){this.control=null,this.mesh=null}translate(){return this._point=this._translatePoint(),this._point}_translatePoint(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());{if(null!=this._control)return new l.Pq(this._control.centerX,this._control.centerY,1-p.bH);let e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new l.Pq(t,i,1-p.bH)}}dispose(){this.resetLinks()}}class q extends P{constructor(e){super(e),this.name=e,this._lineWidth=1,this.onPointUpdate=()=>{this._markAsDirty()},this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._dash=[],this._points=[]}get dash(){return this._dash}set dash(e){this._dash!==e&&(this._dash=e,this._markAsDirty())}getAt(e){return this._points[e]||(this._points[e]=new Y(this)),this._points[e]}add(...e){return e.map(e=>this.push(e))}push(e){let t=this.getAt(this._points.length);return null==e||(e instanceof X.u?t.mesh=e:e instanceof P?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t}remove(e){let t;if(e instanceof Y){if(-1===(t=this._points.indexOf(e)))return}else t=e;let i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))}reset(){for(;this._points.length>0;)this.remove(this._points.length-1)}resetLinks(){for(let e of this._points)null!=e&&e.resetLinks()}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())}set horizontalAlignment(e){}set verticalAlignment(e){}_getTypeName(){return"MultiLine"}_draw(e){let t;e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();let i=!0;for(let s of this._points)s&&(i?(e.moveTo(s._point.x,s._point.y),i=!1):s._point.z<1&&t.z<1?e.lineTo(s._point.x,s._point.y):e.moveTo(s._point.x,s._point.y),t=s._point);e.stroke(),e.restore()}_additionalProcessing(){for(let e of(this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points))e&&(e.translate(),(null==this._minX||e._point.x<this._minX)&&(this._minX=e._point.x),(null==this._minY||e._point.y<this._minY)&&(this._minY=e._point.y),(null==this._maxX||e._point.x>this._maxX)&&(this._maxX=e._point.x),(null==this._maxY||e._point.y>this._maxY)&&(this._maxY=e._point.y));null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)}_measure(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)}_computeAlignment(){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)}dispose(){this.reset(),super.dispose()}}(0,o.Cg)([(0,T.lK)()],q.prototype,"dash",null),(0,C.Y5)("BABYLON.GUI.MultiLine",q);class j extends P{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls(e=>{e!==this&&void 0!==e.group&&e.group===this.group&&(e.isChecked=!1)}))}constructor(e){super(e),this.name=e,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.group="",this.onIsCheckedChangedObservable=new n.cP,this.isPointerBlocker=!0}_getTypeName(){return"RadioButton"}_draw(e){e.save(),this._applyStates(e);let t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),P.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,1,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;let s=t*this._checkSizeRatio,r=i*this._checkSizeRatio;P.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,s/2-this._thickness/2,r/2-this._thickness/2,1,e),e.fill()}e.restore()}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!!this.isReadOnly||(this.isChecked||(this.isChecked=!0),!0))}static AddRadioButtonWithHeader(e,t,i,s){let r=new F;r.isVertical=!1,r.height="30px";let o=new j;o.width="20px",o.height="20px",o.isChecked=i,o.color="green",o.group=t,o.onIsCheckedChangedObservable.add(e=>s(o,e)),r.addControl(o);let a=new O;return a.text=e,a.width="180px",a.paddingLeft="5px",a.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,a.color="white",r.addControl(a),r}}(0,o.Cg)([(0,T.lK)()],j.prototype,"thickness",null),(0,o.Cg)([(0,T.lK)()],j.prototype,"group",void 0),(0,o.Cg)([(0,T.lK)()],j.prototype,"checkSizeRatio",null),(0,o.Cg)([(0,T.lK)()],j.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],j.prototype,"isChecked",null),(0,C.Y5)("BABYLON.GUI.RadioButton",j);class $ extends P{get displayThumb(){return this._displayThumb}set displayThumb(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())}get step(){return this._step}set step(e){this._step!==e&&(this._step=e,this._markAsDirty())}get barOffset(){return this._barOffset.toString(this._host)}get barOffsetInPixels(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)}set barOffset(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()}get thumbWidth(){return this._thumbWidth.toString(this._host)}get thumbWidthInPixels(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set thumbWidth(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()}get minimum(){return this._minimum}set minimum(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get value(){return this._value}set value(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))}get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())}get isThumbClamped(){return this._isThumbClamped}set isThumbClamped(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thumbWidth=new d(20,d.UNITMODE_PIXEL,!1),this._minimum=0,this._maximum=100,this._value=50,this._isVertical=!1,this._barOffset=new d(5,d.UNITMODE_PIXEL,!1),this._isThumbClamped=!1,this._displayThumb=!0,this._step=0,this._lastPointerDownId=-1,this._effectiveBarOffset=0,this.onValueChangedObservable=new n.cP,this._pointerIsDown=!1,this.isPointerBlocker=!0}_getTypeName(){return"BaseSlider"}_getThumbPosition(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength}_getThumbThickness(e){let t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t}_prepareRenderingData(e){if(this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width)return void a.V.Error("Height should be greater than width");this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength)}_updateValueFromPointer(e,t){let i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum),this.value=this._step?Math.round(i/this._step)*this._step:i}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!!this.isReadOnly||(this._pointerIsDown=!0,this._updateValueFromPointer(t.x,t.y),this._host._capturingControl[i]=this,this._lastPointerDownId=i,!0))}_onPointerMove(e,t,i,s){i==this._lastPointerDownId&&(this._pointerIsDown&&!this.isReadOnly&&this._updateValueFromPointer(t.x,t.y),super._onPointerMove(e,t,i,s))}_onPointerUp(e,t,i,s,r){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}}(0,o.Cg)([(0,T.lK)()],$.prototype,"displayThumb",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"step",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"barOffset",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"thumbWidth",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"minimum",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"maximum",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"value",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"isVertical",null),(0,o.Cg)([(0,T.lK)()],$.prototype,"isThumbClamped",null);class Z extends ${get displayValueBar(){return this._displayValueBar}set displayValueBar(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get thumbColor(){return this._thumbColor}set thumbColor(e){this._thumbColor!==e&&(this._thumbColor=e,this._markAsDirty())}get isThumbCircle(){return this._isThumbCircle}set isThumbCircle(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._background="black",this._borderColor="white",this._thumbColor="",this._isThumbCircle=!1,this._displayValueBar=!0,this._backgroundGradient=null}_getTypeName(){return"Slider"}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");let t=this._renderLeft,i=this._renderTop,s=this._renderWidth,r=this._renderHeight,o=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?i+=this._effectiveThumbThickness/2:t+=this._effectiveThumbThickness/2,o=this._backgroundBoxThickness/2):o=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,o=Math.max(0,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);let a=this._getThumbPosition();e.fillStyle=this._getBackgroundColor(e),this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,i,o,Math.PI,2*Math.PI),e.fill(),e.fillRect(t,i,s,r)):e.fillRect(t,i,s,r+this._effectiveThumbThickness):e.fillRect(t,i,s,r):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxLength,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill(),e.fillRect(t,i,s,r)):e.fillRect(t,i,s+this._effectiveThumbThickness,r):e.fillRect(t,i,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this._getColor(e),this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,i+this._backgroundBoxLength,o,0,2*Math.PI),e.fill(),e.fillRect(t,i+a,s,r-a)):e.fillRect(t,i+a,s,r-a+this._effectiveThumbThickness):e.fillRect(t,i+a,s,r-a):(this.isThumbClamped&&this.isThumbCircle&&(e.beginPath(),e.arc(t,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill()),e.fillRect(t,i,a,r))),e.fillStyle=this._thumbColor||this._getColor(e),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(t+this._backgroundBoxThickness/2,i+a,o,0,2*Math.PI):e.arc(t+a,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(t-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(t-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()}serialize(e){super.serialize(e),this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient))}_parseFromContent(e,t){if(super._parseFromContent(e,t),e.backgroundGradient){let t=_.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this.backgroundGradient=new t,this.backgroundGradient.parse(e.backgroundGradient)}}}(0,o.Cg)([(0,T.lK)()],Z.prototype,"displayValueBar",null),(0,o.Cg)([(0,T.lK)()],Z.prototype,"borderColor",null),(0,o.Cg)([(0,T.lK)()],Z.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],Z.prototype,"thumbColor",null),(0,o.Cg)([(0,T.lK)()],Z.prototype,"isThumbCircle",null),(0,C.Y5)("BABYLON.GUI.Slider",Z);class J{constructor(e){this.name=e,this._groupPanel=new F,this._selectors=[],this._groupPanel.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}get groupPanel(){return this._groupPanel}get selectors(){return this._selectors}get header(){return this._groupHeader.text}set header(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)}_addGroupHeader(e){let t=new O("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t}_getSelector(e){if(!(e<0)&&!(e>=this._selectors.length))return this._selectors[e]}removeSelector(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))}}class ee extends J{addCheckbox(e,t=e=>{},i=!1){i=i||!1;let s=new L;s.width="20px",s.height="20px",s.color="#364249",s.background="#CCCCCC",s.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,s.onIsCheckedChangedObservable.add(function(e){t(e)});let r=P.AddHeader(s,e,"200px",{isHorizontal:!0,controlFirst:!0});r.height="30px",r.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,r.left="4px",this.groupPanel.addControl(r),this.selectors.push(r),s.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(s.color=this.groupPanel.parent.parent.buttonColor,s.background=this.groupPanel.parent.parent.buttonBackground)}_setSelectorLabel(e,t){this.selectors[e].children[1].text=t}_setSelectorLabelColor(e,t){this.selectors[e].children[1].color=t}_setSelectorButtonColor(e,t){this.selectors[e].children[0].color=t}_setSelectorButtonBackground(e,t){this.selectors[e].children[0].background=t}}class et extends J{constructor(){super(...arguments),this._selectNb=0}addRadio(e,t=e=>{},i=!1){let s=this._selectNb++,r=new j;r.name=e,r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.group=this.name,r.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add(function(e){e&&t(s)});let o=P.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)}_setSelectorLabel(e,t){this.selectors[e].children[1].text=t}_setSelectorLabelColor(e,t){this.selectors[e].children[1].color=t}_setSelectorButtonColor(e,t){this.selectors[e].children[0].color=t}_setSelectorButtonBackground(e,t){this.selectors[e].children[0].background=t}}class ei extends J{addSlider(e,t=e=>{},i="Units",s=0,r=0,o=0,a=e=>0|e){let n=new Z;n.name=i,n.value=o,n.minimum=s,n.maximum=r,n.width=.9,n.height="20px",n.color="#364249",n.background="#CCCCCC",n.borderColor="black",n.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",n.paddingBottom="4px",n.onValueChangedObservable.add(function(e){n.parent.children[0].text=n.parent.children[0].name+": "+a(e)+" "+n.name,t(e)});let l=P.AddHeader(n,e+": "+a(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});l.height="60px",l.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,l.left="4px",l.children[0].name=e,this.groupPanel.addControl(l),this.selectors.push(l),this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)}_setSelectorLabel(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name}_setSelectorLabelColor(e,t){this.selectors[e].children[0].color=t}_setSelectorButtonColor(e,t){this.selectors[e].children[1].color=t}_setSelectorButtonBackground(e,t){this.selectors[e].children[1].background=t}}class es extends w{constructor(e,t=[]){if(super(e),this.name=e,this.groups=t,this._buttonColor="#364249",this._buttonBackground="#CCCCCC",this._headerColor="black",this._barColor="white",this._barHeight="2px",this._spacerHeight="20px",this._bars=[],this._groups=t,this.thickness=2,this._panel=new F,this._panel.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._panel.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._panel.top=5,this._panel.left=5,this._panel.width=.95,t.length>0){for(let e=0;e<t.length-1;e++)this._panel.addControl(t[e].groupPanel),this._addSpacer();this._panel.addControl(t[t.length-1].groupPanel)}this.addControl(this._panel)}_getTypeName(){return"SelectionPanel"}get panel(){return this._panel}get headerColor(){return this._headerColor}set headerColor(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())}_setHeaderColor(){for(let e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor}get buttonColor(){return this._buttonColor}set buttonColor(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())}_setbuttonColor(){for(let e=0;e<this._groups.length;e++)for(let t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)}get labelColor(){return this._labelColor}set labelColor(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())}_setLabelColor(){for(let e=0;e<this._groups.length;e++)for(let t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)}get buttonBackground(){return this._buttonBackground}set buttonBackground(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())}_setButtonBackground(){for(let e=0;e<this._groups.length;e++)for(let t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)}get barColor(){return this._barColor}set barColor(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())}_setBarColor(){for(let e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor}get barHeight(){return this._barHeight}set barHeight(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())}_setBarHeight(){for(let e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight}get spacerHeight(){return this._spacerHeight}set spacerHeight(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())}_setSpacerHeight(){for(let e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight}_addSpacer(){let e=new M;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT;let t=new w;t.width=1,t.height=this._barHeight,t.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)}addGroup(e){this._groups.length>0&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(let t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)}removeGroup(e){if(e<0||e>=this._groups.length)return;let t=this._groups[e];this._panel.removeControl(t.groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1))}setHeaderName(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)}relabel(e,t,i){if(t<0||t>=this._groups.length)return;let s=this._groups[t];i<0||i>=s.selectors.length||s._setSelectorLabel(i,e)}removeFromGroupSelector(e,t){if(e<0||e>=this._groups.length)return;let i=this._groups[e];t<0||t>=i.selectors.length||i.removeSelector(t)}addToGroupCheckbox(e,t,i=()=>{},s=!1){e<0||e>=this._groups.length||this._groups[e].addCheckbox(t,i,s)}addToGroupRadio(e,t,i=()=>{},s=!1){e<0||e>=this._groups.length||this._groups[e].addRadio(t,i,s)}addToGroupSlider(e,t,i=()=>{},s="Units",r=0,o=0,a=0,n=e=>0|e){e<0||e>=this._groups.length||this._groups[e].addSlider(t,i,s,r,o,a,n)}}class er extends M{get freezeControls(){return this._freezeControls}set freezeControls(e){if(this._freezeControls===e)return;e||this._restoreMeasures(),this._freezeControls=!1;let t=this.host.getSize(),i=t.width,s=t.height,r=this.host.getContext(),o=new m(0,0,i,s);this.host._numLayoutCalls=0,this.host._rootContainer._layout(o,r),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty()}get bucketWidth(){return this._bucketWidth}get bucketHeight(){return this._bucketHeight}setBucketSizes(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}}_useBuckets(){return this._bucketWidth>0&&this._bucketHeight>0}_makeBuckets(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null}_dispatchInBuckets(e){for(let t=0;t<e.length;++t){let i=e[t],s=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),r=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),o=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight),a=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight));for(;a<=o;){for(let e=s;e<=r;++e){let t=a*this._bucketLen+e,s=this._buckets[t];s||(s=[],this._buckets[t]=s),s.push(i)}a++}i instanceof M&&i._children.length>0&&this._dispatchInBuckets(i._children)}}_updateMeasures(){let e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,e,t)}_updateChildrenMeasures(e,t,i){for(let s=0;s<e.length;++s){let r=e[s];r._currentMeasure.left-=t,r._currentMeasure.top-=i,r._customData._origLeft=r._currentMeasure.left,r._customData._origTop=r._currentMeasure.top,r instanceof M&&r._children.length>0&&this._updateChildrenMeasures(r._children,t,i)}}_restoreMeasures(){let e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left=this._customData.origLeftForChildren+e,this._measureForChildren.top=this._customData.origTopForChildren+t,this._currentMeasure.left=this._customData.origLeft+e,this._currentMeasure.top=this._customData.origTop+t}constructor(e){super(e),this._freezeControls=!1,this._bucketWidth=0,this._bucketHeight=0,this._buckets={}}_getTypeName(){return"ScrollViewerWindow"}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._parentMeasure=e,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height}_layout(e,t){return this._freezeControls?(this.invalidateRect(),!1):super._layout(e,t)}_scrollChildren(e,t,i){for(let s=0;s<e.length;++s){let r=e[s];r._currentMeasure.left=r._customData._origLeft+t,r._currentMeasure.top=r._customData._origTop+i,r._isClipped=!1,r instanceof M&&r._children.length>0&&this._scrollChildren(r._children,t,i)}}_scrollChildrenWithBuckets(e,t,i,s){let r=Math.max(0,Math.floor(-e/this._bucketWidth)),o=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),a=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight),n=Math.max(0,Math.floor(-t/this._bucketHeight));for(;n<=a;){for(let e=r;e<=o;++e){let t=n*this._bucketLen+e,r=this._buckets[t];if(r)for(let e=0;e<r.length;++e){let t=r[e];t._currentMeasure.left=t._customData._origLeft+i,t._currentMeasure.top=t._customData._origTop+s,t._isClipped=!1}}n++}}_draw(e,t){if(!this._freezeControls)return void super._draw(e,t);this._localDraw(e),this.clipChildren&&this._clipForChildren(e);let i=0|this.leftInPixels,s=0|this.topInPixels;for(let t of(this._useBuckets()&&null!==this._oldLeft&&null!==this._oldTop?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,s),this._scrollChildrenWithBuckets(i,s,i,s)):this._scrollChildren(this._children,i,s),this._oldLeft=i,this._oldTop=s,this._children))t._intersectsRect(this._parentMeasure)&&t._render(e,this._parentMeasure)}_postMeasure(){if(this._freezeControls)return void super._postMeasure();let e=this.parentClientWidth,t=this.parentClientHeight;for(let i of this.children)i.isVisible&&!i.notRenderable&&(i.horizontalAlignment===P.HORIZONTAL_ALIGNMENT_CENTER&&i._offsetLeft(this._currentMeasure.left-i._currentMeasure.left),i.verticalAlignment===P.VERTICAL_ALIGNMENT_CENTER&&i._offsetTop(this._currentMeasure.top-i._currentMeasure.top),e=Math.max(e,i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width+i.paddingRightInPixels),t=Math.max(t,i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height+i.paddingBottomInPixels));this._currentMeasure.width!==e&&(this._width.updateInPlace(e,d.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==t&&(this._height.updateInPlace(t,d.UNITMODE_PIXEL),this._currentMeasure.height=t,this._rebuildLayout=!0,this._isDirty=!0),super._postMeasure()}}class eo extends ${get borderColor(){return this._borderColor}set borderColor(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(e){this._invertScrollDirection=e}constructor(e){super(e),this.name=e,this._background="black",this._borderColor="white",this._tempMeasure=new m(0,0,0,0),this._invertScrollDirection=!1,this._backgroundGradient=null}_getTypeName(){return"Scrollbar"}_getThumbThickness(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");let t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._getBackgroundColor(e),e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this._getColor(e),this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()}_updateValueFromPointer(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y);let i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=e,this._originY=t}_onPointerDown(e,t,i,s,r){return this._first=!0,super._onPointerDown(e,t,i,s,r)}serialize(e){super.serialize(e),this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient))}_parseFromContent(e,t){if(super._parseFromContent(e,t),e.backgroundGradient){let t=_.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this.backgroundGradient=new t,this.backgroundGradient.parse(e.backgroundGradient)}}}(0,o.Cg)([(0,T.lK)()],eo.prototype,"borderColor",null),(0,o.Cg)([(0,T.lK)()],eo.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],eo.prototype,"invertScrollDirection",null),(0,C.Y5)("BABYLON.GUI.Scrollbar",eo);class ea extends ${get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(e){this._invertScrollDirection=e}get backgroundImage(){return this._backgroundBaseImage}set backgroundImage(e){this._backgroundBaseImage!==e&&(this._backgroundBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._backgroundImage=e._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce(()=>{let t=e._rotate90(this.num90RotationInVerticalMode,!0);this._backgroundImage=t,t.isLoaded||t.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()}):(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()))}get thumbImage(){return this._thumbBaseImage}set thumbImage(e){this._thumbBaseImage!==e&&(this._thumbBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._thumbImage=e._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce(()=>{let t=e._rotate90(-this.num90RotationInVerticalMode,!0);this._thumbImage=t,t.isLoaded||t.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()}):(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()))}get thumbLength(){return this._thumbLength}set thumbLength(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())}get thumbHeight(){return this._thumbHeight}set thumbHeight(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())}get barImageHeight(){return this._barImageHeight}set barImageHeight(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._tempMeasure=new m(0,0,0,0),this._invertScrollDirection=!1,this.num90RotationInVerticalMode=1}_getTypeName(){return"ImageScrollBar"}_getThumbThickness(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");let t=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+r*(1-this._barImageHeight)*.5,this._currentMeasure.top,r*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,s+o*(1-this._barImageHeight)*.5,r,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()}_updateValueFromPointer(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y);let i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=e,this._originY=t}_onPointerDown(e,t,i,s,r){return this._first=!0,super._onPointerDown(e,t,i,s,r)}}(0,o.Cg)([(0,T.lK)()],ea.prototype,"num90RotationInVerticalMode",void 0),(0,o.Cg)([(0,T.lK)()],ea.prototype,"invertScrollDirection",null);class en extends w{get horizontalBar(){return this._horizontalBar}get verticalBar(){return this._verticalBar}addControl(e){return e&&this._window.addControl(e),this}removeControl(e){return this._window.removeControl(e),this}get children(){return this._window.children}_flagDescendantsAsMatrixDirty(){for(let e of this._children)e._markMatrixAsDirty()}get freezeControls(){return this._window.freezeControls}set freezeControls(e){this._window.freezeControls=e}get bucketWidth(){return this._window.bucketWidth}get bucketHeight(){return this._window.bucketHeight}setBucketSizes(e,t){this._window.setBucketSizes(e,t)}get forceHorizontalBar(){return this._forceHorizontalBar}set forceHorizontalBar(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e}get forceVerticalBar(){return this._forceVerticalBar}set forceVerticalBar(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e}constructor(e,t){super(e),this._barSize=20,this._pointerIsOver=!1,this._wheelPrecision=.05,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._horizontalBarImageHeight=1,this._verticalBarImageHeight=1,this._oldWindowContentsWidth=0,this._oldWindowContentsHeight=0,this._forceHorizontalBar=!1,this._forceVerticalBar=!1,this._useImageBar=!!t&&t,this.onDirtyObservable.add(()=>{this._horizontalBarSpace.color=this.color,this._verticalBarSpace.color=this.color,this._dragSpace.color=this.color}),this.onPointerEnterObservable.add(()=>{this._pointerIsOver=!0}),this.onPointerOutObservable.add(()=>{this._pointerIsOver=!1}),this._grid=new V,this._useImageBar?(this._horizontalBar=new ea,this._verticalBar=new ea):(this._horizontalBar=new eo,this._verticalBar=new eo),this._window=new er("scrollViewer_window"),this._window.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._window.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._grid.addColumnDefinition(1),this._grid.addColumnDefinition(0,!0),this._grid.addRowDefinition(1),this._grid.addRowDefinition(0,!0),super.addControl(this._grid),this._grid.addControl(this._window,0,0),this._verticalBarSpace=new w,this._verticalBarSpace.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._verticalBarSpace.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._verticalBarSpace.thickness=1,this._grid.addControl(this._verticalBarSpace,0,1),this._addBar(this._verticalBar,this._verticalBarSpace,!0,Math.PI),this._horizontalBarSpace=new w,this._horizontalBarSpace.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._horizontalBarSpace.verticalAlignment=P.VERTICAL_ALIGNMENT_TOP,this._horizontalBarSpace.thickness=1,this._grid.addControl(this._horizontalBarSpace,1,0),this._addBar(this._horizontalBar,this._horizontalBarSpace,!1,0),this._dragSpace=new w,this._dragSpace.thickness=1,this._grid.addControl(this._dragSpace,1,1),this._grid.clipChildren=!1,this._useImageBar||(this.barColor="grey",this.barBackground="transparent")}resetWindow(){this._window.width="100%",this._window.height="100%"}_getTypeName(){return"ScrollViewer"}_buildClientSizes(){let e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._buildClientSizes()}_postMeasure(){super._postMeasure(),this._updateScroller(),this._setWindowPosition(!1)}get wheelPrecision(){return this._wheelPrecision}set wheelPrecision(e){this._wheelPrecision!==e&&(e<0&&(e=0),e>1&&(e=1),this._wheelPrecision=e)}get scrollBackground(){return this._horizontalBarSpace.background}set scrollBackground(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)}get barColor(){return this._barColor}set barColor(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)}get thumbImage(){return this._barImage}set thumbImage(e){if(this._barImage===e)return;this._barImage=e;let t=this._horizontalBar,i=this._verticalBar;t.thumbImage=e,i.thumbImage=e}get horizontalThumbImage(){return this._horizontalBarImage}set horizontalThumbImage(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)}get verticalThumbImage(){return this._verticalBarImage}set verticalThumbImage(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)}get barSize(){return this._barSize}set barSize(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))}get thumbLength(){return this._thumbLength}set thumbLength(e){if(this._thumbLength===e)return;e<=0&&(e=.1),e>1&&(e=1),this._thumbLength=e;let t=this._horizontalBar,i=this._verticalBar;t.thumbLength=e,i.thumbLength=e,this._markAsDirty()}get thumbHeight(){return this._thumbHeight}set thumbHeight(e){if(this._thumbHeight===e)return;e<=0&&(e=.1),e>1&&(e=1),this._thumbHeight=e;let t=this._horizontalBar,i=this._verticalBar;t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty()}get barImageHeight(){return this._barImageHeight}set barImageHeight(e){if(this._barImageHeight===e)return;e<=0&&(e=.1),e>1&&(e=1),this._barImageHeight=e;let t=this._horizontalBar,i=this._verticalBar;t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty()}get horizontalBarImageHeight(){return this._horizontalBarImageHeight}set horizontalBarImageHeight(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())}get verticalBarImageHeight(){return this._verticalBarImageHeight}set verticalBarImageHeight(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())}get barBackground(){return this._barBackground}set barBackground(e){if(this._barBackground===e)return;this._barBackground=e;let t=this._horizontalBar,i=this._verticalBar;t.background=e,i.background=e,this._dragSpace.background=e}get barImage(){return this._barBackgroundImage}set barImage(e){this._barBackgroundImage=e;let t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e}get horizontalBarImage(){return this._horizontalBarBackgroundImage}set horizontalBarImage(e){this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e}get verticalBarImage(){return this._verticalBarBackgroundImage}set verticalBarImage(e){this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e}_setWindowPosition(e=!0){let t=this.host.idealRatio,i=this._window._currentMeasure.width,s=this._window._currentMeasure.height;if(!e&&this._oldWindowContentsWidth===i&&this._oldWindowContentsHeight===s)return;this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=s;let r=this._clientWidth-i,o=this._clientHeight-s,a=this._horizontalBar.value/t*r+"px",n=this._verticalBar.value/t*o+"px";a!==this._window.left&&(this._window.left=a,this.freezeControls||(this._rebuildLayout=!0)),n!==this._window.top&&(this._window.top=n,this.freezeControls||(this._rebuildLayout=!0))}_updateScroller(){let e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();let i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"}_link(e){super._link(e),this._attachWheel()}_addBar(e,t,i,s){e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=P.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=P.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=s,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add(()=>{this._setWindowPosition()})}_attachWheel(){this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add(e=>{this._pointerIsOver&&!this.isReadOnly&&(!0==this._verticalBar.isVisible&&(e.y<0&&this._verticalBar.value>0?this._verticalBar.value-=this._wheelPrecision:e.y>0&&this._verticalBar.value<this._verticalBar.maximum&&(this._verticalBar.value+=this._wheelPrecision)),!0==this._horizontalBar.isVisible&&(e.x<0&&this._horizontalBar.value<this._horizontalBar.maximum?this._horizontalBar.value+=this._wheelPrecision:e.x>0&&this._horizontalBar.value>0&&(this._horizontalBar.value-=this._wheelPrecision)))}))}_renderHighlightSpecific(e){this.isHighlighted&&(super._renderHighlightSpecific(e),this._grid._renderHighlightSpecific(e),e.restore())}dispose(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,super.dispose()}}(0,o.Cg)([(0,T.lK)()],en.prototype,"wheelPrecision",null),(0,o.Cg)([(0,T.lK)()],en.prototype,"scrollBackground",null),(0,o.Cg)([(0,T.lK)()],en.prototype,"barColor",null),(0,o.Cg)([(0,T.lK)()],en.prototype,"barSize",null),(0,o.Cg)([(0,T.lK)()],en.prototype,"barBackground",null),(0,C.Y5)("BABYLON.GUI.ScrollViewer",en);class el extends w{get group(){return this._group}set group(e){this._group!==e&&(this._group=e)}get isActive(){return this._isActive}set isActive(e){this._isActive!==e&&(this._isActive=e,this._isActive?this.toActiveAnimation?.():this.toInactiveAnimation?.(),this._markAsDirty(),this.onIsActiveChangedObservable.notifyObservers(e),this._isActive&&this._host&&this._group&&this._host.executeOnAllControls(e=>{"ToggleButton"===e.typeName&&e!==this&&e.group===this.group&&(e.isActive=!1)}))}constructor(e,t){super(e),this.name=e,this.onIsActiveChangedObservable=new n.cP,this.delegatePickingToChildren=!1,this._isActive=!1,this.group=t??"",this.thickness=0,this.isPointerBlocker=!0;let i=null;this.toActiveAnimation=()=>{this.thickness=1},this.toInactiveAnimation=()=>{this.thickness=0},this.pointerEnterActiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutActiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownActiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpActiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05},this.pointerEnterInactiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutInactiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownInactiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpInactiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"ToggleButton"}_processPicking(e,t,i,s,r,o,a,n){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable||!super.contains(e,t))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){let r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}return this._processObservables(s,e,t,i,r,o,a,n),!0}_onPointerEnter(e,t){return!!super._onPointerEnter(e,t)&&(!!this.isReadOnly||(this._isActive?this.pointerEnterActiveAnimation&&this.pointerEnterActiveAnimation():this.pointerEnterInactiveAnimation&&this.pointerEnterInactiveAnimation(),!0))}_onPointerOut(e,t,i=!1){!this.isReadOnly&&(this._isActive?this.pointerOutActiveAnimation&&this.pointerOutActiveAnimation():this.pointerOutInactiveAnimation&&this.pointerOutInactiveAnimation()),super._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!!this.isReadOnly||(this._isActive?this.pointerDownActiveAnimation&&this.pointerDownActiveAnimation():this.pointerDownInactiveAnimation&&this.pointerDownInactiveAnimation(),!0))}_onPointerUp(e,t,i,s,r,o){!this.isReadOnly&&(this._isActive?this.pointerUpActiveAnimation&&this.pointerUpActiveAnimation():this.pointerUpInactiveAnimation&&this.pointerUpInactiveAnimation()),super._onPointerUp(e,t,i,s,r,o)}}(0,C.Y5)("BABYLON.GUI.ToggleButton",el);class eh{}class e_ extends F{constructor(){super(...arguments),this.onKeyPressObservable=new n.cP,this.defaultButtonWidth="40px",this.defaultButtonHeight="40px",this.defaultButtonPaddingLeft="2px",this.defaultButtonPaddingRight="2px",this.defaultButtonPaddingTop="2px",this.defaultButtonPaddingBottom="2px",this.defaultButtonColor="#DDD",this.defaultButtonBackground="#070707",this.shiftButtonColor="#7799FF",this.selectedShiftThickness=1,this.shiftState=0,this._currentlyConnectedInputText=null,this._connectedInputTexts=[],this._onKeyPressObserver=null}_getTypeName(){return"VirtualKeyboard"}_createKey(e,t){let i=A.CreateSimpleButton(e,e);return i.width=t&&t.width?t.width:this.defaultButtonWidth,i.height=t&&t.height?t.height:this.defaultButtonHeight,i.color=t&&t.color?t.color:this.defaultButtonColor,i.background=t&&t.background?t.background:this.defaultButtonBackground,i.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,i.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,i.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,i.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,i.thickness=0,i.isFocusInvisible=!0,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.onPointerUpObservable.add(()=>{this.onKeyPressObservable.notifyObservers(e)}),i}addKeysRow(e,t){let i=new F;i.isVertical=!1,i.isFocusInvisible=!0;let s=null;for(let r=0;r<e.length;r++){let o=null;t&&t.length===e.length&&(o=t[r]);let a=this._createKey(e[r],o);(!s||a.heightInPixels>s.heightInPixels)&&(s=a),i.addControl(a)}i.height=s?s.height:this.defaultButtonHeight,this.addControl(i)}applyShiftState(e){if(this.children)for(let t=0;t<this.children.length;t++){let i=this.children[t];if(i&&i.children)for(let t=0;t<i.children.length;t++){let s=i.children[t];if(!s||!s.children[0])continue;let r=s.children[0];"⇧"===r.text&&(s.color=e?this.shiftButtonColor:this.defaultButtonColor,s.thickness=e>1?this.selectedShiftThickness:0),r.text=e>0?r.text.toUpperCase():r.text.toLowerCase()}}}get connectedInputText(){return this._currentlyConnectedInputText}connect(e){if(this._connectedInputTexts.some(t=>t.input===e))return;null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add(e=>{if(this._currentlyConnectedInputText){switch(this._currentlyConnectedInputText._host.focusedControl=this._currentlyConnectedInputText,e){case"⇧":this.shiftState++,this.shiftState>2&&(this.shiftState=0),this.applyShiftState(this.shiftState);return;case"←":this._currentlyConnectedInputText instanceof G?this._currentlyConnectedInputText.alternativeProcessKey("Backspace"):this._currentlyConnectedInputText.processKey(8);return;case"↵":this._currentlyConnectedInputText instanceof G?this._currentlyConnectedInputText.alternativeProcessKey("Enter"):this._currentlyConnectedInputText.processKey(13);return}this._currentlyConnectedInputText instanceof G?this._currentlyConnectedInputText.alternativeProcessKey("",this.shiftState?e.toUpperCase():e):this._currentlyConnectedInputText.processKey(-1,this.shiftState?e.toUpperCase():e),1===this.shiftState&&(this.shiftState=0,this.applyShiftState(this.shiftState))}})),this.isVisible=!1,this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this;let t=e.onFocusObservable.add(()=>{this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this,this.isVisible=!0}),i=e.onBlurObservable.add(()=>{e._connectedVirtualKeyboard=null,this._currentlyConnectedInputText=null,this.isVisible=!1});this._connectedInputTexts.push({input:e,onBlurObserver:i,onFocusObserver:t})}disconnect(e){if(e){let t=this._connectedInputTexts.filter(t=>t.input===e);1===t.length&&(this._removeConnectedInputObservables(t[0]),this._connectedInputTexts=this._connectedInputTexts.filter(t=>t.input!==e),this._currentlyConnectedInputText===e&&(this._currentlyConnectedInputText=null))}else{for(let e of this._connectedInputTexts)this._removeConnectedInputObservables(e);this._connectedInputTexts.length=0}0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)}_removeConnectedInputObservables(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)}dispose(){super.dispose(),this.disconnect()}static CreateDefaultLayout(e){let t=new e_(e);return t.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),t.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),t.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),t.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),t.addKeysRow([" "],[{width:"200px"}]),t}_parseFromContent(e,t){for(let i of(super._parseFromContent(e,t),this.children))if("StackPanel"===i.getClassName())for(let e of i.children)"Button"===e.getClassName()&&e.name&&e.onPointerUpObservable.add(()=>{this.onKeyPressObservable.notifyObservers(e.name)})}}(0,C.Y5)("BABYLON.GUI.VirtualKeyboard",e_);class ed extends P{get displayMinorLines(){return this._displayMinorLines}set displayMinorLines(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())}get displayMajorLines(){return this._displayMajorLines}set displayMajorLines(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth=e,this._markAsDirty()}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight=e,this._markAsDirty()}get minorLineTickness(){return this._minorLineTickness}set minorLineTickness(e){this._minorLineTickness=e,this._markAsDirty()}get minorLineColor(){return this._minorLineColor}set minorLineColor(e){this._minorLineColor=e,this._markAsDirty()}get majorLineTickness(){return this._majorLineTickness}set majorLineTickness(e){this._majorLineTickness=e,this._markAsDirty()}get majorLineColor(){return this._majorLineColor}set majorLineColor(e){this._majorLineColor=e,this._markAsDirty()}get majorLineFrequency(){return this._majorLineFrequency}set majorLineFrequency(e){this._majorLineFrequency=e,this._markAsDirty()}constructor(e){super(e),this.name=e,this._cellWidth=20,this._cellHeight=20,this._minorLineTickness=1,this._minorLineColor="DarkGray",this._majorLineTickness=2,this._majorLineColor="White",this._majorLineFrequency=5,this._background="Black",this._displayMajorLines=!0,this._displayMinorLines=!0}_draw(e){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));let t=this._currentMeasure.width/this._cellWidth,i=this._currentMeasure.height/this._cellHeight,s=this._currentMeasure.left+this._currentMeasure.width/2,r=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(let i=-t/2+1;i<t/2;i++){let t=s+i*this.cellWidth;e.beginPath(),e.moveTo(t,this._currentMeasure.top),e.lineTo(t,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=-i/2+1;t<i/2;t++){let i=r+t*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,i),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),e.stroke()}}if(this._displayMajorLines){e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness;for(let i=-t/2+this._majorLineFrequency;i<t/2;i+=this._majorLineFrequency){let t=s+i*this.cellWidth;e.beginPath(),e.moveTo(t,this._currentMeasure.top),e.lineTo(t,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=-i/2+this._majorLineFrequency;t<i/2;t+=this._majorLineFrequency){let i=r+t*this.cellHeight;e.moveTo(this._currentMeasure.left,i),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),e.closePath(),e.stroke()}}}e.restore()}_getTypeName(){return"DisplayGrid"}}(0,o.Cg)([(0,T.lK)()],ed.prototype,"displayMinorLines",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"displayMajorLines",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"background",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"cellWidth",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"cellHeight",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"minorLineTickness",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"minorLineColor",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"majorLineTickness",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"majorLineColor",null),(0,o.Cg)([(0,T.lK)()],ed.prototype,"majorLineFrequency",null),(0,C.Y5)("BABYLON.GUI.DisplayGrid",ed);class ec extends ${get displayThumb(){return this._displayThumb&&null!=this.thumbImage}set displayThumb(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())}get backgroundImage(){return this._backgroundImage}set backgroundImage(e){this._backgroundImage!==e&&(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}get valueBarImage(){return this._valueBarImage}set valueBarImage(e){this._valueBarImage!==e&&(this._valueBarImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}get thumbImage(){return this._thumbImage}set thumbImage(e){this._thumbImage!==e&&(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}constructor(e){super(e),this.name=e,this._tempMeasure=new m(0,0,0,0)}_getTypeName(){return"ImageBasedSlider"}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");let t=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,o),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s+t,r,o-t+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(i,s+t,r,o-t):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s,t+this._effectiveThumbThickness/2,o):this._tempMeasure.copyFromFloats(i,s,t,o),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset,this._currentMeasure.top+t,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()}serialize(e){super.serialize(e);let t={},i={},s={};this.backgroundImage.serialize(t),this.thumbImage.serialize(i),this.valueBarImage.serialize(s),e.backgroundImage=t,e.thumbImage=i,e.valueBarImage=s}_parseFromContent(e,t){super._parseFromContent(e,t),this.backgroundImage=B.Parse(e.backgroundImage,t),this.thumbImage=B.Parse(e.thumbImage,t),this.valueBarImage=B.Parse(e.valueBarImage,t)}}(0,o.Cg)([(0,T.lK)()],ec.prototype,"displayThumb",null),(0,C.Y5)("BABYLON.GUI.ImageBasedSlider",ec);let eu="Statics";P.AddHeader=function(e,t,i,s){let r=new F("panel"),o=!s||s.isHorizontal,a=!s||s.controlFirst;r.isVertical=!o;let n=new O("header");return n.text=t,n.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,o?n.width=i:n.height=i,a?(r.addControl(e),r.addControl(n),n.paddingLeft="5px"):(r.addControl(n),r.addControl(e),n.paddingRight="5px"),n.shadowBlur=e.shadowBlur,n.shadowColor=e.shadowColor,n.shadowOffsetX=e.shadowOffsetX,n.shadowOffsetY=e.shadowOffsetY,r};class ef{constructor(){this._colorStops=[],this._gradientDirty=!0}_addColorStopsToCanvasGradient(){for(let e of this._colorStops)this._canvasGradient.addColorStop(e.offset,e.color)}getCanvasGradient(e){return(this._gradientDirty||this._context!==e)&&(this._context=e,this._canvasGradient=this._createCanvasGradient(e),this._addColorStopsToCanvasGradient(),this._gradientDirty=!1),this._canvasGradient}addColorStop(e,t){this._colorStops.push({offset:e,color:t}),this._gradientDirty=!0}removeColorStop(e){this._colorStops=this._colorStops.filter(t=>t.offset!==e),this._gradientDirty=!0}clearColorStops(){this._colorStops=[],this._gradientDirty=!0}get colorStops(){return this._colorStops}getClassName(){return"BaseGradient"}serialize(e){e.colorStops=this._colorStops,e.className=this.getClassName()}parse(e){this._colorStops=e.colorStops}}class eg extends ef{constructor(e,t,i,s){super(),this._x0=e??0,this._y0=t??0,this._x1=i??0,this._y1=s??0}_createCanvasGradient(e){return e.createLinearGradient(this._x0,this._y0,this._x1,this._y1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}getClassName(){return"LinearGradient"}serialize(e){super.serialize(e),e.x0=this._x0,e.y0=this._y0,e.x1=this._x1,e.y1=this._y1}parse(e){super.parse(e),this._x0=e.x0,this._y0=e.y0,this._x1=e.x1,this._y1=e.y1}}(0,C.Y5)("BABYLON.GUI.LinearGradient",eg);class em extends ef{constructor(e,t,i,s,r,o){super(),this._x0=e??0,this._y0=t??0,this._r0=i??0,this._x1=s??0,this._y1=r??0,this._r1=o??0}_createCanvasGradient(e){return e.createRadialGradient(this._x0,this._y0,this._r0,this._x1,this._y1,this._r1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}get r0(){return this._r0}get r1(){return this._r1}getClassName(){return"RadialGradient"}serialize(e){super.serialize(e),e.x0=this._x0,e.y0=this._y0,e.r0=this._r0,e.x1=this._x1,e.y1=this._y1,e.r1=this._r1}parse(e){super.parse(e),this._x0=e.x0,this._y0=e.y0,this._r0=e.r0,this._x1=e.x1,this._y1=e.y1,this._r1=e.r1}}(0,C.Y5)("BABYLON.GUI.RadialGradient",em);var ep=i(48451),ev=i(86359);class eb{constructor(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new d(18,d.UNITMODE_PIXEL,!1),this.onChangedObservable=new n.cP,this._host=e}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))}dispose(){this.onChangedObservable.clear()}}var ex=i(39575),eC=i(64607),eT=i(29737),ey=i(84676);class eS extends I.R{get numLayoutCalls(){return this._numLayoutCalls}get numRenderCalls(){return this._numRenderCalls}get adjustToEngineHardwareScalingLevel(){return this._adjustToEngineHardwareScalingLevel}set adjustToEngineHardwareScalingLevel(e){this._adjustToEngineHardwareScalingLevel!==e&&(this._adjustToEngineHardwareScalingLevel=e,this._onResize())}get renderScale(){return this._renderScale}set renderScale(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this.markAsDirty())}get idealWidth(){return this._idealWidth}set idealWidth(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get idealHeight(){return this._idealHeight}set idealHeight(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get useSmallestIdeal(){return this._useSmallestIdeal}set useSmallestIdeal(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get renderAtIdealSize(){return this._renderAtIdealSize}set renderAtIdealSize(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())}get idealRatio(){let e=0,t=0;return(this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight)?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1}get layer(){return this._layerToDispose}get rootContainer(){return this._rootContainer}getChildren(){return[this._rootContainer]}getDescendants(e,t){return this._rootContainer.getDescendants(e,t)}getControlsByType(e){return this._rootContainer.getDescendants(!1,t=>t.typeName===e)}getControlByName(e){return this._getControlByKey("name",e)}_getControlByKey(e,t){return this._rootContainer.getDescendants().find(i=>i[e]===t)||null}get focusedControl(){return this._focusedControl}set focusedControl(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)}get isForeground(){return!this.layer||!this.layer.isBackground}set isForeground(e){this.layer&&!e!==this.layer.isBackground&&(this.layer.isBackground=!e)}get clipboardData(){return this._clipboardData}set clipboardData(e){this._clipboardData=e}constructor(e,t,i=0,s,r=!1,o=E.g.NEAREST_SAMPLINGMODE,a=!0){let l="object"==typeof(t=t??0)&&void 0!==t?t.width??0:t??0,h="object"==typeof t&&void 0!==t?t.height??0:i;if(super(e,{width:l,height:h},"object"==typeof t&&void 0!==t?t:s,r,o,R.Y.TEXTUREFORMAT_RGBA,a),this.useStandalone=!1,this.onGuiReadyObservable=new n.cP,this._isDirty=!1,this._rootContainer=new M("root"),this._lastControlOver={},this._lastControlDown={},this._capturingControl={},this._linkedControls=[],this._isFullscreen=!1,this._fullscreenViewport=new ex.L(0,0,1,1),this._idealWidth=0,this._idealHeight=0,this._useSmallestIdeal=!1,this._renderAtIdealSize=!1,this._blockNextFocusCheck=!1,this._renderScale=1,this._cursorChanged=!1,this._defaultMousePointerId=0,this._rootChildrenHaveChanged=!1,this._adjustToEngineHardwareScalingLevel=!1,this._capturedPointerIds=new Set,this._numLayoutCalls=0,this._numRenderCalls=0,this._clipboardData="",this.onClipboardObservable=new n.cP,this.onControlPickedObservable=new n.cP,this.onBeginLayoutObservable=new n.cP,this.onEndLayoutObservable=new n.cP,this.onBeginRenderObservable=new n.cP,this.onEndRenderObservable=new n.cP,this.premulAlpha=!1,this.applyYInversionOnUpdate=!0,this.disableTabNavigation=!1,this.disablePicking=!1,this.usePointerTapForClickEvent=!1,this.skipBlockEvents=0,this.checkPointerEveryFrame=!1,this._useInvalidateRectOptimization=!0,this._invalidatedRectangle=null,this._alreadyRegisteredForRender=!1,this._clearMeasure=new m(0,0,0,0),this._focusProperties={index:0,total:-1},this._onClipboardCopy=e=>{let t=new N.f(N.G.COPY,e);this.onClipboardObservable.notifyObservers(t),e.preventDefault()},this._onClipboardCut=e=>{let t=new N.f(N.G.CUT,e);this.onClipboardObservable.notifyObservers(t),e.preventDefault()},this._onClipboardPaste=e=>{let t=new N.f(N.G.PASTE,e);this.onClipboardObservable.notifyObservers(t),e.preventDefault()},this.parseContent=this.parseSerializedObject,!(s=this.getScene())||!this._texture)return;this.applyYInversionOnUpdate=a,this._rootElement=s.getEngine().getInputElement();let _=t;this.useStandalone=!!_?.useStandalone,this.useStandalone||(this._renderObserver=s.onBeforeCameraRenderObservable.add(e=>this._checkUpdate(e))),this._controlAddedObserver=this._rootContainer.onControlAddedObservable.add(e=>{e&&(this._rootChildrenHaveChanged=!0)}),this._controlRemovedObserver=this._rootContainer.onControlRemovedObservable.add(e=>{e&&(this._rootChildrenHaveChanged=!0)}),this._preKeyboardObserver=s.onPreKeyboardObservable.add(e=>{if(!this.disableTabNavigation&&e.type===ep.TB.KEYDOWN&&"Tab"===e.event.code){let t=!e.event.shiftKey;if(t&&this._focusProperties.index===this._focusProperties.total-1||!t&&0===this._focusProperties.index&&this._focusProperties.total>0){this.focusedControl=null,this._focusProperties.index=0,this._focusProperties.total=-1;return}this._focusNextElement(t),e.event.preventDefault();return}this._focusedControl&&(e.type===ep.TB.KEYDOWN&&this._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)}),this._rootContainer._link(this),this.hasAlpha=!0,l&&h||(this._resizeObserver=s.getEngine().onResizeObservable.add(()=>this._onResize()),this._onResize()),this._texture.isReady=!0}getClassName(){return"AdvancedDynamicTexture"}executeOnAllControls(e,t){for(let i of(t||(t=this._rootContainer),e(t),t.children)){if(i.children){this.executeOnAllControls(e,i);continue}e(i)}}get useInvalidateRectOptimization(){return this._useInvalidateRectOptimization}set useInvalidateRectOptimization(e){this._useInvalidateRectOptimization=e}invalidateRect(e,t,i,s){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){let r=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,s));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=r-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new m(e,t,i-e+1,s-t+1)}markAsDirty(){this._isDirty=!0}createStyle(){return new eb(this)}addControl(e){return this._rootContainer.addControl(e),this}removeControl(e){return this._rootContainer.removeControl(e),this}moveToNonOverlappedPosition(e,t=1,i=1){let s;if(Array.isArray(e))s=e;else{let t=this.getDescendants(!0);s=void 0===e?t.filter(e=>void 0!==e.overlapGroup):t.filter(t=>t.overlapGroup===e)}for(let e of s){let r=l.I9.Zero(),o=new l.I9(e.centerX,e.centerY);for(let t of s)if(e!==t&&eS._Overlaps(e,t)){let e=o.subtract(new l.I9(t.centerX,t.centerY)),s=e.length();s>0&&(r=r.add(e.normalize().scale(i/s)))}r.length()>0&&(r=r.normalize().scale(t*(e.overlapDeltaMultiplier??1)),e.linkOffsetXInPixels+=r.x,e.linkOffsetYInPixels+=r.y)}}dispose(){let e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._prePointerObserver&&e.onPrePointerObservable.remove(this._prePointerObserver),this._sceneRenderObserver&&e.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&e.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._controlAddedObserver&&this._rootContainer.onControlAddedObservable.remove(this._controlAddedObserver),this._controlRemovedObserver&&this._rootContainer.onControlRemovedObservable.remove(this._controlRemovedObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),this.onGuiReadyObservable.clear(),super.dispose())}_onResize(){let e=this.getScene();if(!e)return;let t=e.getEngine();this.adjustToEngineHardwareScalingLevel&&(this._renderScale=t.getHardwareScalingLevel(),this._renderScale=1/Math.max(this._renderScale,t.getRenderWidth()/t.getCaps().maxTextureSize,t.getRenderHeight()/t.getCaps().maxTextureSize));let i=this.getSize(),s=t.getRenderWidth()*this._renderScale,r=t.getRenderHeight()*this._renderScale;if(this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/s,s=this._idealWidth):this._idealHeight&&(s=s*this._idealHeight/r,r=this._idealHeight)),i.width!==s||i.height!==r){if(this.scaleTo(s,r),this.adjustToEngineHardwareScalingLevel){let e=1/t.getHardwareScalingLevel(),i=this._renderScale*e;this._rootContainer.scaleX=i,this._rootContainer.scaleY=i,this._rootContainer.widthInPixels=s/i,this._rootContainer.heightInPixels=r/i}this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty(),this._alreadyRegisteredForRender||(this._alreadyRegisteredForRender=!0,_.S0.SetImmediate(()=>{this.update(this.applyYInversionOnUpdate,this.premulAlpha,eS.AllowGPUOptimizations),this._alreadyRegisteredForRender=!1}))}this.invalidateRect(0,0,i.width-1,i.height-1)}_getGlobalViewport(){let e=this.getSize(),t=this._fullscreenViewport.toGlobal(e.width,e.height),i=Math.round(t.width/this._rootContainer.scaleX),s=Math.round(t.height/this._rootContainer.scaleY),r=this._adjustToEngineHardwareScalingLevel?this._renderScale/(this.getScene()?.getEngine().getHardwareScalingLevel()||1):1;return t.x+=(t.width/r-i)/2,t.y+=(t.height/r-s)/2,t.width=i,t.height=s,t}getProjectedPosition(e,t){let i=this.getProjectedPositionWithZ(e,t);return new l.I9(i.x,i.y)}getProjectedPositionWithZ(e,t){let i=this.getScene();if(!i)return l.Pq.Zero();let s=this._getGlobalViewport(),r=l.Pq.Project(e,t,i.getTransformMatrix(),s);return new l.Pq(r.x,r.y,r.z)}_checkUpdate(e,t){if(!this._layerToDispose||!e||(e.layerMask&this._layerToDispose.layerMask)!=0){if(this._isFullscreen&&this._linkedControls.length){let e=this.getScene();if(!e)return;let t=this._getGlobalViewport();for(let i of this._linkedControls){if(!i.isVisible)continue;let s=i._linkedMesh;if(!s||s.isDisposed()){_.S0.SetImmediate(()=>{i.linkWithMesh(null)});continue}let r=s.getBoundingInfo?s.getBoundingInfo().boundingSphere.center:l.Pq.ZeroReadOnly,o=l.Pq.Project(r,s.getWorldMatrix(),e.getTransformMatrix(),t);if(o.z<0||o.z>1){i.notRenderable=!0;continue}i.notRenderable=!1,this.useInvalidateRectOptimization&&i.invalidateRect(),i._moveToProjectedPosition(o)}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(t),t||this.update(this.applyYInversionOnUpdate,this.premulAlpha,eS.AllowGPUOptimizations))}}_render(e){let t=this.getSize(),i=t.width,s=t.height,r=this.getContext();if(r.font="18px Arial",r.strokeStyle="white",this.onGuiReadyObservable.hasObservers()&&this._checkGuiIsReady(),this._rootChildrenHaveChanged){let e=this.getScene()?.activeCamera;e&&(this._rootChildrenHaveChanged=!1,this._checkUpdate(e,!0))}this.onBeginLayoutObservable.notifyObservers(this);let o=new m(0,0,i,s);this._numLayoutCalls=0,this._rootContainer._layout(o,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,e||(this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,i,s),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null)}_changeCursor(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)}_registerLastControlDown(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)}_doPicking(e,t,i,s,r,o,a,n){let l=this.getScene();if(!l||this.disablePicking)return;let _=l.getEngine(),d=this.getSize();if(this._isFullscreen){let i=l.cameraToUseForPointers||l.activeCamera;if(!i)return;let s=i.viewport;e*=d.width/(_.getRenderWidth()*s.width),t*=d.height/(_.getRenderHeight()*s.height)}if(this._capturingControl[r]){this._capturingControl[r].isPointerBlocker&&(this._shouldBlockPointer=!0),this._capturingControl[r]._processObservables(s,e,t,i,r,o);return}this._cursorChanged=!1,!this._rootContainer._processPicking(e,t,i,s,r,o,a,n)&&(l.doNotHandleCursors||this._changeCursor(""),s===h.Zp.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r],i),delete this._lastControlOver[r])),this._cursorChanged||l.doNotHandleCursors||this._changeCursor(""),this._manageFocus()}_cleanControlAfterRemovalFromList(e,t){for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&e[i]===t&&delete e[i]}_cleanControlAfterRemoval(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)}pick(e,t,i=null){this._isFullscreen&&this._scene&&this._translateToPicking(this._scene,new ex.L(0,0,0,0),i,e,t)}_translateToPicking(e,t,i,s=e.pointerX,r=e.pointerY){let o=e.cameraToUseForPointers||e.activeCamera,a=e.getEngine(),n=e.cameraToUseForPointers;if(o)if(o.rigCameras.length){let i=new ex.L(0,0,1,1);for(let n of o.rigCameras){n.viewport.toGlobalToRef(a.getRenderWidth(),a.getRenderHeight(),i);let o=s/a.getHardwareScalingLevel()-i.x,l=r/a.getHardwareScalingLevel()-(a.getRenderHeight()-i.y-i.height);if(o<0||l<0||s>i.width||r>i.height)return;e.cameraToUseForPointers=n,t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}}else o.viewport.toGlobalToRef(a.getRenderWidth(),a.getRenderHeight(),t);else t.x=0,t.y=0,t.width=a.getRenderWidth(),t.height=a.getRenderHeight();let l=s/a.getHardwareScalingLevel()-t.x,_=r/a.getHardwareScalingLevel()-(a.getRenderHeight()-t.y-t.height);if(this._shouldBlockPointer=!1,i){let e=i.event.pointerId||this._defaultMousePointerId;this._doPicking(l,_,i,i.type,e,i.event.button,i.event.deltaX,i.event.deltaY),(this._shouldBlockPointer&&!(i.type&this.skipBlockEvents)||this._capturingControl[e])&&(i.skipOnPointerObservable=!0)}else this._doPicking(l,_,null,h.Zp.POINTERMOVE,this._defaultMousePointerId,0);e.cameraToUseForPointers=n}attach(){let e=this.getScene();if(!e)return;let t=new ex.L(0,0,0,0);this._prePointerObserver=e.onPrePointerObservable.add(i=>{if((!e.isPointerCaptured(i.event.pointerId)||i.type!==h.Zp.POINTERUP||this._capturedPointerIds.has(i.event.pointerId))&&(i.type===h.Zp.POINTERMOVE||i.type===h.Zp.POINTERUP||i.type===h.Zp.POINTERDOWN||i.type===h.Zp.POINTERWHEEL||i.type===h.Zp.POINTERTAP)){if(i.type===h.Zp.POINTERMOVE){if(e.isPointerCaptured(i.event.pointerId))return;i.event.pointerId&&(this._defaultMousePointerId=i.event.pointerId)}this._translateToPicking(e,t,i)}}),this._attachPickingToSceneRender(e,()=>this._translateToPicking(e,t,null),!1),this._attachToOnPointerOut(e),this._attachToOnBlur(e)}_focusNextElement(e=!0){let t=[];if(this.executeOnAllControls(e=>{e.isFocusInvisible||!e.isVisible||e.tabIndex<0||t.push(e)}),0===t.length)return;t.sort((e,t)=>0===e.tabIndex?1:0===t.tabIndex?-1:e.tabIndex-t.tabIndex),this._focusProperties.total=t.length;let i=-1;this._focusedControl?(i=t.indexOf(this._focusedControl)+(e?1:-1))<0?i=t.length-1:i>=t.length&&(i=0):i=e?0:t.length-1,t[i].focus(),this._focusProperties.index=i}registerClipboardEvents(){self.addEventListener("copy",this._onClipboardCopy,!1),self.addEventListener("cut",this._onClipboardCut,!1),self.addEventListener("paste",this._onClipboardPaste,!1)}unRegisterClipboardEvents(){self.removeEventListener("copy",this._onClipboardCopy),self.removeEventListener("cut",this._onClipboardCut),self.removeEventListener("paste",this._onClipboardPaste)}_transformUvs(e){let t,i=this.getTextureMatrix();if(i.isIdentityAs3x2())t=e;else{let s=l.AA.Matrix[0];i.getRowToRef(0,l.AA.Vector4[0]),i.getRowToRef(1,l.AA.Vector4[1]),i.getRowToRef(2,l.AA.Vector4[2]);let r=l.AA.Vector4[0],o=l.AA.Vector4[1],a=l.AA.Vector4[2];s.setRowFromFloats(0,r.x,r.y,0,0),s.setRowFromFloats(1,o.x,o.y,0,0),s.setRowFromFloats(2,0,0,1,0),s.setRowFromFloats(3,a.x,a.y,0,1),t=l.AA.Vector2[0],l.I9.TransformToRef(e,s,t)}if((this.wrapU===E.g.WRAP_ADDRESSMODE||this.wrapU===E.g.MIRROR_ADDRESSMODE)&&t.x>1){let e=t.x-Math.trunc(t.x);this.wrapU===E.g.MIRROR_ADDRESSMODE&&Math.trunc(t.x)%2==1&&(e=1-e),t.x=e}if((this.wrapV===E.g.WRAP_ADDRESSMODE||this.wrapV===E.g.MIRROR_ADDRESSMODE)&&t.y>1){let e=t.y-Math.trunc(t.y);this.wrapV===E.g.MIRROR_ADDRESSMODE&&Math.trunc(t.x)%2==1&&(e=1-e),t.y=e}return t}attachToMesh(e,t=!0){let i=this.getScene();i&&(this._pointerObserver&&i.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=i.onPointerObservable.add(t=>{if(t.type!==h.Zp.POINTERMOVE&&t.type!==h.Zp.POINTERUP&&t.type!==h.Zp.POINTERDOWN&&t.type!==h.Zp.POINTERWHEEL)return;t.type===h.Zp.POINTERMOVE&&t.event.pointerId&&(this._defaultMousePointerId=t.event.pointerId);let i=t.event.pointerId||this._defaultMousePointerId;if(t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh===e){let e=t.pickInfo.getTextureCoordinates();if(e){e=this._transformUvs(e);let s=this.getSize();this._doPicking(e.x*s.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*s.height,t,t.type,i,t.event.button,t.event.deltaX,t.event.deltaY)}}else if(t.type===h.Zp.POINTERUP){if(this._lastControlDown[i]&&this._lastControlDown[i]._forcePointerUp(i),delete this._lastControlDown[i],this.focusedControl){let e=this.focusedControl.keepsFocusWith(),t=!0;if(e)for(let s of e){if(this===s._host)continue;let e=s._host;if(e._lastControlOver[i]&&e._lastControlOver[i].isAscendant(s)){t=!1;break}}t&&(this.focusedControl=null)}}else t.type===h.Zp.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i],t,!0),delete this._lastControlOver[i])}),e.enablePointerMoveEvents=t,this._attachPickingToSceneRender(i,()=>{let t=this._defaultMousePointerId,s=i?.pick(i.pointerX,i.pointerY);if(s&&s.hit&&s.pickedMesh===e){let e=s.getTextureCoordinates();if(e){e=this._transformUvs(e);let i=this.getSize();this._doPicking(e.x*i.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*i.height,null,h.Zp.POINTERMOVE,t,0)}}else this._lastControlOver[t]&&this._lastControlOver[t]._onPointerOut(this._lastControlOver[t],null,!0),delete this._lastControlOver[t]},!0),this._attachToOnPointerOut(i),this._attachToOnBlur(i))}moveFocusToControl(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0}_manageFocus(){if(this._blockNextFocusCheck){this._blockNextFocusCheck=!1,this._lastPickedControl=this._focusedControl;return}if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}}_attachPickingToSceneRender(e,t,i){this._sceneRenderObserver=e.onBeforeRenderObservable.add(()=>{this.checkPointerEveryFrame&&(this._linkedControls.length>0||i)&&t()})}_attachToOnPointerOut(e){this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add(e=>{this._lastControlOver[e.pointerId]&&this._lastControlOver[e.pointerId]._onPointerOut(this._lastControlOver[e.pointerId],null),delete this._lastControlOver[e.pointerId],this._lastControlDown[e.pointerId]&&this._lastControlDown[e.pointerId]!==this._capturingControl[e.pointerId]&&(this._lastControlDown[e.pointerId]._forcePointerUp(e.pointerId),delete this._lastControlDown[e.pointerId])})}_attachToOnBlur(e){this._canvasBlurObserver=e.getEngine().onCanvasBlurObservable.add(()=>{Object.entries(this._lastControlDown).forEach(([,e])=>{e._onCanvasBlur()}),this.focusedControl=null,this._lastControlDown={}})}serializeContent(){let e=this.getSize(),t={root:{},width:e.width,height:e.height};return this._rootContainer.serialize(t.root),t}parseSerializedObject(e,t,i){if(this._rootContainer=P.Parse(e.root,this,i),t){let t=e.width,i=e.height;"number"==typeof t&&"number"==typeof i&&t>=0&&i>=0?this.scaleTo(t,i):this.scaleTo(1920,1080)}}clone(e,t){let i,s=this.getScene();if(!s)return this;let r=this.getSize(),o=this.serializeContent();return(i=this._isFullscreen?eS.CreateFullscreenUI(e??"Clone of "+this.name):t?eS.CreateForMesh(t,r.width,r.height):new eS(e??"Clone of "+this.name,r.width,r.height,s,!this.noMipmap,this.samplingMode)).parseSerializedObject(o),i}static async ParseFromSnippetAsync(e,t,i,s){let r=i??eS.CreateFullscreenUI("ADT from snippet");if("_BLANK"===e)return r;let o=await eS._LoadURLContentAsync(eS.SnippetUrl+"/"+e.replace(/#/g,"/"),!0);return r.parseSerializedObject(o,t,s),r}async parseFromSnippetAsync(e,t,i){return await eS.ParseFromSnippetAsync(e,t,this,i)}static async ParseFromFileAsync(e,t,i,s){let r=i??eS.CreateFullscreenUI("ADT from URL"),o=await eS._LoadURLContentAsync(e);return r.parseSerializedObject(o,t,s),r}async parseFromURLAsync(e,t,i){return await eS.ParseFromFileAsync(e,t,this,i)}static async _LoadURLContentAsync(e,t=!1){if(""===e)throw Error("No URL provided");return await new Promise((i,s)=>{let r=new eC.u;r.addEventListener("readystatechange",()=>{if(4==r.readyState)if(200==r.status){let e;if(t){let t=JSON.parse(JSON.parse(r.responseText).jsonPayload);e=t.encodedGui?new TextDecoder("utf-8").decode((0,ey.yS)(t.encodedGui)):t.gui}else e=r.responseText;i(JSON.parse(e))}else s("Unable to load")}),r.open("GET",e),r.send()})}static _Overlaps(e,t){return!(e.centerX>t.centerX+t.widthInPixels||e.centerX+e.widthInPixels<t.centerX||e.centerY+e.heightInPixels<t.centerY||e.centerY>t.centerY+t.heightInPixels)}static CreateForMesh(e,t=1024,i=1024,s=!0,r=!1,o,a=this._CreateMaterial,n=E.g.TRILINEAR_SAMPLINGMODE){let l=(0,eT.z)(),h=new eS(`AdvancedDynamicTexture for ${e.name} [${l}]`,t,i,e.getScene(),!0,n,o);return a(e,l,h,r),h.attachToMesh(e,s),h}static _CreateMaterial(e,t,i,s){let r=(0,C.n9)("BABYLON.StandardMaterial");if(!r)throw"StandardMaterial needs to be imported before as it contains a side-effect required by your code.";let o=new r(`AdvancedDynamicTextureMaterial for ${e.name} [${t}]`,e.getScene());o.backFaceCulling=!1,o.diffuseColor=U.v9.Black(),o.specularColor=U.v9.Black(),s?(o.diffuseTexture=i,o.emissiveTexture=i,i.hasAlpha=!0):(o.emissiveTexture=i,o.opacityTexture=i),e.material=o}static CreateForMeshTexture(e,t=1024,i=1024,s=!0,r,o=E.g.TRILINEAR_SAMPLINGMODE){let a=new eS(e.name+" AdvancedDynamicTexture",t,i,e.getScene(),!0,o,r);return a.attachToMesh(e,s),a}static CreateFullscreenUI(e,t=!0,i=null,s=E.g.BILINEAR_SAMPLINGMODE,r=!1){let o=!i||i._isScene?new eS(e,0,0,i,!1,s):new eS(e,i),a=o.getScene(),n=new ev.W(e+"_layer",null,a,!t);return n.texture=o,o._layerToDispose=n,o._isFullscreen=!0,o.useStandalone&&(n.layerMask=0),o.adjustToEngineHardwareScalingLevel=r,o.attach(),o}scale(e){super.scale(e),this.markAsDirty()}scaleTo(e,t){super.scaleTo(e,t),this.markAsDirty()}_checkGuiIsReady(){this.guiIsReady()&&(this.onGuiReadyObservable.notifyObservers(this),this.onGuiReadyObservable.clear())}guiIsReady(){return this._rootContainer.isReady()}}eS.SnippetUrl=R.Y.SnippetUrl,eS.AllowGPUOptimizations=!0;var eP=i(5961);class eI{get renderTimeCounter(){return this._renderTime}get layoutTimeCounter(){return this._layoutTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(e){e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add(()=>{this._renderTime.beginMonitoring()}),this._onEndRenderObserver=this.texture.onEndRenderObservable.add(()=>{this._renderTime.endMonitoring(!0)})):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))}get captureLayoutTime(){return this._captureLayoutTime}set captureLayoutTime(e){e!==this._captureLayoutTime&&(this._captureLayoutTime=e,e?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add(()=>{this._layoutTime.beginMonitoring()}),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add(()=>{this._layoutTime.endMonitoring(!0)})):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))}constructor(e){this.texture=e,this._captureRenderTime=!1,this._renderTime=new eP.A,this._captureLayoutTime=!1,this._layoutTime=new eP.A,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}dispose(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null}}var eE=i(68355);class eR extends eE.L{get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._adt.disablePicking=e}get gui(){return this._adt}constructor(e,t,i){if(super(e,t),i){if(!i.useStandalone)throw Error(`AdvancedDynamicTexture "${e}": the texture must have been created with the useStandalone property set to true`)}else i=eS.CreateFullscreenUI(e,void 0,{useStandalone:!0});this._adt=i,this.outputTexture=this._frameGraph.textureManager.createDanglingHandle()}isReady(){return this._adt.guiIsReady()&&this._adt._layerToDispose.isReady()}record(){if(void 0===this.targetTexture)throw Error("FrameGraphGUITask: targetTexture is required");this._frameGraph.textureManager.resolveDanglingHandle(this.outputTexture,this.targetTexture);let e=this._frameGraph.addRenderPass(this.name);e.setRenderTarget(this.outputTexture),e.setExecuteFunc(e=>{this._adt._checkUpdate(null),e.render(this._adt._layerToDispose)});let t=this._frameGraph.addRenderPass(this.name+"_disabled",!0);t.setRenderTarget(this.outputTexture),t.setExecuteFunc(e=>{})}dispose(){this._adt.dispose(),super.dispose()}}var eM=i(95631),ew=i(21269);class eO extends eM.E{get task(){return this._frameGraphTask}get gui(){return this._frameGraphTask.gui}constructor(e,t,i){super(e,t,i),this.registerInput("target",ew.tp.Texture),this._addDependenciesInput(),this.registerOutput("output",ew.tp.BasedOnInput),this.target.addAcceptedConnectionPointTypes(ew.tp.TextureAll),this.output._typeConnectionSource=this.target,this._gui=eS.CreateFullscreenUI(this.name,void 0,{useStandalone:!0}),this._frameGraphTask=new eR(this.name,t,this._gui)}getClassName(){return"GUI.NodeRenderGraphGUIBlock"}get target(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e),this.output.value=this._frameGraphTask.outputTexture,this._frameGraphTask.targetTexture=this.target.connectedPoint?.value}}(0,C.Y5)("BABYLON.GUI.NodeRenderGraphGUIBlock",eO);let eB="XmlLoader Exception : XML file is malformed or corrupted.";class eA{constructor(e=null){this._nodes={},this._nodeTypes={element:1,attribute:2,text:3},this._isLoaded=!1,this._objectAttributes={textHorizontalAlignment:1,textVerticalAlignment:2,horizontalAlignment:3,verticalAlignment:4,stretch:5},e&&(this._parentClass=e)}_getChainElement(e){let t=window;this._parentClass&&(t=this._parentClass);let i=e;i=i.split(".");for(let e=0;e<i.length;e++)t=t[i[e]];return t}_getClassAttribute(e){let t=e.split(".");return(0,C.n9)("BABYLON.GUI."+t[0])[t[1]]}_createGuiElement(e,t,i=!0){try{let s=new((0,C.n9)("BABYLON.GUI."+e.nodeName));t&&i&&t.addControl(s);for(let t=0;t<e.attributes.length;t++)if(!e.attributes[t].name.toLowerCase().includes("datasource"))if(e.attributes[t].name.toLowerCase().includes("observable")){let i=this._getChainElement(e.attributes[t].value);s[e.attributes[t].name].add(i);continue}else if("linkWithMesh"==e.attributes[t].name)this._parentClass?s.linkWithMesh(this._parentClass[e.attributes[t].value]):s.linkWithMesh(window[e.attributes[t].value]);else if(e.attributes[t].value.match(/{{.*}}/)){let i=e.attributes[t].value.match(/{{(.*)}}/),r=this._getChainElement(i[1]);e.attributes[t].value.startsWith("{{")&&e.attributes[t].value.endsWith("}}")||(r=e.attributes[t].value.replace(/{{.*}}/,`${r}`)),s[e.attributes[t].name]=r}else this._objectAttributes[e.attributes[t].name]?s[e.attributes[t].name]=this._getClassAttribute(e.attributes[t].value):"true"==e.attributes[t].value||"false"==e.attributes[t].value?s[e.attributes[t].name]="true"==e.attributes[t].value:s[e.attributes[t].name]=isNaN(Number(e.attributes[t].value))?e.attributes[t].value:Number(e.attributes[t].value);if(!e.attributes.getNamedItem("id"))return this._nodes[e.nodeName+Object.keys(this._nodes).length+"_gen"]=s,s;let r=e.attributes.getNamedItem("id").value;if(r.startsWith("{{")&&r.endsWith("}}")&&(r=this._getChainElement(r.substring(2,r.length-2))),this._nodes[r])throw"XmlLoader Exception : Duplicate ID, every element should have an unique ID attribute";return this._nodes[r]=s,s}catch(t){throw"XmlLoader Exception : Error parsing Control "+e.nodeName+","+t+"."}}_parseGrid(e,t,i){let s,r,o,a,n,l=e.children,h=!1,_=-1,d=-1,c=0;for(let e=0;e<l.length;e++)if(l[e].nodeType==this._nodeTypes.element){if("Row"!=l[e].nodeName)throw"XmlLoader Exception : Expecting Row node, received "+l[e].nodeName;if(_+=1,o=l[e].children,!l[e].attributes.getNamedItem("height"))throw"XmlLoader Exception : Height must be defined for grid rows";r=Number(l[e].attributes.getNamedItem("height").nodeValue),h=!!l[e].attributes.getNamedItem("isPixel")&&JSON.parse(l[e].attributes.getNamedItem("isPixel").nodeValue),t.addRowDefinition(r,h);for(let e=0;e<o.length;e++)if(o[e].nodeType==this._nodeTypes.element){if("Column"!=o[e].nodeName)throw"XmlLoader Exception : Expecting Column node, received "+o[e].nodeName;if(d+=1,_>0&&d>c)throw"XmlLoader Exception : In the Grid element, the number of columns is defined in the first row, do not add more columns in the subsequent rows.";if(0==_){if(!o[e].attributes.getNamedItem("width"))throw"XmlLoader Exception : Width must be defined for all the grid columns in the first row";s=Number(o[e].attributes.getNamedItem("width").nodeValue),h=!!o[e].attributes.getNamedItem("isPixel")&&JSON.parse(o[e].attributes.getNamedItem("isPixel").nodeValue),t.addColumnDefinition(s,h)}a=o[e].children;for(let e=0;e<a.length;e++)a[e].nodeType==this._nodeTypes.element&&(n=this._createGuiElement(a[e],t,!1),t.addControl(n,_,d),a[e].firstChild&&this._parseXml(a[e].firstChild,n))}0==_&&(c=d),d=-1}e.nextSibling&&this._parseXml(e.nextSibling,i)}_parseElement(e,t,i){e.firstChild&&this._parseXml(e.firstChild,t),e.nextSibling&&this._parseXml(e.nextSibling,i)}_prepareSourceElement(e,t,i,s,r){this._parentClass?this._parentClass[i]=s[r]:window[i]=s[r],e.firstChild&&this._parseXml(e.firstChild,t,!0)}_parseElementsFromSource(e,t,i){let s=e.attributes.getNamedItem("dataSource").value;if(s.includes(" in ")){let r=!0,o=s.split(" in ");if(o.length<2)throw"XmlLoader Exception : Malformed XML, Data Source must have an iterator and a source";let a=o[1];if(a.startsWith("{")&&a.endsWith("}")&&(r=!1),(!r||a.startsWith("[")&&a.endsWith("]"))&&(a=a.substring(1,a.length-1)),a=this._parentClass?this._parentClass[a]:window[a],r)for(let i=0;i<a.length;i++)this._prepareSourceElement(e,t,o[0],a,i);else for(let i in a)this._prepareSourceElement(e,t,o[0],a,i);e.nextSibling&&this._parseXml(e.nextSibling,i)}else throw"XmlLoader Exception : Malformed XML, Data Source must include an in"}_parseXml(e,t,i=!1){if(e.nodeType!=this._nodeTypes.element){e.nextSibling&&this._parseXml(e.nextSibling,t,i);return}i&&e.setAttribute("id",t.id+(t._children.length+1));let s=this._createGuiElement(e,t);this._rootNode||(this._rootNode=s),"Grid"==e.nodeName?this._parseGrid(e,s,t):e.attributes.getNamedItem("dataSource")?this._parseElementsFromSource(e,s,t):this._parseElement(e,s,t)}isLoaded(){return this._isLoaded}getNodeById(e){return this._nodes[e]}getNodes(){return this._nodes}dispose(){this._rootNode&&(this._rootNode.dispose(),this._rootNode=null,this._nodes={})}loadLayout(e,t,i=null,s=null){let r=new XMLHttpRequest;r.onload=()=>{if(4===r.readyState&&200===r.status){if(!r.responseXML)if(s)return void s(eB);else throw eB;let e=r.responseXML.documentElement;this._parseXml(e.firstChild,t),this._isLoaded=!0,i&&i()}},r.onerror=function(){s&&s("an error occurred during loading the layout")},r.open("GET",e,!0),r.send()}async loadLayoutAsync(e,t){return await new Promise((i,s)=>{this.loadLayout(e,t,i,s)})}}var eF=i(77905);class eL extends l.Pq{constructor(e,t=0){super(e.x,e.y,e.z),this.buttonIndex=t}}class eN{get position(){return this._node?this._node.position:(this._position=this._position||l.Pq.Zero(),this._position)}set position(e){this._position=e,this._node&&(this._node.position=this._position)}get scaling(){return this._node?this._node.scaling:(this._scaling=this.scaling||new l.Pq(1,1,1),this._scaling)}set scaling(e){this._scaling=e,this._node&&(this._isScaledByManager=!1,this._node.scaling=this._scaling)}get behaviors(){return this._behaviors}addBehavior(e){if(-1!==this._behaviors.indexOf(e))return this;e.init();let t=this._host.scene;return t.isLoading?t.onDataLoadedObservable.addOnce(()=>{e.attach(this)}):e.attach(this),this._behaviors.push(e),this}removeBehavior(e){let t=this._behaviors.indexOf(e);return -1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}getBehaviorByName(e){for(let t of this._behaviors)if(t.name===e)return t;return null}get isVisible(){return this._isVisible}set isVisible(e){if(this._isVisible===e)return;this._isVisible=e;let t=this.mesh;t&&t.setEnabled(e)}constructor(e){this.name=e,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this._isScaledByManager=!1,this.onPointerMoveObservable=new n.cP,this.onPointerOutObservable=new n.cP,this.onPointerDownObservable=new n.cP,this.onPointerUpObservable=new n.cP,this.onPointerClickObservable=new n.cP,this.onPointerEnterObservable=new n.cP,this._behaviors=[]}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}_getTypeName(){return"Control3D"}get node(){return this._node}get mesh(){return this._node instanceof X.u?this._node:null}linkToTransformNode(e){return this._node&&(this._node.parent=e),this}_prepareNode(e){if(!this._node){if(this._node=this._createNode(e),!this.node)return;this._position&&(this.node.position=this._position),this._scaling&&(this.node.scaling=this._scaling),this._injectGUI3DReservedDataStore(this.node).control=this;let t=this.mesh;t&&(t.isPickable=!0,this._affectMaterial(t))}}_injectGUI3DReservedDataStore(e){return e.reservedDataStore=e.reservedDataStore??{},e.reservedDataStore.GUI3D=e.reservedDataStore.GUI3D??{},e.reservedDataStore.GUI3D}_createNode(e){return null}_affectMaterial(e){e.material=null}_isTouchButton3D(e){return void 0!==e._generatePointerEventType}_onPointerMove(e,t){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)}_onPointerEnter(e){return -1===this._enterCount&&(this._enterCount=0),this._enterCount++,!(this._enterCount>1)&&(this.onPointerEnterObservable.notifyObservers(this,-1,e,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)}_onPointerOut(e){this._enterCount--,!(this._enterCount>0)&&(this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,e,this),this.pointerOutAnimation&&this.pointerOutAnimation())}_onPointerDown(e,t,i,s){return this._downCount++,this._downPointerIds[i]=this._downPointerIds[i]+1||1,1===this._downCount&&(this.onPointerDownObservable.notifyObservers(new eL(t,s),-1,e,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)}_onPointerUp(e,t,i,s,r){if(this._downCount--,this._downPointerIds[i]--,this._downPointerIds[i]<=0&&delete this._downPointerIds[i],this._downCount<0){this._downCount=0;return}0==this._downCount&&(r&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new eL(t,s),-1,e,this),this.onPointerUpObservable.notifyObservers(new eL(t,s),-1,e,this),this.pointerUpAnimation&&this.pointerUpAnimation())}forcePointerUp(e=null){if(null!==e)this._onPointerUp(this,l.Pq.Zero(),e,0,!0);else{for(let e in this._downPointerIds)this._onPointerUp(this,l.Pq.Zero(),+e,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,l.Pq.Zero(),0,0,!0))}}_processObservables(e,t,i,s,r){if(this._isTouchButton3D(this)&&i&&(e=this._generatePointerEventType(e,i,this._downCount)),e===h.Zp.POINTERMOVE){this._onPointerMove(this,t);let e=this._host._lastControlOver[s];return e&&e!==this&&e._onPointerOut(this),e!==this&&this._onPointerEnter(this),this._host._lastControlOver[s]=this,!0}return e===h.Zp.POINTERDOWN?(this._onPointerDown(this,t,s,r),this._host._lastControlDown[s]=this,this._host._lastPickedControl=this,!0):(e===h.Zp.POINTERUP||e===h.Zp.POINTERDOUBLETAP)&&(this._host._lastControlDown[s]&&this._host._lastControlDown[s]._onPointerUp(this,t,s,r,!0),delete this._host._lastControlDown[s],!0)}_disposeNode(){this._node&&(this._node.dispose(),this._node=null)}dispose(){for(let e of(this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode(),this._behaviors))e.detach()}}class eD extends eN{constructor(){super(...arguments),this._contentResolution=512,this._contentScaleRatio=2}get content(){return this._content}set content(e){if(this._content=e,e&&this._host&&this._host.utilityLayer){if(this._facadeTexture)this._facadeTexture.rootContainer.clearControls();else{let e="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.width,t="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.height;this._facadeTexture=new eS("Facade",e,t,this._host.utilityLayer.utilityLayerScene,!0,E.g.TRILINEAR_SAMPLINGMODE),this._setFacadeTextureScaling(),this._facadeTexture.premulAlpha=!0}this._facadeTexture.addControl(e),this._applyFacade(this._facadeTexture)}}_setFacadeTextureScaling(){this._facadeTexture&&("number"!=typeof this._contentResolution&&(this._contentScaleRatioY=this._contentResolution.height/this._contentResolution.width*this._contentScaleRatio),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatioY??this._contentScaleRatio)}get contentResolution(){return this._contentResolution}set contentResolution(e){let t="number"==typeof e?e:e.width,i="number"==typeof e?e:e.height,s="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.width,r="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.height;(t!==s||i!==r)&&(this._contentResolution=e,this._resetContent())}_disposeFacadeTexture(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)}_resetContent(){this._disposeFacadeTexture(),this.content=this._content}_applyFacade(e){}}class ek extends eD{constructor(e){super(e)}_getTypeName(){return"AbstractButton3D"}_createNode(e){return new eF.V("button"+this.name,e)}}var eV=i(33776),eU=i(78684);class ez extends ek{constructor(e,t){super(e),this._options={width:1,height:1,depth:.08,...t},this.pointerEnterAnimation=()=>{this.mesh&&(this._currentMaterial.emissiveColor=U.v9.Red())},this.pointerOutAnimation=()=>{this._currentMaterial.emissiveColor=U.v9.Black()},this.pointerDownAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(.95)},this.pointerUpAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/.95)}}_applyFacade(e){this._currentMaterial.emissiveTexture=e}_getTypeName(){return"Button3D"}_createNode(e){let t=Array(6);for(let e=0;e<6;e++)t[e]=new l.IU(0,0,0,0);e.useRightHandedSystem?t[0].copyFromFloats(1,0,0,1):t[1].copyFromFloats(0,0,1,1);let i=(0,eV.an)(this.name+"_rootMesh",{width:this._options.width,height:this._options.height,depth:this._options.depth,faceUV:t,wrap:!0},e);return this._contentScaleRatioY=this._contentScaleRatio*this._options.width/this._options.height,this._setFacadeTextureScaling(),i}_affectMaterial(e){let t=new eU.F(this.name+"Material",e.getScene());t.specularColor=U.v9.Black(),e.material=t,this._currentMaterial=t,this._resetContent()}dispose(){super.dispose(),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()}}class eW extends eN{get children(){return this._children}get blockLayout(){return this._blockLayout}set blockLayout(e){this._blockLayout!==e&&(this._blockLayout=e,this._blockLayout||this._arrangeChildren())}constructor(e){super(e),this._blockLayout=!1,this._children=[]}updateLayout(){return this._arrangeChildren(),this}containsControl(e){return -1!==this._children.indexOf(e)}addControl(e){return -1!==this._children.indexOf(e)||(e.parent=this,e._host=this._host,this._children.push(e),this._host.utilityLayer&&(e._prepareNode(this._host.utilityLayer.utilityLayerScene),e.node&&(e.node.parent=this.node),this.blockLayout||this._arrangeChildren())),this}_arrangeChildren(){}_createNode(e){return new eF.V("ContainerNode",e)}removeControl(e){let t=this._children.indexOf(e);return -1!==t&&(this._children.splice(t,1),e.parent=null,e._disposeNode()),this}_getTypeName(){return"Container3D"}dispose(){for(let e of this._children)e.dispose();this._children.length=0,super.dispose()}}eW.UNSET_ORIENTATION=0,eW.FACEORIGIN_ORIENTATION=1,eW.FACEORIGINREVERSED_ORIENTATION=2,eW.FACEFORWARD_ORIENTATION=3,eW.FACEFORWARDREVERSED_ORIENTATION=4;class eQ extends eW{get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}get columns(){return this._columns}set columns(e){this._columns!==e&&(this._columns=e,this._rowThenColum=!0,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}get rows(){return this._rows}set rows(e){this._rows!==e&&(this._rows=e,this._rowThenColum=!1,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}constructor(e){super(e),this._columns=10,this._rows=0,this._rowThenColum=!0,this._orientation=eW.FACEORIGIN_ORIENTATION,this.margin=0}_arrangeChildren(){this._cellWidth=0,this._cellHeight=0;let e=0,t=0,i=0;for(let e of this._children){if(!e.mesh)continue;i++,e.mesh.computeWorldMatrix(!0);let t=e.mesh.getBoundingInfo().boundingBox.extendSize;for(let i of e.mesh.getDescendants(!1))if(i.computeWorldMatrix(!0),"function"==typeof i.getBoundingInfo){let e=i.getBoundingInfo().boundingBox.extendSize;t.x=Math.max(t.x,e.x),t.y=Math.max(t.y,e.y),t.z=Math.max(t.z,e.z)}this._cellWidth=Math.max(this._cellWidth,2*t.x),this._cellHeight=Math.max(this._cellHeight,2*t.y)}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(t=this._columns,e=Math.ceil(i/this._columns)):(e=this._rows,t=Math.ceil(i/this._rows));let s=.5*t*this._cellWidth,r=.5*e*this._cellHeight,o=[],a=0;if(this._rowThenColum)for(let n=0;n<e;n++)for(let e=0;e<t&&(o.push(new l.Pq(e*this._cellWidth-s+this._cellWidth/2,n*this._cellHeight-r+this._cellHeight/2,0)),!(++a>i));e++);else for(let n=0;n<t;n++)for(let t=0;t<e&&(o.push(new l.Pq(n*this._cellWidth-s+this._cellWidth/2,t*this._cellHeight-r+this._cellHeight/2,0)),!(++a>i));t++);for(let e of(a=0,this._children))e.mesh&&(this._mapGridNode(e,o[a]),a++);this._finalProcessing()}_finalProcessing(){}}var eG=i(7804);class eH extends eQ{constructor(){super(...arguments),this._radius=5}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}_mapGridNode(e,t){let i=e.mesh;if(!i)return;let s=this._cylindricalMapping(t);switch(e.position=s,this.orientation){case eW.FACEORIGIN_ORIENTATION:i.lookAt(new l.Pq(2*s.x,s.y,2*s.z));break;case eW.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new l.Pq(-s.x,s.y,-s.z));break;case eW.FACEFORWARD_ORIENTATION:break;case eW.FACEFORWARDREVERSED_ORIENTATION:i.rotate(eG._0.Y,Math.PI,0)}}_cylindricalMapping(e){let t=new l.Pq(0,e.y,this._radius),i=e.x/this._radius;return l.uq.RotationYawPitchRollToRef(i,0,0,l.AA.Matrix[0]),l.Pq.TransformNormal(t,l.AA.Matrix[0])}}var eK=i(29218),eX=i(22740),eY=i(91813),eq=i(77633),ej=i(52019);let e$="fluentVertexShader",eZ=`precision highp float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 world;uniform mat4 viewProjection;varying vec2 vUV;
#ifdef BORDER
varying vec2 scaleInfo;uniform float borderWidth;uniform vec3 scaleFactor;
#endif
#ifdef HOVERLIGHT
varying vec3 worldPosition;
#endif
void main(void) {vUV=uv;
#ifdef BORDER
vec3 scale=scaleFactor;float minScale=min(min(scale.x,scale.y),scale.z);float maxScale=max(max(scale.x,scale.y),scale.z);float minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);float areaYZ=scale.y*scale.z;float areaXZ=scale.x*scale.z;float areaXY=scale.x*scale.y;float scaledBorderWidth=borderWidth; 
if (abs(normal.x)==1.0) 
{scale.x=scale.y;scale.y=scale.z;if (areaYZ>areaXZ && areaYZ>areaXY)
{scaledBorderWidth*=minOverMiddleScale;}}
else if (abs(normal.y)==1.0) 
{scale.x=scale.z;if (areaXZ>areaXY && areaXZ>areaYZ)
{scaledBorderWidth*=minOverMiddleScale;}}
else 
{if (areaXY>areaYZ && areaXY>areaXZ)
{scaledBorderWidth*=minOverMiddleScale;}}
float scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);if (scale.x>scale.y)
{scaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);scaleInfo.y=1.0-scaledBorderWidth;}
else
{scaleInfo.x=1.0-scaledBorderWidth;scaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);} 
#endif 
vec4 worldPos=world*vec4(position,1.0);
#ifdef HOVERLIGHT
worldPosition=worldPos.xyz;
#endif
gl_Position=viewProjection*worldPos;}
`;ej.l.ShadersStore[e$]||(ej.l.ShadersStore[e$]=eZ);let eJ="fluentPixelShader",e0=`precision highp float;varying vec2 vUV;uniform vec4 albedoColor;
#ifdef INNERGLOW
uniform vec4 innerGlowColor;
#endif
#ifdef BORDER
varying vec2 scaleInfo;uniform float edgeSmoothingValue;uniform float borderMinValue;
#endif
#ifdef HOVERLIGHT
varying vec3 worldPosition;uniform vec3 hoverPosition;uniform vec4 hoverColor;uniform float hoverRadius;
#endif
#ifdef TEXTURE
uniform sampler2D albedoSampler;uniform mat4 textureMatrix;vec2 finalUV;
#endif
void main(void) {vec3 albedo=albedoColor.rgb;float alpha=albedoColor.a;
#ifdef TEXTURE
finalUV=vec2(textureMatrix*vec4(vUV,1.0,0.0));albedo=texture2D(albedoSampler,finalUV).rgb;
#endif
#ifdef HOVERLIGHT
float pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;albedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);
#else
float pointToHover=1.0;
#endif
#ifdef BORDER 
float borderPower=10.0;float inverseBorderPower=1.0/borderPower;vec3 borderColor=albedo*borderPower;vec2 distanceToEdge;distanceToEdge.x=abs(vUV.x-0.5)*2.0;distanceToEdge.y=abs(vUV.y-0.5)*2.0;float borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),
smoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));borderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover); 
albedo+=borderColor;alpha=max(alpha,borderValue);
#endif
#ifdef INNERGLOW
vec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);uvGlow=uvGlow*uvGlow;uvGlow=uvGlow*uvGlow;albedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y); 
#endif
gl_FragColor=vec4(albedo,alpha);}`;ej.l.ShadersStore[eJ]||(ej.l.ShadersStore[eJ]=e0);var e1=i(50754);class e2 extends eX.M{constructor(){super(),this.INNERGLOW=!1,this.BORDER=!1,this.HOVERLIGHT=!1,this.TEXTURE=!1,this.rebuild()}}class e3 extends eY.E{constructor(e,t){super(e,t),this.innerGlowColorIntensity=.5,this.innerGlowColor=new U.v9(1,1,1),this.albedoColor=new U.v9(.3,.35,.4),this.renderBorders=!1,this.borderWidth=.5,this.edgeSmoothingValue=.02,this.borderMinValue=.1,this.renderHoverLight=!1,this.hoverRadius=.01,this.hoverColor=new U.ov(.3,.3,.3,1),this.hoverPosition=l.Pq.Zero()}needAlphaBlending(){return 1!==this.alpha}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new e2);let s=this.getScene(),r=t.materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&r._renderId===s.getRenderId())return!0;if(r._areTexturesDirty)if(r.INNERGLOW=this.innerGlowColorIntensity>0,r.BORDER=this.renderBorders,r.HOVERLIGHT=this.renderHoverLight,this._albedoTexture)if(!this._albedoTexture.isReadyOrNotBlocking())return!1;else r.TEXTURE=!0;else r.TEXTURE=!1;let o=s.getEngine();if(r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();let e=[eq.R.PositionKind];e.push(eq.R.NormalKind),e.push(eq.R.UVKind);let i=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius","textureMatrix"],a=["albedoSampler"],n=[];(0,e1.Bb)({uniformsNames:i,uniformBuffersNames:n,samplers:a,defines:r,maxSimultaneousLights:4});let l=r.toString();t.setEffect(s.getEngine().createEffect("fluent",{attributes:e,uniformsNames:i,uniformBuffersNames:n,samplers:a,defines:l,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._mustRebind(s,o,i)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),r.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),r.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),t.getBoundingInfo().boundingBox.extendSize.multiplyToRef(t.scaling,l.AA.Vector3[0]),this._activeEffect.setVector3("scaleFactor",l.AA.Vector3[0])),r.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),r.TEXTURE&&this._albedoTexture)){this._activeEffect.setTexture("albedoSampler",this._albedoTexture);let e=this._albedoTexture.getTextureMatrix();this._activeEffect.setMatrix("textureMatrix",e)}this._afterBind(t,this._activeEffect,i)}}getActiveTextures(){return super.getActiveTextures()}hasTexture(e){return!!super.hasTexture(e)}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new e3(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.GUI.FluentMaterial",e}getClassName(){return"FluentMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new e3(e.name,t),e,t,i)}}(0,o.Cg)([(0,T.lK)(),(0,T.$z)("_markAllSubMeshesAsTexturesDirty")],e3.prototype,"innerGlowColorIntensity",void 0),(0,o.Cg)([(0,T.jT)()],e3.prototype,"innerGlowColor",void 0),(0,o.Cg)([(0,T.jT)()],e3.prototype,"albedoColor",void 0),(0,o.Cg)([(0,T.lK)(),(0,T.$z)("_markAllSubMeshesAsTexturesDirty")],e3.prototype,"renderBorders",void 0),(0,o.Cg)([(0,T.lK)()],e3.prototype,"borderWidth",void 0),(0,o.Cg)([(0,T.lK)()],e3.prototype,"edgeSmoothingValue",void 0),(0,o.Cg)([(0,T.lK)()],e3.prototype,"borderMinValue",void 0),(0,o.Cg)([(0,T.lK)(),(0,T.$z)("_markAllSubMeshesAsTexturesDirty")],e3.prototype,"renderHoverLight",void 0),(0,o.Cg)([(0,T.lK)()],e3.prototype,"hoverRadius",void 0),(0,o.Cg)([(0,T.qK)()],e3.prototype,"hoverColor",void 0),(0,o.Cg)([(0,T.P_)()],e3.prototype,"hoverPosition",void 0),(0,o.Cg)([(0,T.uM)("albedoTexture")],e3.prototype,"_albedoTexture",void 0),(0,o.Cg)([(0,T.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],e3.prototype,"albedoTexture",void 0),(0,C.Y5)("BABYLON.GUI.FluentMaterial",e3);class e4 extends eQ{get backPlateMargin(){return this._backPlateMargin}set backPlateMargin(e){if(this._backPlateMargin=e,this._children.length>=1){for(let e of this.children)this._updateCurrentMinMax(e.position);this._updateMargins()}}_createNode(e){let t=new eK.e(`menu_${this.name}`,e);return this._backPlate=(0,eV.an)("backPlate"+this.name,{size:1},e),this._backPlate.parent=t,t}_affectMaterial(e){this._backPlateMaterial=new e3(this.name+"backPlateMaterial",e.getScene()),this._backPlateMaterial.albedoColor=new U.v9(.08,.15,.55),this._backPlateMaterial.renderBorders=!0,this._backPlateMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add(e=>{e?(this._backPlateMaterial.hoverPosition=e,this._backPlateMaterial.hoverColor.a=1):this._backPlateMaterial.hoverColor.a=0}),this._backPlate.material=this._backPlateMaterial}_mapGridNode(e,t){e.mesh&&(e.position=t.clone(),this._updateCurrentMinMax(t))}_finalProcessing(){this._updateMargins()}_updateCurrentMinMax(e){this._currentMin||(this._currentMin=e.clone(),this._currentMax=e.clone()),this._currentMin.minimizeInPlace(e),this._currentMax.maximizeInPlace(e)}_updateMargins(){if(this._children.length>0){this._currentMin.addInPlaceFromFloats(-this._cellWidth/2,-this._cellHeight/2,0),this._currentMax.addInPlaceFromFloats(this._cellWidth/2,this._cellHeight/2,0);let e=this._currentMax.subtract(this._currentMin);this._backPlate.scaling.x=e.x+this._cellWidth*this.backPlateMargin,this._backPlate.scaling.y=e.y+this._cellHeight*this.backPlateMargin,this._backPlate.scaling.z=.001;for(let t=0;t<this._children.length;t++)this._children[t].position.subtractInPlace(this._currentMin).subtractInPlace(e.scale(.5)),this._children[t].position.z-=.01}this._currentMin=null,this._currentMax=null}constructor(e){super(e),this._backPlateMargin=1.25}addButton(e){let t=this.blockLayout;return t||(this.blockLayout=!0),super.addControl(e),e.isBackplateVisible=!1,e.scaling.scaleInPlace(e4.MENU_BUTTON_SCALE),t||(this.blockLayout=!1),this}addControl(e){return a.V.Warn("TouchHolographicMenu can only contain buttons. Please use the method `addButton` instead."),this}dispose(){super.dispose(),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver)}}e4.MENU_BUTTON_SCALE=1;var e5=i(76767);class e9 extends e4{get handConstraintBehavior(){return this._handConstraintBehavior}_createNode(e){let t=super._createNode(e);return this._handConstraintBehavior.attach(t),t}constructor(e,t){super(t),this._handConstraintBehavior=new e5.Re,this._handConstraintBehavior.linkToXRExperience(e),this.backPlateMargin=.15,this.rows=3}dispose(){super.dispose(),this._handConstraintBehavior.detach()}}var e8=i(86764);let e7="fluentBackplatePixelShader",e6=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Round_Rect_Fragment_B31(
float Radius,
float Line_Width,
vec4 Line_Color,
float Filter_Width,
vec2 UV,
float Line_Visibility,
vec4 Rect_Parms,
vec4 Fill_Color,
out vec4 Color)
{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}
void Blob_Fragment_B71(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void Line_Fragment_B48(
vec4 Base_Color,
vec4 Highlight_Color,
float Highlight_Width,
vec3 Line_Vertex,
float Highlight,
out vec4 Line_Color)
{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}
void Scale_RGB_B54(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Conditional_Float_B38(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void main()
{float R_Q72;float G_Q72;float B_Q72;float A_Q72;R_Q72=vColor.r; G_Q72=vColor.g; B_Q72=vColor.b; A_Q72=vColor.a;vec4 Blob_Color_Q71;
#if BLOB_ENABLE
float k1=dot(vExtra2.xy,vExtra2.xy);float k2=dot(vExtra3.xy,vExtra3.xy);vec3 closer=k1<k2 ? vec3(k1,vExtra2.z,vExtra2.w) : vec3(k2,vExtra3.z,vExtra3.w);Blob_Color_Q71=closer.z*texture(_Blob_Texture_,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);
#else
Blob_Color_Q71=vec4(0,0,0,0);
#endif
vec4 Line_Color_Q48;Line_Fragment_B48(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q48);float X_Q67;float Y_Q67;X_Q67=vUV.x;Y_Q67=vUV.y;vec3 Incident_Q66=normalize(vPosition-cameraPosition);vec3 Reflected_Q60=reflect(Incident_Q66,vBinormal);float Product_Q63=Y_Q67*_Vertical_Offset_;float Dot_Q68=dot(Incident_Q66, Reflected_Q60);float Dot_Q57=dot(vNormal, Incident_Q66);float Result_Q38;Conditional_Float_B38(_Reflected_,Dot_Q68,Dot_Q57,Result_Q38);float Product_Q64=Result_Q38*_Frequency_;float Sum_Q69=Product_Q64+1.0;float Product_Q70=Sum_Q69*0.5;float Sum_Q62=Product_Q63+Product_Q70;float FractF_Q59=fract(Sum_Q62);vec2 Vec2_Q65=vec2(FractF_Q59,0.5);vec4 Color_Q58;
#if IRIDESCENT_MAP_ENABLE
Color_Q58=texture(_Iridescent_Map_,Vec2_Q65);
#else
Color_Q58=vec4(0,0,0,0);
#endif
vec4 Result_Q54;Scale_RGB_B54(Color_Q58,_Iridescence_Edge_Intensity_,Result_Q54);vec4 Result_Q55;Scale_RGB_B54(Color_Q58,_Iridescence_Intensity_,Result_Q55);vec4 Base_And_Iridescent_Q53;Base_And_Iridescent_Q53=Line_Color_Q48+vec4(Result_Q54.rgb,0.0);vec4 Base_And_Iridescent_Q56;Base_And_Iridescent_Q56=_Base_Color_+vec4(Result_Q55.rgb,0.0);vec4 Result_Q52=Base_And_Iridescent_Q53; Result_Q52.a=1.0;vec4 Result_Q35=Blob_Color_Q71+(1.0-Blob_Color_Q71.a)*Base_And_Iridescent_Q56;vec4 Color_Q31;Round_Rect_Fragment_B31(R_Q72,G_Q72,Result_Q52,_Filter_Width_,vUV,1.0,vExtra1,Result_Q35,Color_Q31);vec4 Result_Q47=_Fade_Out_*Color_Q31;vec4 Out_Color=Result_Q47;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[e7]||(ej.l.ShadersStore[e7]=e6);let te="fluentBackplateVertexShader",tt=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B115(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void PickDir_B140(
float Degrees,
vec3 DirX,
vec3 DirY,
out vec3 Dir)
{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}
void Round_Rect_Vertex_B139(
vec2 UV,
float Radius,
float Margin,
float Anisotropy,
float Gradient1,
float Gradient2,
out vec2 Rect_UV,
out vec4 Rect_Parms,
out vec2 Scale_XY,
out vec2 Line_UV)
{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; 
Rect_Parms.w=Gradient2;}
void Line_Vertex_B135(
vec2 Scale_XY,
vec2 UV,
float Time,
float Rate,
vec4 Highlight_Transform,
out vec3 Line_Vertex)
{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }
void Blob_Vertex_B180(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob=Blob_Position;vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B129(
float Anisotropy,
vec3 P,
float Radius,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}
void Object_To_World_Dir_B132(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void RelativeOrAbsoluteDetail_B147(
float Nominal_Radius,
float Nominal_LineWidth,
bool Absolute_Measurements,
float Height,
out float Radius,
out float Line_Width)
{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}
void Edge_AA_Vertex_B130(
vec3 Position_World,
vec3 Position_Object,
vec3 Normal_Object,
vec3 Eye,
float Radial_Gradient,
vec3 Radial_Dir,
vec3 Tangent,
out float Gradient1,
out float Gradient2)
{vec3 I=(Eye-Position_World);vec3 T=(world* vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { 
Gradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}
void Pick_Radius_B144(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void main()
{vec3 Nrm_World_Q128;Nrm_World_Q128=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q131;vec3 Tangent_World_N_Q131;float Tangent_Length_Q131;Tangent_World_Q131=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q131=length(Tangent_World_Q131);Tangent_World_N_Q131=Tangent_World_Q131/Tangent_Length_Q131;vec3 Binormal_World_Q132;vec3 Binormal_World_N_Q132;float Binormal_Length_Q132;Object_To_World_Dir_B132(vec3(0,1,0),Binormal_World_Q132,Binormal_World_N_Q132,Binormal_Length_Q132);float Anisotropy_Q133=Tangent_Length_Q131/Binormal_Length_Q132;vec3 Result_Q177;Result_Q177=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(_Use_Global_Left_Index_));vec3 Result_Q178;Result_Q178=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(_Use_Global_Right_Index_));float Result_Q144;Pick_Radius_B144(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q144);vec3 Dir_Q140;PickDir_B140(_Angle_,Tangent_World_N_Q131,Binormal_World_N_Q132,Dir_Q140);float Radius_Q147;float Line_Width_Q147;RelativeOrAbsoluteDetail_B147(Result_Q144,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q132,Radius_Q147,Line_Width_Q147);vec4 Out_Color_Q145=vec4(Radius_Q147,Line_Width_Q147,0,1);vec3 New_P_Q129;vec2 New_UV_Q129;float Radial_Gradient_Q129;vec3 Radial_Dir_Q129;Move_Verts_B129(Anisotropy_Q133,position,Radius_Q147,New_P_Q129,New_UV_Q129,Radial_Gradient_Q129,Radial_Dir_Q129);vec3 Pos_World_Q115;Object_To_World_Pos_B115(New_P_Q129,Pos_World_Q115);vec4 Blob_Info_Q180;
#if BLOB_ENABLE
Blob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q177,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q180);
#else
Blob_Info_Q180=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q181;
#if BLOB_ENABLE_2
Blob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q178,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q181);
#else
Blob_Info_Q181=vec4(0,0,0,0);
#endif
float Gradient1_Q130;float Gradient2_Q130;
#if SMOOTH_EDGES
Edge_AA_Vertex_B130(Pos_World_Q115,position,normal,cameraPosition,Radial_Gradient_Q129,Radial_Dir_Q129,tangent,Gradient1_Q130,Gradient2_Q130);
#else
Gradient1_Q130=1.0;Gradient2_Q130=1.0;
#endif
vec2 Rect_UV_Q139;vec4 Rect_Parms_Q139;vec2 Scale_XY_Q139;vec2 Line_UV_Q139;Round_Rect_Vertex_B139(New_UV_Q129,Radius_Q147,0.0,Anisotropy_Q133,Gradient1_Q130,Gradient2_Q130,Rect_UV_Q139,Rect_Parms_Q139,Scale_XY_Q139,Line_UV_Q139);vec3 Line_Vertex_Q135;Line_Vertex_B135(Scale_XY_Q139,Line_UV_Q139,0.0,_Rate_,_Highlight_Transform_,Line_Vertex_Q135);vec3 Position=Pos_World_Q115;vec3 Normal=Dir_Q140;vec2 UV=Rect_UV_Q139;vec3 Tangent=Line_Vertex_Q135;vec3 Binormal=Nrm_World_Q128;vec4 Color=Out_Color_Q145;vec4 Extra1=Rect_Parms_Q139;vec4 Extra2=Blob_Info_Q180;vec4 Extra3=Blob_Info_Q181;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;ej.l.ShadersStore[te]||(ej.l.ShadersStore[te]=tt);class ti extends eX.M{constructor(){super(),this.BLOB_ENABLE=!0,this.BLOB_ENABLE_2=!0,this.SMOOTH_EDGES=!0,this.IRIDESCENT_MAP_ENABLE=!0,this._needNormals=!0,this.rebuild()}}class ts extends eY.E{constructor(e,t){super(e,t),this.radius=.03,this.lineWidth=.01,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new U.ov(.0392157,.0666667,.207843,1),this.lineColor=new U.ov(.14902,.133333,.384314,1),this.blobIntensity=.98,this.blobFarSize=.04,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.blobNearSize=.22,this.blobPulse=0,this.blobFade=0,this.blobNearSize2=.22,this.blobPulse2=0,this.blobFade2=0,this._rate=.135,this.highlightColor=new U.ov(.98,.98,.98,1),this.highlightWidth=.25,this._highlightTransform=new l.IU(1,1,0,0),this._highlight=1,this.iridescenceIntensity=0,this.iridescenceEdgeIntensity=1,this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.globalLeftIndexTipPosition=l.Pq.Zero(),this._globalLeftIndexTipPosition4=l.IU.Zero(),this.globalRightIndexTipPosition=l.Pq.Zero(),this._globalRightIndexTipPosition4=l.IU.Zero(),this.alphaMode=R.Y.ALPHA_DISABLE,this.backFaceCulling=!1;let i=_.S0.GetAssetUrl(ts.BLOB_TEXTURE_URL),s=_.S0.GetAssetUrl(ts.IM_TEXTURE_URL);this._blobTexture=new E.g(i,this.getScene(),!0,!1,E.g.NEAREST_SAMPLINGMODE),this._iridescentMap=new E.g(s,this.getScene(),!0,!1,E.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new ti);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Angle_","_Fade_Out_","_Reflected_","_Frequency_","_Vertical_Offset_","_Iridescent_Map_","_Use_Global_Left_Index_","_Use_Global_Right_Index_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position"],l=["_Blob_Texture_","_Iridescent_Map_"],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("fluentBackplate",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){if(!i.materialDefines)return;let s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera?.position??l.Pq.ZeroReadOnly),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",+!!this.absoluteSizes),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",1),this._activeEffect.setFloat("_Radius_Top_Right_",1),this._activeEffect.setFloat("_Radius_Bottom_Left_",1),this._activeEffect.setFloat("_Radius_Bottom_Right_",1),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Reflected_",+!!this._reflected),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMap),this._activeEffect.setFloat("_Use_Global_Left_Index_",1),this._activeEffect.setFloat("_Use_Global_Right_Index_",1),this._globalLeftIndexTipPosition4.set(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this._globalLeftIndexTipPosition4),this._globalRightIndexTipPosition4.set(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this._globalRightIndexTipPosition4),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._blobTexture.dispose(),this._iridescentMap.dispose()}clone(e){return y.p.Clone(()=>new ts(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.FluentBackplateMaterial",e}getClassName(){return"FluentBackplateMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new ts(e.name,t),e,t,i)}}ts.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-blob.png",ts.IM_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-iridescence.png",(0,o.Cg)([(0,T.lK)()],ts.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"lineWidth",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"absoluteSizes",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"baseColor",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"lineColor",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobFarSize",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobNearDistance",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobPulse",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobFade",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobNearSize2",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobPulse2",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"blobFade2",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"highlightColor",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"highlightWidth",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"iridescenceIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"iridescenceEdgeIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ts.prototype,"fadeOut",void 0),(0,o.Cg)([(0,T.P_)()],ts.prototype,"globalLeftIndexTipPosition",void 0),(0,o.Cg)([(0,T.P_)()],ts.prototype,"globalRightIndexTipPosition",void 0),(0,C.Y5)("BABYLON.GUI.FluentBackplateMaterial",ts);var tr=i(18076);class to extends eN{set renderingGroupId(e){this._model.renderingGroupId=e}get renderingGroupId(){return this._model.renderingGroupId}get material(){return this._material}get shareMaterials(){return this._shareMaterials}constructor(e,t=!0){super(e),this._shareMaterials=t}_getTypeName(){return"HolographicBackplate"}_createNode(e){let t=(0,eV.an)((this.name??"HolographicBackplate")+"_CollisionMesh",{width:1,height:1,depth:1},e);t.isPickable=!0,t.visibility=0;let i=_.S0.GetAssetUrl(to.MODEL_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,to.MODEL_FILENAME,e).then(e=>{let i=e.meshes[1];i.name=`${this.name}_frontPlate`,i.isPickable=!1,i.parent=t,this._material&&(i.material=this._material),this._model=i}),t}_createMaterial(e){this._material=new ts(this.name+" Material",e.getScene())}_affectMaterial(e){this._shareMaterials?this._host._touchSharedMaterials.fluentBackplateMaterial?this._material=this._host._touchSharedMaterials.fluentBackplateMaterial:(this._createMaterial(e),this._host._touchSharedMaterials.fluentBackplateMaterial=this._material):this._createMaterial(e)}dispose(){super.dispose(),this.shareMaterials||this._material.dispose(),this._model.dispose()}}to.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",to.MODEL_FILENAME="mrtk-fluent-backplate.glb";var ta=i(65049),tn=i(55628),tl=i(92935);class th extends ez{_disposeTooltip(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)}set renderingGroupId(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)}get renderingGroupId(){return this._backPlate.renderingGroupId}set tooltipText(e){if(!e)return void this._disposeTooltip();if(!this._tooltipFade){let e=this._backPlate._scene.useRightHandedSystem;this._tooltipMesh=(0,ta.x)("",{size:1},this._backPlate._scene);let t=(0,ta.x)("",{size:1,sideOrientation:eK.e.DOUBLESIDE},this._backPlate._scene),i=new eU.F("",this._backPlate._scene);i.diffuseColor=U.v9.FromHexString("#212121"),t.material=i,t.isPickable=!1,this._tooltipMesh.addChild(t),t.position=l.Pq.Forward(e).scale(.05),this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position=l.Pq.Up().scale(.7).add(l.Pq.Forward(e).scale(-.15)),this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=eS.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new O,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new tn._,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!0)}),this._tooltipOutObserver=this.onPointerOutObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!1)})}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}get tooltipText(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._rebuildContent())}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())}get backMaterial(){return this._backMaterial}get frontMaterial(){return this._frontMaterial}get plateMaterial(){return this._plateMaterial}get shareMaterials(){return this._shareMaterials}constructor(e,t=!0){super(e),this._shareMaterials=!0,this._shareMaterials=t,this.pointerEnterAnimation=()=>{this.mesh&&this._frontPlate.setEnabled(!0)},this.pointerOutAnimation=()=>{this.mesh&&this._frontPlate.setEnabled(!1)}}_getTypeName(){return"HolographicButton"}_rebuildContent(){this._disposeFacadeTexture();let e=new F;if(e.isVertical=!0,(0,tl.Nf)()&&document.createElement&&this._imageUrl){let t=new B;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){let t=new O;t.text=this._text,t.color="white",t.height="30px",t.fontSize=24,e.addControl(t)}this._frontPlate&&(this.content=e)}_createNode(e){return this._backPlate=(0,eV.an)(this.name+"BackMesh",{width:1,height:1,depth:.08},e),this._frontPlate=(0,eV.an)(this.name+"FrontMesh",{width:1,height:1,depth:.08},e),this._frontPlate.parent=this._backPlate,this._frontPlate.position=l.Pq.Forward(e.useRightHandedSystem).scale(-.08),this._frontPlate.isPickable=!1,this._frontPlate.setEnabled(!1),this._textPlate=super._createNode(e),this._textPlate.parent=this._backPlate,this._textPlate.position=l.Pq.Forward(e.useRightHandedSystem).scale(-.08),this._textPlate.isPickable=!1,this._backPlate}_applyFacade(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e}_createBackMaterial(e){this._backMaterial=new e3(this.name+"Back Material",e.getScene()),this._backMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add(e=>{e?(this._backMaterial.hoverPosition=e,this._backMaterial.hoverColor.a=1):this._backMaterial.hoverColor.a=0})}_createFrontMaterial(e){this._frontMaterial=new e3(this.name+"Front Material",e.getScene()),this._frontMaterial.innerGlowColorIntensity=0,this._frontMaterial.alpha=.5,this._frontMaterial.renderBorders=!0}_createPlateMaterial(e){this._plateMaterial=new eU.F(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=U.v9.Black()}_affectMaterial(e){this._shareMaterials?(this._host._sharedMaterials.backFluentMaterial?this._backMaterial=this._host._sharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._sharedMaterials.backFluentMaterial=this._backMaterial),this._host._sharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._sharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._sharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._frontPlate.material=this._frontMaterial,this._textPlate.material=this._plateMaterial,this._rebuildContent()}dispose(){super.dispose(),this._disposeTooltip(),!this.shareMaterials&&(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}let t_="fluentButtonPixelShader",td=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform bool _Relative_Width_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool Enable_Fade;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool _Use_Blob_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Holo_Edge_Fragment_B35(
vec4 Edges,
float Edge_Width,
out float NotEdge)
{vec2 c=vec2(min(Edges.r,Edges.g),min(Edges.b,Edges.a));vec2 df=fwidth(c)*Edge_Width;vec2 g=clamp(c/df,0.0,1.0);NotEdge=g.x*g.y;}
void Blob_Fragment_B39(
vec2 UV,
vec3 Blob_Info,
sampler2D Blob_Texture,
out vec4 Blob_Color)
{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}
vec2 FilterStep(vec2 Edge,vec2 X)
{vec2 dX=max(fwidth(X),vec2(0.00001,0.00001));return clamp( (X+dX-max(Edge,X-dX))/(dX*2.0),0.0,1.0);}
void Wireframe_Fragment_B59(
vec3 Widths,
vec2 UV,
float Proximity,
vec4 Edge_Color,
out vec4 Wireframe)
{vec2 c=min(UV,vec2(1.0,1.0)-UV);vec2 g=FilterStep(Widths.xy*0.5,c); 
Wireframe=(1.0-min(g.x,g.y))*Proximity*Edge_Color;}
void Proximity_B53(
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Proximity_Max_Intensity,
float Proximity_Near_Radius,
vec3 Position,
vec3 Show_Selection,
vec4 Extra1,
float Dist_To_Face,
float Intensity,
out float Proximity)
{vec2 delta1=Extra1.xy;vec2 delta2=Extra1.zw;float d2=sqrt(min(dot(delta1,delta1),dot(delta2,delta2))+Dist_To_Face*Dist_To_Face);Proximity=Intensity*Proximity_Max_Intensity*(1.0-clamp(d2/Proximity_Near_Radius,0.0,1.0))*(1.0-Show_Selection.x)+Show_Selection.x;}
void To_XYZ_B46(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void main()
{float NotEdge_Q35;
#if ENABLE_FADE
Holo_Edge_Fragment_B35(vColor,_Fade_Width_,NotEdge_Q35);
#else
NotEdge_Q35=1.0;
#endif
vec4 Blob_Color_Q39;float k=dot(vUV,vUV);vec2 blobTextureCoord=vec2(vec2(sqrt(k),vTangent.x).x,1.0-vec2(sqrt(k),vTangent.x).y);vec4 blobColor=mix(vec4(1.0,1.0,1.0,1.0)*step(1.0-vTangent.x,clamp(sqrt(k)+0.1,0.0,1.0)),texture(_Blob_Texture_,blobTextureCoord),float(_Use_Blob_Texture_));Blob_Color_Q39=vTangent.y*blobColor*(1.0-clamp(k,0.0,1.0));float Is_Quad_Q24;Is_Quad_Q24=vNormal.z;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));float X_Q46;float Y_Q46;float Z_Q46;To_XYZ_B46(vBinormal,X_Q46,Y_Q46,Z_Q46);float Proximity_Q53;Proximity_B53(Blob_Position_Q41,Blob_Position_Q42,_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vPosition,vBinormal,vExtra1,Y_Q46,Z_Q46,Proximity_Q53);vec4 Wireframe_Q59;Wireframe_Fragment_B59(vNormal,vUV,Proximity_Q53,_Edge_Color_,Wireframe_Q59);vec4 Wire_Or_Blob_Q23=mix(Wireframe_Q59,Blob_Color_Q39,Is_Quad_Q24);vec4 Result_Q22;Result_Q22=mix(Wire_Or_Blob_Q23,vec4(0.3,0.3,0.3,0.3),float(_Show_Frame_));vec4 Final_Color_Q37=NotEdge_Q35*Result_Q22;vec4 Out_Color=Final_Color_Q37;float Clip_Threshold=0.0;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[t_]||(ej.l.ShadersStore[t_]=td);let tc="fluentButtonVertexShader",tu=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool _Enable_Fade_;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;void Blob_Vertex_B47(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
vec4 Vx_Color,
vec2 UV,
vec3 Face_Center,
vec2 Face_Size,
vec2 In_UV,
float Blob_Fade_Length,
float Selection_Fade,
float Selection_Fade_Size,
float Inner_Fade,
vec3 Active_Face_Center,
float Blob_Pulse,
float Blob_Fade,
float Blob_Enabled,
out vec3 Out_Position,
out vec2 Out_UV,
out vec3 Blob_Info)
{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal);Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; 
vec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);}
vec2 ProjectProximity(
vec3 blobPosition,
vec3 position,
vec3 center,
vec3 dir,
vec3 xdir,
vec3 ydir,
out float vdistance
)
{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}
void Proximity_Vertex_B66(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Active_Face_Center,
vec3 Active_Face_Dir,
vec3 Position,
float Proximity_Far_Distance,
float Relative_Scale,
float Proximity_Anisotropy,
vec3 Up,
out vec4 Extra1,
out float Distance_To_Face,
out float Intensity)
{vec3 Active_Face_Dir_X=normalize(cross(Active_Face_Dir,Up));vec3 Active_Face_Dir_Y=cross(Active_Face_Dir,Active_Face_Dir_X);float distz1,distz2;Extra1.xy=ProjectProximity(Blob_Position,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz1)/Relative_Scale;Extra1.zw=ProjectProximity(Blob_Position_2,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz2)/Relative_Scale;Distance_To_Face=dot(Active_Face_Dir,Position-Active_Face_Center);Intensity=1.0-clamp(min(distz1,distz2)/Proximity_Far_Distance,0.0,1.0);}
void Holo_Edge_Vertex_B44(
vec3 Incident,
vec3 Normal,
vec2 UV,
vec3 Tangent,
vec3 Bitangent,
bool Smooth_Active_Face,
float Active,
out vec4 Holo_Edges)
{float NdotI=dot(Incident,Normal);vec2 flip=(UV-vec2(0.5,0.5));float udot=dot(Incident,Tangent)*flip.x*NdotI;float uval=1.0-float(udot>0.0);float vdot=-dot(Incident,Bitangent)*flip.y*NdotI;float vval=1.0-float(vdot>0.0);float Smooth_And_Active=step(1.0,float(Smooth_Active_Face && Active>0.0));uval=mix(uval,max(1.0,uval),Smooth_And_Active); 
vval=mix(vval,max(1.0,vval),Smooth_And_Active);Holo_Edges=vec4(1.0,1.0,1.0,1.0)-vec4(uval*UV.x,uval*(1.0-UV.x),vval*UV.y,vval*(1.0-UV.y));}
void Object_To_World_Pos_B13(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Choose_Blob_B38(
vec4 Vx_Color,
vec3 Position1,
vec3 Position2,
bool Blob_Enable_1,
bool Blob_Enable_2,
float Near_Size_1,
float Near_Size_2,
float Blob_Inner_Fade_1,
float Blob_Inner_Fade_2,
float Blob_Pulse_1,
float Blob_Pulse_2,
float Blob_Fade_1,
float Blob_Fade_2,
out vec3 Position,
out float Near_Size,
out float Inner_Fade,
out float Blob_Enable,
out float Fade,
out float Pulse)
{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=float(Blob_Enable_1);float b2=float(Blob_Enable_2);Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}
void Wireframe_Vertex_B51(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Edge_Width,
vec2 Face_Size,
out vec3 Wire_Vx_Pos,
out vec2 UV,
out vec2 Widths)
{Widths.xy=Edge_Width/Face_Size;float x=dot(Position,Tangent);float y=dot(Position,Bitangent);float dx=0.5-abs(x);float newx=(0.5-dx*Widths.x*2.0)*sign(x);float dy=0.5-abs(y);float newy=(0.5-dy*Widths.y*2.0)*sign(y);Wire_Vx_Pos=Normal*0.5+newx*Tangent+newy*Bitangent;UV.x=dot(Wire_Vx_Pos,Tangent)+0.5;UV.y=dot(Wire_Vx_Pos,Bitangent)+0.5;}
vec2 ramp2(vec2 start,vec2 end,vec2 x)
{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}
float computeSelection(
vec3 blobPosition,
vec3 normal,
vec3 tangent,
vec3 bitangent,
vec3 faceCenter,
vec2 faceSize,
float selectionFuzz,
float farDistance,
float fadeLength
)
{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}
void Selection_Vertex_B48(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec2 Face_Size,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Selection_Fuzz,
float Selected,
float Far_Distance,
float Fade_Length,
vec3 Active_Face_Dir,
out float Show_Selection)
{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float Active=max(0.0,dot(Active_Face_Dir,Normal));Show_Selection=mix(max(select1,select2),1.0,Selected)*Active;}
void Proximity_Visibility_B54(
float Selection,
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Input_Width,
float Proximity_Far_Distance,
float Proximity_Radius,
vec3 Active_Face_Center,
vec3 Active_Face_Dir,
out float Width)
{vec3 boxEdges=(world*vec4(vec3(0.5,0.5,0.5),0.0)).xyz;float boxMaxSize=length(boxEdges);float d1=dot(Proximity_Center-Active_Face_Center,Active_Face_Dir);vec3 blob1=Proximity_Center-d1*Active_Face_Dir;float d2=dot(Proximity_Center_2-Active_Face_Center,Active_Face_Dir);vec3 blob2=Proximity_Center_2-d2*Active_Face_Dir;vec3 delta1=blob1-Active_Face_Center;vec3 delta2=blob2-Active_Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=Input_Width*(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));}
void Object_To_World_Dir_B67(
vec3 Dir_Object,
out vec3 Dir_World)
{Dir_World=(world*vec4(Dir_Object,0.0)).xyz;}
void main()
{vec3 Active_Face_Center_Q49;Active_Face_Center_Q49=(world*vec4(_Active_Face_Dir_*0.5,1.0)).xyz;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));vec3 Active_Face_Dir_Q64=normalize((world*vec4(_Active_Face_Dir_,0.0)).xyz);float Relative_Scale_Q57;
#if RELATIVE_WIDTH
Relative_Scale_Q57=length((world*vec4(vec3(0,1,0),0.0)).xyz);
#else
Relative_Scale_Q57=1.0;
#endif
vec3 Tangent_World_Q30;Tangent_World_Q30=(world*vec4(tangent,0.0)).xyz;vec3 Binormal_World_Q31;Binormal_World_Q31=(world*vec4((cross(normal,tangent)),0.0)).xyz;vec3 Normal_World_Q60;Normal_World_Q60=(world*vec4(normal,0.0)).xyz;vec3 Result_Q18=0.5*normal;vec3 Dir_World_Q67;Object_To_World_Dir_B67(_Active_Face_Up_,Dir_World_Q67);float Product_Q56=_Edge_Width_*Relative_Scale_Q57;vec3 Normal_World_N_Q29=normalize(Normal_World_Q60);vec3 Tangent_World_N_Q28=normalize(Tangent_World_Q30);vec3 Binormal_World_N_Q32=normalize(Binormal_World_Q31);vec3 Position_Q38;float Near_Size_Q38;float Inner_Fade_Q38;float Blob_Enable_Q38;float Fade_Q38;float Pulse_Q38;Choose_Blob_B38(color,Blob_Position_Q41,Blob_Position_Q42,_Blob_Enable_,_Blob_Enable_2_,_Blob_Near_Size_,_Blob_Near_Size_2_,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q38,Near_Size_Q38,Inner_Fade_Q38,Blob_Enable_Q38,Fade_Q38,Pulse_Q38);vec3 Face_Center_Q33;Face_Center_Q33=(world*vec4(Result_Q18,1.0)).xyz;vec2 Face_Size_Q50=vec2(length(Tangent_World_Q30),length(Binormal_World_Q31));float Show_Selection_Q48;Selection_Vertex_B48(Blob_Position_Q41,Blob_Position_Q42,Face_Center_Q33,Face_Size_Q50,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,Active_Face_Dir_Q64,Show_Selection_Q48);vec3 Normalized_Q72=normalize(Dir_World_Q67);float Active_Q34=max(0.0,dot(Active_Face_Dir_Q64,Normal_World_N_Q29));float Width_Q54;Proximity_Visibility_B54(Show_Selection_Q48,Blob_Position_Q41,Blob_Position_Q42,Product_Q56,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Active_Face_Center_Q49,Active_Face_Dir_Q64,Width_Q54);vec3 Wire_Vx_Pos_Q51;vec2 UV_Q51;vec2 Widths_Q51;Wireframe_Vertex_B51(position,normal,tangent,(cross(normal,tangent)),Width_Q54,Face_Size_Q50,Wire_Vx_Pos_Q51,UV_Q51,Widths_Q51);vec3 Vec3_Q27=vec3(Widths_Q51.x,Widths_Q51.y,color.r);vec3 Pos_World_Q13;Object_To_World_Pos_B13(Wire_Vx_Pos_Q51,Pos_World_Q13);vec3 Incident_Q36=normalize(Pos_World_Q13-cameraPosition);vec3 Out_Position_Q47;vec2 Out_UV_Q47;vec3 Blob_Info_Q47;Blob_Vertex_B47(Pos_World_Q13,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,Position_Q38,_Blob_Intensity_,Near_Size_Q38,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q33,Face_Size_Q50,UV_Q51,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q38,Active_Face_Center_Q49,Pulse_Q38,Fade_Q38,Blob_Enable_Q38,Out_Position_Q47,Out_UV_Q47,Blob_Info_Q47);vec4 Extra1_Q66;float Distance_To_Face_Q66;float Intensity_Q66;Proximity_Vertex_B66(Blob_Position_Q41,Blob_Position_Q42,Active_Face_Center_Q49,Active_Face_Dir_Q64,Pos_World_Q13,_Proximity_Far_Distance_,Relative_Scale_Q57,_Proximity_Anisotropy_,Normalized_Q72,Extra1_Q66,Distance_To_Face_Q66,Intensity_Q66);vec4 Holo_Edges_Q44;Holo_Edge_Vertex_B44(Incident_Q36,Normal_World_N_Q29,uv,Tangent_World_Q30,Binormal_World_Q31,_Smooth_Active_Face_,Active_Q34,Holo_Edges_Q44);vec3 Vec3_Q19=vec3(Show_Selection_Q48,Distance_To_Face_Q66,Intensity_Q66);vec3 Position=Out_Position_Q47;vec2 UV=Out_UV_Q47;vec3 Tangent=Blob_Info_Q47;vec3 Binormal=Vec3_Q19;vec3 Normal=Vec3_Q27;vec4 Extra1=Extra1_Q66;vec4 Color=Holo_Edges_Q44;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;}`;ej.l.ShadersStore[tc]||(ej.l.ShadersStore[tc]=tu);class tf extends eX.M{constructor(){super(),this.RELATIVE_WIDTH=!0,this.ENABLE_FADE=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class tg extends eY.E{constructor(e,t){super(e,t),this.edgeWidth=.04,this.edgeColor=new U.ov(.592157,.592157,.592157,1),this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=1.5,this.proximityAnisotropy=1,this.selectionFuzz=.5,this.selected=0,this.selectionFade=0,this.selectionFadeSize=.3,this.selectedDistance=.08,this.selectedFadeLength=.08,this.blobIntensity=.5,this.blobFarSize=.05,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.leftBlobEnable=!0,this.leftBlobNearSize=.025,this.leftBlobPulse=0,this.leftBlobFade=1,this.leftBlobInnerFade=.01,this.rightBlobEnable=!0,this.rightBlobNearSize=.025,this.rightBlobPulse=0,this.rightBlobFade=1,this.rightBlobInnerFade=.01,this.activeFaceDir=new l.Pq(0,0,-1),this.activeFaceUp=new l.Pq(0,1,0),this.enableFade=!0,this.fadeWidth=1.5,this.smoothActiveFace=!0,this.showFrame=!1,this.useBlobTexture=!0,this.globalLeftIndexTipPosition=l.Pq.Zero(),this.globalRightIndexTipPosition=l.Pq.Zero(),this.alphaMode=R.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1;let i=_.S0.GetAssetUrl(tg.BLOB_TEXTURE_URL);this._blobTexture=new E.g(i,this.getScene(),!0,!1,E.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!0}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new tf);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!0,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","viewProjection","cameraPosition","_Edge_Width_","_Edge_Color_","_Relative_Width_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Active_Face_Dir_","_Active_Face_Up_","_Enable_Fade_","_Fade_Width_","_Smooth_Active_Face_","_Show_Frame_","_Use_Blob_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Blob_Texture_"],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("fluentButton",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene();if(!i.materialDefines)return;let r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setColor4("_Edge_Color_",new U.v9(this.edgeColor.r,this.edgeColor.g,this.edgeColor.b),this.edgeColor.a),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Blob_Enable_",+!!this.leftBlobEnable),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.leftBlobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.leftBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.leftBlobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.leftBlobFade),this._activeEffect.setFloat("_Blob_Enable_2_",+!!this.rightBlobEnable),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.rightBlobNearSize),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.rightBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_2_",this.rightBlobPulse),this._activeEffect.setFloat("_Blob_Fade_2_",this.rightBlobFade),this._activeEffect.setVector3("_Active_Face_Dir_",this.activeFaceDir),this._activeEffect.setVector3("_Active_Face_Up_",this.activeFaceUp),this._activeEffect.setFloat("_Fade_Width_",this.fadeWidth),this._activeEffect.setFloat("_Smooth_Active_Face_",+!!this.smoothActiveFace),this._activeEffect.setFloat("_Show_Frame_",+!!this.showFrame),this._activeEffect.setFloat("_Use_Blob_Texture_",+!!this.useBlobTexture),this._activeEffect.setFloat("Use_Global_Left_Index",1),this._activeEffect.setFloat("Use_Global_Right_Index",1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",new l.IU(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1)),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",new l.IU(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1)),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new tg(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.FluentButtonMaterial",e}getClassName(){return"FluentButtonMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new tg(e.name,t),e,t,i)}}tg.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-button-blob.png",(0,o.Cg)([(0,T.lK)()],tg.prototype,"edgeWidth",void 0),(0,o.Cg)([(0,T.qK)()],tg.prototype,"edgeColor",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"proximityMaxIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"proximityFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"proximityNearRadius",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"proximityAnisotropy",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selectionFuzz",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selected",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selectionFade",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selectionFadeSize",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selectedDistance",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"selectedFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"blobIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"blobFarSize",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"blobNearDistance",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"blobFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"blobFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"leftBlobEnable",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"leftBlobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"leftBlobPulse",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"leftBlobFade",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"leftBlobInnerFade",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"rightBlobEnable",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"rightBlobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"rightBlobPulse",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"rightBlobFade",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"rightBlobInnerFade",void 0),(0,o.Cg)([(0,T.P_)()],tg.prototype,"activeFaceDir",void 0),(0,o.Cg)([(0,T.P_)()],tg.prototype,"activeFaceUp",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"enableFade",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"fadeWidth",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"smoothActiveFace",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"showFrame",void 0),(0,o.Cg)([(0,T.lK)()],tg.prototype,"useBlobTexture",void 0),(0,o.Cg)([(0,T.P_)()],tg.prototype,"globalLeftIndexTipPosition",void 0),(0,o.Cg)([(0,T.P_)()],tg.prototype,"globalRightIndexTipPosition",void 0),(0,C.Y5)("BABYLON.GUI.FluentButtonMaterial",tg);class tm extends ez{constructor(e,t){super(e),this._isNearPressed=!1,this._interactionSurfaceHeight=0,this._isToggleButton=!1,this._toggleState=!1,this._toggleButtonCallback=()=>{this._onToggle(!this._toggleState)},this.onToggleObservable=new n.cP,this.collidableFrontDirection=l.Pq.Zero(),t&&(this.collisionMesh=t)}get isActiveNearInteraction(){return this._isNearPressed}set collidableFrontDirection(e){if(this._collidableFrontDirection=e.normalize(),this._collisionMesh){let e=l.AA.Matrix[0];e.copyFrom(this._collisionMesh.getWorldMatrix()),e.invert(),l.Pq.TransformNormalToRef(this._collidableFrontDirection,e,this._collidableFrontDirection),this._collidableFrontDirection.normalize()}}get collidableFrontDirection(){if(this._collisionMesh){let e=l.AA.Vector3[0];return l.Pq.TransformNormalToRef(this._collidableFrontDirection,this._collisionMesh.getWorldMatrix(),e),e.normalize()}return this._collidableFrontDirection}set collisionMesh(e){if(this._collisionMesh)for(let e of(this._collisionMesh.isNearPickable=!1,this._collisionMesh.reservedDataStore?.GUI3D&&(this._collisionMesh.reservedDataStore.GUI3D={}),this._collisionMesh.getChildMeshes()))e.isNearPickable=!1,e.reservedDataStore?.GUI3D&&(e.reservedDataStore.GUI3D={});for(let t of(this._collisionMesh=e,this._injectGUI3DReservedDataStore(this._collisionMesh).control=this,this._collisionMesh.isNearPickable=!0,this._collisionMesh.getChildMeshes()))this._injectGUI3DReservedDataStore(t).control=this,t.isNearPickable=!0;this.collidableFrontDirection=e.forward}set isToggleButton(e){e!==this._isToggleButton&&(this._isToggleButton=e,e?this.onPointerUpObservable.add(this._toggleButtonCallback):(this.onPointerUpObservable.removeCallback(this._toggleButtonCallback),this._toggleState&&this._onToggle(!1)))}get isToggleButton(){return this._isToggleButton}set isToggled(e){this._isToggleButton&&this._toggleState!==e&&this._onToggle(e)}get isToggled(){return this._toggleState}_onToggle(e){this._toggleState=e,this.onToggleObservable.notifyObservers(e)}_isInteractionInFrontOfButton(e){return this._getInteractionHeight(e,this._collisionMesh.getAbsolutePosition())>0}getPressDepth(e){if(!this._isNearPressed)return 0;let t=this._getInteractionHeight(e,this._collisionMesh.getAbsolutePosition());return this._interactionSurfaceHeight-t}_getInteractionHeight(e,t){let i=this.collidableFrontDirection;if(0===i.length())return l.Pq.Distance(e,t);let s=l.Pq.Dot(t,i);return l.Pq.Dot(e,i)-s}_generatePointerEventType(e,t,i){if(e===h.Zp.POINTERDOWN||e===h.Zp.POINTERMOVE)if(!this._isInteractionInFrontOfButton(t))return h.Zp.POINTERMOVE;else this._isNearPressed=!0,this._interactionSurfaceHeight=this._getInteractionHeight(t,this._collisionMesh.getAbsolutePosition());if(e===h.Zp.POINTERUP)if(0==i)return h.Zp.POINTERMOVE;else this._isNearPressed=!1;return e}_getTypeName(){return"TouchButton3D"}_createNode(e){return super._createNode(e)}dispose(){super.dispose(),this.onPointerUpObservable.removeCallback(this._toggleButtonCallback),this.onToggleObservable.clear(),this._collisionMesh&&this._collisionMesh.dispose()}}var tp=i(16582);class tv extends tm{_disposeTooltip(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)}set renderingGroupId(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)}get renderingGroupId(){return this._backPlate.renderingGroupId}get mesh(){return this._backPlate}set tooltipText(e){if(!e)return void this._disposeTooltip();if(!this._tooltipFade){let e=this._backPlate._scene.useRightHandedSystem;this._tooltipMesh=(0,ta.x)("",{size:1},this._backPlate._scene);let t=(0,ta.x)("",{size:1,sideOrientation:eK.e.DOUBLESIDE},this._backPlate._scene),i=new eU.F("",this._backPlate._scene);i.diffuseColor=U.v9.FromHexString("#212121"),t.material=i,t.isPickable=!1,this._tooltipMesh.addChild(t),t.position=l.Pq.Forward(e).scale(.05),this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position=l.Pq.Up().scale(.7).add(l.Pq.Forward(e).scale(-.15)),this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=eS.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new O,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new tn._,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!0)}),this._tooltipOutObserver=this.onPointerOutObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!1)})}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}get tooltipText(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._rebuildContent())}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())}get backMaterial(){return this._backMaterial}get frontMaterial(){return this._frontMaterial}get plateMaterial(){return this._plateMaterial}get shareMaterials(){return this._shareMaterials}set isBackplateVisible(e){this.mesh&&this._backMaterial&&(e&&!this._isBackplateVisible?this._backPlate.visibility=1:!e&&this._isBackplateVisible&&(this._backPlate.visibility=0)),this._isBackplateVisible=e}constructor(e,t=!0){super(e),this._shareMaterials=!0,this._isBackplateVisible=!0,this._frontPlateDepth=.5,this._backPlateDepth=.04,this._backplateColor=new U.v9(.08,.15,.55),this._backplateToggledColor=new U.v9(.25,.4,.95),this._shareMaterials=t,this.pointerEnterAnimation=()=>{this._frontMaterial.leftBlobEnable=!0,this._frontMaterial.rightBlobEnable=!0},this.pointerOutAnimation=()=>{this._frontMaterial.leftBlobEnable=!1,this._frontMaterial.rightBlobEnable=!1},this.pointerDownAnimation=()=>{this._frontPlate&&!this.isActiveNearInteraction&&(this._frontPlate.scaling.z=.2*this._frontPlateDepth,this._frontPlate.position=l.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-.2*this._frontPlateDepth)/2),this._textPlate.position=l.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+.2*this._frontPlateDepth)/2))},this.pointerUpAnimation=()=>{this._frontPlate&&(this._frontPlate.scaling.z=this._frontPlateDepth,this._frontPlate.position=l.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-this._frontPlateDepth)/2),this._textPlate.position=l.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+this._frontPlateDepth)/2))},this.onPointerMoveObservable.add(e=>{if(this._frontPlate&&this.isActiveNearInteraction){let t=l.Pq.Zero();if(this._backPlate.getWorldMatrix().decompose(t,void 0,void 0)){let i=this._getInteractionHeight(e,this._backPlate.getAbsolutePosition())/t.z;i=tp.X.Clamp(i-this._backPlateDepth/2,.2*this._frontPlateDepth,this._frontPlateDepth),this._frontPlate.scaling.z=i,this._frontPlate.position=l.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-i)/2),this._textPlate.position=l.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+i)/2)}}}),this._pointerHoverObserver=this.onPointerMoveObservable.add(e=>{this._frontMaterial.globalLeftIndexTipPosition=e})}_getTypeName(){return"TouchHolographicButton"}_rebuildContent(){this._disposeFacadeTexture();let e=new F;if(e.isVertical=!0,(0,tl.Nf)()&&document.createElement&&this._imageUrl){let t=new B;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){let t=new O;t.text=this._text,t.color="white",t.height="30px",t.fontSize=24,e.addControl(t)}this.content=e}_createNode(e){this.name=this.name??"TouchHolographicButton";let t=(0,eV.an)(`${this.name}_collisionMesh`,{width:1,height:1,depth:this._frontPlateDepth},e);t.isPickable=!0,t.isNearPickable=!0,t.visibility=0,t.position=l.Pq.Forward(e.useRightHandedSystem).scale(-this._frontPlateDepth/2);let i=_.S0.GetAssetUrl(tv.MODEL_BASE_URL);tr.cn.ImportMeshAsync(void 0,i,tv.MODEL_FILENAME,e).then(i=>{let s=(0,eV.an)("${this.name}_alphaMesh",{width:1,height:1,depth:1},e);s.isPickable=!1,s.material=new eU.F("${this.name}_alphaMesh_material",e),s.material.alpha=.15;let r=i.meshes[1];r.name=`${this.name}_frontPlate`,r.isPickable=!1,r.scaling.z=this._frontPlateDepth,s.parent=r,r.parent=t,this._frontMaterial&&(r.material=this._frontMaterial),this._frontPlate=r}),this._backPlate=(0,eV.an)(`${this.name}_backPlate`,{width:1,height:1,depth:this._backPlateDepth},e),this._backPlate.position=l.Pq.Forward(e.useRightHandedSystem).scale(this._backPlateDepth/2),this._backPlate.isPickable=!1,this._textPlate=super._createNode(e),this._textPlate.name=`${this.name}_textPlate`,this._textPlate.isPickable=!1,this._textPlate.position=l.Pq.Forward(e.useRightHandedSystem).scale(-this._frontPlateDepth/2),this._backPlate.addChild(t),this._backPlate.addChild(this._textPlate);let s=new eF.V("{this.name}_root",e);return this._backPlate.setParent(s),this.collisionMesh=t,this.collidableFrontDirection=this._backPlate.forward.negate(),s}_applyFacade(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e,this._plateMaterial.diffuseColor=new U.v9(.4,.4,.4)}_createBackMaterial(e){this._backMaterial=new e3(this.name+"backPlateMaterial",e.getScene()),this._backMaterial.albedoColor=this._backplateColor,this._backMaterial.renderBorders=!0,this._backMaterial.renderHoverLight=!1}_createFrontMaterial(e){this._frontMaterial=new tg(this.name+"Front Material",e.getScene())}_createPlateMaterial(e){this._plateMaterial=new eU.F(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=U.v9.Black()}_onToggle(e){this._backMaterial&&(e?this._backMaterial.albedoColor=this._backplateToggledColor:this._backMaterial.albedoColor=this._backplateColor),super._onToggle(e)}_affectMaterial(e){this._shareMaterials?(this._host._touchSharedMaterials.backFluentMaterial?this._backMaterial=this._host._touchSharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._touchSharedMaterials.backFluentMaterial=this._backMaterial),this._host._touchSharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._touchSharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._touchSharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._textPlate.material=this._plateMaterial,this._isBackplateVisible||(this._backPlate.visibility=0),this._frontPlate&&(this._frontPlate.material=this._frontMaterial),this._rebuildContent()}dispose(){super.dispose(),this._disposeTooltip(),this.onPointerMoveObservable.remove(this._pointerHoverObserver),!this.shareMaterials&&(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}tv.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",tv.MODEL_FILENAME="mrtk-fluent-button.glb";var tb=i(42264),tx=i(79518),tC=i(57065);class tT{constructor(){this.followBehaviorEnabled=!1,this.sixDofDragBehaviorEnabled=!0,this.surfaceMagnetismBehaviorEnabled=!0,this._followBehavior=new tb.S,this._sixDofDragBehavior=new tx.Y,this._surfaceMagnetismBehavior=new tC.B}get name(){return"Default"}get followBehavior(){return this._followBehavior}get sixDofDragBehavior(){return this._sixDofDragBehavior}get surfaceMagnetismBehavior(){return this._surfaceMagnetismBehavior}init(){}attach(e,t,i){this._scene=e.getScene(),this.attachedNode=e,this._addObservables(),this._followBehavior.attach(e),this._sixDofDragBehavior.attach(e),this._sixDofDragBehavior.draggableMeshes=t||null,this._sixDofDragBehavior.faceCameraOnDragStart=!0,this._surfaceMagnetismBehavior.attach(e,this._scene),i&&(this._surfaceMagnetismBehavior.meshes=i),this._surfaceMagnetismBehavior.enabled=!1}detach(){this.attachedNode=null,this._removeObservables(),this._followBehavior.detach(),this._sixDofDragBehavior.detach(),this._surfaceMagnetismBehavior.detach()}_addObservables(){this._onBeforeRenderObserver=this._scene.onBeforeRenderObservable.add(()=>{this._followBehavior._enabled=!this._sixDofDragBehavior.isMoving&&this.followBehaviorEnabled}),this._onDragObserver=this._sixDofDragBehavior.onDragObservable.add(e=>{this._sixDofDragBehavior.disableMovement=this._surfaceMagnetismBehavior.findAndUpdateTarget(e.pickInfo)})}_removeObservables(){this._scene.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._sixDofDragBehavior.onDragObservable.remove(this._onDragObserver)}}var ty=i(17629),tS=i(94871),tP=i(11044);let tI="handleVertexShader";ej.l.ShadersStore[tI]||(ej.l.ShadersStore[tI]="precision highp float;attribute vec3 position;uniform vec3 positionOffset;uniform mat4 worldViewProjection;uniform float scale;void main(void) {vec4 vPos=vec4((vec3(position)+positionOffset)*scale,1.0);gl_Position=worldViewProjection*vPos;}");let tE="handlePixelShader";ej.l.ShadersStore[tE]||(ej.l.ShadersStore[tE]="uniform vec3 color;void main(void) {gl_FragColor=vec4(color,1.0);}");class tR extends tP.B{get hover(){return this._hover}set hover(e){this._hover=e,this._updateInterpolationTarget()}get drag(){return this._drag}set drag(e){this._drag=e,this._updateInterpolationTarget()}constructor(e,t){super(e,t,"handle",{attributes:["position"],uniforms:["worldViewProjection","color","scale","positionOffset"],needAlphaBlending:!1,needAlphaTesting:!1}),this._hover=!1,this._drag=!1,this._color=new U.v9,this._scale=1,this._lastTick=-1,this.animationLength=100,this.hoverColor=new U.v9(0,.467,.84),this.baseColor=new U.v9(1,1,1),this.hoverScale=.75,this.baseScale=.35,this.dragScale=.55,this._positionOffset=l.Pq.Zero(),this._updateInterpolationTarget(),this._lastTick=Date.now(),this._onBeforeRender=this.getScene().onBeforeRenderObservable.add(()=>{let e=Date.now(),t=e-this._lastTick,i=this._targetScale-this._scale,s=U.IG.Color3[0].copyFrom(this._targetColor).subtractToRef(this._color,U.IG.Color3[0]);this._scale=this._scale+i*t/this.animationLength,s.scaleToRef(t/this.animationLength,s),this._color.addToRef(s,this._color),this.setColor3("color",this._color),this.setFloat("scale",this._scale),this.setVector3("positionOffset",this._positionOffset),this._lastTick=e})}_updateInterpolationTarget(){this.drag?(this._targetColor=this.hoverColor,this._targetScale=this.dragScale):this.hover?(this._targetColor=this.hoverColor,this._targetScale=this.hoverScale):(this._targetColor=this.baseColor,this._targetScale=this.baseScale)}dispose(){super.dispose(),this.getScene().onBeforeRenderObservable.remove(this._onBeforeRender)}}var tM=i(9771);!function(e){e[e.IDLE=0]="IDLE",e[e.HOVER=1]="HOVER",e[e.DRAG=2]="DRAG"}(r||(r={}));class tw{get state(){return this._state}get gizmo(){return this._gizmo}set hover(e){e?this._state|=1:this._state&=-2,this._updateMaterial()}set drag(e){e?this._state|=2:this._state&=-3,this._updateMaterial()}constructor(e,t){this._state=0,this._materials=[],this._scene=t,this._gizmo=e,this.node=this.createNode(),this.node.reservedDataStore={handle:this}}_createMaterial(e){let t=new tR("handle",this._scene);return e&&(t._positionOffset=e),t}_updateMaterial(){let e=this._state;for(let e of this._materials)e.hover=!1,e.drag=!1;if(2&e)for(let e of this._materials)e.drag=!0;else if(1&e)for(let e of this._materials)e.hover=!0}setDragBehavior(e,t,i){let s=new tM.D;this._dragBehavior=s,this._dragStartObserver=s.onDragStartObservable.add(e),this._draggingObserver=s.onDragObservable.add(t),this._dragEndObserver=s.onDragEndObservable.add(i),this._dragBehavior.attach(this.node)}dispose(){for(let e of(this._dragBehavior.onDragStartObservable.remove(this._dragStartObserver),this._dragBehavior.onDragObservable.remove(this._draggingObserver),this._dragBehavior.onDragEndObservable.remove(this._dragEndObserver),this._dragBehavior.detach(),this._materials))e.dispose();this.node.dispose()}}class tO extends tw{createNode(){let e=(0,eV.an)("sideVert",{width:1,height:10,depth:.1},this._scene),t=new eF.V("side",this._scene);e.parent=t;let i=this._createMaterial();return e.material=i,e.isNearGrabbable=!0,this._materials.push(i),t}}class tB extends tw{createNode(){let e=(0,eV.an)("angleHor",{width:3,height:1,depth:.1},this._scene),t=(0,eV.an)("angleVert",{width:1,height:3,depth:.1},this._scene),i=new eF.V("angle",this._scene);return e.parent=i,t.parent=i,e.material=this._createMaterial(new l.Pq(1,0,0)),t.material=this._createMaterial(new l.Pq(0,1,0)),t.isNearGrabbable=!0,e.isNearGrabbable=!0,this._materials.push(e.material),this._materials.push(t.material),i}}class tA extends ty.Fq{set attachedSlate(e){e?(this.attachedMesh=e.mesh,this.updateBoundingBox(),this._pickedPointObserver=e._host.onPickingObservable.add(e=>{if(this._handleHovered&&(!e||e.parent!==this._handleHovered.node)&&(this._handleHovered.hover=!1,this._handleHovered=null),e&&e.parent&&e.parent.reservedDataStore&&e.parent.reservedDataStore.handle){let t=e.parent.reservedDataStore.handle;t.gizmo===this&&(this._handleHovered=t,this._handleHovered.hover=!0)}})):this._attachedSlate&&this._attachedSlate._host.onPickingObservable.remove(this._pickedPointObserver),this._attachedSlate=e}get attachedSlate(){return this._attachedSlate}constructor(e){super(e),this._boundingDimensions=new l.Pq(0,0,0),this._renderObserver=null,this._tmpQuaternion=new l.PT,this._tmpVector=new l.Pq(0,0,0),this._corners=[],this._sides=[],this._boundingBoxGizmo={min:new l.Pq,max:new l.Pq},this._margin=.35,this._handleSize=.075,this._attachedSlate=null,this._existingSlateScale=new l.Pq,this.fixedScreenSize=!1,this.fixedScreenSizeDistanceFactor=10,this._createNode(),this.updateScale=!1,this._renderObserver=this.gizmoLayer.originalScene.onBeforeRenderObservable.add(()=>{this.attachedMesh&&!this._existingSlateScale.equals(this.attachedMesh.scaling)&&this.updateBoundingBox()})}_createNode(){this._handlesParent=new eF.V("handlesParent",this.gizmoLayer.utilityLayerScene),this._handlesParent.rotationQuaternion=l.PT.Identity();let e=[{dimensions:new l.Pq(-1,-1,0),origin:new l.Pq(1,0,0)},{dimensions:new l.Pq(1,-1,0),origin:new l.Pq(0,0,0)},{dimensions:new l.Pq(1,1,0),origin:new l.Pq(0,1,0)},{dimensions:new l.Pq(-1,1,0),origin:new l.Pq(1,1,0)}];for(let t=0;t<4;t++){let i=new tB(this,this.gizmoLayer.utilityLayerScene);this._corners.push(i),i.node.rotation.z=Math.PI/2*t,i.node.parent=this._handlesParent,this._assignDragBehaviorCorners(i,(e,t,i,s)=>this._moveHandle(e,t,i,s,!0),e[t])}for(let e=0;e<4;e++){let t=new tO(this,this.gizmoLayer.utilityLayerScene);this._sides.push(t),t.node.rotation.z=Math.PI/2*e,t.node.parent=this._handlesParent,this._assignDragBehaviorSides(t,e%2==0?new l.Pq(0,1,0):new l.Pq(1,0,0))}this._handlesParent.parent=this._rootMesh}_keepAspectRatio(e,t,i=!1){let s=l.AA.Vector3[0];s.copyFromFloats(t,1,0).normalize(),i&&(s.y*=-1);let r=l.Pq.Dot(e,s);e.copyFrom(s).scaleInPlace(r)}_clampDimensions(e,t,i,s=!1){let r=l.AA.Vector3[0];r.copyFrom(e).multiplyInPlace(i);let o=l.AA.Vector3[1];if(o.copyFromFloats(Math.max(this._attachedSlate.minDimensions.x,r.x+t.x),Math.max(this._attachedSlate.minDimensions.y,r.y+t.y),0),s){let e=t.x/t.y;o.x=Math.max(o.x,o.y*e),o.y=Math.max(o.y,o.x/e)}r.copyFrom(o).subtractInPlace(t),e.x=Math.sign(e.x)*Math.abs(r.x),e.y=Math.sign(e.y)*Math.abs(r.y)}_moveHandle(e,t,i,s,r){if(!this._attachedSlate)return;if(r){let e=t.x/t.y;this._keepAspectRatio(i,e,s.dimensions.x*s.dimensions.y<0)}this._clampDimensions(i,t,s.dimensions,r);let o=l.AA.Vector3[0],a=l.AA.Vector3[1];o.copyFrom(i).multiplyInPlace(s.origin),a.copyFrom(i).multiplyInPlace(s.dimensions),this._attachedSlate.origin.copyFrom(e).addInPlace(o),this._attachedSlate.dimensions.set(t.x+a.x,t.y+a.y)}_assignDragBehaviorCorners(e,t,i){let s=new l.Pq,r=new l.Pq,o=new l.Pq,a=new l.uq,n=new l.Pq,h=e=>{this.attachedSlate&&this.attachedMesh&&(s.set(this.attachedSlate.dimensions.x,this.attachedSlate.dimensions.y,p.bH),r.copyFrom(this.attachedSlate.origin),o.copyFrom(e.position),a.copyFrom(this.attachedMesh.computeWorldMatrix(!0)),a.invert(),this.attachedSlate._followButton.isToggled=!1,l.Pq.TransformNormalToRef(l.Pq.Forward(),this.attachedMesh.getWorldMatrix(),n),n.normalize(),this._handleHovered&&(this._handleDragged=this._handleHovered,this._handleDragged.drag=!0))},_=e=>{this.attachedSlate&&this.attachedMesh&&(((e,t,i,s)=>{e.subtractToRef(i,l.AA.Vector3[0]);let r=l.Pq.Dot(l.AA.Vector3[0],t);l.AA.Vector3[1].copyFrom(t).scaleInPlace(r),l.AA.Vector3[0].subtractInPlace(l.AA.Vector3[1]),l.AA.Vector3[0].addToRef(i,s)})(e.position,n,o,this._tmpVector),this._tmpVector.subtractInPlace(o),l.Pq.TransformNormalToRef(this._tmpVector,a,this._tmpVector),t(r,s,this._tmpVector,i),this.attachedSlate._positionElements(),this.updateBoundingBox())},d=()=>{this.attachedSlate&&this.attachedNode&&(this.attachedSlate._updatePivot(),this._handleDragged&&(this._handleDragged.drag=!1,this._handleDragged=null))};e.setDragBehavior(h,_,d)}_assignDragBehaviorSides(e,t){let i=new l.PT,s=new l.Pq,r=new l.Pq,o=new l.Pq,a=new l.Pq,n=e=>{this.attachedSlate&&this.attachedMesh&&(i.copyFrom(this.attachedMesh.rotationQuaternion),s.copyFrom(e.position),o.copyFrom(this.attachedMesh.getAbsolutePivotPoint()),r.copyFrom(s).subtractInPlace(o).normalize(),this.attachedSlate._followButton.isToggled=!1,l.Pq.TransformNormalToRef(t,this.attachedMesh.getWorldMatrix(),a),a.normalize(),this._handleHovered&&(this._handleDragged=this._handleHovered,this._handleDragged.drag=!0))},h=e=>{if(this.attachedSlate&&this.attachedMesh){this._tmpVector.copyFrom(e.position),this._tmpVector.subtractInPlace(o),this._tmpVector.normalize();let s=-l.Pq.GetAngleBetweenVectorsOnPlane(this._tmpVector,r,a);l.PT.RotationAxisToRef(t,s,this._tmpQuaternion),i.multiplyToRef(this._tmpQuaternion,this.attachedMesh.rotationQuaternion)}},_=()=>{this.attachedSlate&&this.attachedNode&&(this.attachedSlate._updatePivot(),this._handleDragged&&(this._handleDragged.drag=!1,this._handleDragged=null))};e.setDragBehavior(n,h,_)}_attachedNodeChanged(e){e&&this.updateBoundingBox()}updateBoundingBox(){if(this.attachedMesh){tS.G._RemoveAndStorePivotPoint(this.attachedMesh);let e=this.attachedMesh.parent;this.attachedMesh.setParent(null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=l.PT.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);let t=this.attachedMesh.getHierarchyBoundingVectors();t.max.subtractToRef(t.min,this._boundingDimensions),this._boundingBoxGizmo.min=t.min,this._boundingBoxGizmo.max=t.max,this._updateHandlesPosition(),this._updateHandlesScaling(),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),tS.G._RestorePivotPoint(this.attachedMesh),this.attachedMesh.setParent(e),this.attachedMesh.computeWorldMatrix(!0),this._existingSlateScale.copyFrom(this.attachedMesh.scaling)}}_updateHandlesPosition(){let e=this._boundingBoxGizmo.min.clone(),t=this._boundingBoxGizmo.max.clone(),i=this._corners[0].node.scaling.length();e.x-=this._margin*i,e.y-=this._margin*i,t.x+=this._margin*i,t.y+=this._margin*i;let s=e.add(t).scaleInPlace(.5);this._corners[0].node.position.copyFromFloats(e.x,e.y,0),this._corners[1].node.position.copyFromFloats(t.x,e.y,0),this._corners[2].node.position.copyFromFloats(t.x,t.y,0),this._corners[3].node.position.copyFromFloats(e.x,t.y,0),this._sides[0].node.position.copyFromFloats(e.x,s.y,0),this._sides[1].node.position.copyFromFloats(s.x,e.y,0),this._sides[2].node.position.copyFromFloats(t.x,s.y,0),this._sides[3].node.position.copyFromFloats(s.x,t.y,0)}_updateHandlesScaling(){if(this._attachedSlate&&this._attachedSlate.mesh){let e=Math.min(this._attachedSlate.mesh.scaling.x*this._attachedSlate.dimensions.x,this._attachedSlate.mesh.scaling.y*this._attachedSlate.dimensions.y)*this._handleSize;for(let t=0;t<this._corners.length;t++)this._corners[t].node.scaling.setAll(e);for(let t=0;t<this._sides.length;t++)this._sides[t].node.scaling.setAll(e)}}_update(){if(super._update(),this.gizmoLayer.utilityLayerScene.activeCamera&&this._attachedSlate&&this._attachedSlate.mesh){if(this.fixedScreenSize){this._attachedSlate.mesh.absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);let e=this._handleSize*this._tmpVector.length()/this.fixedScreenSizeDistanceFactor;for(let t=0;t<this._corners.length;t++)this._corners[t].node.scaling.set(e,e,e);for(let t=0;t<this._sides.length;t++)this._sides[t].node.scaling.set(e,e,e)}this._updateHandlesPosition()}}dispose(){for(let e of(this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),super.dispose(),this._corners))e.dispose();for(let e of this._sides)e.dispose()}}var tF=i(54932),tL=i(67840),tN=i(31506);class tD extends eD{get defaultBehavior(){return this._defaultBehavior}get dimensions(){return this._dimensions}set dimensions(e){let t=1;if(e.x<this.minDimensions.x||e.y<this.minDimensions.y){let i=e.x/e.y;t=this.minDimensions.x/this.minDimensions.y>i?this.minDimensions.x/e.x:this.minDimensions.y/e.y}this._dimensions.copyFrom(e).scaleInPlace(t),this._updatePivot(),this._positionElements()}get titleBarHeight(){return this._titleBarHeight}set titleBarHeight(e){this._titleBarHeight=e}set renderingGroupId(e){this._titleBar.renderingGroupId=e,this._titleBarTitle.renderingGroupId=e,this._contentPlate.renderingGroupId=e,this._backPlate.renderingGroupId=e}get renderingGroupId(){return this._titleBar.renderingGroupId}set title(e){this._titleText=e,this._titleTextComponent&&(this._titleTextComponent.text=e)}get title(){return this._titleText}constructor(e){super(e),this.titleBarMargin=.005,this.origin=new l.Pq(0,0,0),this._dimensions=new l.I9(21.875,12.5),this._titleBarHeight=.625,this._titleText="",this.fitContentToDimensions=!1,this._contentScaleRatio=1,this.minDimensions=new l.I9(15.625,6.25),this.defaultDimensions=this._dimensions.clone(),this._followButton=new tv("followButton"+this.name),this._followButton.isToggleButton=!0,this._closeButton=new tv("closeButton"+this.name),this._contentViewport=new ex.L(0,0,1,1),this._contentDragBehavior=new tF.C({dragPlaneNormal:new l.Pq(0,0,-1)})}_applyFacade(e){this._contentMaterial.albedoTexture=e,this._resetContentPositionAndZoom(),this._applyContentViewport(),e.attachToMesh(this._contentPlate,!0)}_addControl(e){e._host=this._host,this._host.utilityLayer&&e._prepareNode(this._host.utilityLayer.utilityLayerScene)}_getTypeName(){return"HolographicSlate"}_positionElements(){let e=this._followButton,t=this._closeButton,i=this._titleBar,s=this._titleBarTitle,r=this._contentPlate,o=this._backPlate;if(e&&t&&i){t.scaling.setAll(this.titleBarHeight),e.scaling.setAll(this.titleBarHeight),t.position.copyFromFloats(this.dimensions.x-this.titleBarHeight/2,-this.titleBarHeight/2,0).addInPlace(this.origin),e.position.copyFromFloats(this.dimensions.x-3*this.titleBarHeight/2,-this.titleBarHeight/2,0).addInPlace(this.origin);let a=this.dimensions.y-this.titleBarHeight-this.titleBarMargin,n=r.getScene().useRightHandedSystem;i.scaling.set(this.dimensions.x,this.titleBarHeight,p.bH),s.scaling.set(this.dimensions.x-2*this.titleBarHeight,this.titleBarHeight,p.bH),r.scaling.copyFromFloats(this.dimensions.x,a,p.bH),o.scaling.copyFromFloats(this.dimensions.x,a,p.bH),i.position.copyFromFloats(this.dimensions.x/2,-(this.titleBarHeight/2),0).addInPlace(this.origin),s.position.copyFromFloats(this.dimensions.x/2-this.titleBarHeight,-(this.titleBarHeight/2),n?p.bH:-p.bH).addInPlace(this.origin),r.position.copyFromFloats(this.dimensions.x/2,-(this.titleBarHeight+this.titleBarMargin+a/2),0).addInPlace(this.origin),o.position.copyFromFloats(this.dimensions.x/2,-(this.titleBarHeight+this.titleBarMargin+a/2),n?-p.bH:p.bH).addInPlace(this.origin),this._titleTextComponent.host.scaleTo(tD._DEFAULT_TEXT_RESOLUTION_Y*s.scaling.x/s.scaling.y,tD._DEFAULT_TEXT_RESOLUTION_Y);let l=this.dimensions.x/a;this._contentViewport.width=this._contentScaleRatio,this._contentViewport.height=this._contentScaleRatio/l,this._applyContentViewport(),this._gizmo&&this._gizmo.updateBoundingBox()}}_applyContentViewport(){if(this._contentPlate?.material&&this._contentPlate.material.albedoTexture){let e=this._contentPlate.material.albedoTexture;e.uScale=this._contentScaleRatio,e.vScale=this.fitContentToDimensions?this._contentScaleRatio:this._contentScaleRatio/this._contentViewport.width*this._contentViewport.height,e.uOffset=this._contentViewport.x,e.vOffset=this._contentViewport.y}}_resetContentPositionAndZoom(){this._contentViewport.x=0,this._contentViewport.y=0,this._contentScaleRatio=1}_updatePivot(){if(!this.mesh)return;let e=new l.Pq(.5*this.dimensions.x,-(.5*this.dimensions.y),p.bH);e.addInPlace(this.origin),e.z=0;let t=new l.Pq(0,0,0);l.Pq.TransformCoordinatesToRef(t,this.mesh.computeWorldMatrix(!0),t),this.mesh.setPivotPoint(e);let i=new l.Pq(0,0,0);l.Pq.TransformCoordinatesToRef(i,this.mesh.computeWorldMatrix(!0),i),this.mesh.position.addInPlace(t).subtractInPlace(i)}_createNode(e){let t=new eK.e("slate_"+this.name,e);this._titleBar=(0,eV.an)("titleBar_"+this.name,{size:1},e),this._titleBarTitle=(0,ta.x)("titleText_"+this.name,{size:1},e),this._titleBarTitle.parent=t,this._titleBarTitle.isPickable=!1;let i=eS.CreateForMesh(this._titleBarTitle);if(this._titleTextComponent=new O("titleText_"+this.name,this._titleText),this._titleTextComponent.textWrapping=2,this._titleTextComponent.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,this._titleTextComponent.color="white",this._titleTextComponent.fontSize=tD._DEFAULT_TEXT_RESOLUTION_Y/2,this._titleTextComponent.paddingLeft=tD._DEFAULT_TEXT_RESOLUTION_Y/4,i.addControl(this._titleTextComponent),e.useRightHandedSystem){let t=new tL.IU(0,0,1,1);this._contentPlate=(0,ta.x)("contentPlate_"+this.name,{size:1,sideOrientation:tN.P.BACKSIDE,frontUVs:t},e),this._backPlate=(0,ta.x)("backPlate_"+this.name,{size:1,sideOrientation:tN.P.FRONTSIDE},e)}else{let t=new tL.IU(0,0,1,1);this._contentPlate=(0,ta.x)("contentPlate_"+this.name,{size:1,sideOrientation:tN.P.FRONTSIDE,frontUVs:t},e),this._backPlate=(0,ta.x)("backPlate_"+this.name,{size:1,sideOrientation:tN.P.BACKSIDE},e)}this._titleBar.parent=t,this._titleBar.isNearGrabbable=!0,this._contentPlate.parent=t,this._backPlate.parent=t,this._attachContentPlateBehavior(),this._addControl(this._followButton),this._addControl(this._closeButton);let s=this._followButton,r=this._closeButton;s.node.parent=t,r.node.parent=t,this._positionElements();let o=_.S0.GetAssetUrl(tD.ASSETS_BASE_URL);return this._followButton.imageUrl=o+tD.FOLLOW_ICON_FILENAME,this._closeButton.imageUrl=o+tD.CLOSE_ICON_FILENAME,this._followButton.isBackplateVisible=!1,this._closeButton.isBackplateVisible=!1,this._followButton.onToggleObservable.add(e=>{this._defaultBehavior.followBehaviorEnabled=e,this._defaultBehavior.followBehaviorEnabled&&this._defaultBehavior.followBehavior.recenter()}),this._closeButton.onPointerClickObservable.add(()=>{this.dispose()}),t.rotationQuaternion=l.PT.Identity(),t.isVisible=!1,t}_attachContentPlateBehavior(){let e,t;this._contentDragBehavior.attach(this._contentPlate),this._contentDragBehavior.moveAttached=!1,this._contentDragBehavior.useObjectOrientationForDragging=!0,this._contentDragBehavior.updateDragPlane=!1;let i=new l.Pq,s=new l.Pq,r=new l.Pq,o=new l.Pq,a=new l.I9;this._contentDragBehavior.onDragStartObservable.add(a=>{this.node&&(e=this._contentViewport.clone(),t=this.node.computeWorldMatrix(!0),i.copyFrom(a.dragPlanePoint),s.set(this.dimensions.x,this.dimensions.y,p.bH),s.y-=this.titleBarHeight+this.titleBarMargin,l.Pq.TransformNormalToRef(s,t,s),r.copyFromFloats(0,1,0),l.Pq.TransformNormalToRef(r,t,r),o.copyFromFloats(1,0,0),l.Pq.TransformNormalToRef(o,t,o),r.normalize(),r.scaleInPlace(1/l.Pq.Dot(r,s)),o.normalize(),o.scaleInPlace(1/l.Pq.Dot(o,s)))});let n=new l.Pq;this._contentDragBehavior.onDragObservable.add(t=>{this.fitContentToDimensions||(n.copyFrom(t.dragPlanePoint),n.subtractInPlace(i),a.copyFromFloats(l.Pq.Dot(n,o),l.Pq.Dot(n,r)),this._contentViewport.x=tp.X.Clamp(e.x-n.x,0,1-this._contentViewport.width*this._contentScaleRatio),this._contentViewport.y=tp.X.Clamp(e.y-n.y,0,1-this._contentViewport.height*this._contentScaleRatio),this._applyContentViewport())})}_affectMaterial(e){this._titleBarMaterial=new ts(`${this.name} plateMaterial`,e.getScene()),this._contentMaterial=new e3(`${this.name} contentMaterial`,e.getScene()),this._contentMaterial.renderBorders=!0,this._backMaterial=new ts(`${this.name} backPlate`,e.getScene()),this._backMaterial.lineWidth=p.bH,this._backMaterial.radius=.005,this._backMaterial.backFaceCulling=!0,this._titleBar.material=this._titleBarMaterial,this._contentPlate.material=this._contentMaterial,this._backPlate.material=this._backMaterial,this._resetContent(),this._applyContentViewport()}_prepareNode(e){super._prepareNode(e),this._gizmo=new tA(this._host.utilityLayer),this._gizmo.attachedSlate=this,this._defaultBehavior=new tT,this._defaultBehavior.attach(this.node,[this._titleBar]),this._defaultBehavior.sixDofDragBehavior.onDragStartObservable.add(()=>{this._followButton.isToggled=!1}),this._positionChangedObserver=this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.add(()=>{this._gizmo.updateBoundingBox()}),this._updatePivot(),this.resetDefaultAspectAndPose(!1)}resetDefaultAspectAndPose(e=!0){if(!this._host||!this._host.utilityLayer||!this.node)return;let t=this._host.utilityLayer.utilityLayerScene,i=t.activeCamera;if(i){let s=i.getWorldMatrix(),r=l.Pq.TransformNormal(l.Pq.Backward(t.useRightHandedSystem),s);this.origin.setAll(0),this._gizmo.updateBoundingBox();let o=this.node.getAbsolutePivotPoint();this.node.position.equalsToFloats(0,0,0)&&this.node.position.copyFrom(i.position).subtractInPlace(r).subtractInPlace(o),this.node.rotationQuaternion=l.PT.FromLookDirectionLH(r,new l.Pq(0,1,0)),e&&(this.dimensions=this.defaultDimensions)}}dispose(){super.dispose(),this._titleBarMaterial.dispose(),this._contentMaterial.dispose(),this._titleBar.dispose(),this._titleBarTitle.dispose(),this._contentPlate.dispose(),this._backPlate.dispose(),this._followButton.dispose(),this._closeButton.dispose(),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.remove(this._positionChangedObserver),this._defaultBehavior.detach(),this._gizmo.dispose(),this._contentDragBehavior.detach()}}tD.ASSETS_BASE_URL="https://assets.babylonjs.com/core/MRTK/",tD.CLOSE_ICON_FILENAME="IconClose.png",tD.FOLLOW_ICON_FILENAME="IconFollowMe.png",tD._DEFAULT_TEXT_RESOLUTION_Y=102.4;class tk extends ez{constructor(e,t){super(t),this._currentMesh=e,this.pointerEnterAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1.1)},this.pointerOutAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/1.1)},this.pointerDownAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(.95)},this.pointerUpAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/.95)}}_getTypeName(){return"MeshButton3D"}_createNode(e){for(let e of this._currentMesh.getChildMeshes())this._injectGUI3DReservedDataStore(e).control=this;return this._currentMesh}_affectMaterial(e){}}class tV extends e4{get defaultBehavior(){return this._defaultBehavior}get isPinned(){return this._isPinned}set isPinned(e){if(this._pinButton.isToggled!==e){this._pinButton.isToggled=e;return}this._isPinned=e,e?this._defaultBehavior.followBehaviorEnabled=!1:this._defaultBehavior.followBehaviorEnabled=!0}_createPinButton(e){let t=new tv("pin"+this.name,!1);return t.imageUrl=_.S0.GetAssetUrl(tV._ASSETS_BASE_URL)+tV._PIN_ICON_FILENAME,t.parent=this,t._host=this._host,t.isToggleButton=!0,t.onToggleObservable.add(e=>{this.isPinned=e}),this._host.utilityLayer&&(t._prepareNode(this._host.utilityLayer.utilityLayerScene),t.scaling.scaleInPlace(e4.MENU_BUTTON_SCALE),t.node&&(t.node.parent=e)),t}_createNode(e){let t=super._createNode(e);return this._pinButton=this._createPinButton(t),this.isPinned=!1,this._defaultBehavior.attach(t,[this._backPlate]),this._defaultBehavior.followBehavior.ignoreCameraPitchAndRoll=!0,this._defaultBehavior.followBehavior.pitchOffset=-15,this._defaultBehavior.followBehavior.minimumDistance=.3,this._defaultBehavior.followBehavior.defaultDistance=.4,this._defaultBehavior.followBehavior.maximumDistance=.6,this._backPlate.isNearGrabbable=!0,t.isVisible=!1,t}_finalProcessing(){super._finalProcessing(),this._pinButton.position.copyFromFloats((this._backPlate.scaling.x+e4.MENU_BUTTON_SCALE)/2,this._backPlate.scaling.y/2,0)}constructor(e){super(e),this._isPinned=!1,this._defaultBehavior=new tT,this._dragObserver=this._defaultBehavior.sixDofDragBehavior.onDragObservable.add(()=>{this.isPinned=!0}),this.backPlateMargin=1}dispose(){super.dispose(),this._defaultBehavior.sixDofDragBehavior.onDragObservable.remove(this._dragObserver),this._defaultBehavior.detach()}}tV._ASSETS_BASE_URL="https://assets.babylonjs.com/core/MRTK/",tV._PIN_ICON_FILENAME="IconPin.png";class tU extends eQ{_mapGridNode(e,t){let i=e.mesh;if(!i)return;e.position=t.clone();let s=l.AA.Vector3[0];switch(s.copyFrom(t),this.orientation){case eW.FACEORIGIN_ORIENTATION:case eW.FACEFORWARD_ORIENTATION:s.addInPlace(new l.Pq(0,0,1)),i.lookAt(s);break;case eW.FACEFORWARDREVERSED_ORIENTATION:case eW.FACEORIGINREVERSED_ORIENTATION:s.addInPlace(new l.Pq(0,0,-1)),i.lookAt(s)}}}class tz extends eQ{constructor(){super(...arguments),this._iteration=100}get iteration(){return this._iteration}set iteration(e){this._iteration!==e&&(this._iteration=e,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}_mapGridNode(e,t){let i=e.mesh,s=this._scatterMapping(t);if(i){switch(this.orientation){case eW.FACEORIGIN_ORIENTATION:case eW.FACEFORWARD_ORIENTATION:i.lookAt(new l.Pq(0,0,1));break;case eW.FACEFORWARDREVERSED_ORIENTATION:case eW.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new l.Pq(0,0,-1))}e.position=s}}_scatterMapping(e){return e.x=(1-2*Math.random())*this._cellWidth,e.y=(1-2*Math.random())*this._cellHeight,e}_finalProcessing(){let e=[];for(let t of this._children)t.mesh&&e.push(t.mesh);for(let t=0;t<this._iteration;t++){e.sort((e,t)=>{let i=e.position.lengthSquared(),s=t.position.lengthSquared();return i<s?1:i>s?-1:0});let t=Math.pow(this.margin,2),i=Math.max(this._cellWidth,this._cellHeight),s=l.AA.Vector2[0],r=l.AA.Vector3[0];for(let o=0;o<e.length-1;o++)for(let a=o+1;a<e.length;a++)if(o!=a){e[a].position.subtractToRef(e[o].position,r),s.x=r.x,s.y=r.y;let n=s.lengthSquared()-t,l=Math.min(n,t);(n-=l)<Math.pow(i,2)&&(s.normalize(),r.scaleInPlace((i-Math.sqrt(n))*.5),e[a].position.addInPlace(r),e[o].position.subtractInPlace(r))}}}}let tW="mrdlSliderBarPixelShader",tQ=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B30(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void FastLinearTosRGB_B42(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Scale_RGB_B59(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Fragment_Main_B121(
float Sun_Intensity,
float Sun_Theta,
float Sun_Phi,
vec3 Normal,
vec4 Albedo,
float Fresnel_Reflect,
float Shininess,
vec3 Incident,
vec4 Horizon_Color,
vec4 Sky_Color,
vec4 Ground_Color,
float Indirect_Diffuse,
float Specular,
float Horizon_Power,
float Reflection,
vec4 Reflection_Sample,
vec4 Indirect_Sample,
float Sharpness,
float SSS,
float Subsurface,
vec4 Translucence,
vec4 Rim_Light,
vec4 Iridescence,
out vec4 Result)
{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}
void Bulge_B79(
bool Enabled,
vec3 Normal,
vec3 Tangent,
float Bulge_Height,
vec4 UV,
float Bulge_Radius,
vec3 ButtonN,
out vec3 New_Normal)
{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}
void SSS_B77(
vec3 ButtonN,
vec3 Normal,
vec3 Incident,
out float Result)
{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }
void FingerOcclusion_B67(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void FingerOcclusion_B68(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void Scale_Color_B91(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void From_HSV_B73(
float Hue,
float Saturation,
float Value,
float Alpha,
out vec4 Color)
{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}
void Fast_Fresnel_B122(
float Front_Reflect,
float Edge_Reflect,
float Power,
vec3 Normal,
vec3 Incident,
out float Transmit,
out float Reflect)
{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(.01-d,Power);Transmit=1.0-Reflect;}
void Mapped_Environment_B51(
sampler2D Reflected_Environment,
sampler2D Indirect_Environment,
vec3 Dir,
out vec4 Reflected_Color,
out vec4 Indirect_Diffuse)
{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}
vec4 SampleEnv_Bid50(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)
{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }
return C;}
void Sky_Environment_B50(
vec3 Normal,
vec3 Reflected,
vec4 Sky_Color,
vec4 Horizon_Color,
vec4 Ground_Color,
float Horizon_Power,
out vec4 Reflected_Color,
out vec4 Indirect_Color)
{Reflected_Color=SampleEnv_Bid50(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}
void Min_Segment_Distance_B65(
vec3 P0,
vec3 P1,
vec3 Q0,
vec3 Q1,
out vec3 NearP,
out vec3 NearQ,
out float Distance)
{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}
if (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}
sc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}
void To_XYZ_B74(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Finger_Positions_B64(
vec3 Left_Index_Pos,
vec3 Right_Index_Pos,
vec3 Left_Index_Middle_Pos,
vec3 Right_Index_Middle_Pos,
out vec3 Left_Index,
out vec3 Right_Index,
out vec3 Left_Index_Middle,
out vec3 Right_Index_Middle)
{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}
void VaryHSV_B108(
vec3 HSV_In,
float Hue_Shift,
float Saturation_Shift,
float Value_Shift,
out vec3 HSV_Out)
{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}
void Remap_Range_B114(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void To_HSV_B75(
vec4 Color,
out float Hue,
out float Saturation,
out float Value,
out float Alpha,
out vec3 HSV)
{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}
void Code_B110(
float X,
out float Result)
{Result=(acos(X)/3.14159-0.5)*2.0;}
void Rim_Light_B132(
vec3 Front,
vec3 Normal,
vec3 Incident,
float Rim_Intensity,
sampler2D Texture,
out vec4 Result)
{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}
void main()
{vec4 Blob_Color_Q30;
#if BLOB_ENABLE
Blob_Fragment_B30(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q30);
#else
Blob_Color_Q30=vec4(0,0,0,0);
#endif
vec3 Incident_Q39=normalize(vPosition-cameraPosition);vec3 Normalized_Q38=normalize(vNormal);vec3 Normalized_Q71=normalize(vTangent);vec4 Color_Q83;
#if DECAL_ENABLE
Color_Q83=texture(_Decal_,vUV);
#else
Color_Q83=vec4(0,0,0,0);
#endif
float X_Q90;float Y_Q90;float Z_Q90;float W_Q90;X_Q90=vExtra1.x;Y_Q90=vExtra1.y;Z_Q90=vExtra1.z;W_Q90=vExtra1.w;vec4 Linear_Q43;Linear_Q43.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q43.a=_Sky_Color_.a;vec4 Linear_Q44;Linear_Q44.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q44.a=_Horizon_Color_.a;vec4 Linear_Q45;Linear_Q45.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q45.a=_Ground_Color_.a;vec3 Left_Index_Q64;vec3 Right_Index_Q64;vec3 Left_Index_Middle_Q64;vec3 Right_Index_Middle_Q64;Finger_Positions_B64(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q64,Right_Index_Q64,Left_Index_Middle_Q64,Right_Index_Middle_Q64);vec4 Linear_Q46;Linear_Q46.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q46.a=_Albedo_.a;vec3 Normalized_Q107=normalize(vBinormal);vec3 Incident_Q70=normalize(vPosition-cameraPosition);vec3 New_Normal_Q79;Bulge_B79(_Bulge_Enabled_,Normalized_Q38,Normalized_Q71,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q79);float Result_Q77;SSS_B77(vBinormal,New_Normal_Q79,Incident_Q39,Result_Q77);vec4 Result_Q91;Scale_Color_B91(Color_Q83,X_Q90,Result_Q91);float Transmit_Q122;float Reflect_Q122;Fast_Fresnel_B122(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q79,Incident_Q39,Transmit_Q122,Reflect_Q122);float Product_Q125=Y_Q90*Y_Q90;vec3 NearP_Q65;vec3 NearQ_Q65;float Distance_Q65;Min_Segment_Distance_B65(Left_Index_Q64,Left_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q65,NearQ_Q65,Distance_Q65);vec3 NearP_Q63;vec3 NearQ_Q63;float Distance_Q63;Min_Segment_Distance_B65(Right_Index_Q64,Right_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q63,NearQ_Q63,Distance_Q63);vec3 Reflected_Q47=reflect(Incident_Q39,New_Normal_Q79);vec4 Product_Q103=Linear_Q46*vec4(1,1,1,1);vec4 Result_Q132;Rim_Light_B132(Normalized_Q107,Normalized_Q38,Incident_Q70,_Rim_Intensity_,_Rim_Texture_,Result_Q132);float Dot_Q72=dot(Incident_Q70, Normalized_Q71);float MaxAB_Q123=max(Reflect_Q122,Product_Q125);float NotInShadow_Q67;
#if OCCLUSION_ENABLED
FingerOcclusion_B67(_Width_,Distance_Q65,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q65,_Clip_Fade_,NotInShadow_Q67);
#else
NotInShadow_Q67=1.0;
#endif
float NotInShadow_Q68;
#if OCCLUSION_ENABLED
FingerOcclusion_B68(_Width_,Distance_Q63,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q63,_Clip_Fade_,NotInShadow_Q68);
#else
NotInShadow_Q68=1.0;
#endif
vec4 Reflected_Color_Q51;vec4 Indirect_Diffuse_Q51;
#if ENV_ENABLE
Mapped_Environment_B51(_Reflection_Map_,_Indirect_Environment_,Reflected_Q47,Reflected_Color_Q51,Indirect_Diffuse_Q51);
#else
Reflected_Color_Q51=vec4(0,0,0,1);Indirect_Diffuse_Q51=vec4(0,0,0,1);
#endif
vec4 Reflected_Color_Q50;vec4 Indirect_Color_Q50;
#if SKY_ENABLED
Sky_Environment_B50(New_Normal_Q79,Reflected_Q47,Linear_Q43,Linear_Q44,Linear_Q45,_Horizon_Power_,Reflected_Color_Q50,Indirect_Color_Q50);
#else
Reflected_Color_Q50=vec4(0,0,0,1);Indirect_Color_Q50=vec4(0,0,0,1);
#endif
float Hue_Q75;float Saturation_Q75;float Value_Q75;float Alpha_Q75;vec3 HSV_Q75;To_HSV_B75(Product_Q103,Hue_Q75,Saturation_Q75,Value_Q75,Alpha_Q75,HSV_Q75);float Hue_Q127;float Saturation_Q127;float Value_Q127;float Alpha_Q127;vec3 HSV_Q127;To_HSV_B75(Result_Q132,Hue_Q127,Saturation_Q127,Value_Q127,Alpha_Q127,HSV_Q127);float Result_Q110;Code_B110(Dot_Q72,Result_Q110);float AbsA_Q76=abs(Result_Q110);float MinAB_Q58=min(NotInShadow_Q67,NotInShadow_Q68);vec4 Sum_Q48=Reflected_Color_Q51+Reflected_Color_Q50;vec4 Sum_Q49=Indirect_Diffuse_Q51+Indirect_Color_Q50;vec3 HSV_Out_Q126;VaryHSV_B108(HSV_Q127,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q126);float Out_Q114;Remap_Range_B114(-1.0,1.0,0.0,1.0,Result_Q110,Out_Q114);float Product_Q106;Product_Q106=AbsA_Q76*_Hue_Shift_;float X_Q128;float Y_Q128;float Z_Q128;To_XYZ_B74(HSV_Out_Q126,X_Q128,Y_Q128,Z_Q128);vec2 Vec2_Q112=vec2(Out_Q114,0.5);vec3 HSV_Out_Q108;VaryHSV_B108(HSV_Q75,Product_Q106,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q108);vec4 Color_Q129;From_HSV_B73(X_Q128,Y_Q128,Z_Q128,0.0,Color_Q129);vec4 Color_Q111;
#if IRIDESCENCE_ENABLED
Color_Q111=texture(_Iridescence_Texture_,Vec2_Q112);
#else
Color_Q111=vec4(0,0,0,0);
#endif
float X_Q74;float Y_Q74;float Z_Q74;To_XYZ_B74(HSV_Out_Q108,X_Q74,Y_Q74,Z_Q74);vec4 Result_Q131=_Rim_Intensity_*Color_Q129;vec4 Result_Q113=_Iridescence_Intensity_*Color_Q111;vec4 Color_Q73;From_HSV_B73(X_Q74,Y_Q74,Z_Q74,0.0,Color_Q73);vec4 Result_Q84=Result_Q91+(1.0-Result_Q91.a)*Color_Q73;vec4 Result_Q121;Fragment_Main_B121(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q79,Result_Q84,MaxAB_Q123,_Shininess_,Incident_Q39,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q48,Sum_Q49,_Sharpness_,Result_Q77,_Subsurface_,vec4(0,0,0,0),Result_Q131,Result_Q113,Result_Q121);vec4 Result_Q59;Scale_RGB_B59(Result_Q121,MinAB_Q58,Result_Q59);vec4 sRGB_Q42;FastLinearTosRGB_B42(Result_Q59,sRGB_Q42);vec4 Result_Q31=Blob_Color_Q30+(1.0-Blob_Color_Q30.a)*sRGB_Q42;vec4 Result_Q40=Result_Q31; Result_Q40.a=1.0;vec4 Out_Color=Result_Q40;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[tW]||(ej.l.ShadersStore[tW]=tQ);let tG="mrdlSliderBarVertexShader",tH=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B12(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Object_To_World_Normal_B32(
vec3 Nrm_Object,
out vec3 Nrm_World)
{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}
void Blob_Vertex_B23(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Blob_Vertex_B24(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B130(
float Anisotropy,
vec3 P,
float Radius,
float Bevel,
vec3 Normal_Object,
float ScaleZ,
float Stretch,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir,
out vec3 New_Normal)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}
void Object_To_World_Dir_B60(
vec3 Dir_Object,
out vec3 Normal_World,
out vec3 Normal_World_N,
out float Normal_Length)
{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}
void To_XYZ_B78(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Conditional_Float_B93(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Object_To_World_Dir_B28(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void Pick_Radius_B69(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Conditional_Float_B36(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Greater_Than_B37(
float Left,
float Right,
out bool Not_Greater_Than,
out bool Greater_Than)
{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}
void Remap_Range_B105(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void main()
{vec2 XY_Q85;XY_Q85=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q27;vec3 Tangent_World_N_Q27;float Tangent_Length_Q27;Tangent_World_Q27=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q27=length(Tangent_World_Q27);Tangent_World_N_Q27=Tangent_World_Q27/Tangent_Length_Q27;vec3 Normal_World_Q60;vec3 Normal_World_N_Q60;float Normal_Length_Q60;Object_To_World_Dir_B60(vec3(0,0,1),Normal_World_Q60,Normal_World_N_Q60,Normal_Length_Q60);float X_Q78;float Y_Q78;float Z_Q78;To_XYZ_B78(position,X_Q78,Y_Q78,Z_Q78);vec3 Nrm_World_Q26;Nrm_World_Q26=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q28;vec3 Binormal_World_N_Q28;float Binormal_Length_Q28;Object_To_World_Dir_B28(vec3(0,1,0),Binormal_World_Q28,Binormal_World_N_Q28,Binormal_Length_Q28);float Anisotropy_Q29=Tangent_Length_Q27/Binormal_Length_Q28;float Result_Q69;Pick_Radius_B69(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q69);float Anisotropy_Q53=Binormal_Length_Q28/Normal_Length_Q60;bool Not_Greater_Than_Q37;bool Greater_Than_Q37;Greater_Than_B37(Z_Q78,0.0,Not_Greater_Than_Q37,Greater_Than_Q37);vec4 Linear_Q101;Linear_Q101.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q101.a=_Left_Color_.a;vec4 Linear_Q102;Linear_Q102.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q102.a=_Right_Color_.a;vec3 Difference_Q61=vec3(0,0,0)-Normal_World_N_Q60;vec4 Out_Color_Q34=vec4(X_Q78,Y_Q78,Z_Q78,1);float Result_Q36;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_,_Bevel_Front_,Result_Q36);float Result_Q94;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q94);vec3 New_P_Q130;vec2 New_UV_Q130;float Radial_Gradient_Q130;vec3 Radial_Dir_Q130;vec3 New_Normal_Q130;Move_Verts_B130(Anisotropy_Q29,position,Result_Q69,Result_Q36,normal,Anisotropy_Q53,Result_Q94,New_P_Q130,New_UV_Q130,Radial_Gradient_Q130,Radial_Dir_Q130,New_Normal_Q130);float X_Q98;float Y_Q98;X_Q98=New_UV_Q130.x;Y_Q98=New_UV_Q130.y;vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q130,Pos_World_Q12);vec3 Nrm_World_Q32;Object_To_World_Normal_B32(New_Normal_Q130,Nrm_World_Q32);vec4 Blob_Info_Q23;
#if BLOB_ENABLE
Blob_Vertex_B23(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q23);
#else
Blob_Info_Q23=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q24;
#if BLOB_ENABLE_2
Blob_Vertex_B24(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q24);
#else
Blob_Info_Q24=vec4(0,0,0,0);
#endif
float Out_Q105;Remap_Range_B105(0.0,1.0,0.0,1.0,X_Q98,Out_Q105);float X_Q86;float Y_Q86;float Z_Q86;To_XYZ_B78(Nrm_World_Q32,X_Q86,Y_Q86,Z_Q86);vec4 Color_At_T_Q97=mix(Linear_Q101,Linear_Q102,Out_Q105);float Minus_F_Q87=-Z_Q86;float R_Q99;float G_Q99;float B_Q99;float A_Q99;R_Q99=Color_At_T_Q97.r; G_Q99=Color_At_T_Q97.g; B_Q99=Color_At_T_Q97.b; A_Q99=Color_At_T_Q97.a;float ClampF_Q88=clamp(0.0,Minus_F_Q87,1.0);float Result_Q93;Conditional_Float_B93(_Decal_Front_Only_,ClampF_Q88,1.0,Result_Q93);vec4 Vec4_Q89=vec4(Result_Q93,Radial_Gradient_Q130,G_Q99,B_Q99);vec3 Position=Pos_World_Q12;vec3 Normal=Nrm_World_Q32;vec2 UV=XY_Q85;vec3 Tangent=Tangent_World_N_Q27;vec3 Binormal=Difference_Q61;vec4 Color=Out_Color_Q34;vec4 Extra1=Vec4_Q89;vec4 Extra2=Blob_Info_Q23;vec4 Extra3=Blob_Info_Q24;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;ej.l.ShadersStore[tG]||(ej.l.ShadersStore[tG]=tH);class tK extends eX.M{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class tX extends eY.E{constructor(e,t){super(e,t),this.radius=.6,this.bevelFront=.6,this.bevelFrontStretch=.077,this.bevelBack=0,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=1.102,this.sunTheta=.76,this.sunPhi=.526,this.indirectDiffuse=.658,this.albedo=new U.ov(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=0,this.leftGradientColor=new U.ov(.0117647,.505882,.996078,1),this.rightGradientColor=new U.ov(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.13,this.skyColor=new U.ov(.0117647,.964706,.996078,1),this.horizonColor=new U.ov(.0117647,.333333,.996078,1),this.groundColor=new U.ov(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new l.Pq(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new l.Pq(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new E.g("",this.getScene()),this.leftIndexPosition=new l.Pq(0,0,1),this.rightIndexPosition=new l.Pq(-1,-1,-1),this.leftIndexMiddlePosition=new l.Pq(0,0,0),this.rightIndexMiddlePosition=new l.Pq(0,0,0),this.decalScaleXY=new l.I9(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new l.IU(.5,0,-.55,1),this.globaRightIndexTipPosition=new l.IU(0,0,0,1),this.globalLeftThumbTipPosition=new l.IU(.5,0,-.55,1),this.globalRightThumbTipPosition=new l.IU(0,0,0,1),this.globalLeftIndexMiddlePosition=new l.IU(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new l.IU(0,0,0,1),this.alphaMode=R.Y.ALPHA_DISABLE,this.backFaceCulling=!1;let i=_.S0.GetAssetUrl(tX.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new E.g(i,this.getScene(),!0,!1,E.g.NEAREST_SAMPLINGMODE),this._decalTexture=new E.g("",this.getScene()),this._reflectionMapTexture=new E.g("",this.getScene()),this._indirectEnvTexture=new E.g("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new tK);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Rim_Texture_","_Iridescence_Texture_"],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlSliderBar",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){if(!i.materialDefines)return;let s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",+!!this.bulgeEnabled),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",+!!this.decalFrontOnly),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(e){return y.p.Clone(()=>new tX(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.MRDLSliderBarMaterial",e}getClassName(){return"MRDLSliderBarMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new tX(e.name,t),e,t,i)}}tX.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png",(0,o.Cg)([(0,T.lK)()],tX.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bevelFront",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bevelFrontStretch",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bevelBack",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bevelBackStretch",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"radiusTopLeft",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"radiusTopRight",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"radiusBottomLeft",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"radiusBottomRight",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bulgeEnabled",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bulgeHeight",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"bulgeRadius",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"sunIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"sunTheta",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"sunPhi",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"indirectDiffuse",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"albedo",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"specular",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"shininess",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"sharpness",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"subsurface",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"leftGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rightGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"reflection",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"frontReflect",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"edgeReflect",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"power",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"skyColor",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"horizonColor",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"groundColor",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"horizonPower",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"width",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"fuzz",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"minFuzz",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"clipFade",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"hueShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"saturationShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"valueShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobPosition",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobFarSize",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobNearDistance",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobPulse",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobFade",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobPosition2",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobNearSize2",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobPulse2",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobFade2",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"blobTexture",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"leftIndexPosition",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rightIndexPosition",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"leftIndexMiddlePosition",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rightIndexMiddlePosition",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"decalScaleXY",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"decalFrontOnly",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rimIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rimHueShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rimSaturationShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"rimValueShift",void 0),(0,o.Cg)([(0,T.lK)()],tX.prototype,"iridescenceIntensity",void 0),(0,C.Y5)("BABYLON.GUI.MRDLSliderBarMaterial",tX);let tY="mrdlSliderThumbPixelShader",tq=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B180(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void FastLinearTosRGB_B192(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Scale_RGB_B209(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Fragment_Main_B271(
float Sun_Intensity,
float Sun_Theta,
float Sun_Phi,
vec3 Normal,
vec4 Albedo,
float Fresnel_Reflect,
float Shininess,
vec3 Incident,
vec4 Horizon_Color,
vec4 Sky_Color,
vec4 Ground_Color,
float Indirect_Diffuse,
float Specular,
float Horizon_Power,
float Reflection,
vec4 Reflection_Sample,
vec4 Indirect_Sample,
float Sharpness,
float SSS,
float Subsurface,
vec4 Translucence,
vec4 Rim_Light,
vec4 Iridescence,
out vec4 Result)
{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}
void Bulge_B229(
bool Enabled,
vec3 Normal,
vec3 Tangent,
float Bulge_Height,
vec4 UV,
float Bulge_Radius,
vec3 ButtonN,
out vec3 New_Normal)
{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}
void SSS_B227(
vec3 ButtonN,
vec3 Normal,
vec3 Incident,
out float Result)
{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }
void FingerOcclusion_B217(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void FingerOcclusion_B218(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void Scale_Color_B241(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void From_HSV_B223(
float Hue,
float Saturation,
float Value,
float Alpha,
out vec4 Color)
{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}
void Fast_Fresnel_B272(
float Front_Reflect,
float Edge_Reflect,
float Power,
vec3 Normal,
vec3 Incident,
out float Transmit,
out float Reflect)
{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(1.0-d,Power);Transmit=1.0-Reflect;}
void Mapped_Environment_B201(
sampler2D Reflected_Environment,
sampler2D Indirect_Environment,
vec3 Dir,
out vec4 Reflected_Color,
out vec4 Indirect_Diffuse)
{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}
vec4 SampleEnv_Bid200(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)
{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }
return C;}
void Sky_Environment_B200(
vec3 Normal,
vec3 Reflected,
vec4 Sky_Color,
vec4 Horizon_Color,
vec4 Ground_Color,
float Horizon_Power,
out vec4 Reflected_Color,
out vec4 Indirect_Color)
{Reflected_Color=SampleEnv_Bid200(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}
void Min_Segment_Distance_B215(
vec3 P0,
vec3 P1,
vec3 Q0,
vec3 Q1,
out vec3 NearP,
out vec3 NearQ,
out float Distance)
{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}
if (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}
sc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}
void To_XYZ_B224(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Finger_Positions_B214(
vec3 Left_Index_Pos,
vec3 Right_Index_Pos,
vec3 Left_Index_Middle_Pos,
vec3 Right_Index_Middle_Pos,
out vec3 Left_Index,
out vec3 Right_Index,
out vec3 Left_Index_Middle,
out vec3 Right_Index_Middle)
{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}
void VaryHSV_B258(
vec3 HSV_In,
float Hue_Shift,
float Saturation_Shift,
float Value_Shift,
out vec3 HSV_Out)
{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}
void Remap_Range_B264(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void To_HSV_B225(
vec4 Color,
out float Hue,
out float Saturation,
out float Value,
out float Alpha,
out vec3 HSV)
{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}
void Code_B260(
float X,
out float Result)
{Result=(acos(X)/3.14159-0.5)*2.0;}
void Rim_Light_B282(
vec3 Front,
vec3 Normal,
vec3 Incident,
float Rim_Intensity,
sampler2D Texture,
out vec4 Result)
{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}
void main()
{vec4 Blob_Color_Q180;
#if BLOB_ENABLE
Blob_Fragment_B180(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q180);
#else
Blob_Color_Q180=vec4(0,0,0,0);
#endif
vec3 Incident_Q189=normalize(vPosition-cameraPosition);vec3 Normalized_Q188=normalize(vNormal);vec3 Normalized_Q221=normalize(vTangent);vec4 Color_Q233;
#if DECAL_ENABLE
Color_Q233=texture(_Decal_,vUV);
#else
Color_Q233=vec4(0,0,0,0);
#endif
float X_Q240;float Y_Q240;float Z_Q240;float W_Q240;X_Q240=vExtra1.x;Y_Q240=vExtra1.y;Z_Q240=vExtra1.z;W_Q240=vExtra1.w;vec4 Linear_Q193;Linear_Q193.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q193.a=_Sky_Color_.a;vec4 Linear_Q194;Linear_Q194.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q194.a=_Horizon_Color_.a;vec4 Linear_Q195;Linear_Q195.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q195.a=_Ground_Color_.a;vec3 Left_Index_Q214;vec3 Right_Index_Q214;vec3 Left_Index_Middle_Q214;vec3 Right_Index_Middle_Q214;Finger_Positions_B214(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q214,Right_Index_Q214,Left_Index_Middle_Q214,Right_Index_Middle_Q214);vec4 Linear_Q196;Linear_Q196.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q196.a=_Albedo_.a;vec3 Normalized_Q257=normalize(vBinormal);vec3 Incident_Q220=normalize(vPosition-cameraPosition);vec3 New_Normal_Q229;Bulge_B229(_Bulge_Enabled_,Normalized_Q188,Normalized_Q221,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q229);float Result_Q227;SSS_B227(vBinormal,New_Normal_Q229,Incident_Q189,Result_Q227);vec4 Result_Q241;Scale_Color_B241(Color_Q233,X_Q240,Result_Q241);float Transmit_Q272;float Reflect_Q272;Fast_Fresnel_B272(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q229,Incident_Q189,Transmit_Q272,Reflect_Q272);float Product_Q275=Y_Q240*Y_Q240;vec3 NearP_Q215;vec3 NearQ_Q215;float Distance_Q215;Min_Segment_Distance_B215(Left_Index_Q214,Left_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q215,NearQ_Q215,Distance_Q215);vec3 NearP_Q213;vec3 NearQ_Q213;float Distance_Q213;Min_Segment_Distance_B215(Right_Index_Q214,Right_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q213,NearQ_Q213,Distance_Q213);vec3 Reflected_Q197=reflect(Incident_Q189,New_Normal_Q229);vec4 Product_Q253=Linear_Q196*vec4(1,1,1,1);vec4 Result_Q282;Rim_Light_B282(Normalized_Q257,Normalized_Q188,Incident_Q220,_Rim_Intensity_,_Rim_Texture_,Result_Q282);float Dot_Q222=dot(Incident_Q220, Normalized_Q221);float MaxAB_Q273=max(Reflect_Q272,Product_Q275);float NotInShadow_Q217;
#if OCCLUSION_ENABLED
FingerOcclusion_B217(_Width_,Distance_Q215,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q215,_Clip_Fade_,NotInShadow_Q217);
#else
NotInShadow_Q217=1.0;
#endif
float NotInShadow_Q218;
#if OCCLUSION_ENABLED
FingerOcclusion_B218(_Width_,Distance_Q213,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q213,_Clip_Fade_,NotInShadow_Q218);
#else
NotInShadow_Q218=1.0;
#endif
vec4 Reflected_Color_Q201;vec4 Indirect_Diffuse_Q201;
#if ENV_ENABLE
Mapped_Environment_B201(_Reflection_Map_,_Indirect_Environment_,Reflected_Q197,Reflected_Color_Q201,Indirect_Diffuse_Q201);
#else
Reflected_Color_Q201=vec4(0,0,0,1);Indirect_Diffuse_Q201=vec4(0,0,0,1);
#endif
vec4 Reflected_Color_Q200;vec4 Indirect_Color_Q200;
#if SKY_ENABLED
Sky_Environment_B200(New_Normal_Q229,Reflected_Q197,Linear_Q193,Linear_Q194,Linear_Q195,_Horizon_Power_,Reflected_Color_Q200,Indirect_Color_Q200);
#else
Reflected_Color_Q200=vec4(0,0,0,1);Indirect_Color_Q200=vec4(0,0,0,1);
#endif
float Hue_Q225;float Saturation_Q225;float Value_Q225;float Alpha_Q225;vec3 HSV_Q225;To_HSV_B225(Product_Q253,Hue_Q225,Saturation_Q225,Value_Q225,Alpha_Q225,HSV_Q225);float Hue_Q277;float Saturation_Q277;float Value_Q277;float Alpha_Q277;vec3 HSV_Q277;To_HSV_B225(Result_Q282,Hue_Q277,Saturation_Q277,Value_Q277,Alpha_Q277,HSV_Q277);float Result_Q260;Code_B260(Dot_Q222,Result_Q260);float AbsA_Q226=abs(Result_Q260);float MinAB_Q208=min(NotInShadow_Q217,NotInShadow_Q218);vec4 Sum_Q198=Reflected_Color_Q201+Reflected_Color_Q200;vec4 Sum_Q199=Indirect_Diffuse_Q201+Indirect_Color_Q200;vec3 HSV_Out_Q276;VaryHSV_B258(HSV_Q277,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q276);float Out_Q264;Remap_Range_B264(-1.0,1.0,0.0,1.0,Result_Q260,Out_Q264);float Product_Q256;Product_Q256=AbsA_Q226*_Hue_Shift_;float X_Q278;float Y_Q278;float Z_Q278;To_XYZ_B224(HSV_Out_Q276,X_Q278,Y_Q278,Z_Q278);vec2 Vec2_Q262=vec2(Out_Q264,0.5);vec3 HSV_Out_Q258;VaryHSV_B258(HSV_Q225,Product_Q256,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q258);vec4 Color_Q279;From_HSV_B223(X_Q278,Y_Q278,Z_Q278,0.0,Color_Q279);vec4 Color_Q261;
#if IRIDESCENCE_ENABLED
Color_Q261=texture(_Iridescence_Texture_,Vec2_Q262);
#else
Color_Q261=vec4(0,0,0,0);
#endif
float X_Q224;float Y_Q224;float Z_Q224;To_XYZ_B224(HSV_Out_Q258,X_Q224,Y_Q224,Z_Q224);vec4 Result_Q281=_Rim_Intensity_*Color_Q279;vec4 Result_Q263=_Iridescence_Intensity_*Color_Q261;vec4 Color_Q223;From_HSV_B223(X_Q224,Y_Q224,Z_Q224,0.0,Color_Q223);vec4 Result_Q234=Result_Q241+(1.0-Result_Q241.a)*Color_Q223;vec4 Result_Q271;Fragment_Main_B271(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q229,Result_Q234,MaxAB_Q273,_Shininess_,Incident_Q189,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q198,Sum_Q199,_Sharpness_,Result_Q227,_Subsurface_,vec4(0,0,0,0),Result_Q281,Result_Q263,Result_Q271);vec4 Result_Q209;Scale_RGB_B209(Result_Q271,MinAB_Q208,Result_Q209);vec4 sRGB_Q192;FastLinearTosRGB_B192(Result_Q209,sRGB_Q192);vec4 Result_Q181=Blob_Color_Q180+(1.0-Blob_Color_Q180.a)*sRGB_Q192;vec4 Result_Q190=Result_Q181; Result_Q190.a=1.0;vec4 Out_Color=Result_Q190;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[tY]||(ej.l.ShadersStore[tY]=tq);let tj="mrdlSliderThumbVertexShader",t$=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B162(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Object_To_World_Normal_B182(
vec3 Nrm_Object,
out vec3 Nrm_World)
{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}
void Blob_Vertex_B173(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Blob_Vertex_B174(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B280(
float Anisotropy,
vec3 P,
float Radius,
float Bevel,
vec3 Normal_Object,
float ScaleZ,
float Stretch,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir,
out vec3 New_Normal)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}
void Object_To_World_Dir_B210(
vec3 Dir_Object,
out vec3 Normal_World,
out vec3 Normal_World_N,
out float Normal_Length)
{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}
void To_XYZ_B228(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Conditional_Float_B243(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Object_To_World_Dir_B178(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void Pick_Radius_B219(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Conditional_Float_B186(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Greater_Than_B187(
float Left,
float Right,
out bool Not_Greater_Than,
out bool Greater_Than)
{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}
void Remap_Range_B255(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void main()
{vec2 XY_Q235;XY_Q235=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q177;vec3 Tangent_World_N_Q177;float Tangent_Length_Q177;Tangent_World_Q177=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q177=length(Tangent_World_Q177);Tangent_World_N_Q177=Tangent_World_Q177/Tangent_Length_Q177;vec3 Normal_World_Q210;vec3 Normal_World_N_Q210;float Normal_Length_Q210;Object_To_World_Dir_B210(vec3(0,0,1),Normal_World_Q210,Normal_World_N_Q210,Normal_Length_Q210);float X_Q228;float Y_Q228;float Z_Q228;To_XYZ_B228(position,X_Q228,Y_Q228,Z_Q228);vec3 Nrm_World_Q176;Nrm_World_Q176=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q178;vec3 Binormal_World_N_Q178;float Binormal_Length_Q178;Object_To_World_Dir_B178(vec3(0,1,0),Binormal_World_Q178,Binormal_World_N_Q178,Binormal_Length_Q178);float Anisotropy_Q179=Tangent_Length_Q177/Binormal_Length_Q178;float Result_Q219;Pick_Radius_B219(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q219);float Anisotropy_Q203=Binormal_Length_Q178/Normal_Length_Q210;bool Not_Greater_Than_Q187;bool Greater_Than_Q187;Greater_Than_B187(Z_Q228,0.0,Not_Greater_Than_Q187,Greater_Than_Q187);vec4 Linear_Q251;Linear_Q251.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q251.a=_Left_Color_.a;vec4 Linear_Q252;Linear_Q252.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q252.a=_Right_Color_.a;vec3 Difference_Q211=vec3(0,0,0)-Normal_World_N_Q210;vec4 Out_Color_Q184=vec4(X_Q228,Y_Q228,Z_Q228,1);float Result_Q186;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_,_Bevel_Front_,Result_Q186);float Result_Q244;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q244);vec3 New_P_Q280;vec2 New_UV_Q280;float Radial_Gradient_Q280;vec3 Radial_Dir_Q280;vec3 New_Normal_Q280;Move_Verts_B280(Anisotropy_Q179,position,Result_Q219,Result_Q186,normal,Anisotropy_Q203,Result_Q244,New_P_Q280,New_UV_Q280,Radial_Gradient_Q280,Radial_Dir_Q280,New_Normal_Q280);float X_Q248;float Y_Q248;X_Q248=New_UV_Q280.x;Y_Q248=New_UV_Q280.y;vec3 Pos_World_Q162;Object_To_World_Pos_B162(New_P_Q280,Pos_World_Q162);vec3 Nrm_World_Q182;Object_To_World_Normal_B182(New_Normal_Q280,Nrm_World_Q182);vec4 Blob_Info_Q173;
#if BLOB_ENABLE
Blob_Vertex_B173(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q173);
#else
Blob_Info_Q173=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q174;
#if BLOB_ENABLE_2
Blob_Vertex_B174(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q174);
#else
Blob_Info_Q174=vec4(0,0,0,0);
#endif
float Out_Q255;Remap_Range_B255(0.0,1.0,0.0,1.0,X_Q248,Out_Q255);float X_Q236;float Y_Q236;float Z_Q236;To_XYZ_B228(Nrm_World_Q182,X_Q236,Y_Q236,Z_Q236);vec4 Color_At_T_Q247=mix(Linear_Q251,Linear_Q252,Out_Q255);float Minus_F_Q237=-Z_Q236;float R_Q249;float G_Q249;float B_Q249;float A_Q249;R_Q249=Color_At_T_Q247.r; G_Q249=Color_At_T_Q247.g; B_Q249=Color_At_T_Q247.b; A_Q249=Color_At_T_Q247.a;float ClampF_Q238=clamp(0.0,Minus_F_Q237,1.0);float Result_Q243;Conditional_Float_B243(_Decal_Front_Only_,ClampF_Q238,1.0,Result_Q243);vec4 Vec4_Q239=vec4(Result_Q243,Radial_Gradient_Q280,G_Q249,B_Q249);vec3 Position=Pos_World_Q162;vec3 Normal=Nrm_World_Q182;vec2 UV=XY_Q235;vec3 Tangent=Tangent_World_N_Q177;vec3 Binormal=Difference_Q211;vec4 Color=Out_Color_Q184;vec4 Extra1=Vec4_Q239;vec4 Extra2=Blob_Info_Q173;vec4 Extra3=Blob_Info_Q174;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;ej.l.ShadersStore[tj]||(ej.l.ShadersStore[tj]=t$);class tZ extends eX.M{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class tJ extends eY.E{constructor(e,t){super(e,t),this.radius=.157,this.bevelFront=.065,this.bevelFrontStretch=.077,this.bevelBack=.031,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=2,this.sunTheta=.937,this.sunPhi=.555,this.indirectDiffuse=1,this.albedo=new U.ov(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=.31,this.leftGradientColor=new U.ov(.0117647,.505882,.996078,1),this.rightGradientColor=new U.ov(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.1,this.skyColor=new U.ov(.0117647,.960784,.996078,1),this.horizonColor=new U.ov(.0117647,.333333,.996078,1),this.groundColor=new U.ov(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new l.Pq(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new l.Pq(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new E.g("",this.getScene()),this.leftIndexPosition=new l.Pq(0,0,1),this.rightIndexPosition=new l.Pq(-1,-1,-1),this.leftIndexMiddlePosition=new l.Pq(0,0,0),this.rightIndexMiddlePosition=new l.Pq(0,0,0),this.decalScaleXY=new l.I9(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new l.IU(.5,0,-.55,1),this.globaRightIndexTipPosition=new l.IU(0,0,0,1),this.globalLeftThumbTipPosition=new l.IU(.5,0,-.55,1),this.globalRightThumbTipPosition=new l.IU(0,0,0,1),this.globalLeftIndexMiddlePosition=new l.IU(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new l.IU(0,0,0,1),this.alphaMode=R.Y.ALPHA_DISABLE,this.backFaceCulling=!1;let i=_.S0.GetAssetUrl(tJ.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new E.g(i,t,!0,!1,E.g.NEAREST_SAMPLINGMODE),this._decalTexture=new E.g("",this.getScene()),this._reflectionMapTexture=new E.g("",this.getScene()),this._indirectEnvTexture=new E.g("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new tZ);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Rim_Texture_","_Iridescence_Texture_"],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlSliderThumb",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){if(!i.materialDefines)return;let s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",+!!this.bulgeEnabled),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",+!!this.decalFrontOnly),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(e){return y.p.Clone(()=>new tJ(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.MRDLSliderThumbMaterial",e}getClassName(){return"MRDLSliderThumbMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new tJ(e.name,t),e,t,i)}}tJ.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png",(0,o.Cg)([(0,T.lK)()],tJ.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bevelFront",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bevelFrontStretch",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bevelBack",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bevelBackStretch",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"radiusTopLeft",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"radiusTopRight",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"radiusBottomLeft",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"radiusBottomRight",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bulgeEnabled",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bulgeHeight",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"bulgeRadius",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"sunIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"sunTheta",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"sunPhi",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"indirectDiffuse",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"albedo",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"specular",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"shininess",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"sharpness",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"subsurface",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"leftGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rightGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"reflection",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"frontReflect",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"edgeReflect",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"power",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"skyColor",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"horizonColor",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"groundColor",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"horizonPower",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"width",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"fuzz",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"minFuzz",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"clipFade",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"hueShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"saturationShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"valueShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobPosition",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobFarSize",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobNearDistance",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobPulse",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobFade",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobPosition2",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobNearSize2",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobPulse2",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobFade2",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"blobTexture",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"leftIndexPosition",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rightIndexPosition",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"leftIndexMiddlePosition",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rightIndexMiddlePosition",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"decalScaleXY",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"decalFrontOnly",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rimIntensity",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rimHueShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rimSaturationShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"rimValueShift",void 0),(0,o.Cg)([(0,T.lK)()],tJ.prototype,"iridescenceIntensity",void 0),(0,C.Y5)("BABYLON.GUI.MRDLSliderThumbMaterial",tJ);let t0="mrdlBackplatePixelShader",t1=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;void FastLinearTosRGB_B353(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Round_Rect_Fragment_B332(
float Radius,
float Line_Width,
vec4 Line_Color,
float Filter_Width,
vec2 UV,
float Line_Visibility,
vec4 Rect_Parms,
vec4 Fill_Color,
out vec4 Color)
{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}
void Iridescence_B343(
vec3 Position,
vec3 Normal,
vec2 UV,
vec3 Axis,
vec3 Eye,
vec4 Tint,
sampler2D Texture,
bool Reflected,
float Frequency,
float Vertical_Offset,
out vec4 Color)
{vec3 i=normalize(Position-Eye);vec3 r=reflect(i,Normal);float idota=dot(i,Axis);float idotr=dot(i,r);float x=Reflected ? idotr : idota;vec2 xy;xy.x=fract((x*Frequency+1.0)*0.5+UV.y*Vertical_Offset);xy.y=0.5;Color=texture(Texture,xy);Color.rgb*=Tint.rgb;}
void Scale_RGB_B346(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Scale_RGB_B344(
float Scalar,
vec4 Color,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Line_Fragment_B362(
vec4 Base_Color,
vec4 Highlight_Color,
float Highlight_Width,
vec3 Line_Vertex,
float Highlight,
out vec4 Line_Color)
{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}
void Edge_B356(
vec4 RectParms,
float Radius,
float Line_Width,
vec2 UV,
float Edge_Width,
float Edge_Power,
out float Result)
{float d=length(max(abs(UV)-RectParms.xy,0.0));float edge=1.0-clamp((1.0-d/(Radius-Line_Width))/Edge_Width,0.0,1.0);Result=pow(edge,Edge_Power);}
void Gradient_B355(
vec4 Gradient_Color,
vec4 Top_Left,
vec4 Top_Right,
vec4 Bottom_Left,
vec4 Bottom_Right,
vec2 UV,
out vec4 Result)
{vec3 top=Top_Left.rgb+(Top_Right.rgb-Top_Left.rgb)*UV.x;vec3 bottom=Bottom_Left.rgb+(Bottom_Right.rgb-Bottom_Left.rgb)*UV.x;Result.rgb=Gradient_Color.rgb*(bottom+(top-bottom)*UV.y);Result.a=1.0;}
void main()
{float X_Q338;float Y_Q338;float Z_Q338;float W_Q338;X_Q338=vExtra2.x;Y_Q338=vExtra2.y;Z_Q338=vExtra2.z;W_Q338=vExtra2.w;vec4 Color_Q343;
#if IRIDESCENCE_ENABLE
Iridescence_B343(vPosition,vNormal,vUV,vBinormal,cameraPosition,_Iridescence_Tint_,_Iridescent_Map_,_Reflected_,_Frequency_,_Vertical_Offset_,Color_Q343);
#else
Color_Q343=vec4(0,0,0,0);
#endif
vec4 Result_Q344;Scale_RGB_B344(_Iridescence_Intensity_,Color_Q343,Result_Q344);vec4 Line_Color_Q362;Line_Fragment_B362(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q362);float Result_Q356;
#if EDGE_ONLY
Edge_B356(vExtra1,Z_Q338,W_Q338,vUV,_Edge_Width_,_Edge_Power_,Result_Q356);
#else
Result_Q356=1.0;
#endif
vec2 Vec2_Q339=vec2(X_Q338,Y_Q338);vec4 Result_Q355;Gradient_B355(_Gradient_Color_,_Top_Left_,_Top_Right_,_Bottom_Left_,_Bottom_Right_,Vec2_Q339,Result_Q355);vec4 Linear_Q348;Linear_Q348.rgb=clamp(Result_Q355.rgb*Result_Q355.rgb,0.0,1.0);Linear_Q348.a=Result_Q355.a;vec4 Result_Q346;Scale_RGB_B346(Linear_Q348,Result_Q356,Result_Q346);vec4 Sum_Q345=Result_Q346+Result_Q344;vec4 Color_At_T_Q347=mix(Line_Color_Q362,Result_Q346,_Line_Gradient_Blend_);vec4 Base_And_Iridescent_Q350;Base_And_Iridescent_Q350=_Base_Color_+vec4(Sum_Q345.rgb,0.0);vec4 Sum_Q349=Color_At_T_Q347+_Iridescence_Edge_Intensity_*Color_Q343;vec4 Result_Q351=Sum_Q349; Result_Q351.a=1.0;vec4 Color_Q332;Round_Rect_Fragment_B332(Z_Q338,W_Q338,Result_Q351,_Filter_Width_,vUV,1.0,vExtra1,Base_And_Iridescent_Q350,Color_Q332);vec4 Result_Q354=_Fade_Out_*Color_Q332;vec4 sRGB_Q353;FastLinearTosRGB_B353(Result_Q354,sRGB_Q353);vec4 Out_Color=sRGB_Q353;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[t0]||(ej.l.ShadersStore[t0]=t1);let t2="mrdlBackplateVertexShader",t3=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec3 tangent;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;void Object_To_World_Pos_B314(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Round_Rect_Vertex_B357(
vec2 UV,
float Radius,
float Margin,
float Anisotropy,
float Gradient1,
float Gradient2,
vec3 Normal,
vec4 Color_Scale_Translate,
out vec2 Rect_UV,
out vec4 Rect_Parms,
out vec2 Scale_XY,
out vec2 Line_UV,
out vec2 Color_UV_Info)
{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; 
Rect_Parms.w=Gradient2;Color_UV_Info=(Line_UV+vec2(0.5,0.5))*Color_Scale_Translate.xy+Color_Scale_Translate.zw;}
void Line_Vertex_B333(
vec2 Scale_XY,
vec2 UV,
float Time,
float Rate,
vec4 Highlight_Transform,
out vec3 Line_Vertex)
{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }
void PickDir_B334(
float Degrees,
vec3 DirX,
vec3 DirY,
out vec3 Dir)
{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}
void Move_Verts_B327(
float Anisotropy,
vec3 P,
float Radius,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}
void Pick_Radius_B336(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Edge_AA_Vertex_B328(
vec3 Position_World,
vec3 Position_Object,
vec3 Normal_Object,
vec3 Eye,
float Radial_Gradient,
vec3 Radial_Dir,
vec3 Tangent,
out float Gradient1,
out float Gradient2)
{vec3 I=(Eye-Position_World);vec3 T=(vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { 
Gradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}
void Object_To_World_Dir_B330(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void RelativeOrAbsoluteDetail_B341(
float Nominal_Radius,
float Nominal_LineWidth,
bool Absolute_Measurements,
float Height,
out float Radius,
out float Line_Width)
{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}
void main()
{vec3 Nrm_World_Q326;Nrm_World_Q326=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q329;vec3 Tangent_World_N_Q329;float Tangent_Length_Q329;Tangent_World_Q329=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q329=length(Tangent_World_Q329);Tangent_World_N_Q329=Tangent_World_Q329/Tangent_Length_Q329;vec3 Binormal_World_Q330;vec3 Binormal_World_N_Q330;float Binormal_Length_Q330;Object_To_World_Dir_B330(vec3(0,1,0),Binormal_World_Q330,Binormal_World_N_Q330,Binormal_Length_Q330);float Radius_Q341;float Line_Width_Q341;RelativeOrAbsoluteDetail_B341(_Radius_,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q330,Radius_Q341,Line_Width_Q341);vec3 Dir_Q334;PickDir_B334(_Angle_,Tangent_World_N_Q329,Binormal_World_N_Q330,Dir_Q334);float Result_Q336;Pick_Radius_B336(Radius_Q341,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q336);float Anisotropy_Q331=Tangent_Length_Q329/Binormal_Length_Q330;vec4 Out_Color_Q337=vec4(Result_Q336,Line_Width_Q341,0,1);vec3 New_P_Q327;vec2 New_UV_Q327;float Radial_Gradient_Q327;vec3 Radial_Dir_Q327;Move_Verts_B327(Anisotropy_Q331,position,Result_Q336,New_P_Q327,New_UV_Q327,Radial_Gradient_Q327,Radial_Dir_Q327);vec3 Pos_World_Q314;Object_To_World_Pos_B314(New_P_Q327,Pos_World_Q314);float Gradient1_Q328;float Gradient2_Q328;
#if SMOOTH_EDGES
Edge_AA_Vertex_B328(Pos_World_Q314,position,normal,cameraPosition,Radial_Gradient_Q327,Radial_Dir_Q327,tangent,Gradient1_Q328,Gradient2_Q328);
#else
Gradient1_Q328=1.0;Gradient2_Q328=1.0;
#endif
vec2 Rect_UV_Q357;vec4 Rect_Parms_Q357;vec2 Scale_XY_Q357;vec2 Line_UV_Q357;vec2 Color_UV_Info_Q357;Round_Rect_Vertex_B357(New_UV_Q327,Result_Q336,0.0,Anisotropy_Q331,Gradient1_Q328,Gradient2_Q328,normal,vec4(1,1,0,0),Rect_UV_Q357,Rect_Parms_Q357,Scale_XY_Q357,Line_UV_Q357,Color_UV_Info_Q357);vec3 Line_Vertex_Q333;Line_Vertex_B333(Scale_XY_Q357,Line_UV_Q357,(20.0),_Rate_,_Highlight_Transform_,Line_Vertex_Q333);float X_Q359;float Y_Q359;X_Q359=Color_UV_Info_Q357.x;Y_Q359=Color_UV_Info_Q357.y;vec4 Vec4_Q358=vec4(X_Q359,Y_Q359,Result_Q336,Line_Width_Q341);vec3 Position=Pos_World_Q314;vec3 Normal=Nrm_World_Q326;vec2 UV=Rect_UV_Q357;vec3 Tangent=Line_Vertex_Q333;vec3 Binormal=Dir_Q334;vec4 Color=Out_Color_Q337;vec4 Extra1=Rect_Parms_Q357;vec4 Extra2=Vec4_Q358;vec4 Extra3=vec4(0,0,0,0);gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vExtra1=Extra1;vExtra2=Extra2;}`;ej.l.ShadersStore[t2]||(ej.l.ShadersStore[t2]=t3);class t4 extends eX.M{constructor(){super(),this.IRIDESCENCE_ENABLE=!0,this.SMOOTH_EDGES=!0,this._needNormals=!0,this.rebuild()}}class t5 extends eY.E{constructor(e,t){super(e,t),this.radius=.3,this.lineWidth=.003,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new U.ov(0,0,0,1),this.lineColor=new U.ov(.2,.262745,.4,1),this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this._rate=0,this.highlightColor=new U.ov(.239216,.435294,.827451,1),this.highlightWidth=0,this._highlightTransform=new l.IU(1,1,0,0),this._highlight=1,this.iridescenceIntensity=.45,this.iridescenceEdgeIntensity=1,this.iridescenceTint=new U.ov(1,1,1,1),this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.gradientColor=new U.ov(.74902,.74902,.74902,1),this.topLeftGradientColor=new U.ov(.00784314,.294118,.580392,1),this.topRightGradientColor=new U.ov(.305882,0,1,1),this.bottomLeftGradientColor=new U.ov(.133333,.258824,.992157,1),this.bottomRightGradientColor=new U.ov(.176471,.176471,.619608,1),this.edgeWidth=.5,this.edgePower=1,this.edgeLineGradientBlend=.5,this.alphaMode=R.Y.ALPHA_DISABLE,this.backFaceCulling=!1;let i=_.S0.GetAssetUrl(t5.IRIDESCENT_MAP_TEXTURE_URL);this._iridescentMapTexture=new E.g(i,this.getScene(),!0,!1,E.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new t4);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Iridescence_Tint_","_Iridescent_Map_","_Angle_","_Reflected_","_Frequency_","_Vertical_Offset_","_Gradient_Color_","_Top_Left_","_Top_Right_","_Bottom_Left_","_Bottom_Right_","_Edge_Width_","_Edge_Power_","_Line_Gradient_Blend_","_Fade_Out_"],l=["_Iridescent_Map_"],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlBackplate",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){if(!i.materialDefines)return;let s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",+!!this.absoluteSizes),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setDirectColor4("_Iridescence_Tint_",this.iridescenceTint),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMapTexture),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Reflected_",+!!this._reflected),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setDirectColor4("_Gradient_Color_",this.gradientColor),this._activeEffect.setDirectColor4("_Top_Left_",this.topLeftGradientColor),this._activeEffect.setDirectColor4("_Top_Right_",this.topRightGradientColor),this._activeEffect.setDirectColor4("_Bottom_Left_",this.bottomLeftGradientColor),this._activeEffect.setDirectColor4("_Bottom_Right_",this.bottomRightGradientColor),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setFloat("_Edge_Power_",this.edgePower),this._activeEffect.setFloat("_Line_Gradient_Blend_",this.edgeLineGradientBlend),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new t5(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.MRDLBackplateMaterial",e}getClassName(){return"MRDLBackplateMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new t5(e.name,t),e,t,i)}}t5.IRIDESCENT_MAP_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-backplate-iridescence.png",(0,o.Cg)([(0,T.lK)()],t5.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"lineWidth",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"absoluteSizes",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"baseColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"lineColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"radiusTopLeft",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"radiusTopRight",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"radiusBottomLeft",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"radiusBottomRight",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"highlightColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"highlightWidth",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"iridescenceIntensity",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"iridescenceEdgeIntensity",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"iridescenceTint",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"fadeOut",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"gradientColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"topLeftGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"topRightGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"bottomLeftGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"bottomRightGradientColor",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"edgeWidth",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"edgePower",void 0),(0,o.Cg)([(0,T.lK)()],t5.prototype,"edgeLineGradientBlend",void 0),(0,C.Y5)("BABYLON.GUI.MRDLBackplateMaterial",t5);class t9 extends eN{constructor(e,t){super(e),this.onValueChangedObservable=new n.cP,this._sliderBackplateVisible=t||!1,this._minimum=0,this._maximum=100,this._step=0,this._value=50}get mesh(){return this.node?this._sliderThumb:null}get minimum(){return this._minimum}set minimum(e){this._minimum!==e&&(this._minimum=Math.max(e,0),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(e){this._maximum!==e&&(this._maximum=Math.max(e,this._minimum),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))}get step(){return this._step}set step(e){this._step!==e&&(this._step=Math.max(Math.min(e,this._maximum-this._minimum),0))}get value(){return this._value}set value(e){this._value!==e&&(this._value=Math.max(Math.min(e,this._maximum),this._minimum),this._sliderThumb&&(this._sliderThumb.position.x=this._convertToPosition(this.value)),this.onValueChangedObservable.notifyObservers(this._value))}get start(){return this.node?this._sliderBar.position.x-this._sliderBar.scaling.x/2:-.5}get end(){return this.node?this._sliderBar.position.x+this._sliderBar.scaling.x/2:.5}get sliderBarMaterial(){return this._sliderBarMaterial}get sliderThumbMaterial(){return this._sliderThumbMaterial}get sliderBackplateMaterial(){return this._sliderBackplateMaterial}get sliderBar(){return this._sliderBar}get sliderThumb(){return this._sliderThumb}get sliderBackplate(){return this._sliderBackplate}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this.node?.setEnabled(e))}_createNode(e){let t=(0,eV.an)(`${this.name}_sliderbackplate`,{width:1,height:1,depth:1},e);t.isPickable=!1,t.visibility=0,t.scaling=new l.Pq(1,.5,.8);let i=_.S0.GetAssetUrl(t9.MODEL_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,t9.MODEL_FILENAME,e).then(e=>{for(let t of e.meshes)t.isPickable=!1;let i=e.meshes[1],s=e.meshes[1].clone(`${this.name}_sliderbar`,t),r=e.meshes[1].clone(`${this.name}_sliderthumb`,t);for(let e of(i.visibility=0,this._sliderBackplateVisible&&(i.visibility=1,i.name=`${this.name}_sliderbackplate`,i.scaling.x=1,i.scaling.z=.2,i.parent=t,this._sliderBackplateMaterial&&(i.material=this._sliderBackplateMaterial),this._sliderBackplate=i),s&&(s.parent=t,s.position.z=-.1,s.scaling=new l.Pq(.8,.04,.3),this._sliderBarMaterial&&(s.material=this._sliderBarMaterial),this._sliderBar=s),r&&(r.parent=t,r.isPickable=!0,r.position.z=-.115,r.scaling=new l.Pq(.025,.3,.6),r.position.x=this._convertToPosition(this.value),r.addBehavior(this._createBehavior()),this._sliderThumbMaterial&&(r.material=this._sliderThumbMaterial),this._sliderThumb=r),this._injectGUI3DReservedDataStore(t).control=this,t.getChildMeshes()))this._injectGUI3DReservedDataStore(e).control=this}),this._affectMaterial(t),t}_affectMaterial(e){this._sliderBackplateMaterial=this._sliderBackplateMaterial??new t5(`${this.name}_sliderbackplate_material`,e.getScene()),this._sliderBarMaterial=this._sliderBarMaterial??new tX(`${this.name}_sliderbar_material`,e.getScene()),this._sliderThumbMaterial=this._sliderThumbMaterial??new tJ(`${this.name}_sliderthumb_material`,e.getScene())}_createBehavior(){let e=new tF.C({dragAxis:l.Pq.Right()});return e.moveAttached=!1,e.onDragStartObservable.add(()=>{this._draggedPosition=this._sliderThumb.position.x}),e.onDragObservable.add(e=>{this._draggedPosition+=e.dragDistance/this.scaling.x,this.value=this._convertToValue(this._draggedPosition)}),e}_convertToPosition(e){return Math.min(Math.max((e-this.minimum)/(this.maximum-this.minimum)*(this.end-this.start)+this.start,this.start),this.end)}_convertToValue(e){let t=(e-this.start)/(this.end-this.start)*(this.maximum-this.minimum);return t=this.step?Math.round(t/this.step)*this.step:t,Math.max(Math.min(this.minimum+t,this._maximum),this._minimum)}dispose(){super.dispose(),this._sliderBar?.dispose(),this._sliderThumb?.dispose(),this._sliderBarMaterial?.dispose(),this._sliderThumbMaterial?.dispose(),this._sliderBackplate?.dispose(),this._sliderBackplateMaterial?.dispose()}}t9.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",t9.MODEL_FILENAME="mrtk-fluent-backplate.glb";class t8 extends eQ{constructor(){super(...arguments),this._radius=5}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}_mapGridNode(e,t){let i=e.mesh;if(!i)return;let s=this._sphericalMapping(t);switch(e.position=s,this.orientation){case eW.FACEORIGIN_ORIENTATION:i.lookAt(new l.Pq(2*s.x,2*s.y,2*s.z));break;case eW.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new l.Pq(-s.x,-s.y,-s.z));break;case eW.FACEFORWARD_ORIENTATION:break;case eW.FACEFORWARDREVERSED_ORIENTATION:i.rotate(eG._0.Y,Math.PI,0)}}_sphericalMapping(e){let t=new l.Pq(0,0,this._radius),i=e.y/this._radius,s=-(e.x/this._radius);return l.uq.RotationYawPitchRollToRef(s,i,0,l.AA.Matrix[0]),l.Pq.TransformNormal(t,l.AA.Matrix[0])}}class t7 extends eW{get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,_.S0.SetImmediate(()=>{this._arrangeChildren()}))}constructor(e=!1){super(),this._isVertical=!1,this.margin=.1,this._isVertical=e}_arrangeChildren(){let e,t=0,i=0,s=0,r=[],o=l.uq.Invert(this.node.computeWorldMatrix(!0));for(let e of this._children){if(!e.mesh)continue;s++,e.mesh.computeWorldMatrix(!0),e.mesh.getWorldMatrix().multiplyToRef(o,l.AA.Matrix[0]);let a=e.mesh.getBoundingInfo().boundingBox,n=l.Pq.TransformNormal(a.extendSize,l.AA.Matrix[0]);r.push(n),this._isVertical?i+=n.y:t+=n.x}this._isVertical?i+=(s-1)*this.margin/2:t+=(s-1)*this.margin/2,e=this._isVertical?-i:-t;let a=0;for(let t of this._children){if(!t.mesh)continue;s--;let i=r[a++];this._isVertical?(t.position.y=e+i.y,t.position.x=0,e+=2*i.y):(t.position.x=e+i.x,t.position.y=0,e+=2*i.x),e+=s>0?this.margin:0}}}class t6 extends tm{constructor(e,t){super(t,e),this._currentMesh=e,this.pointerEnterAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1.1)},this.pointerOutAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/1.1)},this.pointerDownAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(.95)},this.pointerUpAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/.95)}}_getTypeName(){return"TouchMeshButton3D"}_createNode(){for(let e of this._currentMesh.getChildMeshes())this._injectGUI3DReservedDataStore(e).control=this;return this._currentMesh}_affectMaterial(e){}}var ie=i(9333),it=i(79112);let ii="mrdlBackglowPixelShader",is=`uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;float BiasFunc(float b,float v) {return pow(v,log(clamp(b,0.001,0.999))/log(0.5));}
void Fuzzy_Round_Rect_B33(
float Size_X,
float Size_Y,
float Radius_X,
float Radius_Y,
float Line_Width,
vec2 UV,
float Outer_Fuzz,
float Max_Outer_Fuzz,
out float Rect_Distance,
out float Inner_Distance)
{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius_X,Radius_Y),halfSize),vec2(0.001,0.001));float radius=min(r.x,r.y)-Max_Outer_Fuzz;vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);float d=distance(nearestp,v);Inner_Distance=clamp(1.0-(radius-d)/Line_Width,0.0,1.0);Rect_Distance=clamp(1.0-(d-radius)/Outer_Fuzz,0.0,1.0)*Inner_Distance;}
void main()
{float X_Q42;float Y_Q42;X_Q42=vNormal.x;Y_Q42=vNormal.y;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Sqrt_F_Q27=sqrt(MaxAB_Q24);float Power_Q43=pow(MaxAB_Q24,_Intensity_Fade_In_Exponent_);float Value_At_T_Q26=mix(_Outer_Fuzz_Start_,_Outer_Fuzz_End_,Sqrt_F_Q27);float Product_Q23=_Max_Intensity_*Power_Q43;float Rect_Distance_Q33;float Inner_Distance_Q33;Fuzzy_Round_Rect_B33(X_Q42,Y_Q42,_Bevel_Radius_,_Bevel_Radius_,_Line_Width_,vUV,Value_At_T_Q26,_Outer_Fuzz_Start_,Rect_Distance_Q33,Inner_Distance_Q33);float Power_Q44=pow(Inner_Distance_Q33,_Blend_Exponent_);float Result_Q45=pow(BiasFunc(_Bias_,Rect_Distance_Q33),_Falloff_);vec4 Color_At_T_Q25=mix(_Inner_Color_,_Color_,Power_Q44);float Product_Q22=Result_Q45*Product_Q23;vec4 Result_Q28=Product_Q22*Color_At_T_Q25;vec4 Out_Color=Result_Q28;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[ii]||(ej.l.ShadersStore[ii]=is);let ir="mrdlBackglowVertexShader",io=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;varying vec3 vNormal;varying vec2 vUV;void main()
{vec3 Dir_World_Q41=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q40=(world*vec4((cross(normal,tangent)),0.0)).xyz;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Length_Q16=length(Dir_World_Q41);float Length_Q17=length(Dir_World_Q40);bool Greater_Than_Q37=MaxAB_Q24>0.0;vec3 Sizes_Q35;vec2 XY_Q35;Sizes_Q35=(_Absolute_Sizes_ ? vec3(Length_Q16,Length_Q17,0) : vec3(Length_Q16/Length_Q17,1,0));XY_Q35=(uv-vec2(0.5,0.5))*Sizes_Q35.xy;vec3 Result_Q38=Greater_Than_Q37 ? position : vec3(0,0,0);vec3 Pos_World_Q39=(world*vec4(Result_Q38,1.0)).xyz;vec3 Position=Pos_World_Q39;vec3 Normal=Sizes_Q35;vec2 UV=XY_Q35;vec3 Tangent=vec3(0,0,0);vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;}`;ej.l.ShadersStore[ir]||(ej.l.ShadersStore[ir]=io);class ia extends eX.M{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class il extends eY.E{constructor(e,t){super(e,t),this.bevelRadius=.16,this.lineWidth=.16,this.absoluteSizes=!1,this.tuningMotion=0,this.motion=1,this.maxIntensity=.7,this.intensityFadeInExponent=2,this.outerFuzzStart=.04,this.outerFuzzEnd=.04,this.color=new U.ov(.682353,.698039,1,1),this.innerColor=new U.ov(.356863,.392157,.796078,1),this.blendExponent=1.5,this.falloff=2,this.bias=.5,this.alphaMode=R.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new ia);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Bevel_Radius_","_Line_Width_","_Absolute_Sizes_","_Tuning_Motion_","_Motion_","_Max_Intensity_","_Intensity_Fade_In_Exponent_","_Outer_Fuzz_Start_","_Outer_Fuzz_End_","_Color_","_Inner_Color_","_Blend_Exponent_","_Falloff_","_Bias_"],l=[],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlBackglow",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene();if(!i.materialDefines)return;let r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setFloat("_Bevel_Radius_",this.bevelRadius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",+!!this.absoluteSizes),this._activeEffect.setFloat("_Tuning_Motion_",this.tuningMotion),this._activeEffect.setFloat("_Motion_",this.motion),this._activeEffect.setFloat("_Max_Intensity_",this.maxIntensity),this._activeEffect.setFloat("_Intensity_Fade_In_Exponent_",this.intensityFadeInExponent),this._activeEffect.setFloat("_Outer_Fuzz_Start_",this.outerFuzzStart),this._activeEffect.setFloat("_Outer_Fuzz_End_",this.outerFuzzEnd),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setDirectColor4("_Inner_Color_",this.innerColor),this._activeEffect.setFloat("_Blend_Exponent_",this.blendExponent),this._activeEffect.setFloat("_Falloff_",this.falloff),this._activeEffect.setFloat("_Bias_",this.bias),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new il(e,this.getScene()),this)}serialize(){let e=y.p.Serialize(this);return e.customType="BABYLON.MRDLBackglowMaterial",e}getClassName(){return"MRDLBackglowMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new il(e.name,t),e,t,i)}}(0,o.Cg)([(0,T.lK)()],il.prototype,"bevelRadius",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"lineWidth",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"absoluteSizes",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"tuningMotion",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"motion",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"maxIntensity",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"intensityFadeInExponent",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"outerFuzzStart",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"outerFuzzEnd",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"color",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"innerColor",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"blendExponent",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"falloff",void 0),(0,o.Cg)([(0,T.lK)()],il.prototype,"bias",void 0),(0,C.Y5)("BABYLON.GUI.MRDLBackglowMaterial",il);let ih="mrdlFrontplatePixelShader",i_=`uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Scale_Color_B54(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void Scale_RGB_B50(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Proximity_Fragment_B51(
float Proximity_Max_Intensity,
float Proximity_Near_Radius,
vec4 Deltas,
float Show_Selection,
float Distance_Fade1,
float Distance_Fade2,
float Strength,
out float Proximity)
{float proximity1=(1.0-clamp(length(Deltas.xy)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade1;float proximity2=(1.0-clamp(length(Deltas.zw)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade2;Proximity=Strength*(Proximity_Max_Intensity*max(proximity1,proximity2) *(1.0-Show_Selection)+Show_Selection);}
void Blob_Fragment_B56(
vec2 UV,
vec3 Blob_Info,
sampler2D Blob_Texture,
out vec4 Blob_Color)
{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}
void Round_Rect_Fragment_B61(
float Radius,
vec4 Line_Color,
float Filter_Width,
float Line_Visibility,
vec4 Fill_Color,
bool Smooth_Edges,
vec4 Rect_Parms,
out float Inside_Rect)
{float d=length(max(abs(Rect_Parms.zw)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);Inside_Rect=Smooth_Edges ? clamp((Radius-d)/dx,0.0,1.0) : 1.0-step(Radius,d);}
void main()
{float Is_Quad_Q53;Is_Quad_Q53=vNormal.z;vec4 Blob_Color_Q56;Blob_Fragment_B56(vUV,vTangent,_Blob_Texture_,Blob_Color_Q56);float X_Q52;float Y_Q52;float Z_Q52;float W_Q52;X_Q52=vExtra3.x;Y_Q52=vExtra3.y;Z_Q52=vExtra3.z;W_Q52=vExtra3.w;float Proximity_Q51;Proximity_Fragment_B51(_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vExtra2,X_Q52,Y_Q52,Z_Q52,1.0,Proximity_Q51);float Inside_Rect_Q61;Round_Rect_Fragment_B61(W_Q52,vec4(1,1,1,1),_Filter_Width_,1.0,vec4(0,0,0,0),_Smooth_Edges_,vExtra1,Inside_Rect_Q61);vec4 Result_Q50;Scale_RGB_B50(_Edge_Color_,Proximity_Q51,Result_Q50);vec4 Result_Q47=Inside_Rect_Q61*Blob_Color_Q56;vec4 Color_At_T_Q48=mix(Result_Q50,Result_Q47,Is_Quad_Q53);vec4 Result_Q54;Scale_Color_B54(Color_At_T_Q48,_Fade_Out_,Result_Q54);vec4 Out_Color=Result_Q54;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;ej.l.ShadersStore[ih]||(ej.l.ShadersStore[ih]=i_);let id="mrdlFrontplateVertexShader",ic=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Blob_Vertex_B40(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
vec4 Vx_Color,
vec2 UV,
vec3 Face_Center,
vec2 Face_Size,
vec2 In_UV,
float Blob_Fade_Length,
float Selection_Fade,
float Selection_Fade_Size,
float Inner_Fade,
float Blob_Pulse,
float Blob_Fade,
float Blob_Enabled,
float DistanceOffset,
out vec3 Out_Position,
out vec2 Out_UV,
out vec3 Blob_Info,
out vec2 Blob_Relative_UV)
{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal)+DistanceOffset*Blob_Far_Distance;Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; 
vec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);Blob_Relative_UV=blobClipped/Face_Size.y;}
void Round_Rect_Vertex_B36(
vec2 UV,
vec3 Tangent,
vec3 Binormal,
float Radius,
float Anisotropy,
vec2 Blob_Center_UV,
out vec2 Rect_UV,
out vec2 Scale_XY,
out vec4 Rect_Parms)
{Scale_XY=vec2(Anisotropy,1.0);Rect_UV=(UV-vec2(0.5,0.5))*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius);Rect_Parms.zw=Blob_Center_UV;}
vec2 ProjectProximity(
vec3 blobPosition,
vec3 position,
vec3 center,
vec3 dir,
vec3 xdir,
vec3 ydir,
out float vdistance
)
{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}
void Proximity_Vertex_B33(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec3 Position,
float Proximity_Far_Distance,
float Relative_Scale,
float Proximity_Anisotropy,
vec3 Normal,
vec3 Tangent,
vec3 Binormal,
out vec4 Extra,
out float Distance_To_Face,
out float Distance_Fade1,
out float Distance_Fade2)
{float distz1,distz2;Extra.xy=ProjectProximity(Blob_Position,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz1)/Relative_Scale;Extra.zw=ProjectProximity(Blob_Position_2,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz2)/Relative_Scale;Distance_To_Face=dot(Normal,Position-Face_Center);Distance_Fade1=1.0-clamp(distz1/Proximity_Far_Distance,0.0,1.0);Distance_Fade2=1.0-clamp(distz2/Proximity_Far_Distance,0.0,1.0);}
void Object_To_World_Pos_B12(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Choose_Blob_B27(
vec4 Vx_Color,
vec3 Position1,
vec3 Position2,
bool Blob_Enable_1,
bool Blob_Enable_2,
float Near_Size_1,
float Near_Size_2,
float Blob_Inner_Fade_1,
float Blob_Inner_Fade_2,
float Blob_Pulse_1,
float Blob_Pulse_2,
float Blob_Fade_1,
float Blob_Fade_2,
out vec3 Position,
out float Near_Size,
out float Inner_Fade,
out float Blob_Enable,
out float Fade,
out float Pulse)
{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=Blob_Enable_1 ? 1.0 : 0.0;float b2=Blob_Enable_2 ? 1.0 : 0.0;Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}
void Move_Verts_B32(
vec2 UV,
float Radius,
float Anisotropy,
float Line_Width,
float Visible,
out vec3 New_P,
out vec2 New_UV)
{vec2 xy=2.0*UV-vec2(0.5,0.5);vec2 center=clamp(xy,0.0,1.0);vec2 delta=2.0*(xy-center);float deltaLength=length(delta);vec2 aniso=vec2(1.0/Anisotropy,1.0);center=(center-vec2(0.5,0.5))*(1.0-2.0*Radius*aniso);New_UV=vec2((2.0-2.0*deltaLength)*Visible,0.0);float deltaRadius= (Radius-Line_Width*New_UV.x);New_P.xy=(center+deltaRadius/deltaLength *aniso*delta);New_P.z=0.0;}
void Object_To_World_Dir_B14(
vec3 Dir_Object,
out vec3 Binormal_World)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;}
void Proximity_Visibility_B55(
float Selection,
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Proximity_Far_Distance,
float Proximity_Radius,
vec3 Face_Center,
vec3 Normal,
vec2 Face_Size,
float Gaze,
out float Width)
{float boxMaxSize=length(Face_Size)*0.5;float d1=dot(Proximity_Center-Face_Center,Normal);vec3 blob1=Proximity_Center-d1*Normal;float d2=dot(Proximity_Center_2-Face_Center,Normal);vec3 blob2=Proximity_Center_2-d2*Normal;vec3 delta1=blob1-Face_Center;vec3 delta2=blob2-Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));Width=max(Gaze,Width);}
vec2 ramp2(vec2 start,vec2 end,vec2 x)
{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}
float computeSelection(
vec3 blobPosition,
vec3 normal,
vec3 tangent,
vec3 bitangent,
vec3 faceCenter,
vec2 faceSize,
float selectionFuzz,
float farDistance,
float fadeLength
)
{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}
void Selection_Vertex_B31(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec2 Face_Size,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Selection_Fuzz,
float Selected,
float Far_Distance,
float Fade_Length,
vec3 Active_Face_Dir,
out float Show_Selection)
{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);Show_Selection=mix(max(select1,select2),1.0,Selected);}
void main()
{vec3 Vec3_Q29=vec3(vec2(0,0).x,vec2(0,0).y,color.r);vec3 Nrm_World_Q24;Nrm_World_Q24=normalize((world*vec4(normal,0.0)).xyz);vec3 Face_Center_Q30;Face_Center_Q30=(world*vec4(vec3(0,0,0),1.0)).xyz;vec3 Tangent_World_Q13;Tangent_World_Q13=(world*vec4(tangent,0.0)).xyz;vec3 Result_Q42;Result_Q42=_Use_Global_Left_Index_ ? Global_Left_Index_Tip_Position.xyz : _Blob_Position_;vec3 Result_Q43;Result_Q43=_Use_Global_Right_Index_ ? Global_Right_Index_Tip_Position.xyz : _Blob_Position_2_;float Value_At_T_Q58=mix(_Blob_Near_Size_,_Blob_Pulse_Max_Size_,_Blob_Pulse_);float Value_At_T_Q59=mix(_Blob_Near_Size_2_,_Blob_Pulse_Max_Size_,_Blob_Pulse_2_);vec3 Cross_Q70=cross(normal,tangent);float Product_Q45=_Gaze_Intensity_*_Gaze_Focus_;float Step_Q46=step(0.0001,Product_Q45);vec3 Tangent_World_N_Q15=normalize(Tangent_World_Q13);vec3 Position_Q27;float Near_Size_Q27;float Inner_Fade_Q27;float Blob_Enable_Q27;float Fade_Q27;float Pulse_Q27;Choose_Blob_B27(color,Result_Q42,Result_Q43,_Blob_Enable_,_Blob_Enable_2_,Value_At_T_Q58,Value_At_T_Q59,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q27,Near_Size_Q27,Inner_Fade_Q27,Blob_Enable_Q27,Fade_Q27,Pulse_Q27);vec3 Binormal_World_Q14;Object_To_World_Dir_B14(Cross_Q70,Binormal_World_Q14);float Anisotropy_Q21=length(Tangent_World_Q13)/length(Binormal_World_Q14);vec3 Binormal_World_N_Q16=normalize(Binormal_World_Q14);vec2 Face_Size_Q35;float ScaleY_Q35;Face_Size_Q35=vec2(length(Tangent_World_Q13),length(Binormal_World_Q14));ScaleY_Q35=Face_Size_Q35.y;float Out_Radius_Q38;float Out_Line_Width_Q38;Out_Radius_Q38=_Relative_To_Height_ ? _Radius_ : _Radius_/ScaleY_Q35;Out_Line_Width_Q38=_Relative_To_Height_ ? _Line_Width_ : _Line_Width_/ScaleY_Q35;float Show_Selection_Q31;Selection_Vertex_B31(Result_Q42,Result_Q43,Face_Center_Q30,Face_Size_Q35,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,vec3(0,0,-1),Show_Selection_Q31);float MaxAB_Q41=max(Show_Selection_Q31,Product_Q45);float Width_Q55;Proximity_Visibility_B55(Show_Selection_Q31,Result_Q42,Result_Q43,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Face_Center_Q30,Nrm_World_Q24,Face_Size_Q35,Step_Q46,Width_Q55);vec3 New_P_Q32;vec2 New_UV_Q32;Move_Verts_B32(uv,Out_Radius_Q38,Anisotropy_Q21,Out_Line_Width_Q38,Width_Q55,New_P_Q32,New_UV_Q32);vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q32,Pos_World_Q12);vec3 Out_Position_Q40;vec2 Out_UV_Q40;vec3 Blob_Info_Q40;vec2 Blob_Relative_UV_Q40;Blob_Vertex_B40(Pos_World_Q12,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Position_Q27,_Blob_Intensity_,Near_Size_Q27,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q30,Face_Size_Q35,New_UV_Q32,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q27,Pulse_Q27,Fade_Q27,Blob_Enable_Q27,0.0,Out_Position_Q40,Out_UV_Q40,Blob_Info_Q40,Blob_Relative_UV_Q40);vec2 Rect_UV_Q36;vec2 Scale_XY_Q36;vec4 Rect_Parms_Q36;Round_Rect_Vertex_B36(New_UV_Q32,Tangent_World_Q13,Binormal_World_Q14,Out_Radius_Q38,Anisotropy_Q21,Blob_Relative_UV_Q40,Rect_UV_Q36,Scale_XY_Q36,Rect_Parms_Q36);vec4 Extra_Q33;float Distance_To_Face_Q33;float Distance_Fade1_Q33;float Distance_Fade2_Q33;Proximity_Vertex_B33(Result_Q42,Result_Q43,Face_Center_Q30,Pos_World_Q12,_Proximity_Far_Distance_,1.0,_Proximity_Anisotropy_,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Extra_Q33,Distance_To_Face_Q33,Distance_Fade1_Q33,Distance_Fade2_Q33);vec4 Vec4_Q37=vec4(MaxAB_Q41,Distance_Fade1_Q33,Distance_Fade2_Q33,Out_Radius_Q38);vec3 Position=Out_Position_Q40;vec3 Normal=Vec3_Q29;vec2 UV=Out_UV_Q40;vec3 Tangent=Blob_Info_Q40;vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);vec4 Extra1=Rect_Parms_Q36;vec4 Extra2=Extra_Q33;vec4 Extra3=Vec4_Q37;gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;vTangent=Tangent;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;ej.l.ShadersStore[id]||(ej.l.ShadersStore[id]=ic);class iu extends eX.M{constructor(){super(),this.SMOOTH_EDGES=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class ig extends eY.E{constructor(e,t){super(e,t),this.radius=.12,this.lineWidth=.01,this.relativeToHeight=!1,this._filterWidth=1,this.edgeColor=new U.ov(.53,.53,.53,1),this.blobEnable=!0,this.blobPosition=new l.Pq(100,100,100),this.blobIntensity=.5,this.blobNearSize=.032,this.blobFarSize=.048,this.blobNearDistance=.008,this.blobFarDistance=.064,this.blobFadeLength=.04,this.blobInnerFade=.01,this.blobPulse=0,this.blobFade=1,this.blobPulseMaxSize=.05,this.blobEnable2=!0,this.blobPosition2=new l.Pq(10,10.1,-.6),this.blobNearSize2=.008,this.blobInnerFade2=.1,this.blobPulse2=0,this.blobFade2=1,this.gazeIntensity=.8,this.gazeFocus=0,this.selectionFuzz=.5,this.selected=1,this.selectionFade=.2,this.selectionFadeSize=0,this.selectedDistance=.08,this.selectedFadeLength=.08,this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=.016,this.proximityAnisotropy=1,this.useGlobalLeftIndex=!0,this.useGlobalRightIndex=!0,this.fadeOut=1,this.alphaMode=R.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1,this._blobTexture=new E.g(ig.BLOB_TEXTURE_URL,t,!0,!1,E.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new iu);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Relative_To_Height_","_Filter_Width_","_Edge_Color_","_Fade_Out_","_Smooth_Edges_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Pulse_Max_Size_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Gaze_Intensity_","_Gaze_Focus_","_Blob_Texture_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","_Use_Global_Left_Index_","_Use_Global_Right_Index_"],l=[],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlFrontplate",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene();if(!i.materialDefines)return;let r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Relative_To_Height_",+!!this.relativeToHeight),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Edge_Color_",this.edgeColor),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Blob_Enable_",+!!this.blobEnable),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.blobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setFloat("_Blob_Pulse_Max_Size_",this.blobPulseMaxSize),this._activeEffect.setFloat("_Blob_Enable_2_",+!!this.blobEnable2),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.blobInnerFade2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Gaze_Intensity_",this.gazeIntensity),this._activeEffect.setFloat("_Gaze_Focus_",this.gazeFocus),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Use_Global_Left_Index_",+!!this.useGlobalLeftIndex),this._activeEffect.setFloat("_Use_Global_Right_Index_",+!!this.useGlobalRightIndex),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new ig(e,this.getScene()),this)}serialize(){let e=y.p.Serialize(this);return e.customType="BABYLON.MRDLFrontplateMaterial",e}getClassName(){return"MRDLFrontplateMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new ig(e.name,t),e,t,i)}}ig.BLOB_TEXTURE_URL="",(0,o.Cg)([(0,T.lK)()],ig.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"lineWidth",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"relativeToHeight",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"edgeColor",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobEnable",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobPosition",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobNearSize",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobFarSize",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobNearDistance",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobInnerFade",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobPulse",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobFade",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobPulseMaxSize",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobEnable2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobPosition2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobNearSize2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobInnerFade2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobPulse2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"blobFade2",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"gazeIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"gazeFocus",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selectionFuzz",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selected",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selectionFade",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selectionFadeSize",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selectedDistance",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"selectedFadeLength",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"proximityMaxIntensity",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"proximityFarDistance",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"proximityNearRadius",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"proximityAnisotropy",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"useGlobalLeftIndex",void 0),(0,o.Cg)([(0,T.lK)()],ig.prototype,"useGlobalRightIndex",void 0),(0,C.Y5)("BABYLON.GUI.MRDLFrontplateMaterial",ig);let im="mrdlInnerquadPixelShader",ip=`uniform vec3 cameraPosition;varying vec2 vUV;varying vec3 vTangent;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;float FilterStep_Bid194(float edge,float x,float filterWidth)
{float dx=max(1.0E-5,fwidth(x)*filterWidth);return max((x+dx*0.5-max(edge,x-dx*0.5))/dx,0.0);}
void Round_Rect_B194(
float Size_X,
float Size_Y,
float Radius,
vec4 Rect_Color,
float Filter_Width,
vec2 UV,
float Glow_Fraction,
float Glow_Max,
float Glow_Falloff,
out vec4 Color)
{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius,Radius),halfSize),vec2(0.01,0.01));vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);vec2 delta=(v-nearestp)/max(vec2(0.01,0.01),r);float Distance=length(delta);float insideRect=1.0-FilterStep_Bid194(1.0-Glow_Fraction,Distance,Filter_Width);float glow=clamp((1.0-Distance)/Glow_Fraction,0.0,1.0);glow=pow(glow,Glow_Falloff);Color=Rect_Color*max(insideRect,glow*Glow_Max);}
void main()
{float X_Q192;float Y_Q192;float Z_Q192;X_Q192=vTangent.x;Y_Q192=vTangent.y;Z_Q192=vTangent.z;vec4 Color_Q194;Round_Rect_B194(X_Q192,1.0,Y_Q192,_Color_,_Filter_Width_,vUV,_Glow_Fraction_,_Glow_Max_,_Glow_Falloff_,Color_Q194);vec4 Out_Color=Color_Q194;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}
`;ej.l.ShadersStore[im]||(ej.l.ShadersStore[im]=ip);let iv="mrdlInnerquadVertexShader",ib=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;varying vec2 vUV;varying vec3 vTangent;void main()
{vec3 Pos_World_Q189;Pos_World_Q189=(world*vec4(position,1.0)).xyz;vec3 Dir_World_Q190;Dir_World_Q190=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q191;Dir_World_Q191=(world*vec4((cross(normal,tangent)),0.0)).xyz;float Length_Q180=length(Dir_World_Q190);float Length_Q181=length(Dir_World_Q191);float Quotient_Q184=Length_Q180/Length_Q181;float Quotient_Q195=_Radius_/Length_Q181;vec2 Result_Q193;Result_Q193=vec2((uv.x-0.5)*Length_Q180/Length_Q181,(uv.y-0.5));float Result_Q198=_Fixed_Radius_ ? Quotient_Q195 : _Radius_;vec3 Vec3_Q183=vec3(Quotient_Q184,Result_Q198,0);vec3 Position=Pos_World_Q189;vec3 Normal=vec3(0,0,0);vec2 UV=Result_Q193;vec3 Tangent=Vec3_Q183;vec3 Binormal=vec3(0,0,0);vec4 Color=color;gl_Position=viewProjection*vec4(Position,1);vUV=UV;vTangent=Tangent;}
`;ej.l.ShadersStore[iv]||(ej.l.ShadersStore[iv]=ib);class ix extends eX.M{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class iC extends eY.E{constructor(e,t){super(e,t),this.color=new U.ov(1,1,1,.05),this.radius=.12,this.fixedRadius=!0,this._filterWidth=1,this.glowFraction=0,this.glowMax=.5,this.glowFalloff=2,this.alphaMode=R.Y.ALPHA_COMBINE,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new ix);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;let o=r.getEngine();if((0,e1.qB)(e,s,!0,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new e8.J;s.FOG&&e.addFallback(1,"FOG"),(0,e1.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;let i=[eq.R.PositionKind];s.NORMAL&&i.push(eq.R.NormalKind),s.UV1&&i.push(eq.R.UVKind),s.UV2&&i.push(eq.R.UV2Kind),s.VERTEXCOLOR&&i.push(eq.R.ColorKind),s.TANGENT&&i.push(eq.R.TangentKind),(0,e1.ER)(i,s);let a=s.toString(),n=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Color_","_Radius_","_Fixed_Radius_","_Filter_Width_","_Glow_Fraction_","_Glow_Max_","_Glow_Falloff_"],l=[],h=[];(0,e1.Bb)({uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("mrdlInnerquad",{attributes:i,uniformsNames:n,uniformBuffersNames:h,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),s)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene();if(!i.materialDefines)return;let r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Fixed_Radius_",+!!this.fixedRadius),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setFloat("_Glow_Fraction_",this.glowFraction),this._activeEffect.setFloat("_Glow_Max_",this.glowMax),this._activeEffect.setFloat("_Glow_Falloff_",this.glowFalloff),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return y.p.Clone(()=>new iC(e,this.getScene()),this)}serialize(){let e=y.p.Serialize(this);return e.customType="BABYLON.MRDLInnerquadMaterial",e}getClassName(){return"MRDLInnerquadMaterial"}static Parse(e,t,i){return y.p.Parse(()=>new iC(e.name,t),e,t,i)}}(0,o.Cg)([(0,T.lK)()],iC.prototype,"color",void 0),(0,o.Cg)([(0,T.lK)()],iC.prototype,"radius",void 0),(0,o.Cg)([(0,T.lK)()],iC.prototype,"fixedRadius",void 0),(0,o.Cg)([(0,T.lK)()],iC.prototype,"glowFraction",void 0),(0,o.Cg)([(0,T.lK)()],iC.prototype,"glowMax",void 0),(0,o.Cg)([(0,T.lK)()],iC.prototype,"glowFalloff",void 0),(0,C.Y5)("BABYLON.GUI.MRDLInnerquadMaterial",iC);class iT extends tm{_disposeTooltip(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)}set renderingGroupId(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._backGlow.renderingGroupId=e,this._innerQuad.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)}get renderingGroupId(){return this._backPlate.renderingGroupId}get mesh(){return this._backPlate}set tooltipText(e){if(!e)return void this._disposeTooltip();if(!this._tooltipFade){let e=this._backPlate._scene.useRightHandedSystem;this._tooltipMesh=(0,ta.x)("",{size:1},this._backPlate._scene),this._tooltipMesh.position=l.Pq.Down().scale(.7).add(l.Pq.Forward(e).scale(-.15)),this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._frontPlateCollisionMesh,this._tooltipTexture=eS.CreateForMesh(this._tooltipMesh);let t=new w;t.height=.25,t.width=.8,t.cornerRadius=25,t.color="#ffffff",t.thickness=20,t.background="#060668",this._tooltipTexture.addControl(t),this._tooltipTextBlock=new O,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=100,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new tn._,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!0)}),this._tooltipOutObserver=this.onPointerOutObservable.add(()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!1)})}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}get tooltipText(){return this._tooltipTextBlock?.text||null}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._rebuildContent())}get subtext(){return this._subtext}set subtext(e){this._subtext!==e&&(this._subtext=e,this._rebuildContent())}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())}get backMaterial(){return this._backMaterial}get frontMaterial(){return this._frontMaterial}get backGlowMaterial(){return this._backGlowMaterial}get innerQuadMaterial(){return this._innerQuadMaterial}get plateMaterial(){return this._plateMaterial}get shareMaterials(){return this._shareMaterials}set isBackplateVisible(e){this.mesh&&this._backMaterial&&(e&&!this._isBackplateVisible?this._backPlate.visibility=1:!e&&this._isBackplateVisible&&(this._backPlate.visibility=0)),this._isBackplateVisible=e}constructor(e,t=!0){super(e),this.width=1,this.height=1,this.radius=.14,this.textSizeInPixels=18,this.imageSizeInPixels=40,this.plateMaterialColor=new U.v9(.4,.4,.4),this.frontPlateDepth=.2,this.backPlateDepth=.04,this.backGlowOffset=.1,this.flatPlaneDepth=.001,this.innerQuadRadius=this.radius-.04,this.innerQuadColor=new U.ov(0,0,0,0),this.innerQuadToggledColor=new U.ov(.5197843,.6485234,.9607843,.6),this.innerQuadHoverColor=new U.ov(1,1,1,.05),this.innerQuadToggledHoverColor=new U.ov(.5197843,.6485234,.9607843,1),this._isBackplateVisible=!0,this._shareMaterials=!0,this._shareMaterials=t,this.pointerEnterAnimation=()=>{this._frontPlate&&this._textPlate&&!this.isToggleButton&&this._performEnterExitAnimation(1),this.isToggleButton&&this._innerQuadMaterial&&(this.isToggled?this._innerQuadMaterial.color=this.innerQuadToggledHoverColor:this._innerQuadMaterial.color=this.innerQuadHoverColor)},this.pointerOutAnimation=()=>{this._frontPlate&&this._textPlate&&!this.isToggleButton&&this._performEnterExitAnimation(-.8),this.isToggleButton&&this._innerQuadMaterial&&this._onToggle(this.isToggled)},this.pointerDownAnimation=()=>{},this.pointerUpAnimation=()=>{},this._pointerClickObserver=this.onPointerClickObservable.add(()=>{this._frontPlate&&this._backGlow&&!this.isActiveNearInteraction&&this._performClickAnimation(),this.isToggleButton&&this._innerQuadMaterial&&this._onToggle(this.isToggled)}),this._pointerEnterObserver=this.onPointerEnterObservable.add(()=>{this.pointerEnterAnimation()}),this._pointerOutObserver=this.onPointerOutObservable.add(()=>{this.pointerOutAnimation()}),this._toggleObserver=this.onToggleObservable.add(e=>{e?this._innerQuadMaterial.color=this.innerQuadToggledColor:this._innerQuadMaterial.color=this.innerQuadColor})}_getTypeName(){return"TouchHolographicButton"}_rebuildContent(){let e;e=1>=this._getAspectRatio()?this._alignContentVertically():this._alignContentHorizontally(),this.content=e}_getAspectRatio(){return this.width/this.height}_alignContentVertically(){let e=new F;if(e.isVertical=!0,(0,tl.Nf)()&&document.createElement&&this._imageUrl){let t=new B;t.source=this._imageUrl,t.heightInPixels=180,t.widthInPixels=100,t.paddingTopInPixels=40,t.paddingBottomInPixels=40,e.addControl(t)}if(this._text){let t=new O;t.text=this._text,t.color="white",t.heightInPixels=30,t.fontSize=24,e.addControl(t)}return e}_alignContentHorizontally(){let e=240,t=new w;t.widthInPixels=e,t.heightInPixels=e,t.color="transparent",t.setPaddingInPixels(15,15,15,15),e-=30;let i=new F;if(i.isVertical=!1,i.scaleY=this._getAspectRatio(),(0,tl.Nf)()&&document.createElement&&this._imageUrl){let t=new w(`${this.name}_image`);t.widthInPixels=this.imageSizeInPixels,t.heightInPixels=this.imageSizeInPixels,t.color="transparent",e-=this.imageSizeInPixels;let s=new B;s.source=this._imageUrl,t.addControl(s),i.addControl(t)}if(this._text){let t=new O(`${this.name}_text`);if(t.text=this._text,t.color="white",t.fontSize=this.textSizeInPixels,t.widthInPixels=e,this._imageUrl&&(t.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,t.paddingLeftInPixels=15),this._subtext){let s=new V;s.addColumnDefinition(1),s.addRowDefinition(.5),s.addRowDefinition(.5),s.widthInPixels=e,s.heightInPixels=45;let r=new O(`${this.name}_subtext`);r.text=this._subtext,r.color="#EEEEEEAB",r.fontSize=.75*this.textSizeInPixels,r.fontWeight="600",this._imageUrl&&(r.textHorizontalAlignment=P.HORIZONTAL_ALIGNMENT_LEFT,r.paddingLeftInPixels=15),s.addControl(t,0),s.addControl(r,1),i.addControl(s)}else i.addControl(t)}return t.addControl(i),t}_createNode(e){this.name=this.name??"TouchHolographicButton";let t=this._createBackPlate(e),i=this._createFrontPlate(e),s=this._createInnerQuad(e),r=this._createBackGlow(e);this._frontPlateCollisionMesh=i,this._textPlate=super._createNode(e),this._textPlate.name=`${this.name}_textPlate`,this._textPlate.isPickable=!1,this._textPlate.scaling.x=this.width,this._textPlate.parent=i,this._backPlate=t,this._backPlate.position=l.Pq.Forward(e.useRightHandedSystem).scale(this.backPlateDepth/2),this._backPlate.isPickable=!1,this._backPlate.addChild(i),this._backPlate.addChild(s),r&&this._backPlate.addChild(r);let o=new eF.V(`${this.name}_root`,e);return this._backPlate.setParent(o),this.collisionMesh=i,this.collidableFrontDirection=this._backPlate.forward.negate(),o}_createBackPlate(e){let t=(0,eV.an)(`${this.name}_backPlate`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=.2;let i=_.S0.GetAssetUrl(iT.MRTK_ASSET_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,iT.BACKPLATE_MODEL_FILENAME,e).then(e=>{let i=e.meshes[1];i.visibility=0,this._isBackplateVisible&&(i.visibility=1,i.name=`${this.name}_backPlate`,i.isPickable=!1,i.scaling.x=this.width,i.scaling.y=this.height,i.parent=t),this._backMaterial&&(i.material=this._backMaterial),this._backPlate=i}),t}_createFrontPlate(e){let t=(0,eV.an)(`${this.name}_frontPlate`,{width:this.width,height:this.height,depth:this.frontPlateDepth},e);t.isPickable=!0,t.isNearPickable=!0,t.visibility=0,t.position=l.Pq.Forward(e.useRightHandedSystem).scale((this.backPlateDepth-this.frontPlateDepth)/2);let i=_.S0.GetAssetUrl(iT.MRTK_ASSET_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,iT.FRONTPLATE_MODEL_FILENAME,e).then(i=>{let s=(0,eV.an)(`${this.name}_collisionPlate`,{width:this.width,height:this.height},e);s.isPickable=!1,s.scaling.z=this.frontPlateDepth,s.visibility=0,s.parent=t,this._collisionPlate=s;let r=i.meshes[1];r.name=`${this.name}_frontPlate`,r.isPickable=!1,r.scaling.x=this.width-this.backGlowOffset,r.scaling.y=this.height-this.backGlowOffset,r.position=l.Pq.Forward(e.useRightHandedSystem).scale(-.5),r.parent=s,this.isToggleButton&&(r.visibility=0),this._frontMaterial&&(r.material=this._frontMaterial),this._textPlate.scaling.x=1,this._textPlate.parent=r,this._frontPlate=r}),t}_createInnerQuad(e){let t=(0,eV.an)(`${this.name}_innerQuad`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=this.flatPlaneDepth,t.position.z+=this.backPlateDepth/2-this.flatPlaneDepth;let i=_.S0.GetAssetUrl(iT.MRTK_ASSET_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,iT.INNERQUAD_MODEL_FILENAME,e).then(e=>{let i=e.meshes[1];i.name=`${this.name}_innerQuad`,i.isPickable=!1,i.scaling.x=this.width-this.backGlowOffset,i.scaling.y=this.height-this.backGlowOffset,i.parent=t,this._innerQuadMaterial&&(i.material=this._innerQuadMaterial),this._innerQuad=i}),t}_createBackGlow(e){if(this.isToggleButton)return;let t=(0,eV.an)(`${this.name}_backGlow`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=this.flatPlaneDepth,t.position.z+=this.backPlateDepth/2-2*this.flatPlaneDepth;let i=_.S0.GetAssetUrl(iT.MRTK_ASSET_BASE_URL);return tr.cn.ImportMeshAsync(void 0,i,iT.BACKGLOW_MODEL_FILENAME,e).then(e=>{let i=e.meshes[1];i.name=`${this.name}_backGlow`,i.isPickable=!1,i.scaling.x=this.width-this.backGlowOffset,i.scaling.y=this.height-this.backGlowOffset,i.parent=t,this._backGlowMaterial&&(i.material=this._backGlowMaterial),this._backGlow=i}),t}_applyFacade(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e,this._plateMaterial.diffuseColor=this.plateMaterialColor}_performClickAnimation(){let e=new it.AnimationGroup("Click Animation Group");for(let t of[{name:"backGlowMotion",mesh:this._backGlow,property:"material.motion",keys:[{frame:0,values:[0,0,0]},{frame:20,values:[1,.0144,.0144]},{frame:40,values:[.0027713229489760476,0,0]},{frame:45,values:[.0027713229489760476]}]},{name:"_collisionPlateZSlide",mesh:this._collisionPlate,property:"position.z",keys:[{frame:0,values:[0,0,0]},{frame:20,values:[l.Pq.Forward(this._collisionPlate._scene.useRightHandedSystem).scale(this.frontPlateDepth/2).z,0,0]},{frame:40,values:[0,.005403332496794331]},{frame:45,values:[0]}]},{name:"_collisionPlateZScale",mesh:this._collisionPlate,property:"scaling.z",keys:[{frame:0,values:[this.frontPlateDepth,0,0]},{frame:20,values:[this.backPlateDepth,0,0]},{frame:40,values:[this.frontPlateDepth,.0054]},{frame:45,values:[this.frontPlateDepth]}]}]){let i=new ie.X5(t.name,t.property,60,ie.X5.ANIMATIONTYPE_FLOAT,ie.X5.ANIMATIONLOOPMODE_CYCLE),s=[];for(let e of t.keys)s.push({frame:e.frame,value:e.values[0],inTangent:e.values[1],outTangent:e.values[2],interpolation:e.values[3]});i.setKeys(s),t.mesh&&e.addTargetedAnimation(i,t.mesh)}e.normalize(0,45),e.speedRatio=1,e.play()}_performEnterExitAnimation(e){let t=new it.AnimationGroup("Enter Exit Animation Group");for(let e of[{name:"frontPlateFadeOut",mesh:this._frontPlate,property:"material.fadeOut",keys:[{frame:0,values:[0,0,.025045314830017686,0]},{frame:40,values:[1.00205599570012,.025045314830017686,0,0]}]},{name:"textPlateZSlide",mesh:this._textPlate,property:"position.z",keys:[{frame:0,values:[0,0,0]},{frame:40,values:[l.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-.15).z,0,0]}]}]){let i=new ie.X5(e.name,e.property,60,ie.X5.ANIMATIONTYPE_FLOAT,ie.X5.ANIMATIONLOOPMODE_CYCLE),s=[];for(let t of e.keys)s.push({frame:t.frame,value:t.values[0],inTangent:t.values[1],outTangent:t.values[2],interpolation:t.values[3]});i.setKeys(s),e.mesh&&t.addTargetedAnimation(i,e.mesh)}t.normalize(0,45),t.speedRatio=e,t.play()}_createBackMaterial(e){this._backMaterial=this._backMaterial??new t5(this.name+"backPlateMaterial",e.getScene()),this._backMaterial.absoluteSizes=!0,this._backMaterial.radius=this.radius,this._backMaterial.lineWidth=.02}_createFrontMaterial(e){this._frontMaterial=this._frontMaterial??new ig(this.name+"Front Material",e.getScene()),this.frontMaterial.radius=this.innerQuadRadius,this.frontMaterial.fadeOut=0}_createBackGlowMaterial(e){let t=this.radius+.04;this._backGlowMaterial=this._backGlowMaterial??new il(this.name+"Back Glow Material",e.getScene()),this._backGlowMaterial.bevelRadius=t,this._backGlowMaterial.lineWidth=t,this._backGlowMaterial.motion=0}_createInnerQuadMaterial(e){this._innerQuadMaterial=this._innerQuadMaterial??new iC("inner_quad",e.getScene()),this._innerQuadMaterial.radius=this.innerQuadRadius,this.isToggleButton&&(this._innerQuadMaterial.color=this.innerQuadColor)}_createPlateMaterial(e){this._plateMaterial=this._plateMaterial??new eU.F(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=U.v9.Black()}_onToggle(e){super._onToggle(e)}_affectMaterial(e){this._shareMaterials?(this._host._touchSharedMaterials.mrdlBackplateMaterial?this._backMaterial=this._host._touchSharedMaterials.mrdlBackplateMaterial:(this._createBackMaterial(e),this._host._touchSharedMaterials.mrdlBackplateMaterial=this._backMaterial),this._host._touchSharedMaterials.mrdlFrontplateMaterial?this._frontMaterial=this._host._touchSharedMaterials.mrdlFrontplateMaterial:(this._createFrontMaterial(e),this._host._touchSharedMaterials.mrdlFrontplateMaterial=this._frontMaterial),this._host._touchSharedMaterials.mrdlBackglowMaterial?this._backGlowMaterial=this._host._touchSharedMaterials.mrdlBackglowMaterial:(this._createBackGlowMaterial(e),this._host._touchSharedMaterials.mrdlBackglowMaterial=this._backGlowMaterial),this._host._touchSharedMaterials.mrdlInnerQuadMaterial?this._innerQuadMaterial=this._host._touchSharedMaterials.mrdlInnerQuadMaterial:(this._createInnerQuadMaterial(e),this._host._touchSharedMaterials.mrdlInnerQuadMaterial=this._innerQuadMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e),this._createBackGlowMaterial(e),this._createInnerQuadMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._textPlate.material=this._plateMaterial,this._isBackplateVisible||(this._backPlate.visibility=0),this._frontPlate&&(this._frontPlate.material=this._frontMaterial),this._backGlow&&(this._backGlow.material=this._backGlowMaterial),this._innerQuad&&(this._innerQuad.material=this._innerQuadMaterial),this._rebuildContent()}dispose(){super.dispose(),this._disposeTooltip(),this.onPointerClickObservable.remove(this._pointerClickObserver),this.onPointerEnterObservable.remove(this._pointerEnterObserver),this.onPointerOutObservable.remove(this._pointerOutObserver),this.onToggleObservable.remove(this._toggleObserver),!this.shareMaterials&&(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._backGlowMaterial.dispose(),this._innerQuadMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}iT.MRTK_ASSET_BASE_URL="https://assets.babylonjs.com/core/MRTK/",iT.FRONTPLATE_MODEL_FILENAME="mrtk-fluent-frontplate.glb",iT.BACKPLATE_MODEL_FILENAME="mrtk-fluent-backplate.glb",iT.BACKGLOW_MODEL_FILENAME="mrtk-fluent-button.glb",iT.INNERQUAD_MODEL_FILENAME="SlateProximity.glb";var iy=i(20680),iS=i(21892);class iP{get scene(){return this._scene}get utilityLayer(){return this._utilityLayer}get controlScaling(){return this._customControlScaling}set controlScaling(e){if(this._customControlScaling!==e&&e>0){let t=e/this._customControlScaling;for(let i of(this._customControlScaling=e,this._rootContainer.children))i.scaling.scaleInPlace(t),1!==e&&(i._isScaledByManager=!0)}}get useRealisticScaling(){return this.controlScaling===iP.MRTK_REALISTIC_SCALING}set useRealisticScaling(e){this.controlScaling=e?iP.MRTK_REALISTIC_SCALING:1}constructor(e){this._customControlScaling=1,this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new n.cP,this.onPickingObservable=new n.cP,this._sharedMaterials={},this._touchSharedMaterials={},this._scene=e||S.q.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(()=>{this._sceneDisposeObserver=null,this._utilityLayer=null,this.dispose()}),this._utilityLayer=iS.j._CreateDefaultUtilityLayerFromScene(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=e=>e&&e.reservedDataStore?.GUI3D?.control?._node,this._rootContainer=new eW("RootContainer"),this._rootContainer._host=this;let t=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add(e=>{this._handlePointerOut(e,!0)}),this._pointerObserver=t.onPointerObservable.add(e=>{this._doPicking(e)}),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new iy.g("hemi",l.Pq.Up(),this._utilityLayer.utilityLayerScene)}_handlePointerOut(e,t){let i=this._lastControlOver[e];i&&(i._onPointerOut(i),delete this._lastControlOver[e]),t&&this._lastControlDown[e]&&(this._lastControlDown[e].forcePointerUp(),delete this._lastControlDown[e]),this.onPickedPointChangedObservable.notifyObservers(null)}_doPicking(e){if(!this._utilityLayer||!this._utilityLayer.shouldRender||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;let t=e.event,i=t.pointerId||0,s=t.button,r=e.pickInfo;if(r&&this.onPickingObservable.notifyObservers(r.pickedMesh),!r||!r.hit)return this._handlePointerOut(i,e.type===h.Zp.POINTERUP),!1;r.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(r.pickedPoint);let o=r.pickedMesh.reservedDataStore?.GUI3D?.control;return o&&!o._processObservables(e.type,r.pickedPoint,r.originMesh?.position||null,i,s)&&e.type===h.Zp.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i]),delete this._lastControlOver[i]),e.type===h.Zp.POINTERUP&&(this._lastControlDown[t.pointerId]&&(this._lastControlDown[t.pointerId].forcePointerUp(),delete this._lastControlDown[t.pointerId]),("touch"===t.pointerType||"xr"===t.pointerType&&this._scene.getEngine().hostInformation.isMobile)&&this._handlePointerOut(i,!1)),!0}get rootContainer(){return this._rootContainer}containsControl(e){return this._rootContainer.containsControl(e)}addControl(e){return this._rootContainer.addControl(e),1!==this._customControlScaling&&(e.scaling.scaleInPlace(this._customControlScaling),e._isScaledByManager=!0),this}removeControl(e){return this._rootContainer.removeControl(e),e._isScaledByManager&&(e.scaling.scaleInPlace(1/this._customControlScaling),e._isScaledByManager=!1),this}dispose(){for(let e in this._rootContainer.dispose(),this._sharedMaterials)Object.prototype.hasOwnProperty.call(this._sharedMaterials,e)&&this._sharedMaterials[e].dispose();for(let e in this._sharedMaterials={},this._touchSharedMaterials)Object.prototype.hasOwnProperty.call(this._touchSharedMaterials,e)&&this._touchSharedMaterials[e].dispose();this._touchSharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear(),this.onPickingObservable.clear();let e=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;e&&this._pointerObserver&&(e.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()}}iP.MRTK_REALISTIC_SCALING=.032},66317:(e,t,i)=>{i.r(t),i.d(t,{CellMaterial:()=>T,CustomMaterial:()=>E,CustomShaderStructure:()=>P,FireMaterial:()=>U,FurMaterial:()=>Y,GradientMaterial:()=>ee,GridMaterial:()=>ea,LavaMaterial:()=>ec,MixMaterial:()=>ev,NormalMaterial:()=>eS,PBRCustomMaterial:()=>B,ShaderAlbedoParts:()=>w,ShaderAlebdoParts:()=>O,ShaderSpecialParts:()=>I,ShadowOnlyMaterial:()=>ew,SimpleMaterial:()=>eN,SkyMaterial:()=>eW,TerrainMaterial:()=>eY,TriPlanarMaterial:()=>e0,WaterMaterial:()=>ti});var s=i(94269),r=i(5426),o=i(68180),a=i(26856),n=i(22740),l=i(91813),h=i(50280),_=i(77633),d=i(3177),c=i(88473),u=i(52019);i(8932),i(55455),i(7545),i(6915),i(70381),i(15755),i(59380),i(37519),i(21237),i(52740),i(19377),i(74804),i(20737),i(34873);let f="cellPixelShader",g=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
vec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)
{diffuseBase=info.diffuse*shadow;
#ifdef CELLBASIC
float level=1.0;if (info.ndl<0.5)
level=0.5;diffuseBase.rgb*vec3(level,level,level);
#else
float ToonThresholds[4];ToonThresholds[0]=0.95;ToonThresholds[1]=0.5;ToonThresholds[2]=0.2;ToonThresholds[3]=0.03;float ToonBrightnessLevels[5];ToonBrightnessLevels[0]=1.0;ToonBrightnessLevels[1]=0.8;ToonBrightnessLevels[2]=0.6;ToonBrightnessLevels[3]=0.35;ToonBrightnessLevels[4]=0.2;if (info.ndl>ToonThresholds[0])
{diffuseBase.rgb*=ToonBrightnessLevels[0];}
else if (info.ndl>ToonThresholds[1])
{diffuseBase.rgb*=ToonBrightnessLevels[1];}
else if (info.ndl>ToonThresholds[2])
{diffuseBase.rgb*=ToonBrightnessLevels[2];}
else if (info.ndl>ToonThresholds[3])
{diffuseBase.rgb*=ToonBrightnessLevels[3];}
else
{diffuseBase.rgb*=ToonBrightnessLevels[4];}
#endif
return max(diffuseBase,vec3(0.2));}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
lightingInfo info;vec3 diffuseBase=vec3(0.,0.,0.);float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif 
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[f]||(u.l.ShadersStore[f]=g),i(32570),i(32262),i(9979),i(86941),i(15969),i(20691),i(40616),i(30994),i(26851),i(52495),i(85950),i(57490),i(11966);let m="cellVertexShader",p=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x==0.)
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}
else
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[m]||(u.l.ShadersStore[m]=p);var v=i(86764),b=i(41469),x=i(50754);class C extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.NDOTL=!0,this.CUSTOMUSERLIGHTING=!0,this.CELLBASIC=!0,this.DEPTHPREPASS=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class T extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this._computeHighLevel=!1,this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new C);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._diffuseTexture&&h.h.DiffuseTextureEnabled))if(!this._diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if(r.CELLBASIC=!this.computeHighLevel,(0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant"],h=["diffuseSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("cell",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this._diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),(0,b.ij)(this._activeEffect,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this._maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e}dispose(e){this._diffuseTexture&&this._diffuseTexture.dispose(),super.dispose(e)}getClassName(){return"CellMaterial"}clone(e){return o.p.Clone(()=>new T(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.CellMaterial",e}static Parse(e,t,i){return o.p.Parse(()=>new T(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],T.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.jT)("diffuse")],T.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)("computeHighLevel")],T.prototype,"_computeHighLevel",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"computeHighLevel",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],T.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],T.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],T.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],T.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.CellMaterial",T);var y=i(32797),S=i(78684);i(73322),i(51046);class P{constructor(){}}class I{constructor(){}}class E extends S.F{AttachAfterBind(e,t){if(this._newUniformInstances)for(let e in this._newUniformInstances){let i=e.toString().split("-");"vec2"==i[0]?t.setVector2(i[1],this._newUniformInstances[e]):"vec3"==i[0]?this._newUniformInstances[e]instanceof a.v9?t.setColor3(i[1],this._newUniformInstances[e]):t.setVector3(i[1],this._newUniformInstances[e]):"vec4"==i[0]?(this._newUniformInstances[e]instanceof a.ov?t.setDirectColor4(i[1],this._newUniformInstances[e]):t.setVector4(i[1],this._newUniformInstances[e]),t.setVector4(i[1],this._newUniformInstances[e])):"mat4"==i[0]?t.setMatrix(i[1],this._newUniformInstances[e]):"float"==i[0]&&t.setFloat(i[1],this._newUniformInstances[e])}if(this._newSamplerInstances)for(let e in this._newSamplerInstances){let i=e.toString().split("-");"sampler2D"==i[0]&&this._newSamplerInstances[e].isReady&&this._newSamplerInstances[e].isReady()&&t.setTexture(i[1],this._newSamplerInstances[e])}}ReviewUniform(e,t){if("uniform"==e&&this._newUniforms)for(let e=0;e<this._newUniforms.length;e++)-1==this._customUniform[e].indexOf("sampler")&&t.push(this._newUniforms[e].replace(/\[\d*\]/g,""));if("sampler"==e&&this._newUniforms)for(let e=0;e<this._newUniforms.length;e++)-1!=this._customUniform[e].indexOf("sampler")&&t.push(this._newUniforms[e].replace(/\[\d*\]/g,""));return t}Builder(e,t,i,s,r,o){o&&this._customAttributes&&this._customAttributes.length>0&&o.push(...this._customAttributes),this.ReviewUniform("uniform",t),this.ReviewUniform("sampler",s);let a=this._createdShaderName;return y.M.ShadersStore[a+"VertexShader"]&&y.M.ShadersStore[a+"PixelShader"]||(y.M.ShadersStore[a+"VertexShader"]=this._injectCustomCode(this.VertexShader,"vertex"),y.M.ShadersStore[a+"PixelShader"]=this._injectCustomCode(this.FragmentShader,"fragment")),a}_injectCustomCode(e,t){let i=this._getCustomCode(t);for(let t in i){let s=i[t];if(s&&s.length>0){let i="#define "+t;e=e.replace(i,"\n"+s+"\n"+i)}}return e}_getCustomCode(e){return"vertex"===e?{CUSTOM_VERTEX_BEGIN:this.CustomParts.Vertex_Begin,CUSTOM_VERTEX_DEFINITIONS:(this._customUniform?.join("\n")||"")+(this.CustomParts.Vertex_Definitions||""),CUSTOM_VERTEX_MAIN_BEGIN:this.CustomParts.Vertex_MainBegin,CUSTOM_VERTEX_UPDATE_POSITION:this.CustomParts.Vertex_Before_PositionUpdated,CUSTOM_VERTEX_UPDATE_NORMAL:this.CustomParts.Vertex_Before_NormalUpdated,CUSTOM_VERTEX_MAIN_END:this.CustomParts.Vertex_MainEnd,CUSTOM_VERTEX_UPDATE_WORLDPOS:this.CustomParts.Vertex_After_WorldPosComputed}:{CUSTOM_FRAGMENT_BEGIN:this.CustomParts.Fragment_Begin,CUSTOM_FRAGMENT_DEFINITIONS:(this._customUniform?.join("\n")||"")+(this.CustomParts.Fragment_Definitions||""),CUSTOM_FRAGMENT_MAIN_BEGIN:this.CustomParts.Fragment_MainBegin,CUSTOM_FRAGMENT_UPDATE_DIFFUSE:this.CustomParts.Fragment_Custom_Diffuse,CUSTOM_FRAGMENT_UPDATE_ALPHA:this.CustomParts.Fragment_Custom_Alpha,CUSTOM_FRAGMENT_BEFORE_LIGHTS:this.CustomParts.Fragment_Before_Lights,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:this.CustomParts.Fragment_Before_FragColor,CUSTOM_FRAGMENT_MAIN_END:this.CustomParts.Fragment_MainEnd,CUSTOM_FRAGMENT_BEFORE_FOG:this.CustomParts.Fragment_Before_Fog}}constructor(e,t){super(e,t,!0),this.CustomParts=new I,this.customShaderNameResolve=this.Builder,this.FragmentShader=y.M.ShadersStore.defaultPixelShader,this.VertexShader=y.M.ShadersStore.defaultVertexShader,E.ShaderIndexer++,this._createdShaderName="custom_"+E.ShaderIndexer}_afterBind(e,t=null,i){if(t){this.AttachAfterBind(e,t);try{super._afterBind(e,t,i)}catch(e){}}}AddUniform(e,t,i){return this._customUniform||(this._customUniform=[],this._newUniforms=[],this._newSamplerInstances={},this._newUniformInstances={}),i&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=i:this._newUniformInstances[t+"-"+e]=i),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this}AddAttribute(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this}Fragment_Begin(e){return this.CustomParts.Fragment_Begin=e,this}Fragment_Definitions(e){return this.CustomParts.Fragment_Definitions=e,this}Fragment_MainBegin(e){return this.CustomParts.Fragment_MainBegin=e,this}Fragment_MainEnd(e){return this.CustomParts.Fragment_MainEnd=e,this}Fragment_Custom_Diffuse(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this}Fragment_Custom_Alpha(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this}Fragment_Before_Lights(e){return this.CustomParts.Fragment_Before_Lights=e,this}Fragment_Before_Fog(e){return this.CustomParts.Fragment_Before_Fog=e,this}Fragment_Before_FragColor(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this}Vertex_Begin(e){return this.CustomParts.Vertex_Begin=e,this}Vertex_Definitions(e){return this.CustomParts.Vertex_Definitions=e,this}Vertex_MainBegin(e){return this.CustomParts.Vertex_MainBegin=e,this}Vertex_Before_PositionUpdated(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this}Vertex_Before_NormalUpdated(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this}Vertex_After_WorldPosComputed(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this}Vertex_MainEnd(e){return this.CustomParts.Vertex_MainEnd=e,this}}E.ShaderIndexer=1,(0,c.Y5)("BABYLON.CustomMaterial",E);var R=i(81622),M=i(64648);i(83019),i(63835);class w{constructor(){}}let O=w;class B extends R.Y{AttachAfterBind(e,t){if(this._newUniformInstances)for(let e in this._newUniformInstances){let i=e.toString().split("-");"vec2"==i[0]?t.setVector2(i[1],this._newUniformInstances[e]):"vec3"==i[0]?this._newUniformInstances[e]instanceof a.v9?t.setColor3(i[1],this._newUniformInstances[e]):t.setVector3(i[1],this._newUniformInstances[e]):"vec4"==i[0]?(this._newUniformInstances[e]instanceof a.ov?t.setDirectColor4(i[1],this._newUniformInstances[e]):t.setVector4(i[1],this._newUniformInstances[e]),t.setVector4(i[1],this._newUniformInstances[e])):"mat4"==i[0]?t.setMatrix(i[1],this._newUniformInstances[e]):"float"==i[0]&&t.setFloat(i[1],this._newUniformInstances[e])}if(this._newSamplerInstances)for(let e in this._newSamplerInstances){let i=e.toString().split("-");"sampler2D"==i[0]&&this._newSamplerInstances[e].isReady&&this._newSamplerInstances[e].isReady()&&t.setTexture(i[1],this._newSamplerInstances[e])}}ReviewUniform(e,t){if("uniform"==e&&this._newUniforms)for(let e=0;e<this._newUniforms.length;e++)-1==this._customUniform[e].indexOf("sampler")&&t.push(this._newUniforms[e].replace(/\[\d*\]/g,""));if("sampler"==e&&this._newUniforms)for(let e=0;e<this._newUniforms.length;e++)-1!=this._customUniform[e].indexOf("sampler")&&t.push(this._newUniforms[e].replace(/\[\d*\]/g,""));return t}Builder(e,t,i,s,r,o,a){if(a){let e=a.processFinalCode;a.processFinalCode=(t,i)=>{if("vertex"===t)return e?e(t,i):i;let s=new M.Y(i);return s.inlineToken="#define pbr_inline",s.processCode(),e?e(t,s.code):s.code}}o&&this._customAttributes&&this._customAttributes.length>0&&o.push(...this._customAttributes),this.ReviewUniform("uniform",t),this.ReviewUniform("sampler",s);let n=this._createdShaderName;return y.M.ShadersStore[n+"VertexShader"]&&y.M.ShadersStore[n+"PixelShader"]||(y.M.ShadersStore[n+"VertexShader"]=this._injectCustomCode(this.VertexShader,"vertex"),y.M.ShadersStore[n+"PixelShader"]=this._injectCustomCode(this.FragmentShader,"fragment")),n}_injectCustomCode(e,t){let i=this._getCustomCode(t);for(let t in i){let s=i[t];if(s&&s.length>0){let i="#define "+t;e=e.replace(i,"\n"+s+"\n"+i)}}return e}_getCustomCode(e){return"vertex"===e?{CUSTOM_VERTEX_BEGIN:this.CustomParts.Vertex_Begin,CUSTOM_VERTEX_DEFINITIONS:(this._customUniform?.join("\n")||"")+(this.CustomParts.Vertex_Definitions||""),CUSTOM_VERTEX_MAIN_BEGIN:this.CustomParts.Vertex_MainBegin,CUSTOM_VERTEX_UPDATE_POSITION:this.CustomParts.Vertex_Before_PositionUpdated,CUSTOM_VERTEX_UPDATE_NORMAL:this.CustomParts.Vertex_Before_NormalUpdated,CUSTOM_VERTEX_MAIN_END:this.CustomParts.Vertex_MainEnd,CUSTOM_VERTEX_UPDATE_WORLDPOS:this.CustomParts.Vertex_After_WorldPosComputed}:{CUSTOM_FRAGMENT_BEGIN:this.CustomParts.Fragment_Begin,CUSTOM_FRAGMENT_MAIN_BEGIN:this.CustomParts.Fragment_MainBegin,CUSTOM_FRAGMENT_DEFINITIONS:(this._customUniform?.join("\n")||"")+(this.CustomParts.Fragment_Definitions||""),CUSTOM_FRAGMENT_UPDATE_ALBEDO:this.CustomParts.Fragment_Custom_Albedo,CUSTOM_FRAGMENT_UPDATE_ALPHA:this.CustomParts.Fragment_Custom_Alpha,CUSTOM_FRAGMENT_BEFORE_LIGHTS:this.CustomParts.Fragment_Before_Lights,CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS:this.CustomParts.Fragment_Custom_MetallicRoughness,CUSTOM_FRAGMENT_UPDATE_MICROSURFACE:this.CustomParts.Fragment_Custom_MicroSurface,CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION:this.CustomParts.Fragment_Before_FinalColorComposition,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:this.CustomParts.Fragment_Before_FragColor,CUSTOM_FRAGMENT_MAIN_END:this.CustomParts.Fragment_MainEnd,CUSTOM_FRAGMENT_BEFORE_FOG:this.CustomParts.Fragment_Before_Fog}}constructor(e,t){super(e,t,!0),this.CustomParts=new w,this.customShaderNameResolve=this.Builder,this.FragmentShader=y.M.ShadersStore.pbrPixelShader,this.VertexShader=y.M.ShadersStore.pbrVertexShader,this.FragmentShader=this.FragmentShader.replace(/#include<pbrBlockAlbedoOpacity>/g,y.M.IncludesShadersStore.pbrBlockAlbedoOpacity),this.FragmentShader=this.FragmentShader.replace(/#include<pbrBlockReflectivity>/g,y.M.IncludesShadersStore.pbrBlockReflectivity),this.FragmentShader=this.FragmentShader.replace(/#include<pbrBlockFinalColorComposition>/g,y.M.IncludesShadersStore.pbrBlockFinalColorComposition),B.ShaderIndexer++,this._createdShaderName="custompbr_"+B.ShaderIndexer}_afterBind(e,t=null,i){if(t){this.AttachAfterBind(e,t);try{super._afterBind(e,t,i)}catch(e){}}}AddUniform(e,t,i){return this._customUniform||(this._customUniform=[],this._newUniforms=[],this._newSamplerInstances={},this._newUniformInstances={}),i&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=i:this._newUniformInstances[t+"-"+e]=i),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this}AddAttribute(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this}Fragment_Begin(e){return this.CustomParts.Fragment_Begin=e,this}Fragment_Definitions(e){return this.CustomParts.Fragment_Definitions=e,this}Fragment_MainBegin(e){return this.CustomParts.Fragment_MainBegin=e,this}Fragment_Custom_Albedo(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this}Fragment_Custom_Alpha(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this}Fragment_Before_Lights(e){return this.CustomParts.Fragment_Before_Lights=e,this}Fragment_Custom_MetallicRoughness(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this}Fragment_Custom_MicroSurface(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this}Fragment_Before_Fog(e){return this.CustomParts.Fragment_Before_Fog=e,this}Fragment_Before_FinalColorComposition(e){return this.CustomParts.Fragment_Before_FinalColorComposition=e,this}Fragment_Before_FragColor(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this}Fragment_MainEnd(e){return this.CustomParts.Fragment_MainEnd=e,this}Vertex_Begin(e){return this.CustomParts.Vertex_Begin=e,this}Vertex_Definitions(e){return this.CustomParts.Vertex_Definitions=e,this}Vertex_MainBegin(e){return this.CustomParts.Vertex_MainBegin=e,this}Vertex_Before_PositionUpdated(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this}Vertex_Before_NormalUpdated(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this}Vertex_After_WorldPosComputed(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this}Vertex_MainEnd(e){return this.CustomParts.Vertex_MainEnd=e,this}}B.ShaderIndexer=1,(0,c.Y5)("BABYLON.PBRCustomMaterial",B);var A=i(75089),F=i(75200);let L="firePixelShader",N=`precision highp float;uniform vec4 vEyePosition;varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
uniform sampler2D distortionSampler;uniform sampler2D opacitySampler;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;varying vec2 vDistortionCoords2;varying vec2 vDistortionCoords3;
#endif
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
vec4 bx2(vec4 x)
{return vec4(2.0)*x-vec4(1.0);}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);float alpha=1.0;
#ifdef DIFFUSE
const float distortionAmount0 =0.092;const float distortionAmount1 =0.092;const float distortionAmount2 =0.092;vec2 heightAttenuation=vec2(0.3,0.39);vec4 noise0=texture2D(distortionSampler,vDistortionCoords1);vec4 noise1=texture2D(distortionSampler,vDistortionCoords2);vec4 noise2=texture2D(distortionSampler,vDistortionCoords3);vec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;vec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);vec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);
#ifdef ALPHATEST
if (opacityColor.r<0.1)
discard;
#endif
#include<depthPrePass>
baseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;baseColor*=opacityColor;baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
vec3 diffuseBase=vec3(1.0,1.0,1.0);
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec4 color=vec4(baseColor.rgb,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[L]||(u.l.ShadersStore[L]=N);let D="fireVertexShader",k=`precision highp float;attribute vec3 position;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
uniform float time;uniform float speed;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;varying vec2 vDistortionCoords2;varying vec2 vDistortionCoords3;
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef DIFFUSE
vDiffuseUV=uv;vDiffuseUV.y-=0.2;
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#ifdef DIFFUSE
vec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;vDistortionCoords1.x=uv.x;vDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;vDistortionCoords2.x=uv.x;vDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;vDistortionCoords3.x=uv.x;vDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[D]||(u.l.ShadersStore[D]=k);class V extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.UV1=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.BonesPerMesh=0,this.NUM_BONE_INFLUENCERS=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class U extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this.speed=1,this._scaledDiffuse=new a.v9,this._lastTime=0}needAlphaBlending(){return!1}needAlphaTesting(){return!0}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new V);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,this._diffuseTexture&&h.h.DiffuseTextureEnabled))if(!this._diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if(r.ALPHATEST=!!this._opacityTexture,r._areMiscDirty&&(r.POINTSIZE=this.pointsCloud||o.forcePointsCloud,r.FOG=o.fogEnabled&&e.applyFog&&o.fogMode!==d.Z.FOGMODE_NONE&&this.fogEnabled,r.LOGARITHMICDEPTH=this._useLogarithmicDepth),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.UV1&&s.push(_.R.UVKind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant","time","speed"];(0,b.Ll)(n);let l=r.toString();t.setEffect(o.getEngine().createEffect("fire",{attributes:s,uniformsNames:n,uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:l,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},a),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this._diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),(0,b.ij)(this._activeEffect,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._lastTime+=s.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&e.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._distortionTexture&&e.push(this._distortionTexture),this._opacityTexture&&e.push(this._opacityTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e||this._distortionTexture===e||this._opacityTexture===e}getClassName(){return"FireMaterial"}dispose(e){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new U(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.FireMaterial",e.diffuseColor=this.diffuseColor.asArray(),e.speed=this.speed,this._diffuseTexture&&(e._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(e._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(e._opacityTexture=this._opacityTexture.serialize()),e}static Parse(e,t,i){let s=new U(e.name,t);return s.diffuseColor=a.v9.FromArray(e.diffuseColor),s.speed=e.speed,s.alpha=e.alpha,s.id=e.id,A.Y.AddTagsTo(s,e.tags),s.backFaceCulling=e.backFaceCulling,s.wireframe=e.wireframe,e._diffuseTexture&&(s._diffuseTexture=F.g.Parse(e._diffuseTexture,t,i)),e._distortionTexture&&(s._distortionTexture=F.g.Parse(e._distortionTexture,t,i)),e._opacityTexture&&(s._opacityTexture=F.g.Parse(e._opacityTexture,t,i)),s}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],U.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.uM)("distortionTexture")],U.prototype,"_distortionTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"distortionTexture",void 0),(0,s.Cg)([(0,r.uM)("opacityTexture")],U.prototype,"_opacityTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"opacityTexture",void 0),(0,s.Cg)([(0,r.jT)("diffuse")],U.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)()],U.prototype,"speed",void 0),(0,c.Y5)("BABYLON.FireMaterial",U);var z=i(27746),W=i(4661);let Q="furPixelShader",G=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;uniform vec4 furColor;uniform float furLength;varying vec3 vPositionW;varying float vfur_length;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
#ifdef HIGHLEVEL
uniform float furOffset;uniform float furOcclusion;uniform sampler2D furTexture;varying vec2 vFurUV;
#endif
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<fogFragmentDeclaration>
#include<clipPlaneFragmentDeclaration>
float Rand(vec3 rv) {float x=dot(rv,vec3(12.9898,78.233,24.65487));return fract(sin(x)*43758.5453);}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=furColor;vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor*=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef HIGHLEVEL
vec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));if (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {discard;}
float occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);baseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);
#ifdef HIGHLEVEL
vec4 color=vec4(finalDiffuse,alpha);
#else
float r=vfur_length/furLength*0.5;vec4 color=vec4(finalDiffuse*(0.5+r),alpha);
#endif
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[Q]||(u.l.ShadersStore[Q]=G);let H="furVertexShader",K=`precision highp float;attribute vec3 position;attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
uniform float furLength;uniform float furAngle;
#ifdef HIGHLEVEL
uniform float furOffset;uniform vec3 furGravity;uniform float furTime;uniform float furSpacing;uniform float furDensity;
#endif
#ifdef HEIGHTMAP
uniform sampler2D heightTexture;
#endif
#ifdef HIGHLEVEL
varying vec2 vFurUV;
#endif
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
varying float vfur_length;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
float Rand(vec3 rv) {float x=dot(rv,vec3(12.9898,78.233,24.65487));return fract(sin(x)*43758.5453);}
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
float r=Rand(position);
#ifdef HEIGHTMAP
#if __VERSION__>100
vfur_length=furLength*texture(heightTexture,uv).x;
#else
vfur_length=furLength*texture2D(heightTexture,uv).r;
#endif
#else 
vfur_length=(furLength*r);
#endif
vec3 tangent1=vec3(normal.y,-normal.x,0);vec3 tangent2=vec3(-normal.z,0,normal.x);r=Rand(tangent1*r);float J=(2.0+4.0*r);r=Rand(tangent2*r);float K=(2.0+2.0*r);tangent1=tangent1*J+tangent2*K;tangent1=normalize(tangent1);vec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);
#ifdef HIGHLEVEL
vec3 forceDirection=vec3(0.0,0.0,0.0);forceDirection.x=sin(furTime+position.x*0.05)*0.2;forceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;forceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;vec3 displacement=vec3(0.0,0.0,0.0);displacement=furGravity+forceDirection;float displacementFactor=pow(furOffset,3.0);vec3 aNormal=normal;aNormal.xyz+=displacement*displacementFactor;newPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);
#endif
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
gl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);vec4 worldPos=finalWorld*vec4(newPosition,1.0);vPositionW=vec3(worldPos);
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x==0.)
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}
else
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}
#ifdef HIGHLEVEL
vFurUV=vDiffuseUV*furDensity;
#endif
#else
#ifdef HIGHLEVEL
vFurUV=uv*furDensity;
#endif
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[H]||(u.l.ShadersStore[H]=K);class X extends n.M{constructor(){super(),this.DIFFUSE=!1,this.HEIGHTMAP=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.HIGHLEVEL=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class Y extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this.furLength=1,this.furAngle=0,this.furColor=new a.v9(.44,.21,.02),this.furOffset=0,this.furSpacing=12,this.furGravity=new z.Pq(0,0,0),this.furSpeed=100,this.furDensity=20,this.furOcclusion=0,this._disableLighting=!1,this._maxSimultaneousLights=4,this.highLevelFur=!0,this._furTime=0}get furTime(){return this._furTime}set furTime(e){this._furTime=e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}updateFur(){for(let e=1;e<this._meshes.length;e++){let t=this._meshes[e].material;t.furLength=this.furLength,t.furAngle=this.furAngle,t.furGravity=this.furGravity,t.furSpacing=this.furSpacing,t.furSpeed=this.furSpeed,t.furColor=this.furColor,t.diffuseTexture=this.diffuseTexture,t.furTexture=this.furTexture,t.highLevelFur=this.highLevelFur,t.furTime=this.furTime,t.furDensity=this.furDensity}}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new X);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&o.texturesEnabled){if(this.diffuseTexture&&h.h.DiffuseTextureEnabled)if(!this.diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if(this.heightTexture&&a.getCaps().maxVertexTextureImageUnits)if(!this.heightTexture.isReady())return!1;else r._needUVs=!0,r.HEIGHTMAP=!0}if(this.highLevelFur!==r.HIGHLEVEL&&(r.HIGHLEVEL=!0,r.markAsUnprocessed()),(0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"];(0,b.Ll)(l);let h=["diffuseSampler","heightTexture","furTexture","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("fur",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this._diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),(0,b.ij)(this._activeEffect,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._heightTexture&&e.push(this._heightTexture),e}hasTexture(e){return!!super.hasTexture(e)||this.diffuseTexture===e||this._heightTexture===e}dispose(e){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(let t=1;t<this._meshes.length;t++){let i=this._meshes[t].material;i&&i.dispose(e),this._meshes[t].dispose()}super.dispose(e)}clone(e){return o.p.Clone(()=>new Y(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.FurMaterial",this._meshes&&(e.sourceMeshName=this._meshes[0].name,e.quality=this._meshes.length),e}getClassName(){return"FurMaterial"}static Parse(e,t,i){let s=o.p.Parse(()=>new Y(e.name,t),e,t,i);return e.sourceMeshName&&s.highLevelFur&&t.executeWhenReady(()=>{let i=t.getMeshByName(e.sourceMeshName);i&&(s.furTexture=Y.GenerateTexture("Fur Texture",t),Y.FurifyMesh(i,e.quality))}),s}static GenerateTexture(e,t){let i=new W.R("FurTexture "+e,256,t,!0),s=i.getContext();for(let e=0;e<2e4;++e)s.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",s.fillRect(Math.random()*i.getSize().width,Math.random()*i.getSize().height,2,2);return i.update(!1),i.wrapU=F.g.WRAP_ADDRESSMODE,i.wrapV=F.g.WRAP_ADDRESSMODE,i}static FurifyMesh(e,t){let i,s=[e],r=e.material;if(!(r instanceof Y))throw"The material of the source mesh must be a Fur Material";for(i=1;i<t;i++){let o=new Y(r.name+i,e.getScene());e.getScene().materials.pop(),A.Y.EnableFor(o),A.Y.AddTagsTo(o,"furShellMaterial"),o.furLength=r.furLength,o.furAngle=r.furAngle,o.furGravity=r.furGravity,o.furSpacing=r.furSpacing,o.furSpeed=r.furSpeed,o.furColor=r.furColor,o.diffuseTexture=r.diffuseTexture,o.furOffset=i/t,o.furTexture=r.furTexture,o.highLevelFur=r.highLevelFur,o.furTime=r.furTime,o.furDensity=r.furDensity;let a=e.clone(e.name+i);a.material=o,a.skeleton=e.skeleton,a.position=z.Pq.Zero(),s.push(a)}for(i=1;i<s.length;i++)s[i].parent=e;return e.material._meshes=s,s}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],Y.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.uM)("heightTexture")],Y.prototype,"_heightTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"heightTexture",void 0),(0,s.Cg)([(0,r.jT)()],Y.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furLength",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furAngle",void 0),(0,s.Cg)([(0,r.jT)()],Y.prototype,"furColor",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furOffset",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furSpacing",void 0),(0,s.Cg)([(0,r.P_)()],Y.prototype,"furGravity",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furSpeed",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furDensity",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furOcclusion",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],Y.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],Y.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"highLevelFur",void 0),(0,s.Cg)([(0,r.lK)()],Y.prototype,"furTime",null),(0,c.Y5)("BABYLON.FurMaterial",Y);let q="gradientPixelShader",j=`precision highp float;uniform vec4 vEyePosition;uniform vec4 topColor;uniform vec4 bottomColor;uniform float offset;uniform float scale;uniform float smoothness;varying vec3 vPositionW;varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);float h=vPosition.y*scale+offset;float mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));vec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));vec3 diffuseColor=baseColor.rgb;float alpha=baseColor.a;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef EMISSIVE
vec3 diffuseBase=baseColor.rgb;
#else
vec3 diffuseBase=vec3(0.,0.,0.);
#endif
lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[q]||(u.l.ShadersStore[q]=j);let $="gradientVertexShader",Z=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);vPosition=position;
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[$]||(u.l.ShadersStore[$]=Z);class J extends n.M{constructor(){super(),this.EMISSIVE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class ee extends l.E{constructor(e,t){super(e,t),this._maxSimultaneousLights=4,this.topColor=new a.v9(1,0,0),this.topColorAlpha=1,this.bottomColor=new a.v9(0,0,1),this.bottomColorAlpha=1,this.offset=0,this.scale=1,this.smoothness=1,this._disableLighting=!1}needAlphaBlending(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1}needAlphaTesting(){return!0}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new J);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if((0,x.OR)(o,a,this,r,!!i),(0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),r.EMISSIVE=this._disableLighting,(0,x.qB)(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","logarithmicDepthConstant","topColor","bottomColor","offset","smoothness","scale"];(0,b.Ll)(l);let h=["areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:4}),t.setEffect(o.getEngine().createEffect("gradient",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,o),this._mustRebind(s,o,i)&&((0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return o.p.Clone(()=>new ee(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.GradientMaterial",e}getClassName(){return"GradientMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new ee(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],ee.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ee.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.jT)()],ee.prototype,"topColor",void 0),(0,s.Cg)([(0,r.lK)()],ee.prototype,"topColorAlpha",void 0),(0,s.Cg)([(0,r.jT)()],ee.prototype,"bottomColor",void 0),(0,s.Cg)([(0,r.lK)()],ee.prototype,"bottomColorAlpha",void 0),(0,s.Cg)([(0,r.lK)()],ee.prototype,"offset",void 0),(0,s.Cg)([(0,r.lK)()],ee.prototype,"scale",void 0),(0,s.Cg)([(0,r.lK)()],ee.prototype,"smoothness",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],ee.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ee.prototype,"disableLighting",void 0),(0,c.Y5)("BABYLON.GradientMaterial",ee);let et="gridPixelShader",ei=`#extension GL_OES_standard_derivatives : enable
#define SQRT2 1.41421356
#define PI 3.14159
precision highp float;uniform float visibility;uniform vec3 mainColor;uniform vec3 lineColor;uniform vec4 gridControl;uniform vec3 gridOffset;varying vec3 vPosition;varying vec3 vNormal;
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;uniform sampler2D opacitySampler;uniform vec2 vOpacityInfos;
#endif
float getDynamicVisibility(float position) {float majorGridFrequency=gridControl.y;if (floor(position+0.5)==floor(position/majorGridFrequency+0.5)*majorGridFrequency)
{return 1.0;}
return gridControl.z;}
float getAnisotropicAttenuation(float differentialLength) {const float maxNumberOfLines=10.0;return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);}
float isPointOnLine(float position,float differentialLength) {float fractionPartOfPosition=position-floor(position+0.5); 
fractionPartOfPosition/=differentialLength; 
#ifdef ANTIALIAS
fractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);float result=0.5+0.5*cos(fractionPartOfPosition*PI); 
return result;
#else
return abs(fractionPartOfPosition)<SQRT2/4. ? 1. : 0.;
#endif
}
float contributionOnAxis(float position) {float differentialLength=length(vec2(dFdx(position),dFdy(position)));differentialLength*=SQRT2; 
float result=isPointOnLine(position,differentialLength);float dynamicVisibility=getDynamicVisibility(position);result*=dynamicVisibility;float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);result*=anisotropicAttenuation;return result;}
float normalImpactOnAxis(float x) {float normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);return normalImpact;}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
float gridRatio=gridControl.x;vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;float x=contributionOnAxis(gridPos.x);float y=contributionOnAxis(gridPos.y);float z=contributionOnAxis(gridPos.z);vec3 normal=normalize(vNormal);x*=normalImpactOnAxis(normal.x);y*=normalImpactOnAxis(normal.y);z*=normalImpactOnAxis(normal.z);
#ifdef MAX_LINE
float grid=clamp(max(max(x,y),z),0.,1.);
#else
float grid=clamp(x+y+z,0.,1.);
#endif
vec3 color=mix(mainColor,lineColor,grid);
#ifdef FOG
#include<fogFragment>
#endif
float opacity=1.0;
#ifdef TRANSPARENT
opacity=clamp(grid,0.08,gridControl.w*grid);
#endif
#ifdef OPACITY
opacity*=texture2D(opacitySampler,vOpacityUV).a;
#endif
gl_FragColor=vec4(color.rgb,opacity*visibility);
#ifdef TRANSPARENT
#ifdef PREMULTIPLYALPHA
gl_FragColor.rgb*=opacity;
#endif
#else
#endif
#include<logDepthFragment>
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[et]||(u.l.ShadersStore[et]=ei),i(25285),i(84837);let es="gridVertexShader",er=`precision highp float;attribute vec3 position;attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#include<instancesDeclaration>
#include<__decl__sceneVertex>
varying vec3 vPosition;varying vec3 vNormal;
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;uniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;
#endif
#include<clipPlaneVertexDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#include<instancesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#include<fogVertex>
vec4 cameraSpacePosition=view*worldPos;gl_Position=projection*cameraSpacePosition;
#ifdef OPACITY
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
if (vOpacityInfos.x==0.)
{vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));}
else
{vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));}
#endif 
#include<clipPlaneVertex>
#include<logDepthVertex>
vPosition=position;vNormal=normal;
#define CUSTOM_VERTEX_MAIN_END
}`;u.l.ShadersStore[es]||(u.l.ShadersStore[es]=er);class eo extends n.M{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.OPACITY=!1,this.ANTIALIAS=!1,this.TRANSPARENT=!1,this.FOG=!1,this.PREMULTIPLYALPHA=!1,this.MAX_LINE=!1,this.UV1=!1,this.UV2=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class ea extends l.E{constructor(e,t){super(e,t),this.mainColor=a.v9.Black(),this.lineColor=a.v9.Teal(),this.gridRatio=1,this.gridOffset=z.Pq.Zero(),this.majorUnitFrequency=10,this.minorUnitVisibility=.33,this.opacity=1,this.antialias=!0,this.preMultiplyAlpha=!1,this.useMaxLine=!1,this._gridControl=new z.IU(this.gridRatio,this.majorUnitFrequency,this.minorUnitVisibility,this.opacity)}needAlphaBlending(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()}needAlphaBlendingForMesh(e){return e.visibility<1||this.needAlphaBlending()}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new eo);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(r.TRANSPARENT!==this.opacity<1&&(r.TRANSPARENT=!r.TRANSPARENT,r.markAsUnprocessed()),r.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(r.PREMULTIPLYALPHA=!r.PREMULTIPLYALPHA,r.markAsUnprocessed()),r.MAX_LINE!==this.useMaxLine&&(r.MAX_LINE=!r.MAX_LINE,r.markAsUnprocessed()),r.ANTIALIAS!==this.antialias&&(r.ANTIALIAS=!r.ANTIALIAS,r.markAsUnprocessed()),r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._opacityTexture&&h.h.OpacityTextureEnabled))if(!this._opacityTexture.isReady())return!1;else r._needUVs=!0,r.OPACITY=!0;if((0,x.fm)(e,o,this._useLogarithmicDepth,!1,this.fogEnabled,!1,r,void 0,void 0,void 0,this._setVertexOutputInvariant),(0,x.OR)(o,o.getEngine(),this,r,!!i),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial(),(0,x.qB)(e,r,!1,!1);let i=[_.R.PositionKind,_.R.NormalKind];r.UV1&&i.push(_.R.UVKind),r.UV2&&i.push(_.R.UV2Kind),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess,(0,x.ER)(i,r);let s=["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos","visibility","logarithmicDepthConstant"],a=r.toString();(0,b.Ll)(s),t.setEffect(o.getEngine().createEffect("grid",{attributes:i,uniformsNames:s,uniformBuffersNames:["Scene"],samplers:["opacitySampler"],defines:a,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError},o.getEngine()),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this._activeEffect.setFloat("visibility",t.visibility),(!r.INSTANCES||r.THIN_INSTANCE)&&this.bindOnlyWorldMatrix(e),this.bindView(o),this.bindViewProjection(o),this._mustRebind(s,o,i)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&h.h.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix())),(0,b.ij)(o,this,s),this._useLogarithmicDepth&&(0,x.DL)(r,o,s)),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}dispose(e){super.dispose(e)}clone(e){return o.p.Clone(()=>new ea(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.GridMaterial",e}getClassName(){return"GridMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new ea(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.jT)()],ea.prototype,"mainColor",void 0),(0,s.Cg)([(0,r.jT)()],ea.prototype,"lineColor",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"gridRatio",void 0),(0,s.Cg)([(0,r.P_)()],ea.prototype,"gridOffset",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"majorUnitFrequency",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"minorUnitVisibility",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"opacity",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"antialias",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"preMultiplyAlpha",void 0),(0,s.Cg)([(0,r.lK)()],ea.prototype,"useMaxLine",void 0),(0,s.Cg)([(0,r.uM)("opacityTexture")],ea.prototype,"_opacityTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ea.prototype,"opacityTexture",void 0),(0,c.Y5)("BABYLON.GridMaterial",ea);let en="lavaPixelShader",el=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;varying vec3 vPositionW;uniform float time;uniform float speed;uniform float movingSpeed;uniform vec3 fogColor;uniform sampler2D noiseTexture;uniform float fogDensity;varying float noise;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
float random( vec3 scale,float seed ){return fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
vec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );vec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time *0.02;vec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;T1.x+=noiseTex.x*2.0;T1.y+=noiseTex.y*2.0;T2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;T2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;float p=texture2D( noiseTexture,T1*3.0 ).a;vec4 lavaColor=texture2D( diffuseSampler,T2*4.0);vec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );baseColor=temp;float depth=gl_FragCoord.z*4.0;const float LOG2=1.442695;float fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );fogFactor=1.0-clamp( fogFactor,0.0,1.0 );baseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );diffuseColor=baseColor.rgb;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
#endif
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[en]||(u.l.ShadersStore[en]=el);let eh="lavaVertexShader",e_=`precision highp float;uniform float time;uniform float lowFrequencySpeed;varying float noise;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
/* NOISE FUNCTIONS */
vec3 mod289(vec3 x)
{return x-floor(x*(1.0/289.0))*289.0;}
vec4 mod289(vec4 x)
{return x-floor(x*(1.0/289.0))*289.0;}
vec4 permute(vec4 x)
{return mod289(((x*34.0)+1.0)*x);}
vec4 taylorInvSqrt(vec4 r)
{return 1.79284291400159-0.85373472095314*r;}
vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}
float pnoise(vec3 P,vec3 rep)
{vec3 Pi0=mod(floor(P),rep); 
vec3 Pi1=mod(Pi0+vec3(1.0),rep); 
Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P); 
vec3 Pf1=Pf0-vec3(1.0); 
vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}
/* END FUNCTION */
float turbulence( vec3 p ) {float w=100.0;float t=-.5;for (float f=1.0 ; f<=10.0 ; f++ ){float power=pow( 2.0,f );t+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );}
return t;}
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
#ifdef NORMAL
noise=10.0* -.10*turbulence( .5*normal+time*1.15 );float b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );float displacement=- 1.5*noise+b;vec3 newPosition=position+normal*displacement;gl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );vec4 worldPos=finalWorld*vec4(newPosition,1.0);vPositionW=vec3(worldPos);vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x==0.)
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}
else
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#include<logDepthVertex>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}`;u.l.ShadersStore[eh]||(u.l.ShadersStore[eh]=e_);class ed extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.LIGHT0=!1,this.LIGHT1=!1,this.LIGHT2=!1,this.LIGHT3=!1,this.SPOTLIGHT0=!1,this.SPOTLIGHT1=!1,this.SPOTLIGHT2=!1,this.SPOTLIGHT3=!1,this.HEMILIGHT0=!1,this.HEMILIGHT1=!1,this.HEMILIGHT2=!1,this.HEMILIGHT3=!1,this.DIRLIGHT0=!1,this.DIRLIGHT1=!1,this.DIRLIGHT2=!1,this.DIRLIGHT3=!1,this.POINTLIGHT0=!1,this.POINTLIGHT1=!1,this.POINTLIGHT2=!1,this.POINTLIGHT3=!1,this.SHADOW0=!1,this.SHADOW1=!1,this.SHADOW2=!1,this.SHADOW3=!1,this.SHADOWS=!1,this.SHADOWESM0=!1,this.SHADOWESM1=!1,this.SHADOWESM2=!1,this.SHADOWESM3=!1,this.SHADOWPOISSON0=!1,this.SHADOWPOISSON1=!1,this.SHADOWPOISSON2=!1,this.SHADOWPOISSON3=!1,this.SHADOWPCF0=!1,this.SHADOWPCF1=!1,this.SHADOWPCF2=!1,this.SHADOWPCF3=!1,this.SHADOWPCSS0=!1,this.SHADOWPCSS1=!1,this.SHADOWPCSS2=!1,this.SHADOWPCSS3=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.UNLIT=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class ec extends l.E{constructor(e,t){super(e,t),this.speed=1,this.movingSpeed=1,this.lowFrequencySpeed=1,this.fogDensity=.15,this._lastTime=0,this.diffuseColor=new a.v9(1,1,1),this._disableLighting=!1,this._unlit=!1,this._maxSimultaneousLights=4,this._scaledDiffuse=new a.v9}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new ed);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._diffuseTexture&&h.h.DiffuseTextureEnabled))if(!this._diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=!0,(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"];(0,b.Ll)(l);let h=["diffuseSampler","noiseTexture","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("lava",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,r.UNLIT=this._unlit,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this.diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._lastTime+=s.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1e3),this.fogColor||(this.fogColor=a.v9.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&e.push(this.noiseTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),e}hasTexture(e){return!!super.hasTexture(e)||this.diffuseTexture===e}dispose(e){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new ec(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.LavaMaterial",e}getClassName(){return"LavaMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new ec(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],ec.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ec.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.uM)()],ec.prototype,"noiseTexture",void 0),(0,s.Cg)([(0,r.jT)()],ec.prototype,"fogColor",void 0),(0,s.Cg)([(0,r.lK)()],ec.prototype,"speed",void 0),(0,s.Cg)([(0,r.lK)()],ec.prototype,"movingSpeed",void 0),(0,s.Cg)([(0,r.lK)()],ec.prototype,"lowFrequencySpeed",void 0),(0,s.Cg)([(0,r.lK)()],ec.prototype,"fogDensity",void 0),(0,s.Cg)([(0,r.jT)()],ec.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],ec.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ec.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("unlit")],ec.prototype,"_unlit",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ec.prototype,"unlit",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],ec.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ec.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.LavaMaterial",ec);let eu="mixPixelShader",ef=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef DIFFUSE
varying vec2 vTextureUV;uniform sampler2D mixMap1Sampler;uniform vec2 vTextureInfos;
#ifdef MIXMAP2
uniform sampler2D mixMap2Sampler;
#endif
uniform sampler2D diffuse1Sampler;uniform sampler2D diffuse2Sampler;uniform sampler2D diffuse3Sampler;uniform sampler2D diffuse4Sampler;uniform vec2 diffuse1Infos;uniform vec2 diffuse2Infos;uniform vec2 diffuse3Infos;uniform vec2 diffuse4Infos;
#ifdef MIXMAP2
uniform sampler2D diffuse5Sampler;uniform sampler2D diffuse6Sampler;uniform sampler2D diffuse7Sampler;uniform sampler2D diffuse8Sampler;uniform vec2 diffuse5Infos;uniform vec2 diffuse6Infos;uniform vec2 diffuse7Infos;uniform vec2 diffuse8Infos;
#endif
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 finalMixColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef MIXMAP2
vec4 mixColor2=vec4(1.,1.,1.,1.);
#endif
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
float alpha=vDiffuseColor.a;
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
vec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);
#include<depthPrePass>
mixColor.rgb*=vTextureInfos.y;vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);vec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);diffuse1Color.rgb*=mixColor.r;diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);diffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);finalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);
#ifdef MIXMAP2
mixColor=texture2D(mixMap2Sampler,vTextureUV);mixColor.rgb*=vTextureInfos.y;vec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);vec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);vec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);vec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);diffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);diffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);diffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);finalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);
#endif
#endif
#ifdef VERTEXCOLOR
finalMixColor.rgb*=vColor.rgb;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[eu]||(u.l.ShadersStore[eu]=ef);let eg="mixVertexShader",em=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;uniform mat4 textureMatrix;uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x==0.)
{vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));}
else
{vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eg]||(u.l.ShadersStore[eg]=em);class ep extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.MIXMAP2=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class ev extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this.specularColor=new a.v9(0,0,0),this.specularPower=64,this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new ep);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(o.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(r._needUVs=!0,h.h.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady()||(r.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady()||!this._diffuseTexture3||!this._diffuseTexture3.isReady()||!this._diffuseTexture4||!this._diffuseTexture4.isReady()))return!1;if(this._mixTexture2&&(!this._mixTexture2.isReady()||(r.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady()||!this._diffuseTexture6||!this._diffuseTexture6.isReady()||!this._diffuseTexture7||!this._diffuseTexture7.isReady()||!this._diffuseTexture8||!this._diffuseTexture8.isReady())))return!1}}if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","textureMatrix","logarithmicDepthConstant","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],h=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("mix",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),h.h.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),h.h.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&e.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&e.push(this._mixTexture2),e}getActiveTextures(){let e=super.getActiveTextures();return this._mixTexture1&&e.push(this._mixTexture1),this._diffuseTexture1&&e.push(this._diffuseTexture1),this._diffuseTexture2&&e.push(this._diffuseTexture2),this._diffuseTexture3&&e.push(this._diffuseTexture3),this._diffuseTexture4&&e.push(this._diffuseTexture4),this._mixTexture2&&e.push(this._mixTexture2),this._diffuseTexture5&&e.push(this._diffuseTexture5),this._diffuseTexture6&&e.push(this._diffuseTexture6),this._diffuseTexture7&&e.push(this._diffuseTexture7),this._diffuseTexture8&&e.push(this._diffuseTexture8),e}hasTexture(e){return!!super.hasTexture(e)||this._mixTexture1===e||this._diffuseTexture1===e||this._diffuseTexture2===e||this._diffuseTexture3===e||this._diffuseTexture4===e||this._mixTexture2===e||this._diffuseTexture5===e||this._diffuseTexture6===e||this._diffuseTexture7===e||this._diffuseTexture8===e||!1}dispose(e){this._mixTexture1&&this._mixTexture1.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new ev(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.MixMaterial",e}getClassName(){return"MixMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new ev(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("mixTexture1")],ev.prototype,"_mixTexture1",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"mixTexture1",void 0),(0,s.Cg)([(0,r.uM)("mixTexture2")],ev.prototype,"_mixTexture2",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"mixTexture2",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture1")],ev.prototype,"_diffuseTexture1",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture1",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture2")],ev.prototype,"_diffuseTexture2",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture2",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture3")],ev.prototype,"_diffuseTexture3",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture3",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture4")],ev.prototype,"_diffuseTexture4",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture4",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture1")],ev.prototype,"_diffuseTexture5",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture5",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture2")],ev.prototype,"_diffuseTexture6",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture6",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture3")],ev.prototype,"_diffuseTexture7",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture7",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture4")],ev.prototype,"_diffuseTexture8",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ev.prototype,"diffuseTexture8",void 0),(0,s.Cg)([(0,r.jT)()],ev.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.jT)()],ev.prototype,"specularColor",void 0),(0,s.Cg)([(0,r.lK)()],ev.prototype,"specularPower",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],ev.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ev.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],ev.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ev.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.MixMaterial",ev);let eb="normalPixelShader",ex=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef LIGHTING
#include<helperFunctions>
#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#endif
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef NORMAL
baseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef LIGHTING
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse= baseColor.rgb;
#endif
vec4 color=vec4(finalDiffuse,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[eb]||(u.l.ShadersStore[eb]=ex);let eC="normalVertexShader",eT=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x==0.)
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}
else
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eC]||(u.l.ShadersStore[eC]=eT);class ey extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.LIGHT0=!1,this.LIGHT1=!1,this.LIGHT2=!1,this.LIGHT3=!1,this.SPOTLIGHT0=!1,this.SPOTLIGHT1=!1,this.SPOTLIGHT2=!1,this.SPOTLIGHT3=!1,this.HEMILIGHT0=!1,this.HEMILIGHT1=!1,this.HEMILIGHT2=!1,this.HEMILIGHT3=!1,this.DIRLIGHT0=!1,this.DIRLIGHT1=!1,this.DIRLIGHT2=!1,this.DIRLIGHT3=!1,this.POINTLIGHT0=!1,this.POINTLIGHT1=!1,this.POINTLIGHT2=!1,this.POINTLIGHT3=!1,this.SHADOW0=!1,this.SHADOW1=!1,this.SHADOW2=!1,this.SHADOW3=!1,this.SHADOWS=!1,this.SHADOWESM0=!1,this.SHADOWESM1=!1,this.SHADOWESM2=!1,this.SHADOWESM3=!1,this.SHADOWPOISSON0=!1,this.SHADOWPOISSON1=!1,this.SHADOWPOISSON2=!1,this.SHADOWPOISSON3=!1,this.SHADOWPCF0=!1,this.SHADOWPCF1=!1,this.SHADOWPCF2=!1,this.SHADOWPCF3=!1,this.SHADOWPCSS0=!1,this.SHADOWPCSS1=!1,this.SHADOWPCSS2=!1,this.SHADOWPCSS3=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.LIGHTING=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class eS extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaBlendingForMesh(e){return this.needAlphaBlending()||e.visibility<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new ey);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._diffuseTexture&&h.h.DiffuseTextureEnabled))if(!this._diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=!0,(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i,null,t.getRenderingMesh().hasThinInstances),r.LIGHTING=!this._disableLighting,(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant"],h=["diffuseSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:4}),t.setEffect(o.getEngine().createEffect("normal",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this.diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),e}hasTexture(e){return!!super.hasTexture(e)||this.diffuseTexture===e}dispose(e){this.diffuseTexture&&this.diffuseTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new eS(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.NormalMaterial",e}getClassName(){return"NormalMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new eS(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],eS.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eS.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.jT)()],eS.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],eS.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eS.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],eS.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eS.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.NormalMaterial",eS),i(72067);let eP="shadowOnlyPixelShader",eI=`precision highp float;
#include<__decl__sceneFragment>
uniform float alpha;uniform vec3 shadowColor;varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#include<lightFragment>[0..1]
vec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[eP]||(u.l.ShadersStore[eP]=eI);let eE="shadowOnlyVertexShader",eR=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
#include<__decl__sceneVertex>
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eE]||(u.l.ShadersStore[eE]=eR);class eM extends n.M{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class ew extends l.E{constructor(e,t){super(e,t),this._needAlphaBlending=!0,this.shadowColor=a.v9.Black()}needAlphaBlending(){return this._needAlphaBlending}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}get activeLight(){return this._activeLight}set activeLight(e){this._activeLight=e}_getFirstShadowLightForMesh(e){for(let t of e.lightSources)if(t.shadowEnabled)return t;return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new eM);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(this._activeLight){for(let t of e.lightSources)if(t.shadowEnabled){if(this._activeLight===t)break;let i=e.lightSources.indexOf(this._activeLight);-1!==i&&(e.lightSources.splice(i,1),e.lightSources.splice(0,0,this._activeLight));break}}(0,x.OR)(o,a,this,r,!!i),(0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,1);let n=this._getFirstShadowLightForMesh(e)?.getShadowGenerator();if(this._needAlphaBlending=!0,n&&n.getClassName&&"CascadedShadowGenerator"===n.getClassName()&&(this._needAlphaBlending=!n.autoCalcDepthBounds),(0,x.qB)(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,1),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","logarithmicDepthConstant"],h=[],d=["Scene"];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:1}),t.setEffect(o.getEngine().createEffect("shadowOnly",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},a),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this.bindViewProjection(o),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&((0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),s.lightsEnabled){(0,x.RL)(s,t,this._activeEffect,r,1);let e=this._getFirstShadowLightForMesh(t);e&&(e._renderId=-1)}(s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE||r.SHADOWCSM0)&&this.bindView(o),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i)}}clone(e){return o.p.Clone(()=>new ew(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.ShadowOnlyMaterial",e}getClassName(){return"ShadowOnlyMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new ew(e.name,t),e,t,i)}}(0,c.Y5)("BABYLON.ShadowOnlyMaterial",ew);let eO="simplePixelShader",eB=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif 
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}`;u.l.ShadersStore[eO]||(u.l.ShadersStore[eO]=eB);let eA="simpleVertexShader",eF=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x==0.)
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}
else
{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eA]||(u.l.ShadersStore[eA]=eF);class eL extends n.M{constructor(){super(),this.DIFFUSE=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class eN extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new eL);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._diffuseTexture&&h.h.DiffuseTextureEnabled))if(!this._diffuseTexture.isReady())return!1;else r._needUVs=!0,r.DIFFUSE=!0;if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","diffuseMatrix","logarithmicDepthConstant"],h=["diffuseSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("simple",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this._diffuseTexture&&h.h.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),e}hasTexture(e){return!!super.hasTexture(e)||this.diffuseTexture===e}dispose(e){this._diffuseTexture&&this._diffuseTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new eN(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.SimpleMaterial",e}getClassName(){return"SimpleMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new eN(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("diffuseTexture")],eN.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eN.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.jT)("diffuse")],eN.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],eN.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eN.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],eN.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eN.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.SimpleMaterial",eN);let eD="skyPixelShader",ek=`precision highp float;varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneFragmentDeclaration>
uniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
const float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)
{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}
vec3 simplifiedRayleigh()
{return 0.0005/vec3(94,40,18);}
float rayleighPhase(float cosTheta)
{ 
return (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}
vec3 totalMie(vec3 lambda,vec3 K,float T)
{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}
float hgPhase(float cosTheta,float g)
{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}
float sunIntensity(float zenithAngleCos)
{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}
float A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)
{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}
#if DITHER
#include<helperFunctions>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
/**
*--------------------------------------------------------------------------------------------------
* Sky Color
*--------------------------------------------------------------------------------------------------
*/
float sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; 
float fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); 
float ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**
*--------------------------------------------------------------------------------------------------
* Sky Color
*--------------------------------------------------------------------------------------------------
*/
float alpha=1.0;
#ifdef VERTEXCOLOR
retColor.rgb*=vColor.rgb;
#endif
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#if DITHER
retColor.rgb+=dither(gl_FragCoord.xy,0.5);
#endif
vec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[eD]||(u.l.ShadersStore[eD]=ek);let eV="skyVertexShader",eU=`precision highp float;attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
uniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<logDepthDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
gl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#ifdef VERTEXCOLOR
vColor=color;
#endif
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eV]||(u.l.ShadersStore[eV]=eU);class ez extends n.M{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class eW extends l.E{constructor(e,t){super(e,t),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new z.Pq(0,100,0),this.useSunPosition=!1,this.cameraOffset=z.Pq.Zero(),this.up=z.Pq.Up(),this.dithering=!1,this._cameraPosition=z.Pq.Zero(),this._skyOrientation=new z.PT}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){let i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new ez);let s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;if((0,x.fm)(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,s,void 0,void 0,void 0,this._setVertexOutputInvariant),(0,x.qB)(e,s,!0,!1),s.IMAGEPROCESSINGPOSTPROCESS!==r.imageProcessingConfiguration.applyByPostProcess&&s.markAsMiscDirty(),s.DITHER!==this.dithering&&s.markAsMiscDirty(),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();let e=new v.J;s.FOG&&e.addFallback(1,"FOG"),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess,s.DITHER=this.dithering;let i=[_.R.PositionKind];s.VERTEXCOLOR&&i.push(_.R.ColorKind);let o=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,b.Ll)(o);let a=s.toString();t.setEffect(r.getEngine().createEffect("sky",i,o,[],a,e,this.onCompiled,this.onError),s,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;if(!o)return;this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._mustRebind(s,o,i)&&((0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s)),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect);let a=s.activeCamera;if(a){let e=a.getWorldMatrix();this._cameraPosition.x=e.m[12],this._cameraPosition.y=e.m[13],this._cameraPosition.z=e.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){let e=Math.PI*(this.inclination-.5),t=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(t)*Math.cos(e),this.sunPosition.y=this.distance*Math.sin(-e),this.sunPosition.z=this.distance*Math.sin(t)*Math.cos(e),z.PT.FromUnitVectorsToRef(z.Pq.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect,i)}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return o.p.Clone(()=>new eW(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.SkyMaterial",e}getClassName(){return"SkyMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new eW(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.lK)()],eW.prototype,"luminance",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"turbidity",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"rayleigh",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"mieCoefficient",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"mieDirectionalG",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"distance",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"inclination",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"azimuth",void 0),(0,s.Cg)([(0,r.P_)()],eW.prototype,"sunPosition",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"useSunPosition",void 0),(0,s.Cg)([(0,r.P_)()],eW.prototype,"cameraOffset",void 0),(0,s.Cg)([(0,r.P_)()],eW.prototype,"up",void 0),(0,s.Cg)([(0,r.lK)()],eW.prototype,"dithering",void 0),(0,c.Y5)("BABYLON.SkyMaterial",eW);let eQ="terrainPixelShader",eG=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef DIFFUSE
varying vec2 vTextureUV;uniform sampler2D textureSampler;uniform vec2 vTextureInfos;uniform sampler2D diffuse1Sampler;uniform sampler2D diffuse2Sampler;uniform sampler2D diffuse3Sampler;uniform vec2 diffuse1Infos;uniform vec2 diffuse2Infos;uniform vec2 diffuse3Infos;
#endif
#ifdef BUMP
uniform sampler2D bump1Sampler;uniform sampler2D bump2Sampler;uniform sampler2D bump3Sampler;
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#ifdef BUMP
#extension GL_OES_standard_derivatives : enable
mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));return mat3(tangent*invmax,binormal*invmax,normal);}
vec3 perturbNormal(vec3 viewDir,vec3 mixColor)
{vec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;vec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;vec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;bump1Color.rgb*=mixColor.r;bump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);vec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);map=map*255./127.-128./127.;mat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);return normalize(TBN*map);}
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
float alpha=vDiffuseColor.a;
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
baseColor=texture2D(textureSampler,vTextureUV);
#if defined(BUMP) && defined(DIFFUSE)
normalW=perturbNormal(viewDirectionW,baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vTextureInfos.y;vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);diffuse1Color.rgb*=baseColor.r;diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);baseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
baseColor.rgb*=vColor.rgb;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[eQ]||(u.l.ShadersStore[eQ]=eG);let eH="terrainVertexShader",eK=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;uniform mat4 textureMatrix;uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<logDepthDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x==0.)
{vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));}
else
{vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));}
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[eH]||(u.l.ShadersStore[eH]=eK);class eX extends n.M{constructor(){super(),this.DIFFUSE=!1,this.BUMP=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class eY extends l.E{constructor(e,t){super(e,t),this.diffuseColor=new a.v9(1,1,1),this.specularColor=new a.v9(0,0,0),this.specularPower=64,this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new eX);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(o.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(r._needUVs=!0,h.h.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady()||!this.diffuseTexture2||!this.diffuseTexture2.isReady()||!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;r.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&h.h.BumpTextureEnabled){if(!this.bumpTexture1.isReady()||!this.bumpTexture2.isReady()||!this.bumpTexture3.isReady())return!1;r._needNormals=!0,r.BUMP=!0}}if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],h=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler","logarithmicDepthConstant","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("terrain",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",s.getViewMatrix()),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),h.h.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),h.h.BumpTextureEnabled&&s.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._mixTexture&&e.push(this._mixTexture),this._diffuseTexture1&&e.push(this._diffuseTexture1),this._diffuseTexture2&&e.push(this._diffuseTexture2),this._diffuseTexture3&&e.push(this._diffuseTexture3),this._bumpTexture1&&e.push(this._bumpTexture1),this._bumpTexture2&&e.push(this._bumpTexture2),this._bumpTexture3&&e.push(this._bumpTexture3),e}hasTexture(e){return!!super.hasTexture(e)||this._mixTexture===e||this._diffuseTexture1===e||this._diffuseTexture2===e||this._diffuseTexture3===e||this._bumpTexture1===e||this._bumpTexture2===e||this._bumpTexture3===e||!1}dispose(e){this.mixTexture&&this.mixTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new eY(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.TerrainMaterial",e}getClassName(){return"TerrainMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new eY(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)("mixTexture")],eY.prototype,"_mixTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"mixTexture",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture1")],eY.prototype,"_diffuseTexture1",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"diffuseTexture1",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture2")],eY.prototype,"_diffuseTexture2",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"diffuseTexture2",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexture3")],eY.prototype,"_diffuseTexture3",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"diffuseTexture3",void 0),(0,s.Cg)([(0,r.uM)("bumpTexture1")],eY.prototype,"_bumpTexture1",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"bumpTexture1",void 0),(0,s.Cg)([(0,r.uM)("bumpTexture2")],eY.prototype,"_bumpTexture2",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"bumpTexture2",void 0),(0,s.Cg)([(0,r.uM)("bumpTexture3")],eY.prototype,"_bumpTexture3",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],eY.prototype,"bumpTexture3",void 0),(0,s.Cg)([(0,r.jT)()],eY.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.jT)()],eY.prototype,"specularColor",void 0),(0,s.Cg)([(0,r.lK)()],eY.prototype,"specularPower",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],eY.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eY.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],eY.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],eY.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.TerrainMaterial",eY);let eq="triplanarPixelShader",ej=`precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
varying vec3 vPositionW;
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef DIFFUSEX
varying vec2 vTextureUVX;uniform sampler2D diffuseSamplerX;
#ifdef BUMPX
uniform sampler2D normalSamplerX;
#endif
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;uniform sampler2D diffuseSamplerY;
#ifdef BUMPY
uniform sampler2D normalSamplerY;
#endif
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;uniform sampler2D diffuseSamplerZ;
#ifdef BUMPZ
uniform sampler2D normalSamplerZ;
#endif
#endif
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(0.,0.,0.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef NORMAL
vec3 normalW=tangentSpace[2];
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
vec4 baseNormal=vec4(0.0,0.0,0.0,1.0);normalW*=normalW;
#ifdef DIFFUSEX
baseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;
#ifdef BUMPX
baseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;
#endif
#endif
#ifdef DIFFUSEY
baseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;
#ifdef BUMPY
baseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;
#endif
#endif
#ifdef DIFFUSEZ
baseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;
#ifdef BUMPZ
baseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;
#endif
#endif
#ifdef NORMAL
normalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
baseColor.rgb*=vColor.rgb;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularBase=vec3(0.,0.,0.);vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[eq]||(u.l.ShadersStore[eq]=ej);let e$="triplanarVertexShader",eZ=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef DIFFUSEX
varying vec2 vTextureUVX;
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;
#endif
uniform float tileSize;
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<logDepthDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);
#ifdef DIFFUSEX
vTextureUVX=worldPos.zy/tileSize;
#endif
#ifdef DIFFUSEY
vTextureUVY=worldPos.xz/tileSize;
#endif
#ifdef DIFFUSEZ
vTextureUVZ=worldPos.xy/tileSize;
#endif
#ifdef NORMAL
vec3 xtan=vec3(0,0,1);vec3 xbin=vec3(0,1,0);vec3 ytan=vec3(1,0,0);vec3 ybin=vec3(0,0,1);vec3 ztan=vec3(1,0,0);vec3 zbin=vec3(0,1,0);vec3 normalizedNormal=normalize(normal);normalizedNormal*=normalizedNormal;vec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);vec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
worldTangent=normalize((normalWorld*worldTangent).xyz);worldBinormal=normalize((normalWorld*worldBinormal).xyz);vec3 worldNormal=normalize((normalWorld*normalize(normal)).xyz);tangentSpace[0]=worldTangent;tangentSpace[1]=worldBinormal;tangentSpace[2]=worldNormal;
#endif
#include<clipPlaneVertex>
#include<logDepthVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[e$]||(u.l.ShadersStore[e$]=eZ);class eJ extends n.M{constructor(){super(),this.DIFFUSEX=!1,this.DIFFUSEY=!1,this.DIFFUSEZ=!1,this.BUMPX=!1,this.BUMPY=!1,this.BUMPZ=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.NORMAL=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.NONUNIFORMSCALING=!1,this.LOGARITHMICDEPTH=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}}class e0 extends l.E{constructor(e,t){super(e,t),this.tileSize=1,this.diffuseColor=new a.v9(1,1,1),this.specularColor=new a.v9(.2,.2,.2),this.specularPower=64,this._disableLighting=!1,this._maxSimultaneousLights=4}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new eJ);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&o.texturesEnabled){if(h.h.DiffuseTextureEnabled){let e=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],t=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"];for(let i=0;i<e.length;i++)if(e[i])if(!e[i].isReady())return!1;else r[t[i]]=!0}if(h.h.BumpTextureEnabled){let e=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],t=["BUMPX","BUMPY","BUMPZ"];for(let i=0;i<e.length;i++)if(e[i])if(!e[i].isReady())return!1;else r[t[i]]=!0}}if((0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._needNormals=(0,x.az)(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),(0,x.OR)(o,a,this,r,!!i),(0,x.qB)(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","tileSize"],h=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ","logarithmicDepthConstant","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=[];(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("triplanar",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),r,this._materialContext)}if(r.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),this._mustRebind(s,o,i)&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),this._afterBind(t,this._activeEffect,i))}getAnimatables(){let e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTextureX&&e.push(this._diffuseTextureX),this._diffuseTextureY&&e.push(this._diffuseTextureY),this._diffuseTextureZ&&e.push(this._diffuseTextureZ),this._normalTextureX&&e.push(this._normalTextureX),this._normalTextureY&&e.push(this._normalTextureY),this._normalTextureZ&&e.push(this._normalTextureZ),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTextureX===e||this._diffuseTextureY===e||this._diffuseTextureZ===e||this._normalTextureX===e||this._normalTextureY===e||this._normalTextureZ===e||!1}dispose(e){this.mixTexture&&this.mixTexture.dispose(),super.dispose(e)}clone(e){return o.p.Clone(()=>new e0(e,this.getScene()),this)}serialize(){let e=super.serialize();return e.customType="BABYLON.TriPlanarMaterial",e}getClassName(){return"TriPlanarMaterial"}static Parse(e,t,i){return o.p.Parse(()=>new e0(e.name,t),e,t,i)}}(0,s.Cg)([(0,r.uM)()],e0.prototype,"mixTexture",void 0),(0,s.Cg)([(0,r.uM)("diffuseTextureX")],e0.prototype,"_diffuseTextureX",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"diffuseTextureX",void 0),(0,s.Cg)([(0,r.uM)("diffuseTexturY")],e0.prototype,"_diffuseTextureY",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"diffuseTextureY",void 0),(0,s.Cg)([(0,r.uM)("diffuseTextureZ")],e0.prototype,"_diffuseTextureZ",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"diffuseTextureZ",void 0),(0,s.Cg)([(0,r.uM)("normalTextureX")],e0.prototype,"_normalTextureX",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"normalTextureX",void 0),(0,s.Cg)([(0,r.uM)("normalTextureY")],e0.prototype,"_normalTextureY",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"normalTextureY",void 0),(0,s.Cg)([(0,r.uM)("normalTextureZ")],e0.prototype,"_normalTextureZ",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],e0.prototype,"normalTextureZ",void 0),(0,s.Cg)([(0,r.lK)()],e0.prototype,"tileSize",void 0),(0,s.Cg)([(0,r.jT)()],e0.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.jT)()],e0.prototype,"specularColor",void 0),(0,s.Cg)([(0,r.lK)()],e0.prototype,"specularPower",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],e0.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],e0.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],e0.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],e0.prototype,"maxSimultaneousLights",void 0),(0,c.Y5)("BABYLON.TriPlanarMaterial",e0);var e1=i(54101),e2=i(72500),e3=i(85082),e4=i(73467),e5=i(56008);i(9937),i(64608);let e9="waterPixelShader",e8=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<helperFunctions>
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#ifdef BUMP
varying vec2 vNormalUV;
#ifdef BUMPSUPERIMPOSE
varying vec2 vNormalUV2;
#endif
uniform sampler2D normalSampler;uniform vec2 vNormalInfos;
#endif
uniform sampler2D refractionSampler;uniform sampler2D reflectionSampler;const float LOG2=1.442695;uniform vec3 cameraPosition;uniform vec4 waterColor;uniform float colorBlendFactor;uniform vec4 waterColor2;uniform float colorBlendFactor2;uniform float bumpHeight;uniform float time;varying vec3 vRefractionMapTexCoord;varying vec3 vReflectionMapTexCoord;
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef BUMP
#ifdef BUMPSUPERIMPOSE
baseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));
#else
baseColor=texture2D(normalSampler,vNormalUV);
#endif
vec3 bumpColor=baseColor.rgb;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
baseColor.rgb*=vNormalInfos.y;
#else
vec3 bumpColor=vec3(1.0);
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
baseColor.rgb*=vColor.rgb;
#endif
#ifdef NORMAL
vec2 perturbation=bumpHeight*(baseColor.rg-0.5);
#ifdef BUMPAFFECTSREFLECTION
vec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));if (normalW.y<0.0) {normalW.y=-normalW.y;}
#else
vec3 normalW=normalize(vNormalW);
#endif
#else
vec3 normalW=vec3(1.0,1.0,1.0);vec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);
#endif
#ifdef FRESNELSEPARATE
#ifdef REFLECTION
vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
#ifdef IS_REFRACTION_LINEAR
refractiveColor.rgb=toGammaSpace(refractiveColor.rgb);
#endif
vec2 projectedReflectionTexCoords=vec2(
vReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,
vReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y
);vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
#ifdef IS_REFLECTION_LINEAR
reflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);
#endif
vec3 upVector=vec3(0.0,1.0,0.0);float fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);float IfresnelTerm=1.0-fresnelTerm;refractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;reflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;baseColor=combinedColor;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularBase=vec3(0.,0.,0.);vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#else 
#ifdef REFLECTION
vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
#ifdef IS_REFRACTION_LINEAR
refractiveColor.rgb=toGammaSpace(refractiveColor.rgb);
#endif
vec2 projectedReflectionTexCoords=vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation;vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
#ifdef IS_REFLECTION_LINEAR
reflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);
#endif
vec3 upVector=vec3(0.0,1.0,0.0);float fresnelTerm=max(dot(viewDirectionW,upVector),0.0);vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);baseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularBase=vec3(0.,0.,0.);vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#endif
vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#elif defined(IMAGEPROCESSING)
color.rgb=toLinearSpace(color.rgb);color=applyImageProcessing(color);
#endif
gl_FragColor=color;
#define CUSTOM_FRAGMENT_MAIN_END
}
`;u.l.ShadersStore[e9]||(u.l.ShadersStore[e9]=e8);let e7="waterVertexShader",e6=`precision highp float;attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
uniform mat4 view;uniform mat4 viewProjection;
#ifdef BUMP
varying vec2 vNormalUV;
#ifdef BUMPSUPERIMPOSE
varying vec2 vNormalUV2;
#endif
uniform mat4 normalMatrix;uniform vec2 vNormalInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<logDepthDeclaration>
uniform mat4 reflectionViewProjection;uniform vec2 windDirection;uniform float waveLength;uniform float time;uniform float windForce;uniform float waveHeight;uniform float waveSpeed;uniform float waveCount;varying vec3 vRefractionMapTexCoord;varying vec3 vReflectionMapTexCoord;
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef BUMP
if (vNormalInfos.x==0.)
{vNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));
#endif
}
else
{vNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));
#endif
}
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
float finalWaveCount=1.0/(waveCount*0.5);
#ifdef USE_WORLD_COORDINATES
vec3 p=worldPos.xyz;
#else
vec3 p=position;
#endif
float newY=(sin(((p.x/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.x*5.0)
+ (cos(((p.z/finalWaveCount)+ time*waveSpeed))*waveHeight*windDirection.y*5.0);p.y+=abs(newY);
#ifdef USE_WORLD_COORDINATES
gl_Position=viewProjection*vec4(p,1.0);
#else
gl_Position=viewProjection*finalWorld*vec4(p,1.0);
#endif
#ifdef REFLECTION
vRefractionMapTexCoord.x=0.5*(gl_Position.w+gl_Position.x);vRefractionMapTexCoord.y=0.5*(gl_Position.w+gl_Position.y);vRefractionMapTexCoord.z=gl_Position.w;worldPos=reflectionViewProjection*finalWorld*vec4(position,1.0);vReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);vReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);vReflectionMapTexCoord.z=worldPos.w;
#endif
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;u.l.ShadersStore[e7]||(u.l.ShadersStore[e7]=e6);var te=i(93558);i(59840);class tt extends n.M{constructor(){super(),this.BUMP=!1,this.REFLECTION=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.SPECULARTERM=!1,this.LOGARITHMICDEPTH=!1,this.USE_REVERSE_DEPTHBUFFER=!1,this.FRESNELSEPARATE=!1,this.BUMPSUPERIMPOSE=!1,this.BUMPAFFECTSREFLECTION=!1,this.USE_WORLD_COORDINATES=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}class ti extends l.E{get hasRenderTargetTextures(){return!0}constructor(e,t,i=new z.I9(512,512)){super(e,t),this.renderTargetSize=i,this.diffuseColor=new a.v9(1,1,1),this.specularColor=new a.v9(0,0,0),this.specularPower=64,this._disableLighting=!1,this._maxSimultaneousLights=4,this.windForce=6,this.windDirection=new z.I9(0,1),this.waveHeight=.4,this.bumpHeight=.4,this._bumpSuperimpose=!1,this._fresnelSeparate=!1,this._bumpAffectsReflection=!1,this.waterColor=new a.v9(.1,.1,.6),this.colorBlendFactor=.2,this.waterColor2=new a.v9(.1,.1,.6),this.colorBlendFactor2=.2,this.waveLength=.1,this.waveSpeed=1,this.waveCount=20,this.disableClipPlane=!1,this._useWorldCoordinatesForWaveDeformation=!1,this._renderTargets=new e3.L(16),this._mesh=null,this._reflectionTransform=z.uq.Zero(),this._lastTime=0,this._lastDeltaTime=0,this._createRenderTargets(this.getScene(),i),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),this._renderTargets.push(this._reflectionRTT),this._renderTargets.push(this._refractionRTT),this._renderTargets),this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()}))}get refractionTexture(){return this._refractionRTT}get reflectionTexture(){return this._reflectionRTT}addToRenderList(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)}removeFromRenderList(e){if(this._refractionRTT&&this._refractionRTT.renderList){let t=this._refractionRTT.renderList.indexOf(e);-1!==t&&this._refractionRTT.renderList.splice(t,1)}if(this._reflectionRTT&&this._reflectionRTT.renderList){let t=this._reflectionRTT.renderList.indexOf(e);-1!==t&&this._reflectionRTT.renderList.splice(t,1)}}enableRenderTargets(e){let t=+!!e;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)}getRenderList(){return this._refractionRTT?this._refractionRTT.renderList:[]}get renderTargetsEnabled(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,i){let s=t._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new tt);let r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;let a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled)){if(this.bumpTexture&&h.h.BumpTextureEnabled)if(!this.bumpTexture.isReady())return!1;else r._needUVs=!0,r.BUMP=!0;h.h.ReflectionTextureEnabled&&(r.REFLECTION=!0)}if((0,x.OR)(o,a,this,r,!!i),(0,x.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),r,void 0,void 0,void 0,this._setVertexOutputInvariant),r._areMiscDirty&&(r.FRESNELSEPARATE=this._fresnelSeparate,r.BUMPSUPERIMPOSE=this._bumpSuperimpose,r.BUMPAFFECTSREFLECTION=this._bumpAffectsReflection,r.USE_WORLD_COORDINATES=this._useWorldCoordinatesForWaveDeformation),r._needNormals=(0,x.az)(o,e,r,!0,this._maxSimultaneousLights,this._disableLighting),r._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(r),r.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,r.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if((0,x.qB)(e,r,!0,!0),this._mesh=e,this._waitingRenderList){for(let e=0;e<this._waitingRenderList.length;e++)this.addToRenderList(o.getNodeById(this._waitingRenderList[e]));this._waitingRenderList=null}if(r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();let i=new v.J;r.FOG&&i.addFallback(1,"FOG"),r.LOGARITHMICDEPTH&&i.addFallback(0,"LOGARITHMICDEPTH"),(0,x.c4)(r,i,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,e);let s=[_.R.PositionKind];r.NORMAL&&s.push(_.R.NormalKind),r.UV1&&s.push(_.R.UVKind),r.UV2&&s.push(_.R.UV2Kind),r.VERTEXCOLOR&&s.push(_.R.ColorKind),(0,x.ni)(s,e,r,i),(0,x.ER)(s,r);let n=r.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","normalMatrix","logarithmicDepthConstant","reflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed","waveCount"],h=["normalSampler","refractionSampler","reflectionSampler"],d=[];e5.p&&(e5.p.PrepareUniforms(l,r),e5.p.PrepareSamplers(h,r)),(0,b.Ll)(l),(0,x.Bb)({uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("water",{attributes:s,uniformsNames:l,uniformBuffersNames:d,samplers:h,defines:n,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},a),r,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(r._renderId=o.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=!!i,!0)}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let o=i.effect;if(!o||!this._mesh)return;this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),(0,x.f$)(t,this._activeEffect),this._mustRebind(s,o,i)&&(this.bumpTexture&&h.h.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),(0,b.ij)(o,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.DL)(r,o,s),s.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),s.lightsEnabled&&!this.disableLighting&&(0,x.RL)(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,x.Yy)(s,t,this._activeEffect),(0,x.DL)(r,this._activeEffect,s),h.h.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));let a=this._reflectionTransform.multiply(s.getProjectionMatrix()),n=s.getEngine().getDeltaTime();n!==this._lastDeltaTime&&(this._lastDeltaTime=n,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("reflectionViewProjection",a),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._activeEffect.setFloat("waveCount",this.waveCount),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(t,this._activeEffect,i)}_createRenderTargets(e,t){let i,s;this._refractionRTT=new e4.$(name+"_refraction",{width:t.x,height:t.y},e,!1,!0),this._refractionRTT.wrapU=e2.Y.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=e2.Y.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0;let r=!1;this._refractionRTT.onBeforeRenderObservable.add(()=>{r=e.getBoundingBoxRenderer().enabled,e.getBoundingBoxRenderer().enabled=!1}),this._refractionRTT.onAfterRenderObservable.add(()=>{e.getBoundingBoxRenderer().enabled=r}),this._reflectionRTT=new e4.$(name+"_reflection",{width:t.x,height:t.y},e,!1,!0),this._reflectionRTT.wrapU=e2.Y.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=e2.Y.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;let o=null,a=z.uq.Zero();this._refractionRTT.onBeforeRender=()=>{if(this._mesh&&(i=this._mesh.isVisible,this._mesh.isVisible=!1),!this.disableClipPlane){o=e.clipPlane;let t=this._mesh?this._mesh.absolutePosition.y:0;e.clipPlane=e1.Z.FromPositionAndNormal(new z.Pq(0,t+.05,0),new z.Pq(0,1,0))}},this._refractionRTT.onAfterRender=()=>{this._mesh&&(this._mesh.isVisible=i),this.disableClipPlane||(e.clipPlane=o)},this._reflectionRTT.onBeforeRender=()=>{if(this._mesh&&(i=this._mesh.isVisible,this._mesh.isVisible=!1),!this.disableClipPlane){o=e.clipPlane;let t=this._mesh?this._mesh.absolutePosition.y:0;e.clipPlane=e1.Z.FromPositionAndNormal(new z.Pq(0,t-.05,0),new z.Pq(0,-1,0)),z.uq.ReflectionToRef(e.clipPlane,a)}s=e.getViewMatrix(),a.multiplyToRef(s,this._reflectionTransform),e.setTransformMatrix(this._reflectionTransform,e.getProjectionMatrix()),e._mirroredCameraPosition=z.Pq.TransformCoordinates(e.activeCamera.position,a)},this._reflectionRTT.onAfterRender=()=>{this._mesh&&(this._mesh.isVisible=i),e.clipPlane=o,e.setTransformMatrix(s,e.getProjectionMatrix()),e._mirroredCameraPosition=null}}getAnimatables(){let e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e}getActiveTextures(){let e=super.getActiveTextures();return this._bumpTexture&&e.push(this._bumpTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._bumpTexture===e}dispose(e){this.bumpTexture&&this.bumpTexture.dispose();let t=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=t&&this.getScene().customRenderTargets.splice(t,1),t=-1,-1!=(t=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(t,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e)}clone(e){return o.p.Clone(()=>new ti(e,this.getScene()),this)}serialize(){let e=super.serialize();if(e.customType="BABYLON.WaterMaterial",e.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(let t=0;t<this._refractionRTT.renderList.length;t++)e.renderList.push(this._refractionRTT.renderList[t].id);return e}getClassName(){return"WaterMaterial"}static Parse(e,t,i){let s=o.p.Parse(()=>new ti(e.name,t),e,t,i);return s._waitingRenderList=e.renderList,s}static CreateDefaultMesh(e,t){return(0,te.km)(e,{width:512,height:512,subdivisions:32,updatable:!1},t)}}(0,s.Cg)([(0,r.uM)("bumpTexture")],ti.prototype,"_bumpTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],ti.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,r.jT)()],ti.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.jT)()],ti.prototype,"specularColor",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"specularPower",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],ti.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ti.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],ti.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],ti.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"windForce",void 0),(0,s.Cg)([(0,r.WM)()],ti.prototype,"windDirection",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"waveHeight",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"bumpHeight",void 0),(0,s.Cg)([(0,r.lK)("bumpSuperimpose")],ti.prototype,"_bumpSuperimpose",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],ti.prototype,"bumpSuperimpose",void 0),(0,s.Cg)([(0,r.lK)("fresnelSeparate")],ti.prototype,"_fresnelSeparate",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],ti.prototype,"fresnelSeparate",void 0),(0,s.Cg)([(0,r.lK)("bumpAffectsReflection")],ti.prototype,"_bumpAffectsReflection",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],ti.prototype,"bumpAffectsReflection",void 0),(0,s.Cg)([(0,r.jT)()],ti.prototype,"waterColor",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"colorBlendFactor",void 0),(0,s.Cg)([(0,r.jT)()],ti.prototype,"waterColor2",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"colorBlendFactor2",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"waveLength",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"waveSpeed",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"waveCount",void 0),(0,s.Cg)([(0,r.lK)()],ti.prototype,"disableClipPlane",void 0),(0,s.Cg)([(0,r.lK)("useWorldCoordinatesForWaveDeformation")],ti.prototype,"_useWorldCoordinatesForWaveDeformation",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],ti.prototype,"useWorldCoordinatesForWaveDeformation",void 0),(0,c.Y5)("BABYLON.WaterMaterial",ti)},87773:(e,t,i)=>{i.r(t),i.d(t,{msdfPixelShaderWGSL:()=>a});var s=i(52019);let r="msdfPixelShader",o=`var fontAtlas: texture_2d<f32>;var fontAtlasSampler: sampler;uniform uColor: vec4f;uniform thickness: f32;uniform uStrokeColor: vec4f;uniform uStrokeInsetWidth: f32;uniform uStrokeOutsetWidth: f32;varying atlasUV: vec2f;fn median(msdf: vec3<f32>)->f32 {let a=min(msdf.r,msdf.g);let b=max(msdf.r,msdf.g);return max(a,min(b,msdf.b));}
@fragment
fn main(input: FragmentInputs)->FragmentOutputs {let s=textureSample(fontAtlas,fontAtlasSampler,input.atlasUV).rgb;let sigDist=median(s)-0.5+uniforms.thickness;let afwidth=length(vec2<f32>(dpdx(sigDist),dpdy(sigDist)));let alpha=clamp(sigDist/afwidth+0.5,0.0,1.0);let sigDistOutset=sigDist+uniforms.uStrokeOutsetWidth*0.5;let sigDistInset=sigDist-uniforms.uStrokeInsetWidth*0.5;let afwidthOutset=length(vec2<f32>(dpdx(sigDistOutset),dpdy(sigDistOutset)));let afwidthInset=length(vec2<f32>(dpdx(sigDistInset),dpdy(sigDistInset)));let outset=clamp(sigDistOutset/afwidthOutset+0.5,0.0,1.0);let inset=1.0-clamp(sigDistInset/afwidthInset+0.5,0.0,1.0);let border=outset*inset;let filledFragColor=vec4<f32>(uniforms.uColor.rgb,alpha*uniforms.uColor.a);let strokedFragColor=vec4<f32>(uniforms.uStrokeColor.rgb,border*uniforms.uStrokeColor.a);fragmentOutputs.color=mix(filledFragColor,strokedFragColor,border);}`;s.l.ShadersStoreWGSL[r]||(s.l.ShadersStoreWGSL[r]=o);let a={name:r,shader:o}}}]);